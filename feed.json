{
    "version": "https://jsonfeed.org/version/1",
    "title": "藏器于身",
    "subtitle": "待时而动",
    "icon": "https://gality.cn/images/favicon.ico",
    "description": "安全杂记 & 日常随感",
    "home_page_url": "https://gality.cn",
    "items": [
        {
            "id": "https://gality.cn/misc/trail-and-error/ubuntu%E6%89%A9%E5%AE%B9/",
            "url": "https://gality.cn/misc/trail-and-error/ubuntu%E6%89%A9%E5%AE%B9/",
            "title": "Ubuntu虚拟机扩展磁盘 ｜ 命令行 | LVM",
            "date_published": "2024-03-25T12:13:23.000Z",
            "content_html": "<div class=\"note primary no-icon\">\n<p>🎯 给虚拟机新增一个磁盘空间并挂载到根目录上</p>\n</div>\n<h1 id=\"分配空间\"><a class=\"anchor\" href=\"#分配空间\">#</a> 分配空间</h1>\n<p>首先需要在 VMware Fusion 中给虚拟机分配空间：</p>\n<ol>\n<li>删除所有快照并关闭虚拟机</li>\n<li>「设置」=&gt; 「硬盘」=&gt; 「磁盘大小」</li>\n<li>调整为合适的值（这里我调整为 80G，这个值是虚拟机所能使用的最大磁盘大小，而非是新增的大小）</li>\n</ol>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ht0fvd.png\" alt=\"虚拟机设置\" /></p>\n<h1 id=\"ubuntu挂载空间\"><a class=\"anchor\" href=\"#ubuntu挂载空间\">#</a> Ubuntu 挂载空间</h1>\n<p>完成分配后，虚拟机 “看” 到的磁盘变大了，但由于还没有分配 &amp; 挂载，所以此时，Ubuntu 并不能直接使用这片空间，还需进行如下配置。</p>\n<h2 id=\"确认使用了lvm\"><a class=\"anchor\" href=\"#确认使用了lvm\">#</a> 确认使用了 LVM</h2>\n<p>Ubuntu Server 使用 <code>Logical Volume Management</code>  技术来管理磁盘分区，可以在不停止系统服务的前提下，就能动态增加硬盘空间。使用如下命令：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">df</span> <span class=\"token parameter variable\">-h</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Filesystem                         Size  Used Avail Use% Mounted on</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>udev                               <span class=\"token number\">2</span>.5G     <span class=\"token number\">0</span>  <span class=\"token number\">2</span>.5G   <span class=\"token number\">0</span>% /dev</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tmpfs                              590M  <span class=\"token number\">1</span>.6M  589M   <span class=\"token number\">1</span>% /run</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>/dev/mapper/ubuntu--vg-ubuntu--lv   19G   14G  <span class=\"token number\">4</span>.6G  <span class=\"token number\">75</span>% /</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tmpfs                              <span class=\"token number\">2</span>.9G     <span class=\"token number\">0</span>  <span class=\"token number\">2</span>.9G   <span class=\"token number\">0</span>% /dev/shm</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>tmpfs                              <span class=\"token number\">5</span>.0M     <span class=\"token number\">0</span>  <span class=\"token number\">5</span>.0M   <span class=\"token number\">0</span>% /run/lock</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>tmpfs                              <span class=\"token number\">2</span>.9G     <span class=\"token number\">0</span>  <span class=\"token number\">2</span>.9G   <span class=\"token number\">0</span>% /sys/fs/cgroup</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>/dev/sda2                          <span class=\"token number\">2</span>.0G  <span class=\"token number\">1</span>.1G  780M  <span class=\"token number\">58</span>% /boot</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>/dev/loop0                          64M   64M     <span class=\"token number\">0</span> <span class=\"token number\">100</span>% /snap/core20/1828</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>/dev/loop2                          50M   50M     <span class=\"token number\">0</span> <span class=\"token number\">100</span>% /snap/snapd/18357</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>/dev/loop1                          92M   92M     <span class=\"token number\">0</span> <span class=\"token number\">100</span>% /snap/lxd/24061</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>tmpfs                              590M     <span class=\"token number\">0</span>  590M   <span class=\"token number\">0</span>% /run/user/0</pre></td></tr></table></figure><p>看组名是 <code>ubuntu--vg-ubuntu--lv</code> ，确定使用了 LVM</p>\n<h2 id=\"创建新的物理卷\"><a class=\"anchor\" href=\"#创建新的物理卷\">#</a> 创建新的物理卷</h2>\n<p>创建个 sda4，把新增的空闲空间搞成一个分区好了</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$sudo</span> <span class=\"token function\">parted</span> /dev/sda</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GNU Parted <span class=\"token number\">3.3</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Using /dev/sda</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Welcome to GNU Parted<span class=\"token operator\">!</span> Type <span class=\"token string\">'help'</span> to view a list of commands.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 打印磁盘使用情况，可以看到有 42.9GB 的空闲空间</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">(</span>parted<span class=\"token punctuation\">)</span> print <span class=\"token function\">free</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Model: VMware, VMware Virtual S <span class=\"token punctuation\">(</span>scsi<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Disk /dev/sda: <span class=\"token number\">85</span>.9GB</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Sector size <span class=\"token punctuation\">(</span>logical/physical<span class=\"token punctuation\">)</span>: 512B/512B</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Partition Table: gpt</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Disk Flags:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Number  Start   End     Size    File system  Name  Flags</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token number\">17</span>.4kB  1049kB  1031kB  Free Space</pre></td></tr><tr><td data-num=\"14\"></td><td><pre> <span class=\"token number\">1</span>      1049kB  2097kB  1049kB                        bios_grub</pre></td></tr><tr><td data-num=\"15\"></td><td><pre> <span class=\"token number\">2</span>      2097kB  2150MB  2147MB  ext4</pre></td></tr><tr><td data-num=\"16\"></td><td><pre> <span class=\"token number\">3</span>      2150MB  <span class=\"token number\">42</span>.9GB  <span class=\"token number\">40</span>.8GB</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token number\">42</span>.9GB  <span class=\"token number\">85</span>.9GB  <span class=\"token number\">42</span>.9GB  Free Space</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># 创建新分区        </span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">(</span>parted<span class=\"token punctuation\">)</span> mkpart primary ext4 <span class=\"token number\">42</span>.9GB <span class=\"token number\">100</span>%</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">(</span>parted<span class=\"token punctuation\">)</span> print <span class=\"token function\">free</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Model: VMware, VMware Virtual S <span class=\"token punctuation\">(</span>scsi<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Disk /dev/sda: <span class=\"token number\">85</span>.9GB</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>Sector size <span class=\"token punctuation\">(</span>logical/physical<span class=\"token punctuation\">)</span>: 512B/512B</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>Partition Table: gpt</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>Disk Flags:</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Number  Start   End     Size    File system  Name     Flags</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token number\">17</span>.4kB  1049kB  1031kB  Free Space</pre></td></tr><tr><td data-num=\"28\"></td><td><pre> <span class=\"token number\">1</span>      1049kB  2097kB  1049kB                        bios_grub</pre></td></tr><tr><td data-num=\"29\"></td><td><pre> <span class=\"token number\">2</span>      2097kB  2150MB  2147MB  ext4</pre></td></tr><tr><td data-num=\"30\"></td><td><pre> <span class=\"token number\">3</span>      2150MB  <span class=\"token number\">42</span>.9GB  <span class=\"token number\">40</span>.8GB</pre></td></tr><tr><td data-num=\"31\"></td><td><pre> <span class=\"token number\">4</span>      <span class=\"token number\">42</span>.9GB  <span class=\"token number\">85</span>.9GB  <span class=\"token number\">42</span>.9GB               primary</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token number\">85</span>.9GB  <span class=\"token number\">85</span>.9GB  1032kB  Free Space</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">(</span>parted<span class=\"token punctuation\">)</span> quit</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\"># 创建了一个 ext4 类型主分区。设备路径是 /dev/sda4</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token variable\">$sudo</span> pvcreate /dev/sda4</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  Physical volume <span class=\"token string\">\"/dev/sda4\"</span> successfully created.</pre></td></tr></table></figure><h2 id=\"把ubuntu-vg组扩展到devsda4上\"><a class=\"anchor\" href=\"#把ubuntu-vg组扩展到devsda4上\">#</a> 把 ubuntu-vg 组扩展到 /dev/sda4 上</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$sudo</span> vgextend ubuntu-vg /dev/sda4</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  Volume group <span class=\"token string\">\"ubuntu-vg\"</span> successfully extended</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$sudo</span> lvm lvextend <span class=\"token parameter variable\">-l</span> +100%FREE /dev/ubuntu-vg/ubuntu-lv</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  Size of logical volume ubuntu-vg/ubuntu-lv changed from <span class=\"token operator\">&lt;</span><span class=\"token number\">19.00</span> GiB <span class=\"token punctuation\">(</span><span class=\"token number\">4863</span> extents<span class=\"token punctuation\">)</span> to <span class=\"token number\">77</span> GiB <span class=\"token punctuation\">(</span><span class=\"token number\">19964</span> extents<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  Logical volume ubuntu-vg/ubuntu-lv successfully resized.</pre></td></tr></table></figure><h2 id=\"扩展文件系统\"><a class=\"anchor\" href=\"#扩展文件系统\">#</a> 扩展文件系统</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">$sudo</span> resize2fs <span class=\"token parameter variable\">-p</span> /dev/mapper/ubuntu--vg-ubuntu--lv</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>resize2fs <span class=\"token number\">1.45</span>.5 <span class=\"token punctuation\">(</span>07-Jan-2020<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Filesystem at /dev/mapper/ubuntu--vg-ubuntu--lv is mounted on /<span class=\"token punctuation\">;</span> on-line resizing required</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>old_desc_blocks <span class=\"token operator\">=</span> <span class=\"token number\">3</span>, new_desc_blocks <span class=\"token operator\">=</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>The filesystem on /dev/mapper/ubuntu--vg-ubuntu--lv is now <span class=\"token number\">10221568</span> <span class=\"token punctuation\">(</span>4k<span class=\"token punctuation\">)</span> blocks long.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">$df</span> <span class=\"token parameter variable\">-h</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Filesystem                         Size  Used Avail Use% Mounted on</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>udev                               <span class=\"token number\">2</span>.5G     <span class=\"token number\">0</span>  <span class=\"token number\">2</span>.5G   <span class=\"token number\">0</span>% /dev</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>tmpfs                              590M  <span class=\"token number\">1</span>.6M  589M   <span class=\"token number\">1</span>% /run</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>/dev/mapper/ubuntu--vg-ubuntu--lv   77G   14G   63G  <span class=\"token number\">18</span>% /</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>tmpfs                              <span class=\"token number\">2</span>.9G     <span class=\"token number\">0</span>  <span class=\"token number\">2</span>.9G   <span class=\"token number\">0</span>% /dev/shm</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>tmpfs                              <span class=\"token number\">5</span>.0M     <span class=\"token number\">0</span>  <span class=\"token number\">5</span>.0M   <span class=\"token number\">0</span>% /run/lock</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>tmpfs                              <span class=\"token number\">2</span>.9G     <span class=\"token number\">0</span>  <span class=\"token number\">2</span>.9G   <span class=\"token number\">0</span>% /sys/fs/cgroup</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>/dev/sda2                          <span class=\"token number\">2</span>.0G  <span class=\"token number\">1</span>.1G  780M  <span class=\"token number\">58</span>% /boot</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>/dev/loop0                          64M   64M     <span class=\"token number\">0</span> <span class=\"token number\">100</span>% /snap/core20/1828</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>/dev/loop2                          50M   50M     <span class=\"token number\">0</span> <span class=\"token number\">100</span>% /snap/snapd/18357</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>/dev/loop1                          92M   92M     <span class=\"token number\">0</span> <span class=\"token number\">100</span>% /snap/lxd/24061</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>tmpfs                              590M     <span class=\"token number\">0</span>  590M   <span class=\"token number\">0</span>% /run/user/0</pre></td></tr></table></figure><p>完成～</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9vaS4wdzAuaW8vMjAyMi8wNC8yMC8lRTUlOUMlQTh2bXdhcmUlRTQlQjglOEIlRTYlODklQTklRTUlQjElOTUtdWJ1bnR1LTIwLTA0LSVFNyVBMyU4MSVFNyU5QiU5OCVFNSU4OCU4NiVFNSU4QyVCQSVFRiVCQyU4OC1kZXYtbWFwcGVyLXVidW50dS12Zy11YnVudHUtbHYlRUYlQkMlODkv\">https://oi.0w0.io/2022/04/20 / 在 vmware 下扩展 - ubuntu-20-04 - 磁盘分区（-dev-mapper-ubuntu-vg-ubuntu-lv）/</span></li>\n</ul>\n",
            "tags": [
                "杂项",
                "踩坑",
                "杂项",
                "踩坑",
                "Ubuntu"
            ]
        },
        {
            "id": "https://gality.cn/os/kernel/build-kernel/",
            "url": "https://gality.cn/os/kernel/build-kernel/",
            "title": "从0开始构建Linux内核",
            "date_published": "2024-03-25T10:23:22.000Z",
            "content_html": "<div class=\"note primary no-icon\">\n<p>⚙️ 以下是本篇文章所使用的环境：</p>\n<ul>\n<li>宿主机：MacOS Sonoma 14.4</li>\n<li>虚拟机：Ubuntu Server 20.04 LTS</li>\n<li>VMware Fusion 13.5.1</li>\n<li>Linux kernel 5.4.272</li>\n</ul>\n</div>\n<h1 id=\"环境准备\"><a class=\"anchor\" href=\"#环境准备\">#</a> 环境准备</h1>\n<h2 id=\"下载项\"><a class=\"anchor\" href=\"#下载项\">#</a> 下载项</h2>\n<h3 id=\"下载linux内核源码\"><a class=\"anchor\" href=\"#下载linux内核源码\">#</a> 下载 Linux 内核源码</h3>\n<p>从<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cua2VybmVsLm9yZy8=\">官方网站</span>下载 linux 内核源码</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/0egux9.png\" alt=\"linux kernel\" /></p>\n<p>点击 [tarball]，你会得到一个 <code>linux-5.4.272.tar.xz</code>  格式的打包文件，后续会用到。</p>\n<h3 id=\"下载ubuntu-server\"><a class=\"anchor\" href=\"#下载ubuntu-server\">#</a> 下载 Ubuntu Server</h3>\n<div class=\"note info no-icon\">\n<ol>\n<li>\n<p>选择 Ubuntu 的原因在于 Ubuntu 是目前市场占有率最高的 Linux 系统，这意味着他会有最好的支持和社区，便于查找 &amp; 解决各种 bug。</p>\n</li>\n<li>\n<p>选择 Server 版的原因在于 Server 版本舍弃了图形化界面，整体大小会小非常多，这意味着能给内核的编译 &amp; 后续操作留更多的空间。</p>\n</li>\n<li>\n<p>选择 20.04 版本的原因在于该版本默认使用 linux 5.4 的内核，减少我们后续自己编译的内核时可能出现的莫名 bug。</p>\n</li>\n</ol>\n</div>\n<p>从<span class=\"exturl\" data-url=\"aHR0cHM6Ly91YnVudHUuY29tL2Rvd25sb2FkL3NlcnZlcg==\">官方网站</span>下载 Ubuntu Server 的镜像文件</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/9oceyz.png\" alt=\"ubuntu server\" /></p>\n<h2 id=\"必要配置\"><a class=\"anchor\" href=\"#必要配置\">#</a> 必要配置</h2>\n<h3 id=\"虚拟机配置\"><a class=\"anchor\" href=\"#虚拟机配置\">#</a> 虚拟机配置</h3>\n<div class=\"note warning no-icon\">\n<p>⚠️ 本篇文章假定读者知道：如何使用虚拟机软件安装虚拟系统，如果不知道，请自行 Google～</p>\n<p>在假定读者已经知道如何安装虚拟机的基础上，<span class=\"red\">请注意</span>：</p>\n<ol>\n<li>安装虚拟机时请给虚拟机最好分配<strong> 70G</strong> 以上的存储空间，因为编译内核所需空间非常大，使用默认配置的 20G 空间会导致没有足够空间编译内核。</li>\n<li>最好分配<strong> 4 个</strong>以上 CPU 核心，核心数量直接影响内核的编译速度。</li>\n<li>最好分配<strong> 4G</strong> 以上内存</li>\n</ol>\n</div>\n<p>由于采用的是没有图形化界面的 Server 版本，所以我们最好配置一下<strong>共享文件夹</strong>来方便在宿主机和虚拟机之间共享文件，配置过程如下：</p>\n<ol>\n<li>\n<p>找到「设置」=&gt; 「共享」</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/i3o4xc.png\" alt=\"共享设置\" /></p>\n</li>\n<li>\n<p>创建一个文件夹用于共享，并将其权限改为「读与写」，点击「启用共享文件夹」（我这里共享文件夹命名为 <code>share</code> ）。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/bgjphy.png\" alt=\"共享文件夹\" /></p>\n</li>\n<li>\n<p>将刚刚下载的内核文件放入文件夹中，并在虚拟机中执行如下指令：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /mnt/hgfs/share</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">ls</span></pre></td></tr></table></figure><p>如果一切顺利，你将会看到 <code>linux-5.4.272.tar.xz</code>  就在这里。「 所有共享文件夹会自动被挂载在 <code>/mnt/hgfs</code>  下，如果你的共享文件夹命名为其他的名字，请替换成自己的名字：) 」</p>\n<p>🙅 如果没有找到 <code>share</code>  文件夹，可以参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC83MzE4MjM3NDkxOTA2NTQzNjQy\">这篇博客</span>。</p>\n</li>\n</ol>\n<h3 id=\"apt换源\"><a class=\"anchor\" href=\"#apt换源\">#</a> apt 换源</h3>\n<p>构建内核需要依赖大量工具，建议先更换一下 apt 源，方便下载。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 备份之前的 sources.list</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak</pre></td></tr></table></figure><p>然后替换 <code>/etc/apt/sources.list</code>  为以下内容并保存：</p>\n<pre><code>deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\n</code></pre>\n<p>完成后使用 <code>sudo apt update</code>  来重新获取一下软件包缓存。</p>\n<h3 id=\"编译工具安装\"><a class=\"anchor\" href=\"#编译工具安装\">#</a> 编译工具安装</h3>\n<p>安装编译内核时所需的工具，这里假设你使用的是一个纯净的 ubuntu 系统。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> gcc g++ <span class=\"token function\">make</span> <span class=\"token function\">git</span> libncurses5-dev build-essential kernel-package libssl-dev libelf-dev dwarves flex bison</pre></td></tr></table></figure><h1 id=\"编译内核\"><a class=\"anchor\" href=\"#编译内核\">#</a> 编译内核</h1>\n<h2 id=\"解压linux内核\"><a class=\"anchor\" href=\"#解压linux内核\">#</a> 解压 Linux 内核</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 将 Linux 内核从共享文件夹中复制到家目录下</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> /mnt/hgfs/share/linux-5.4.272.tar.xz ~/ <span class=\"token operator\">|</span> <span class=\"token builtin class-name\">cd</span> ~ </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 解压</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>xz <span class=\"token parameter variable\">-d</span> linux-5.4.272.tar.xz</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xvf</span> linux-5.4.272.tar</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">cd</span> linux-5.4.272</pre></td></tr></table></figure><h2 id=\"配置linux内核\"><a class=\"anchor\" href=\"#配置linux内核\">#</a> 配置 Linux 内核</h2>\n<p>Linux 内核的构建过程会查找  <code>.config</code>  文件，这是一个配置文件，用于指定 Linux 内核的所有可能的配置选项。这是必需的文件。</p>\n<p>获取 Linux 内核的  <code>.config</code>  文件有两种方式：</p>\n<ol>\n<li>使用你的 Linux 发行版的配置作为基础（<strong>推荐做法</strong>）</li>\n<li>使用默认的，通用的配置</li>\n</ol>\n<blockquote>\n<p>💡 也有第三种方法，也就是从零开始，手动配置每一个选项，但注意，这需要配置超过 12,000 个选项。并不推荐这种方式，因为手动配置所有选项将花费大量的时间，并且你还需要理解每个启用和禁用选项的含义。</p>\n</blockquote>\n<p>以下是第一种方式：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> linux-*/</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 复制你的 Ubuntu 的配置文件</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> /boot/config-<span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-r</span><span class=\"token variable\">)</span></span>\"</span> .config</pre></td></tr></table></figure><h2 id=\"更新config配置\"><a class=\"anchor\" href=\"#更新config配置\">#</a> 更新 config 配置</h2>\n<p>由于我们使用的是 “旧的配置文件”（当前保存为  <code>.config</code> ，这是发行版配置的一个副本），所以需要检查从上一版本以来 Linux 代码库中新加的任何配置选项。如果找到任何「新的、未配置」 的选项，该选项的默认配置值会被使用，并会对  <code>.config</code>  文件进行更新。</p>\n<p>原来的  <code>.config</code>  文件将被重命名为  <code>.config.old</code>  进行备份，并将新的更改写入至  <code>.config</code>  文件。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">make</span> olddefconfig</pre></td></tr></table></figure><h2 id=\"添加必要配置\"><a class=\"anchor\" href=\"#添加必要配置\">#</a> 添加必要配置</h2>\n<p>构建内核时内核模块会使用一个签名证书，默认情况下，你的计算机并不包含这个证书。我们可以用以下命令告诉编译器，自行生成一个签名证书并在编译时使用。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./scripts/config <span class=\"token parameter variable\">--file</span> .config --set-str SYSTEM_TRUSTED_KEYS <span class=\"token string\">''</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>./scripts/config <span class=\"token parameter variable\">--file</span> .config --set-str SYSTEM_REVOCATION_KEYS <span class=\"token string\">''</span></pre></td></tr></table></figure><p>我们还可以为自定义内核构建添加一个标签。我使用字符串  <code>-gality</code>  作为标签。这样当运行  <code>uname -r</code>  命令时，就会显示 <code>5.4.272-gality</code>  了：)</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./scripts/config <span class=\"token parameter variable\">--file</span> .config --set-str LOCALVERSION <span class=\"token string\">\"-gality\"</span></pre></td></tr></table></figure><h2 id=\"编译\"><a class=\"anchor\" href=\"#编译\">#</a> 编译</h2>\n<p>实际的编译很简单，也很漫长（可能 1～3 小时，如果顺利的话～</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># -j 参数指定使用多个核心来加速编译过程</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">make</span> -j<span class=\"token variable\"><span class=\"token variable\">$(</span>nproc<span class=\"token variable\">)</span></span></pre></td></tr></table></figure><p>如果很不幸，你出现了 <code>No space left on device</code>  的错误，那么意味着你并没有好好阅读之前的内容，不过，你可以参考<a href=\"https://gality.cn/misc/trail-and-error/ubuntu%E6%89%A9%E5%AE%B9/\">这篇文章</a>来让解决问题。</p>\n<h1 id=\"安装内核\"><a class=\"anchor\" href=\"#安装内核\">#</a> 安装内核</h1>\n<h2 id=\"安装模块\"><a class=\"anchor\" href=\"#安装模块\">#</a> 安装模块</h2>\n<p>将已经编译好的模块安装到内核中</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">make</span> modules_install</pre></td></tr></table></figure><h2 id=\"安装-linux-内核头文件可选\"><a class=\"anchor\" href=\"#安装-linux-内核头文件可选\">#</a> 安装 Linux 内核头文件 (可选)</h2>\n<p>如果打算尝试自行编写模块，可能会需要 Linux 内核提供的头文件。可使用如下命令来安装头文件：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">make</span> headers_install</pre></td></tr></table></figure><p>这些头文件会被安装到  <code>/usr</code>  目录。同时还会在  <code>/usr</code>  目录内创建子目录  <code>include/linux</code> ，然后将头文件安装到  <code>/usr/include/linux</code>  内</p>\n<h2 id=\"安装内核-2\"><a class=\"anchor\" href=\"#安装内核-2\">#</a> 安装内核</h2>\n<p>安装内核，这个过程会更新 boot 和 grub</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">make</span> <span class=\"token function\">install</span></pre></td></tr></table></figure><p>此时，可以重启 <code>reboot</code>  来测试新内核是否成功安装：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>$ <span class=\"token function\">uname</span> <span class=\"token parameter variable\">-r</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">5.4</span>.272-gality <span class=\"token comment\"># Yeah~</span></pre></td></tr></table></figure>",
            "tags": [
                "操作系统",
                "内核",
                "操作系统",
                "kernel",
                "linux"
            ]
        },
        {
            "id": "https://gality.cn/llvm/llvm-tutorial/",
            "url": "https://gality.cn/llvm/llvm-tutorial/",
            "title": "LLVM 简明教程",
            "date_published": "2024-03-11T02:35:28.000Z",
            "content_html": "<div class=\"note warning no-icon\">\n<p>⚠️ 笔者本人也是 LLVM 新手，所以本篇内容只是笔者在自己的理解上写出的笔记性质的 “教程”，如有错误，还请大佬们指正。写这篇文章的目的在于，笔者自己在入门 LLVM IR 及 API 时基本都是英文教程，国内的教程非常杂乱，LLVM IR 相关的内容还比较丰富，但对于 LLVM API 相关的资料就比较少了，笔者在学习过程中的很多问题都是在 Stack Overflow 上得到解答的，所以这里将各种踩坑记录下来，帮助其他同学。</p>\n</div>\n<h1 id=\"llvm-安装与环境配置\"><a class=\"anchor\" href=\"#llvm-安装与环境配置\">#</a> LLVM 安装与环境配置</h1>\n<div class=\"note primary no-icon\">\n<p>笔者的环境为：</p>\n<ul>\n<li>MacBook Pro 2019 Intel 芯片 macOS 14.2.1 Sonoma</li>\n<li>Homebrew 4.2.11</li>\n<li>CLion 233.14475.31, built on February 13, 2024</li>\n</ul>\n</div>\n<h2 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> 安装</h2>\n<p>由于 xcode 自带的 LLVM 是经过阉割的版本，很多 llvm 的命令都没有，所以需要单独下载 llvm，推荐使用 <code>Homebrew</code>  来安装。</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 搜索所有可用的 llvm 版本</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>brew search llvm</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 下载指定版本</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>brew <span class=\"token function\">install</span> llvm@11</pre></td></tr></table></figure><p>由于<strong> llvm 不同版本之间的 API 有些微不同</strong>，所以最好是根据需求安装指定版本的 LLVM，防止出现 <code>undefined symbol</code>  的问题。</p>\n<details class=\"info\"><summary>无法安装/安装出错</summary><div>\n<p>如果安装时出现报错： <code>Error: llvm@11 has been disabled because it is a versioned formula!</code> ，可以通过如下方式解决：</p>\n<ol>\n<li><code>brew tap --force homebrew/core</code></li>\n<li><code>brew edit llvm@11</code></li>\n<li>把  <code>disable! date: &quot;2024-02-22&quot;, because: :versioned_formula</code>  中的过期时间改为当前或以后，然后保存</li>\n<li><code>HOMEBREW_NO_INSTALL_FROM_API=1 brew install llvm@11</code></li>\n</ol>\n</div></details>\n<p>安装完成后需要将如下配置写入环境变量中，由于笔者使用的 <code>zsh</code> ，所以就是把如下内容写入到 <code>~/.zshrc</code>  中：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">LDFLAGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-L/usr/local/opt/llvm@11/lib -Wl,-rpath,/usr/local/opt/llvm@11/lib\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/opt/llvm@11/bin:<span class=\"token environment constant\">$PATH</span>\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">LDFLAGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-L/usr/local/opt/llvm@11/lib\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">CPPFLAGS</span><span class=\"token operator\">=</span><span class=\"token string\">\"-I/usr/local/opt/llvm@11/include\"</span></pre></td></tr></table></figure><p>这是在当前版本下 <code>Homebrew</code>  的默认 LLVM 安装路径，如果你的路径不是这个，请改成自己的路径。</p>\n<h2 id=\"测试\"><a class=\"anchor\" href=\"#测试\">#</a> 测试</h2>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 重新加载一下环境变量</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">source</span> ~/.zshrc</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 测试 llvm 是否成功安装</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>llvm-config <span class=\"token parameter variable\">--version</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>╰▸ <span class=\"token number\">11.1</span>.0</pre></td></tr></table></figure><h2 id=\"环境配置\"><a class=\"anchor\" href=\"#环境配置\">#</a> 环境配置</h2>\n<div class=\"note info\">\n<p>笔者尝试了多种不同的 IDE，包括 VSCode、Xcode 和 CLion，最终成功在 CLion 上成功搭建了可调试的 LLVM 开发环境，所以推荐使用 CLion 作为 IDE。</p>\n</div>\n<ol>\n<li>\n<p>随便创建一个 <code>C++ Executable</code>  项目，语言标准任选。</p>\n</li>\n<li>\n<p>点击<span class=\"kbd\"> CLion</span> =&gt; <span class=\"kbd\">settings</span> =&gt; <span class=\"kbd blue\">Build, Execution, Deployment</span> =&gt; <span class=\"kbd red\">CMake options</span>，写入：<br />\n <code>-DLLVM_DIR:PATH=/usr/local/Cellar/llvm@11/11.1.0_4/lib/cmake/llvm</code></p>\n</li>\n<li>\n<p>CLion 应该会自动为当前项目创建一个 <code>CMakeLists.txt</code> 。如果没有，则在 CLion 左边的项目根目录中<span class=\"kbd\">右键</span> =&gt; <span class=\"kbd\">new</span> =&gt; <span class=\"kbd red\">CMakeLists.txt</span>。</p>\n</li>\n<li>\n<p>将如下内容写入 <code>CMakeLists.txt</code>  中（假设你的项目名为 llvm_test）：</p>\n<figure class=\"highlight cmake\"><figcaption data-lang=\"CMake\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">cmake_minimum_required</span><span class=\"token punctuation\">(</span><span class=\"token property\">VERSION</span> <span class=\"token number\">3.27</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">project</span><span class=\"token punctuation\">(</span>llvm_test<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 需改为你的项目名</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">find_package</span><span class=\"token punctuation\">(</span>LLVM REQUIRED CONFIG<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">message</span><span class=\"token punctuation\">(</span>STATUS <span class=\"token string\">\"Found LLVM <span class=\"token interpolation\"><span class=\"token punctuation\">$&#123;</span><span class=\"token variable\">LLVM_PACKAGE_VERSION</span><span class=\"token punctuation\">&#125;</span></span>\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">message</span><span class=\"token punctuation\">(</span>STATUS <span class=\"token string\">\"Using LLVMConfig.cmake in: <span class=\"token interpolation\"><span class=\"token punctuation\">$&#123;</span><span class=\"token variable\">LLVM_DIR</span><span class=\"token punctuation\">&#125;</span></span>\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># Set your project compile flags.</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># E.g. if using the C++ header files</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># you will need to enable C++11 support</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># for your compiler.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">include_directories</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">$&#123;</span>LLVM_INCLUDE_DIRS<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">add_definitions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">$&#123;</span>LLVM_DEFINITIONS<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">set</span><span class=\"token punctuation\">(</span><span class=\"token variable\">CMAKE_CXX_STANDARD</span> <span class=\"token number\">17</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">add_executable</span><span class=\"token punctuation\">(</span>llvm_test main.cpp<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 需改为你的项目名 需要编译的 cpp 文件名</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">llvm_map_components_to_libnames</span><span class=\"token punctuation\">(</span>llvm_libs irreader<span class=\"token punctuation\">)</span> <span class=\"token comment\">#根据需要填入 LLVM 组件</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># Link against LLVM libraries</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">target_link_libraries</span><span class=\"token punctuation\">(</span>llvm_test <span class=\"token punctuation\">$&#123;</span>llvm_libs<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure></li>\n<li>\n<p>保存后即可使用 CLion 愉快的开发 / Debug LLVM C++ API 代码了。</p>\n</li>\n</ol>\n<details class=\"info\"><summary>⚠️常见问题</summary><div>\n<ol>\n<li>如果在第 4 步出现错误：找不到 <code>LLVMConfig.cmake</code>  文件，代表你的 <code>Homebrew</code>  和笔者不同，请全局搜索 <code>LLVMConfig.cmake</code>  文件并在 <code>-DLLVM_DIR:PATH=</code>  后写入正确的位置）</li>\n<li>上述代码中 <code>llvm_map_components_to_libnames(llvm_libs irreader)</code>  是一种按需使用 LLVM 组件的方式， <code>irreader</code>  就是一个组件，对应着头文件 <code>&quot;llvm/IR/IRBuilder.h&quot;</code> ，如果你在引用头文件是出现 <code>&quot;xxx.h&quot; not found</code>  的错误，请检查是否在 <code>CMakeLists.txt</code>  中引入了对应的组件。</li>\n<li>可以通过 <code>llvm-config --components all</code>  列出 LLVM 的所有组件。</li>\n</ol>\n</div></details>\n<h1 id=\"llvm-基本知识\"><a class=\"anchor\" href=\"#llvm-基本知识\">#</a> LLVM 基本知识</h1>\n<h2 id=\"基本概念\"><a class=\"anchor\" href=\"#基本概念\">#</a> 基本概念</h2>\n<h3 id=\"引入\"><a class=\"anchor\" href=\"#引入\">#</a> 引入</h3>\n<p>随着计算机技术的不断发展以及各种领域需求的增多，近几年来，许多编程语言如雨后春笋般出现，他们大多为了解决某一些特定领域的需求，比如说为 JavaScript 增加静态类型检查的 TypeScript，为解决服务器端高并发的 Golang，为解决内存安全和线程安全的 Rust。</p>\n<p>让我们设身处地地想象一下，如果我们想开发一门新的编译型的编程语言，有什么需要解决的问题呢？</p>\n<ol>\n<li>\n<p>怎样让我的编程语言能在尽可能多的平台上运行</p>\n<p>​\t我想让我的编程语言能够在 Windows、macOS 和 Linux 上都可以运行；我想让我的编程语言能够在 Intel 芯片、ARM 芯片，乃至龙芯上都可以运行。</p>\n</li>\n<li>\n<p>怎样让我的编程语言可以使用前人先进的技术</p>\n<p>​\t在编程语言发展的过程中，有许许多多成熟的技术。从汇编指令层面来看，简单地想给一个变量值置 0，AMD64 架构下可以用 <code>xor %eax, %eax</code>  异或自身，AArch64 架构下可以用 <code>mov w0, wzr</code>  使用零寄存器；从算法层面来看，可以使用尾调用优化、CFI 等。如果我不想重复造轮子，该如何复用这些技术呢？</p>\n</li>\n<li>\n<p>怎样让我的编程语言在汇编层面实现「定制」</p>\n<p>​\t高级语言中的函数名，在汇编层面，我想让他换个名字；我想让 C 语言库能用它的调用约定来调用我的高级语言中的函数。</p>\n</li>\n</ol>\n<p>我们可以选择使用 C 语言来作为 “中间层”，当我们开发新编译语言时，提供该语言到 C 语言的转换，这样做是因为：</p>\n<ol>\n<li>绝大部分的操作系统都是由 C 和汇编语言写成，因此平台大多会提供一个 C 编译器可以使用，这样就解决了第一个问题</li>\n<li>C 语言历史久远，有非常多的优化器，程序翻译成 C 语言后就可以直接使用那些为 C 语言定制的优化器，从而方便的使用前人的成熟技术，这就解决了第二个问题。</li>\n<li>C 语言本身并没有笨重的运行时，代码很贴近底层，可以使用一定程度的定制，一定程度上解决了第三个问题。</li>\n</ol>\n<p>然而，C 语言毕竟是 “老古董” 了，相对于现在的各种编程语言来说还是太过僵硬死板。如果有这么一种语言，他<strong>可以在各个平台运行</strong>，且<strong>自带极高的代码优化能力</strong>，同时<strong>提供灵活操作系统底层的能力</strong>，那么当我们想开发一个新的编程语言时，岂不是只需要提供一个从新语言到这种语言的转换器就可以了。没错，这就是 LLVM！</p>\n<p>简单来说，当我们想开发一种新的编程语言时，只需提供将自己语言的源代码编译成 LLVM 的中间代码（LLVM IR）的能力，然后就可以交由 LLVM 对中间代码进行优化，并编译成所需运行平台的二进制程序。LLVM 的优点也正对应我们之前讲的三个问题：</p>\n<ul>\n<li>\n<p>LLVM 后端支持的平台很多，我们不需要担心 CPU、操作系统的问题</p>\n<p>有一点需要指出的是，操作系统 API 的调用还是得由编程语言开发者自己实现，LLVM 不负责这个。例如，编程语言的标准库中，打开一个文件，其底层实现在 Linux 中是否是 <code>open</code>  系统调用，在 Windows 中是否是 <code>CreateFile</code>  函数，这都得编程语言开发者自己实现。</p>\n</li>\n<li>\n<p>LLVM 后端的优化水平较高，我们只需要将代码编译成 LLVM IR，就可以由 LLVM 后端作相应的优化</p>\n<p>但我们需要知道一点，LLVM IR 毕竟是更为底层的语言，在高级语言中的许多细节，都会在 LLVM IR 中丢失。因此，高级语言中能做的优化，还是得趁早做，把一大堆未经优化的 LLVM IR 丢给 LLVM 后端去优化，会严重拖慢编译时间，降低生成的二进制程序的性能。</p>\n</li>\n<li>\n<p>LLVM IR 本身比较贴近汇编语言，同时也提供了许多 ABI 层面的定制化功能</p>\n</li>\n</ul>\n<h3 id=\"架构\"><a class=\"anchor\" href=\"#架构\">#</a> 架构</h3>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/lhykol.jpg\" alt=\"LLVM 架构\" /></p>\n<p>LLVM 整体架构如上图所示。在整个编译过程中，LLVM 的前端是为各种编程语言定制的，负责将对应编程语言的源代码转换成 LLVM 中间表示（IR，Intermediate Representation）；LLVM 的后端为各种不同的平台做了适配，负责将 LLVM IR 转换成在特定平台上可执行的二进制文件。如果在编译过程中涉及到优化的话，则由 LLVM 优化器来对 IR 文件进行优化，并将优化后的 IR 文件输出给 LLVM 后端去编译，因此 IR 的设计是 LLVM 的灵魂所在。</p>\n<h3 id=\"llvm-ir\"><a class=\"anchor\" href=\"#llvm-ir\">#</a> LLVM IR</h3>\n<div class=\"note info no-icon\">\n<p>🔔 有关 IR 的更多知识，将在「基本 IR 指令」章节中讲解</p>\n</div>\n<p>LLVM IR 的设计体现了<strong>权衡</strong>的计算思维。低级的 IR（即更接近目标代码的 IR）允许编译器更容易地生成针对特定硬件的优化代码，但不利于支持多目标代码的生成。高级的 IR 允许优化器更容易地提取源代码的意图，但不利于编译器根据不同的硬件特性进行代码优化。</p>\n<p>LLVM IR 的设计采用 <code>common IR</code>  和 <code>specific IR</code>  相结合的方式。 <code>common IR</code>  旨在不同的后端共享对源程序的相同理解，以将其转换为不同的目标代码。除此之外，也为多个后端之间共享一组与目标无关的优化提供了可能性。 <code>specific IR</code>  允许不同的后端在不同的较低级别优化目标代码。这样做，既可以支持多目标代码的生成，也兼顾了目标代码的执行效率。</p>\n<p>LLVM IR 有如下 3 种<strong>等价</strong>形式：</p>\n<ul>\n<li>内存表示\n<ul>\n<li>类 <code>llvm::Function</code> 、 <code>llvm::Instruction</code>  等用于表示 <code>common IR</code> 。</li>\n<li>类 <code>llvm::MachineFunction</code> 、 <code>llvm::MachineInstr</code>  等用于表示 <code>specific IR</code> 。</li>\n</ul>\n</li>\n<li><code>.bc</code>  格式（Bitcode Files，存储在磁盘中）</li>\n<li><code>.ll</code>  格式（存储在磁盘中，便于人类阅读）</li>\n</ul>\n<p>LLVM IR 的特点如下：</p>\n<ul>\n<li>采用静态单一赋值（Static Single Assignment，SSA），即每个值只有一个定义它的赋值操作</li>\n<li>代码被组织为三地址指令（Three-address Instructions）</li>\n<li>有无限多个寄存器</li>\n</ul>\n<h2 id=\"基本命令\"><a class=\"anchor\" href=\"#基本命令\">#</a> 基本命令</h2>\n<h3 id=\"c-to-irbitcode\"><a class=\"anchor\" href=\"#c-to-irbitcode\">#</a> C to IR/Bitcode</h3>\n<p>由  <code>test.c</code>  生成  <code>IR</code>  文件</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>clang -emit-llvm <span class=\"token parameter variable\">-S</span> test.c <span class=\"token parameter variable\">-o</span> test.ll</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>clang -emit-llvm <span class=\"token parameter variable\">-c</span> test.c <span class=\"token parameter variable\">-o</span> test.bc</pre></td></tr></table></figure><p>如果需要其他编译参数可以直接附加，只要保证有  <code>-emit-llvm -S</code>  参数即可生成 <code>IR/Bicode</code>  文件，例如：</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>clang -emit-llvm <span class=\"token parameter variable\">-S</span> <span class=\"token parameter variable\">-g</span> <span class=\"token parameter variable\">-O3</span> -funroll-loops test.c <span class=\"token parameter variable\">-o</span> test.ll</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>clang -emit-llvm <span class=\"token parameter variable\">-c</span> <span class=\"token parameter variable\">-g</span> <span class=\"token parameter variable\">-O3</span> -funroll-loops test.c <span class=\"token parameter variable\">-o</span> test.bc</pre></td></tr></table></figure><h3 id=\"cpp-to-irbitcode\"><a class=\"anchor\" href=\"#cpp-to-irbitcode\">#</a> CPP to IR/Bitcode</h3>\n<p>由  <code>test.cpp</code>  生成  <code>IR</code>  文件</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>clang++ -emit-llvm <span class=\"token parameter variable\">-S</span> test.cpp <span class=\"token parameter variable\">-o</span> test.ll</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>clang++ -emit-llvm <span class=\"token parameter variable\">-c</span> test.cpp <span class=\"token parameter variable\">-o</span> test.bc</pre></td></tr></table></figure><h3 id=\"ccpp-to-execute\"><a class=\"anchor\" href=\"#ccpp-to-execute\">#</a> C/CPP to execute</h3>\n<p>使用方法与 <code>gcc</code>  类似</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>clang test.c <span class=\"token parameter variable\">-o</span> <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>clang++ test.cpp <span class=\"token parameter variable\">-o</span> <span class=\"token builtin class-name\">test</span></pre></td></tr></table></figure><h3 id=\"ir-to-bitcode\"><a class=\"anchor\" href=\"#ir-to-bitcode\">#</a> IR to Bitcode</h3>\n<p>对于 LLVM 来说， <code>.ll</code>  格式是给 “人” 看的格式， <code>.bc</code>  是给 “机器” 看的格式，将 “人” 看的代码转成 “机器码”，就类似于汇编的过程，所以用 <code>llvm-as</code>  命令。</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>llvm-as test.ll <span class=\"token parameter variable\">-o</span> test.bc</pre></td></tr></table></figure><h3 id=\"bitcode-to-ir\"><a class=\"anchor\" href=\"#bitcode-to-ir\">#</a> Bitcode to IR</h3>\n<p>同理，将 <code>.bc</code>  格式转换为 <code>.ll</code>  格式的过程就类似于反汇编的过程，所以用 <code>llvm-dis</code>  命令。</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>llvm-dis test.bc <span class=\"token parameter variable\">-o</span> test.bc.ll</pre></td></tr></table></figure><h3 id=\"irbicode-to-asm\"><a class=\"anchor\" href=\"#irbicode-to-asm\">#</a> IR/Bicode to asm</h3>\n<p>生成目标平台的汇编代码，输入文件可以是  <code>.bc</code>  类型的，也可以是  <code>.ll</code>  类型的。</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>llc test.bc <span class=\"token parameter variable\">-o</span> test.bc.s</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>llc test.ll <span class=\"token parameter variable\">-o</span> test.ll.s</pre></td></tr></table></figure><h3 id=\"irbicode-to-execute\"><a class=\"anchor\" href=\"#irbicode-to-execute\">#</a> IR/Bicode to execute</h3>\n<p>IR 和 Bitcode 格式都能直接运行</p>\n<figure class=\"highlight sh\"><figcaption data-lang=\"sh\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>lli test.ll</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>lli test.bc</pre></td></tr></table></figure><h2 id=\"基本ir语法\"><a class=\"anchor\" href=\"#基本ir语法\">#</a> 基本 IR 语法</h2>\n<h3 id=\"ir结构\"><a class=\"anchor\" href=\"#ir结构\">#</a> IR 结构</h3>\n<details class=\"primary\"><summary>LLVM IR的结构（可先往下看，自己总结）</summary><div>\n<ol>\n<li>模块（Module）：LLVM IR 的最顶层结构是模块，表示整个程序或库。一个模块由一组全局变量和函数组成。</li>\n<li>全局变量（Global Variables）：LLVM IR 允许声明全局变量，它们是在整个程序中可见的。全局变量由其类型、名称和可选的初始值组成。全局变量的声明以 <code>@</code> 符号开头，后面跟着变量名称和类型信息。例如， <code>@myGlobal = global i32 0</code>  表示一个名为 <code>myGlobal</code>  的 32 位整数全局变量，初始值为 0。</li>\n<li>函数（Functions）：LLVM IR 中的函数由函数类型、名称、参数列表和函数体组成。函数类型包括返回类型和参数类型。函数的声明以 <code>define</code>  关键字开头，后面是返回类型、函数名称、参数列表和函数体。函数体由基本块（Basic Block）组成，每个基本块由一组指令组成。函数体的最后一条指令通常是返回指令。</li>\n<li>基本块（Basic Blocks）：基本块是 LLVM IR 中的基本执行单元。它由一系列按顺序执行的指令组成，没有分支或跳转指令。基本块以标签（Label）开头，后面是一组指令。基本块可以包含控制流指令，如条件分支和无条件跳转，以便实现程序的控制流程。</li>\n<li>指令（Instructions）：LLVM IR 包括各种指令来表示程序的操作。指令由操作码和操作数组成，用于执行特定的操作。LLVM IR 支持常见的指令类型，如赋值指令、算术运算指令、逻辑运算指令、条件分支指令、内存访问指令等。指令可以使用变量、常量和表达式作为操作数。</li>\n</ol>\n</div></details>\n<p>首先来看看 IR 长什么样子</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">_GNU_SOURCE</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hello World!\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>使用 <code>clang -emit-llvm -S main.c -o main.ll</code>  将上述代码编译成 IR 的 <code>.ll</code>  格式：</p>\n<figure class=\"highlight llvm\"><figcaption data-lang=\"LLVM IR\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">; ModuleID = 'main.c'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">source_filename</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"main.c\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">target</span> <span class=\"token keyword\">datalayout</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"e-m:o-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">target</span> <span class=\"token keyword\">triple</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"x86_64-apple-macosx14.0.0\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token variable\">@.str</span> <span class=\"token punctuation\">=</span> <span class=\"token keyword\">private</span> <span class=\"token keyword\">unnamed_addr</span> <span class=\"token keyword\">constant</span> <span class=\"token punctuation\">[</span><span class=\"token number\">14</span> <span class=\"token keyword\">x</span> <span class=\"token type class-name\">i8</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">c</span><span class=\"token string\">\"Hello World!\\0A\\00\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">align</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">; Function Attrs: noinline nounwind optnone ssp uwtable</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">define</span> <span class=\"token keyword\">dso_local</span> <span class=\"token type class-name\">i32</span> <span class=\"token variable\">@main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token variable\">#0</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token variable\">%1</span> <span class=\"token punctuation\">=</span> <span class=\"token keyword\">alloca</span> <span class=\"token type class-name\">i32</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">align</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token keyword\">store</span> <span class=\"token type class-name\">i32</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token type class-name\">i32</span><span class=\"token punctuation\">*</span> <span class=\"token variable\">%1</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">align</span> <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token variable\">%2</span> <span class=\"token punctuation\">=</span> <span class=\"token keyword\">call</span> <span class=\"token type class-name\">i32</span> <span class=\"token punctuation\">(</span><span class=\"token type class-name\">i8</span><span class=\"token punctuation\">*</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token variable\">@printf</span><span class=\"token punctuation\">(</span><span class=\"token type class-name\">i8</span><span class=\"token punctuation\">*</span> <span class=\"token keyword\">getelementptr</span> <span class=\"token keyword\">inbounds</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">14</span> <span class=\"token keyword\">x</span> <span class=\"token type class-name\">i8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token number\">14</span> <span class=\"token keyword\">x</span> <span class=\"token type class-name\">i8</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">*</span> <span class=\"token variable\">@.str</span><span class=\"token punctuation\">,</span> <span class=\"token type class-name\">i64</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token type class-name\">i64</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token keyword\">ret</span> <span class=\"token type class-name\">i32</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">declare</span> <span class=\"token type class-name\">i32</span> <span class=\"token variable\">@printf</span><span class=\"token punctuation\">(</span><span class=\"token type class-name\">i8</span><span class=\"token punctuation\">*</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span> <span class=\"token variable\">#1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">attributes</span> <span class=\"token variable\">#0</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">noinline</span> <span class=\"token keyword\">nounwind</span> <span class=\"token keyword\">optnone</span> <span class=\"token keyword\">ssp</span> <span class=\"token keyword\">uwtable</span> <span class=\"token string\">\"disable-tail-calls\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"frame-pointer\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"all\"</span> <span class=\"token string\">\"less-precise-fpmad\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"min-legal-vector-width\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"0\"</span> <span class=\"token string\">\"no-infs-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-jump-tables\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-nans-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-signed-zeros-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-trapping-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"true\"</span> <span class=\"token string\">\"stack-protector-buffer-size\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"8\"</span> <span class=\"token string\">\"target-cpu\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"penryn\"</span> <span class=\"token string\">\"target-features\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\"</span> <span class=\"token string\">\"tune-cpu\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"generic\"</span> <span class=\"token string\">\"unsafe-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"use-soft-float\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">attributes</span> <span class=\"token variable\">#1</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"disable-tail-calls\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"frame-pointer\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"all\"</span> <span class=\"token string\">\"less-precise-fpmad\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-infs-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-nans-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-signed-zeros-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-trapping-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"true\"</span> <span class=\"token string\">\"stack-protector-buffer-size\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"8\"</span> <span class=\"token string\">\"target-cpu\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"penryn\"</span> <span class=\"token string\">\"target-features\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\"</span> <span class=\"token string\">\"tune-cpu\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"generic\"</span> <span class=\"token string\">\"unsafe-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"use-soft-float\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token variable\">!llvm.module.flags</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">!</span><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">!0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">!1</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token variable\">!llvm.ident</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">!</span><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">!2</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token variable\">!0</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">!</span><span class=\"token punctuation\">&#123;</span><span class=\"token type class-name\">i32</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">!</span><span class=\"token string\">\"wchar_size\"</span><span class=\"token punctuation\">,</span> <span class=\"token type class-name\">i32</span> <span class=\"token number\">4</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token variable\">!1</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">!</span><span class=\"token punctuation\">&#123;</span><span class=\"token type class-name\">i32</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">!</span><span class=\"token string\">\"PIC Level\"</span><span class=\"token punctuation\">,</span> <span class=\"token type class-name\">i32</span> <span class=\"token number\">2</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token variable\">!2</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">!</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">!</span><span class=\"token string\">\"Homebrew clang version 12.0.1\"</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>虽然只是一个简单的 <code>Hello world</code>  程序，但是也基本包含了 IR 文件的各个部分。“麻雀虽小，五脏俱全”，让我们从上往下依次来看：</p>\n<p><strong>第一部分（1～4 行）</strong></p>\n<ul>\n<li>\n<p><code>source_filename</code> ：描述了源文件的名称及其所在路径。</p>\n</li>\n<li>\n<p><code>target datalayout</code> ：描述了目标机器中数据的内存布局方式，包括：字节序、类型大小以及对齐方式「<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sbHZtLm9yZy9kb2NzL0xhbmdSZWYuaHRtbCNkYXRhLWxheW91dA==\">具体说明</span>」。</p>\n</li>\n<li>\n<p><code>target triple</code> ：描述了目标机器是什么，从而指示后端生成相应的目标代码。</p>\n</li>\n</ul>\n<p><strong>第二部分（6～19 行）</strong></p>\n<ul>\n<li>\n<p>标识符</p>\n<p>LLVM IR 中的标识符分为：全局标识符和局部标识符。全局标识符以 <code>@</code> 开头，比如：全局函数、全局变量。局部标识符以 <code>%</code>  开头，类似于汇编语言中的寄存器。</p>\n<p>标识符有如下 3 种形式：</p>\n<ul>\n<li>有名称的值（Named Value），表示为带有前缀（ <code>@</code> 或 <code>%</code> ）的字符串。比如：% val、@name。</li>\n<li>无名称的值（Unnamed Value），表示为带前缀（ <code>@</code> 或 <code>%</code> ）的无符号数值。比如：%0、%1、@2。</li>\n<li>常量。</li>\n</ul>\n</li>\n<li>\n<p><code>define</code> ：用于定义一个函数</p>\n<ul>\n<li>\n<p><code>define dso_local i32 @main() #0 &#123; ... &#125;</code> ，表示定义一个函数。其函数名称为 <code>main</code> ，返回值的数据类型为 <code>i32</code> （占用 4 字节的整型），没有参数。</p>\n</li>\n<li>\n<p><code>#0</code> ，用于修饰函数时表示一组函数属性「<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sbHZtLm9yZy9kb2NzL0xhbmdSZWYuaHRtbCNmdW5jdGlvbi1hdHRyaWJ1dGVz\">具体说明</span>」。这些属性定义在文件末尾。如下：</p>\n<figure class=\"highlight llvm\"><figcaption data-lang=\"LLVM IR\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">attributes</span> <span class=\"token variable\">#0</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">noinline</span> <span class=\"token keyword\">nounwind</span> <span class=\"token keyword\">optnone</span> <span class=\"token keyword\">ssp</span> <span class=\"token keyword\">uwtable</span> <span class=\"token string\">\"disable-tail-calls\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"frame-pointer\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"all\"</span> <span class=\"token string\">\"less-precise-fpmad\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"min-legal-vector-width\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"0\"</span> <span class=\"token string\">\"no-infs-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-jump-tables\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-nans-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-signed-zeros-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"no-trapping-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"true\"</span> <span class=\"token string\">\"stack-protector-buffer-size\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"8\"</span> <span class=\"token string\">\"target-cpu\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"penryn\"</span> <span class=\"token string\">\"target-features\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"+cx16,+cx8,+fxsr,+mmx,+sahf,+sse,+sse2,+sse3,+sse4.1,+ssse3,+x87\"</span> <span class=\"token string\">\"tune-cpu\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"generic\"</span> <span class=\"token string\">\"unsafe-fp-math\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token string\">\"use-soft-float\"</span><span class=\"token punctuation\">=</span><span class=\"token string\">\"false\"</span> <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>LLVM IR 中，函数体是由<strong>基本块</strong>（Basic Blocks）构成的。基本块是由一系列顺序执行的语句构成的，并（可选地）以标签作为起始。不同的标签代表不同的基本块。</p>\n<p>基本块的特点如下：</p>\n<ul>\n<li>仅有一个入口，即基本块中的第一条指令。</li>\n<li>仅有一个出口，即基本块中的最后一条指令（被称为 <code>terminator instruction</code> ）。该指令要么跳转到其他基本块（不包括入口基本块），要么从函数返回。</li>\n<li>函数体中第一个出现的基本块，称为入口基本块（Entry Basic Block）。它是一个特殊的基本块，在进入函数时立即执行该基本块，并且不允许作为其他基本块的跳转目标（即不允许该基本块有前继节点）。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p><strong>第三部分（21～26 行）</strong></p>\n<ul>\n<li>\n<p><code>llvm.module.flags</code> ：命名元数据（Named Metadata）之一，用于描述模块级别的信息。</p>\n<p><code>llvm.module.flags</code>  是一个包含一系列元数据节点的集合。集合中的每个元数据节点都是一个形如 <code>&#123;&lt;behavior&gt;, &lt;key&gt;, &lt;value&gt;&#125;</code>  的三元组。其中， <code>&lt;behavior&gt;</code>  用于指定来自不同模块的 <code>&lt;key&gt;</code>  和 <code>&lt;value&gt;</code>  都相同的元数据合并时如何处理， <code>&lt;key&gt;</code>  表示元数据在本模块中的唯一标识符（仅在本模块内唯一，来自不同模块的元数据可能有相同的标识符）， <code>&lt;value&gt;</code>  表示元数据所携带信息的值。</p>\n<p>常见的 <code>&lt;behavior&gt;</code>  值为「1」，表示「如果两个值不一致，则发出错误，否则生成的值就是操作数的值」。</p>\n<figure class=\"highlight llvm\"><figcaption data-lang=\"LLVM IR\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token variable\">!llvm.module.flags</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">!</span><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">!0</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">!1</span><span class=\"token punctuation\">&#125;</span> <span class=\"token comment\">; 指定了两个元数据！0 和！1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token variable\">!0</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">!</span><span class=\"token punctuation\">&#123;</span><span class=\"token type class-name\">i32</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">!</span><span class=\"token string\">\"wchar_size\"</span><span class=\"token punctuation\">,</span> <span class=\"token type class-name\">i32</span> <span class=\"token number\">4</span><span class=\"token punctuation\">&#125;</span> <span class=\"token comment\">; 表示标识符为 \"wchar_size\" 的元数据所携带信息的值在所有模块中都应该是 4，否则会报错</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token variable\">!1</span> <span class=\"token punctuation\">=</span> <span class=\"token punctuation\">!</span><span class=\"token punctuation\">&#123;</span><span class=\"token type class-name\">i32</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">!</span><span class=\"token string\">\"PIC Level\"</span><span class=\"token punctuation\">,</span> <span class=\"token type class-name\">i32</span> <span class=\"token number\">2</span><span class=\"token punctuation\">&#125;</span> <span class=\"token comment\">; 同理</span></pre></td></tr></table></figure></li>\n<li>\n<p><code>llvm.ident</code> ：用于表示 Clang 的版本信息。</p>\n</li>\n</ul>\n<h3 id=\"ir-指令\"><a class=\"anchor\" href=\"#ir-指令\">#</a> IR 指令</h3>\n<p>在 LLVM 的 IR 中，所有的数据类型都是基于 LLVM 类型系统定义的，这些数据类型包括整数、浮点数、指针、数组、结构体等等，每个数据类型都具有自己的属性，例如位宽、对齐方式等等。在 IR 中，每个值都有一个类型，这个类型可以被显式地指定，或者通过指令的操作数推导出来。</p>\n<p>LLVM 的 IR 指令非常丰富，包括算术、逻辑、比较、转换、控制流等等，它们可以被用来表达复杂的程序结构，同时 IR 指令还可以通过 LLVM 的优化器进行优化，以生成高效的目标代码。</p>\n<p>IR 指令类型比较多，以下是一些常见的指令类型：</p>\n<ol>\n<li>加减乘除指令：add, sub, mul, sdiv, udiv, fadd, fsub, fmul, fdiv 等</li>\n<li>位运算指令：and, or, xor, shl, lshr, ashr 等</li>\n<li>转换指令：trunc, zext, sext, fptrunc, fpext, fptoui, fptosi, uitofp, sitofp, ptrtoint, inttoptr, bitcast 等</li>\n<li>内存指令：alloca, load, store, getelementptr 等</li>\n<li>控制流指令：br, switch, ret, indirectbr, invoke, resume, unreachable 等</li>\n<li>其他指令：phi, select, call, va_arg, landingpad 等</li>\n</ol>\n<p>指令相关内容资料丰富，不再具体赘述了，可以参考：</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC83MjAyOTc2MTY3NTE1MDQ1OTQ2\">LLVM 的 IR 指令详解</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sbHZtLm9yZy9kb2NzL0xhbmdSZWYuaHRtbA==\">LLVM 官方手册</span></li>\n</ul>\n<h1 id=\"llvm-c-api相关操作\"><a class=\"anchor\" href=\"#llvm-c-api相关操作\">#</a> LLVM C++ API 相关操作</h1>\n<div class=\"note primary no-icon\">\n<ul>\n<li>\n<p>本章使用的 C++ API 对应 <code>LLVM 17.0.6_1</code> ，同大版本下 API 基本不会发生太大变化，而如果是不同大版本，部分 API 的定义可能不同，需要自行查看 API 手册。</p>\n</li>\n<li>\n<p>查看 LLVM 版本： <code>llvm-config --version</code></p>\n</li>\n<li>\n<p>API 手册：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sbHZtLm9yZy9kb2NzL0xhbmdSZWYuaHRtbA==\">https://llvm.org/docs/LangRef.html</span></p>\n</li>\n<li>\n<p>⚠️ 为了方便书写，给出的代码大多是片段的形式。在默认情况下，本章节代码具有连续性，即若代码片段中某个变量未定义但直接使用，可以往前找找看。</p>\n</li>\n</ul>\n</div>\n<h2 id=\"读写ir文件\"><a class=\"anchor\" href=\"#读写ir文件\">#</a> 读 / 写 IR 文件</h2>\n<p>读写 IR 文件是分析的基础，通过读入 IR 文件并进行解析，可以向源程序中插入我们自定义的操作，然后将更改后的 IR 写回文件，将结果保存下来。假设需要读入一个 <code>main.ll</code>  的 IR 文件并对其进行操作，操作完成后将 IR 保存成 <code>.bc</code>  的格式。</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/LLVMContext.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/Module.h></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/IRBuilder.h></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/Instructions.h></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/Support/SourceMgr.h></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IRReader/IRReader.h></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/BasicBlock.h></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/Transforms/Utils/BasicBlockUtils.h></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"llvm/Support/raw_ostream.h\"</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"llvm/Bitcode/BitcodeWriter.h\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> llvm<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    LLVMContext ctx<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    SMDiagnostic err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  \t<span class=\"token comment\">// 读入指定 IR 文件并解析，获取 LLVMContext</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>unique_ptr<span class=\"token operator\">&lt;</span>Module<span class=\"token operator\">></span> mod_ptr <span class=\"token operator\">=</span> <span class=\"token function\">parseIRFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main.ll\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mod_ptr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cerr <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Failed to read IR File\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    Module <span class=\"token operator\">*</span>mod <span class=\"token operator\">=</span> mod_ptr<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\">// 分析操作</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>  \t<span class=\"token comment\">// 保存成文件</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>error_code EC<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    llvm<span class=\"token double-colon punctuation\">::</span>raw_fd_ostream <span class=\"token function\">OS</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main.bc\"</span><span class=\"token punctuation\">,</span> EC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>EC<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cerr <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"failed to open output file\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    llvm<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">WriteBitcodeToFile</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>mod_ptr<span class=\"token punctuation\">,</span> OS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>\n<p>保存成 <code>.ll</code>  格式：</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>std<span class=\"token double-colon punctuation\">::</span>error_code EC<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>llvm<span class=\"token double-colon punctuation\">::</span>raw_fd_ostream <span class=\"token function\">OS</span><span class=\"token punctuation\">(</span>source_ll<span class=\"token punctuation\">,</span> EC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>EC<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cerr <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"failed to open output file\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>mod<span class=\"token operator\">-></span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span>OS<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>在终端直接输出 <code>.ll</code>  格式</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mod<span class=\"token operator\">-></span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token function\">outs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"遍历ir文件\"><a class=\"anchor\" href=\"#遍历ir文件\">#</a> 遍历 IR 文件</h2>\n<p>这里给出遍历所有指令的代码</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/LLVMContext.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/Module.h></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/IRBuilder.h></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/Instructions.h></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/Support/SourceMgr.h></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IRReader/IRReader.h></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/BasicBlock.h></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/Transforms/Utils/BasicBlockUtils.h></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"llvm/Support/raw_ostream.h\"</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"llvm/Bitcode/BitcodeWriter.h\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> llvm<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    LLVMContext ctx<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    SMDiagnostic err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>unique_ptr<span class=\"token operator\">&lt;</span>Module<span class=\"token operator\">></span> mod_ptr <span class=\"token operator\">=</span> <span class=\"token function\">parseIRFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main.ll\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mod_ptr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cerr <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Failed to read IR File\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    Module <span class=\"token operator\">*</span>mod <span class=\"token operator\">=</span> mod_ptr<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  \t<span class=\"token comment\">// 依次遍历 * 函数 *</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>Function <span class=\"token operator\">&amp;</span>F <span class=\"token operator\">:</span> <span class=\"token operator\">*</span>mod<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      \t<span class=\"token comment\">// 依次遍历 * 基本块 *</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>BasicBlock <span class=\"token operator\">&amp;</span>BB <span class=\"token operator\">:</span> F<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>          \t<span class=\"token comment\">// 依次遍历 * 指令 *</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>Instruction <span class=\"token operator\">&amp;</span>I <span class=\"token operator\">:</span> BB<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token comment\">// 对指令进行操作</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t\tmod<span class=\"token operator\">-></span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token function\">outs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><details class=\"info\"><summary>范围for「C++ 11引入」</summary><div>\n<p>C++ 11 中引入了<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL3poLWNuL2NwcC9zdGFuZGFyZC1saWJyYXJ5L2l0ZXJhdG9yP3ZpZXc9bXN2Yy0xNzA=\">迭代器对象</span>，可通过使用成员和全局函数（如  <code>begin()</code>  和  <code>end()</code> ）以及运算符（如  <code>++</code>  和  <code>--</code> ）向前或向后移动，来显式使用迭代器。也可以通过范围 for 循环来隐式使用迭代器。</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/* 显示使用迭代器 */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 定义一个迭代器</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span> vec<span class=\"token punctuation\">&#123;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span><span class=\"token number\">4</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> it <span class=\"token operator\">=</span> <span class=\"token function\">begin</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> it <span class=\"token operator\">!=</span> <span class=\"token function\">end</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> it<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// Access element using dereference operator</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token operator\">*</span>it <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>上述代码等价于</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 推荐使用 auto 来自动获取类型</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> num <span class=\"token operator\">:</span> vec<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// no dereference operator</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    cout <span class=\"token operator\">&lt;&lt;</span> num <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></div></details>\n<h2 id=\"创建函数基本块指令\"><a class=\"anchor\" href=\"#创建函数基本块指令\">#</a> 创建函数 / 基本块 / 指令</h2>\n<p>在创建函数 / 基本块 / 指令时需要先获取当前的上下文，并设置好 “插入点”，创建的基本块 / 指令会插入到 “插入点” 指定的位置。</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/LLVMContext.h></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/Module.h></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/IRBuilder.h></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/Instructions.h></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/Support/SourceMgr.h></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IRReader/IRReader.h></span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/IR/BasicBlock.h></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;llvm/Transforms/Utils/BasicBlockUtils.h></span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"llvm/Support/raw_ostream.h\"</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"llvm/Bitcode/BitcodeWriter.h\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> llvm<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    LLVMContext ctx<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    SMDiagnostic err<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>unique_ptr<span class=\"token operator\">&lt;</span>Module<span class=\"token operator\">></span> mod_ptr <span class=\"token operator\">=</span> <span class=\"token function\">parseIRFile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main.ll\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mod_ptr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cerr <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Failed to read IR File\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    Module <span class=\"token operator\">*</span>mod <span class=\"token operator\">=</span> mod_ptr<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    IRBuilder<span class=\"token operator\">&lt;</span><span class=\"token operator\">></span> <span class=\"token function\">builder</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  \t<span class=\"token comment\">// 先声明函数结构：这里声明了一个返回值为 double，参数为一个 double 类型的函数；false 表明该函数参数个数不可变</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    FunctionType <span class=\"token operator\">*</span>funcType <span class=\"token operator\">=</span> <span class=\"token class-name\">FunctionType</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Type</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">getDoubleTy</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span><span class=\"token class-name\">Type</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">getDoubleTy</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token comment\">// 创建一个函数，将函数命名为 check</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    Function <span class=\"token operator\">*</span>checkFunc <span class=\"token operator\">=</span> <span class=\"token class-name\">Function</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Create</span><span class=\"token punctuation\">(</span>funcType<span class=\"token punctuation\">,</span> Function<span class=\"token double-colon punctuation\">::</span>ExternalLinkage<span class=\"token punctuation\">,</span> <span class=\"token string\">\"check\"</span><span class=\"token punctuation\">,</span> mod<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token comment\">// 存储参数（获取参数的引用）</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    Function<span class=\"token double-colon punctuation\">::</span>arg_iterator argsIT <span class=\"token operator\">=</span> checkFunc<span class=\"token operator\">-></span><span class=\"token function\">arg_begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//Function 中的一个方法，获取参数的迭代器</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    Value <span class=\"token operator\">*</span>arg_n <span class=\"token operator\">=</span> argsIT<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 获取第一个参数</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  \t<span class=\"token comment\">// 在 \"check\" 函数中创建一个基本块</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    BasicBlock <span class=\"token operator\">*</span>entryBlock <span class=\"token operator\">=</span> <span class=\"token class-name\">BasicBlock</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Create</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span> checkFunc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    builder<span class=\"token punctuation\">.</span><span class=\"token function\">SetInsertPoint</span><span class=\"token punctuation\">(</span>entryBlock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 设置插入点为上一行创建的基本块</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    Value <span class=\"token operator\">*</span>fRemResult <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">CreateFRem</span><span class=\"token punctuation\">(</span>arg_n<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConstantFP</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token function\">APFloat</span><span class=\"token punctuation\">(</span><span class=\"token number\">100.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 创建 \"FRem\" 指令</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    builder<span class=\"token punctuation\">.</span><span class=\"token function\">CreateRet</span><span class=\"token punctuation\">(</span>fRemResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 创建 \"ret\" 指令， 返回值为 \"FRem\" 的结果</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>Function <span class=\"token operator\">&amp;</span>F <span class=\"token operator\">:</span> <span class=\"token operator\">*</span>mod<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>BasicBlock <span class=\"token operator\">&amp;</span>BB <span class=\"token operator\">:</span> F<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>Instruction <span class=\"token operator\">&amp;</span>I <span class=\"token operator\">:</span> BB<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    mod<span class=\"token operator\">-></span><span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token function\">outs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"创建跳转\"><a class=\"anchor\" href=\"#创建跳转\">#</a> 创建跳转</h2>\n<ol>\n<li>\n<p>通过函数调用进行跳转</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// BO 是 FAdd 指令指针，同时也是该指令的返回值</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">auto</span> <span class=\"token operator\">*</span>BO <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">dyn_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>BinaryOperator<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>I<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>BO<span class=\"token operator\">-></span><span class=\"token function\">getOpcode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> Instruction<span class=\"token double-colon punctuation\">::</span>FAdd<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// 设置插入点为 BO 指令的下一条</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   builder<span class=\"token punctuation\">.</span><span class=\"token function\">SetInsertPoint</span><span class=\"token punctuation\">(</span>BO<span class=\"token operator\">-></span><span class=\"token function\">getNextNode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token comment\">// 创建 call 指令，call checkFunc 函数，参数为 BO</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   Value <span class=\"token operator\">*</span>checkResult <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">CreateCall</span><span class=\"token punctuation\">(</span>checkFunc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span>BO<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>通过函数返回进行跳转</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 函数原型：ReturnInst *CreateRet (Value *RetVal, Instruction *InsertBefore = nullptr);</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">// 接受一个返回值 RetVal，将其作为函数的返回值返回。可选的 InsertBefore 参数允许指定插入该指令的位置，默认为 nullptr，表示在当前插入点处插入。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>builder<span class=\"token punctuation\">.</span><span class=\"token function\">CreateRet</span><span class=\"token punctuation\">(</span>fRemResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>无条件跳转</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 在当前基本块的末尾创建一个无条件跳转指令，使控制流转移到 DestBB 指定的基本块</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>builder<span class=\"token punctuation\">.</span><span class=\"token function\">CreateBr</span><span class=\"token punctuation\">(</span>DestBB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>条件跳转</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 创建比较指令，比较 sum 和 100.0 的大小</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Value <span class=\"token operator\">*</span>cmp <span class=\"token operator\">=</span> builder<span class=\"token punctuation\">.</span><span class=\"token function\">CreateFCmpUGT</span><span class=\"token punctuation\">(</span>sum<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ConstantFP</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> <span class=\"token function\">APFloat</span><span class=\"token punctuation\">(</span><span class=\"token number\">100.0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">// 创建条件跳转，完整定义如下：</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// BranchInst *CreateCondBr(Value *Cond, BasicBlock *TrueBB, BasicBlock *FalseBB, Instruction *InsertBefore = nullptr);</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>builder<span class=\"token punctuation\">.</span><span class=\"token function\">CreateCondBr</span><span class=\"token punctuation\">(</span>cmp<span class=\"token punctuation\">,</span> TrueBB<span class=\"token punctuation\">,</span> FalseBB<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"获取更改参数\"><a class=\"anchor\" href=\"#获取更改参数\">#</a> 获取 / 更改参数</h2>\n<p>加入我想通过 LLVM C++ API 获取一个 IR 指令的参数以便后续分析、或将其修改为指定值</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 创建一个加法指令</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Instruction <span class=\"token operator\">*</span>AddInst <span class=\"token operator\">=</span> <span class=\"token class-name\">BinaryOperator</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">CreateAdd</span><span class=\"token punctuation\">(</span>Operand1<span class=\"token punctuation\">,</span> Operand2<span class=\"token punctuation\">,</span> <span class=\"token string\">\"sum\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Value <span class=\"token operator\">*</span>NewValue <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 定义一个新的操作数值 NewValue</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// 函数原型：void Instruction::setOperand (unsigned index, Value *val);</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//index 表示要设置的操作数的索引，从 0 开始，表示指令的第一个操作数；</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//val 表示要设置的新的操作数值，类型为 Value，可以是常量、变量或其他指令的结果</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>AddInst<span class=\"token operator\">-></span><span class=\"token function\">setOperand</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> NewValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 将 Add 指令的第一个参数修改为 NewValue</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">// 获取第一个操作数 Operand1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">// 注意：AddInst 同时也是一个 Value * 类型，表示 add 的计算结果</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>AddInst<span class=\"token operator\">-></span><span class=\"token function\">getOperand</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldmlhbi16aGFuZy5naXRodWIuaW8vbGx2bS1pci10dXRvcmlhbC9pbmRleC5odG1s\">https://evian-zhang.github.io/llvm-ir-tutorial/index.html</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sbHZtLm9yZy9kb2NzL0xhbmdSZWYuaHRtbA==\">https://llvm.org/docs/LangRef.html</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sbHZtLm9yZy9kb2NzL0NvZGluZ1N0YW5kYXJkcy5odG1s\">https://llvm.org/docs/CodingStandards.html</span></li>\n</ul>\n",
            "tags": [
                "LLVM",
                "LLVM",
                "教程"
            ]
        },
        {
            "id": "https://gality.cn/ml/transformer/",
            "url": "https://gality.cn/ml/transformer/",
            "title": "Transformer 详解",
            "date_published": "2024-02-23T07:13:11.000Z",
            "content_html": "<div class=\"note primary no-icon\">\n<p>Transformer 是一种采用了 “自注意力机制” 的模型，主要应用于自然语言处理（NLP）和计算机（CV）视觉领域。Transformer 采用 “encoder+decoder” 的架构，输入和输出都可以是不定长的序列（seq2seq）。通过注意力机制，transformer 可以学习到输入序列中的上下文信息，从而表现出更强的学习能力。</p>\n<p><strong>Key words：seq2seq、Encoder、Decoder、Multi-headed Attention、Positional Encoding、Input Embedding</strong></p>\n</div>\n<h1 id=\"transformer-架构\"><a class=\"anchor\" href=\"#transformer-架构\">#</a> Transformer 架构</h1>\n<div class=\"note info no-icon\">\n<p>为了方便解释，下文都以<strong>文本翻译</strong>为例来解释 transformer。在这个例子中，transformer 的输入是一段英文，输出是一段不定长度的中文。</p>\n</div>\n<p>原始的 Transformer 采用<strong>编码器 - 解码器</strong>（Encoder–Decoder）架构，Encoder 和 Decoder 又由多层小 encoder 和 decoder 组成。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/767krk.jpg\" alt=\"Transformer架构\" /></p>\n<h2 id=\"评估过程\"><a class=\"anchor\" href=\"#评估过程\">#</a> 评估过程</h2>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/64apze.jpg\" alt=\"评估过程\" /></p>\n<p>原始输入信息在进入 Encoder 之后，首先需要进行<strong>词嵌入</strong>和<strong>位置信息编码</strong>转换为一组向量，然后将该组向量向量经过<strong>多层</strong>的抽取会被映射为一组<strong>抽象的连续表示</strong>，其中包含了原始输入的所有可学习信息（可以理解为一种总结概括，保留输入中对机器有用的信息，然后输出成一种机器能看懂的形式），然后将该组表示输入到 Decoder 中。每层小 decoder 利用输入的那些表示来生成输出信息，注意，小 decoder 生成的信息同样也会被输入到其他小 decoder 中参与后续的输出，即每一次小 decoder 的输入是<strong>其他小 decoder 之前的输出</strong>和<strong> Encoder 的输出</strong>。</p>\n<h2 id=\"训练过程\"><a class=\"anchor\" href=\"#训练过程\">#</a> 训练过程</h2>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ew35a6.jpg\" alt=\"训练过程\" /></p>\n<p>相比于使用 transformer，在训练 transformer 的时候，Decoder 的输入会有所不同。在训练时，Decoder 的输入是<strong> Encoder 的输出</strong>和<strong>正确答案</strong>，目的是让 Decoder 能根据正确的答案计算交叉熵，这样才能进行参数更新。关于这部分的细节，我会在后文中详细讲解。</p>\n<h1 id=\"transormer-细节\"><a class=\"anchor\" href=\"#transormer-细节\">#</a> Transormer 细节</h1>\n<h2 id=\"词嵌入\"><a class=\"anchor\" href=\"#词嵌入\">#</a> 词嵌入</h2>\n<div class=\"note info no-icon\">\n<p>在机器学习中，为了快速运算，通常会将数据转换成各种 tensor。而 transformer 的输入是一段序列（可能是文本、像素等离散值），以什么规则来将这些值组成 tensor 会直接影响机器学习结果的好坏，所以需要探索一种好的<strong>转换规则</strong>。将单词转换（嵌入）到 tesnor 的过程就是<strong>词嵌入（word embedding）</strong>。</p>\n</div>\n<p>假设现在有三个单词：</p>\n<ul>\n<li>apple</li>\n<li>orange</li>\n<li>iphone</li>\n</ul>\n<p>我们可以将每一个单词转换成一个 one-hot 向量，但这会带来两个问题：</p>\n<h2 id=\"encoder-详解\"><a class=\"anchor\" href=\"#encoder-详解\">#</a> encoder 详解</h2>\n",
            "tags": [
                "机器学习",
                "机器学习",
                "tranformer"
            ]
        },
        {
            "id": "https://gality.cn/ml/CNN/",
            "url": "https://gality.cn/ml/CNN/",
            "title": "CNN | Network Architecture Designed for Image",
            "date_published": "2024-02-05T03:12:37.000Z",
            "content_html": "<div class=\"note info no-icon\">\n<p>卷积神经网络（Convolutional Neural Network）是一种专为图像处理设计的神经网络结构。相比于全连接神经网络结构，卷积神经网络在面对图像相关任务时有突出的表现，这是因为这种特殊的网络结构的设计思路与图像本身的特征紧密相关，也正因为如此，如果想将 CNN 应用于其他模态任务中，应根据具体模态的特征对网络进行修改。「著名的 AlphaGo 就是基于 CNN 结构来进行学习的」</p>\n</div>\n<h1 id=\"问题引入\"><a class=\"anchor\" href=\"#问题引入\">#</a> 问题引入</h1>\n<p>假设我们希望用机器学习来实现一个图片分类任务，模型的输入是一张图片，模型的输出是其所属的分类。以一个 <code>100x100</code>  像素的图片为例（作为对比，我们常说的 4K 分辨率指 <code>3840x2160</code>  像素）。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/vldzu5.jpg\" alt=\"图片处理\" height=\"350\" /></p>\n<p>图片可以看作是一个 3 维的 tensor，三个维度分别为：长、宽、通道。对于彩色图片来说，有三个通道，对应着<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNjc4MjMzMTk=\"> RGB 三种颜色</span>（计算机存储图片的原理）。由于神经网络的输入只能是一个向量（2 维），所以为了让神经网络能读取一个图片，我们需要先将三维 tensor “平坦化”，将三维的 tensor 按通道维度排列成 2 维的向量，在这个例子中，向量的大小为 <code>300x100</code> 。</p>\n<p>我们先考虑用一个全连接神经网络来处理这个图片，假设第一层有 1000 个神经元，任意一个输入到任意一个神经元之间都应存在一个 “权重”。此时，第一层将有 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>100</mn><mo>×</mo><mn>300</mn><mo>×</mo><mn>1000</mn><mo>=</mo><mn>1</mn><msup><mn>0</mn><mn>7</mn></msup></mrow><annotation encoding=\"application/x-tex\">100 \\times 300 \\times 1000 = 10^7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span></span></span> 个 “权重”，这还是在不考虑 “偏置”，不考虑 “多层” 网络的情况下。</p>\n<p><span class=\"red\">事实上，想要更新如此海量的参数，对算力要求实在太过庞大，根本就 “train” 不起来。</span></p>\n<h1 id=\"简化基于局部特征来简化网络结构\"><a class=\"anchor\" href=\"#简化基于局部特征来简化网络结构\">#</a> 简化：基于局部特征来简化网络结构</h1>\n<p>人类在识别图片时，图片中的大部分的内容其实是无用的，人类其实是通过一些<strong>局部特征</strong>来识别物体的，例如下面的图片，第一眼看上去非常像一只乌鸦，因为我们首先看到了 “喙”，结合 “黑色” 的特征，我们很容易联想到乌鸦。但是再往下看，当我们看到了 “尾巴” 这个特征后，我们会反应过来，原来这是一个猫。但是无论我们怎么识别这个动物，周围的黄色地板别没有为我们提供任何有效信息，把它们去掉也并不影响我们识别出这个动物。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/fih9ra.png\" alt=\"“乌鸦”猫猫\" height=\"210\" /></p>\n<h2 id=\"让模型只关注局部细节\"><a class=\"anchor\" href=\"#让模型只关注局部细节\">#</a> 让模型只关注局部细节</h2>\n<p>受上面的观察启发，我们发现在进行图像处理时，神经网络其实并不需要整个图像来作为输入，只要神经网络能识别出图片中物体的某些特征就足够完成识别任务了。因此，我们可以考虑按一定的规则来将原图片划分成多个 “小图片”，给一个小图片分配<strong>一个或多个神经元</strong>来学习。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/wqu0cs.jpg\" alt=\"模型只看细节\" height=\"350\" /></p>\n<p>假设我们将图片划分成 <code>3x3</code>  像素（需要根据实际情况调整，能覆盖住特征即可，覆盖不完全也可以，后面会说）的小图片，并且令每 3 个神经元学习一个小图片，那么此时，对于一个神经元来说，所需更新的 “权重” 就从过去的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">3 \\times 10^4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span> 个降低到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><mo>×</mo><mn>3</mn><mo>×</mo><mn>3</mn><mo>=</mo><mn>9</mn></mrow><annotation encoding=\"application/x-tex\">3\\times3\\times3=9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">9</span></span></span></span> 个，所需运算量就会大大减小了，这就是一种简化。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/7qunhq.png\" alt=\"感受野\" height=\"350\" /></p>\n<p>其中，每个神经元可感知的区域，就叫做<strong>感受野（receptive field）</strong>。</p>\n<h2 id=\"常见问题\"><a class=\"anchor\" href=\"#常见问题\">#</a> 常见问题</h2>\n<h3 id=\"感受野是否可以重叠为什么\"><a class=\"anchor\" href=\"#感受野是否可以重叠为什么\">#</a> 感受野是否可以重叠，为什么？</h3>\n<p>感受野可以重叠，也必须重叠，因为在划定感受野时我们并不能保证识别物体所需的特征就正好完整的落在感受野内，所以，最好逐像素的划定感受野，以保证特征可以完整的出现在某些神经元的感受野中。每个感受野相隔的距离称为<strong>步长（stride）</strong>。</p>\n<h3 id=\"感受野的设计是否有规范\"><a class=\"anchor\" href=\"#感受野的设计是否有规范\">#</a> 感受野的设计是否有规范？</h3>\n<p>感受野可以根据任务需要随意设计，例如感受野可以只看某个通道、或者感受野的形状也可以是长方形等等、或者也是可以设计不同大小的感受野，总之，一切根据任务需要来。</p>\n<h3 id=\"感受野越过图像边界怎么办\"><a class=\"anchor\" href=\"#感受野越过图像边界怎么办\">#</a> 感受野越过图像边界怎么办？</h3>\n<p>可以直接不填充，也可以根据需要对图像的边缘进行填充，同样，具体怎么填充也可以随意设计。</p>\n<h3 id=\"经典设计\"><a class=\"anchor\" href=\"#经典设计\">#</a> 经典设计</h3>\n<p>这里提供一种经典设计：每个感受野分配 64 个神经元，感受野大小 <code>3x3</code> ，步长为 2，边缘需要进行填充。</p>\n<h1 id=\"简化基于相似特征简化训练过程\"><a class=\"anchor\" href=\"#简化基于相似特征简化训练过程\">#</a> 简化：基于相似特征简化训练过程</h1>\n<p>人类在识别图片的过程中常常会忽略一点，那就是我们要识别的物体可以在图片中的任意位置，人类会自动忽略物体相对在图片中相对位置的区别，但是对于神经网络来说，由于是不同的神经元来感知不同的区域，所以可能存在某一特征换了个位置，另外一个神经元识别不出的情况。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ge8iuo.jpg\" alt=\"同一特征出现在不同位置\" height=\"350\" /></p>\n<h2 id=\"让不同感受野的神经元共享参数\"><a class=\"anchor\" href=\"#让不同感受野的神经元共享参数\">#</a> 让不同感受野的神经元共享参数</h2>\n<p>神经网络学习的过程其实就是确定一组参数的过程，我们从单个神经元的角度来看，神经元对某特征的识别可以对应到该神经元的一组参数上，所以，如果我们让不同的神经元共享这一组参数，则可以实现让不同的神经元都可以识别同一特征。这里需要强调的的是，这里的不同的神经元必须是<strong>不同感受野</strong>的神经元，由于不同的感受野的神经元的输入不同，即使共享同一组参数，仍然会有不同的输出；而如果是同一感受野的神经元的话，共享同一组参数则会使不同神经元输出相同的结果，这并不是我们希望看到的。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/53hkro.jpg\" alt=\"不同感受野的神经元共享同一组参数\" height=\"350\" /></p>\n<p>进一步来说，其实就是将一组参数和一个特征绑定，记得上文中提到的要让多个神经元来感受同一个感受野吗？是的，让 64 个神经元感受一个感受野，其实就是在模型中预留了 64 个 “可更新” 的特征位，该模型最多可以从图片中提取 64 个不同的特征，且任意一个感受野的神经元都可以识别这种特征。感受同一个感受野的不同神经元我们以 <code>filter x</code>  来命名，第一个称为 <code>filter 1</code> ，以此类推。</p>\n<p>这样，我们就可以在训练过程中<strong>同步更新多个神经元</strong>，任意一个神经元学习到某种特征后，其他感受野的对应的 <code>filter</code>  也会自动的学会这种特征，从而大大简化训练的过程，同时提高模型的泛化能力。</p>\n<h1 id=\"从filter的角度看待训练过程\"><a class=\"anchor\" href=\"#从filter的角度看待训练过程\">#</a> 从 filter 的角度看待训练过程</h1>\n<p>前面说过，一个 <code>filter</code>  识别一种特征，这个说法可能稍微有些抽象，我们来给出一个具体的例子：输入是一个 <code>6x6</code>  像素的黑白图片（通道数为 1），感受野为 <code>3x3</code> ，每个感受野设置 64 个神经元去学习，步长为 1，在神经网络中我们仍只考虑 “权重”。</p>\n<h2 id=\"一个filter识别一种特征\"><a class=\"anchor\" href=\"#一个filter识别一种特征\">#</a> 一个 filter 识别一种特征</h2>\n<p>首先来说明为什么一个 <code>filter</code>  可以识别一种特征。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/lxcfqf.jpg\" alt=\"一个filter识别一种特征\" height=\"350\" /></p>\n<p>假设 <code>Filter 1</code>  就是一个主对角线全为 1，其他元素都为 - 1 的权重矩阵，那么当且仅当感受野中主对角线全为 1，其他元素全 0 时才能，该神经元的输出可以取得最大值 3，即 <code>Filter 1</code>  识别了特征：有一条从左上到右下的线。</p>\n<h2 id=\"从小图片到整个图片\"><a class=\"anchor\" href=\"#从小图片到整个图片\">#</a> 从小图片到整个图片</h2>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/5ftedn.jpg\" alt=\"多层CNN\" height=\"350\" /></p>\n<p>因为一个感受野设置了 64 个神经元，所以第一层卷积层处理后得到的是一个 64 通道，大小为 <code>4x4</code>  的特征 tensor，将该输出交给下一层卷积层，下一个卷积层设置的感受野仍为 <code>3x3</code> ，但是这时，由于 <code>3x3</code>  的感受野中的每一个 <code>Feature</code>  都是从原图片中 <code>3x3x1</code>  的小图片中提取的，即每一个 <code>Feature</code>  都包含了 <code>3x3x1</code>  的像素信息，那么第二层卷积层所能 “感受” 的范围其实是原图片中 <code>5x5x1</code>  大小的区域。</p>\n<p>随着卷积层的增多，后面的卷积层中的神经元 “感受” 的范围就会<strong>越来越大</strong>。</p>\n<h1 id=\"简化基于图片的压缩来简化计算量\"><a class=\"anchor\" href=\"#简化基于图片的压缩来简化计算量\">#</a> 简化：基于图片的压缩来简化计算量</h1>\n<p>一般来说，对图片进行降采样并不影响图片的识别，我们可以采用某种方法来将多个像素合成成一个像素，从而大幅减少图片中的总像素点数，这过程称为 <code>Pooling</code> 。以 <code>Max Pooling</code>  为例， <code>Max Pooling</code>  就是用一个区域内最大的值代替该区域的所有值，从而压缩图片大小。</p>\n<p>需要注意的是，无论怎样 <code>Pooling</code>  都一定会减少图片的特征。这种方法一般在过去算力紧张时使用，现在的 CNN 中已经在慢慢减少，甚至完全不使用 <code>Pooling</code>  技术了。</p>\n<h1 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h1>\n<p>卷积神经网络其实就是一种专为处理图像而设计的网络结构。全连接层可以处理任何任务，同样的，也意味着他并不擅长任何任务。在全连接的基础上加入 “感受野” 和 “参数共享”，就诞生了卷积卷积神经网络。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/gch9wd.png\" alt=\"Benefit of Convolutional Layer\" height=\"350\" /></p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMVRENHkxMzdtUD9wPTIw\">https://www.bilibili.com/video/BV1TD4y137mP?p=20</span></li>\n</ul>\n",
            "tags": [
                "机器学习",
                "机器学习",
                "CNN",
                "图像处理"
            ]
        },
        {
            "id": "https://gality.cn/scientific-research/thesis-reading/%20Blockchain%20Imitation%20Game/",
            "url": "https://gality.cn/scientific-research/thesis-reading/%20Blockchain%20Imitation%20Game/",
            "title": "论文阅读｜ The Blockchain Imitation Game",
            "date_published": "2024-01-08T06:21:22.000Z",
            "content_html": "<div class=\"note info\">\n<p>Qin K, Chaliasos S, Zhou L, et al. The blockchain imitation game[J]. arXiv preprint arXiv:2303.17877, 2023.</p>\n<p>链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudXNlbml4Lm9yZy9zeXN0ZW0vZmlsZXMvc2VjMjNmYWxsLXByZXB1Yi0zMzEtcWluLnBkZg==\">https://www.usenix.org/system/files/sec23fall-prepub-331-qin.pdf</span></p>\n</div>\n<details class=\"primary\"><summary>思考🤔</summary><div>\n<p>回顾整篇论文，安全问题产生于 “抢先” 运行，这种抢先运行是基于某些私密 “情报” 的，这种事情非常常见，影响也非常广泛，就像罗斯柴尔德借助拿破仑滑铁卢掌控了整个英国的经济一样，掌握 “情报” 的用户可以几乎 “确定的” 盈利。这一情况在区块链中的影响会更加的严重，因为在区块链中，矿工本身就可以进行交易，相当于可以不直接经过 “交易所” 就可以完成金钱的流动，这无疑更有利于那些能更快拥有 “情报” 的矿工。</p>\n<p>我认为，论文中提出的方法有几个关键点：</p>\n<ol>\n<li>根据动态控制流图的构建快速分析程序的流程</li>\n<li>通过污点分析程序自动化找到污点位置并生成对抗性智能合约</li>\n<li>本地快速验证以确保攻击收益</li>\n</ol>\n<p>从实验的结果来看，APE 在以太坊中成功攻击的交易占 0.0061%；在 BSC 中成功攻击的交易占 0.0022%，这个比例相比于 &quot;Naive Transaction Imitation Attack&quot; 来说虽然更小，但是产生的收益却翻了 3 倍左右。这意味着部分大额交易采用了的保密的智能合约来对抗 &quot;Naive Transaction Imitation Attack&quot;，这是合理的，但同时也暴露了交易所其实缺乏对于安全问题的深刻认知，总是尝试通过尽可能小的改变来对已知安全威胁进行防护，这可能会导致更大的安全隐患；另外一个暴露出来的问题是即使在安全威胁已知的前提下，大量的用户并没有关心可能存在的安全风险，在区块链这样的一个有海量节点及用户的应用中，攻击者更容易通过已知威胁来获取利益，从这点上来说，如果金融类区块链算法本身可以及时提供对安全威胁的更新并强制进行版本验证，可以最大程度上避免金融损失。</p>\n<p>从 APE 的实现角度来说，APE 中的程序流分析、污点分析、对抗性智能合约生成的底层实现都是基于对区块链程序的二进制分析，这种攻击手法需要对于二进制程序有极强的了解，同时，近年来由 Go 语言实现的区块链程序不断增多，Go 语言本身的代码设计又增加了逆向分析的难度，一定程度上提高了安全性。因此，虽然 APE 中的程序流分析无法对抗对程序流的混淆防护，但是却提供了一种更轻量化的安全攻击的思路，这种思路对于相对来说还未高度复杂化的区块链程序可能会更加好用。</p>\n<p>整体来看，APE 虽然实现了一种通用的模拟攻击的方法，但是本身其实仍然相对简单，能成功运行模拟攻击的交易数量仍然占比很小，我认为存在一些可以改进的点。</p>\n<ol>\n<li>在污点分析中，APE 仅仅是结合了部分确定的 EVN 操作码，这可能会导致部分事实上可处理的污点程序未被发现，这里可以结合 “fuzzing” 技术提前对所有的 EVN 操作码进行筛选，尽可能将所有可能造成污点的操作码找出，有利于扩大攻击面。</li>\n<li>在智能合约生成中，论文并没有详细的描述这里生成智能合约的具体方法，但是从论文来看主要 patch 的点在于对  <code>JUMPI</code>  的替换，这其实是一种简单的针对程序流的控制手段，对应的防护方法也非常多，很容易的导致模仿攻击失效。可以通过增加更多的 patch 模版，针对更多操作码进行改变来扩大攻击面。</li>\n</ol>\n</div></details>\n<h1 id=\"abstract\"><a class=\"anchor\" href=\"#abstract\">#</a> Abstract</h1>\n<p>使用区块链进行自动交易和对抗性交易已经司空见惯。然而，由于区块链的透明性，对手能够观察到任何<span class=\"red\">悬而未决、尚未挖掘的交易及其执行逻辑</span>。这种透明性进一步助长了新型对手的出现，他们会实时<span class=\"red\">复制并预先运行有利可图的待处理交易</span>，从而获得可观的经济收益。</p>\n<p>为了揭示这种 &quot;复制粘贴&quot; 的不良行为，本文介绍了区块链模仿游戏，并提出了一种名为 APE 的通用模仿攻击方法。APE 利用动态程序分析技术，支持对抗性智能合约的自动合成。在一年的时间内（2021 年 8 月 1 日至 2022 年 7 月 31 日），APE 可以在以太坊上产生 1.4896 亿美元的利润，在 BNB 智能链（BSC）上产生 4270 万美元的利润。</p>\n<p>不仅是恶意攻击，我们还进一步展示了<span class=\"red\">交易和合约模仿作为防御策略的潜力</span>。我们发现，APE 在一年内分别成功模仿了以太坊和 BSC 上 13 次和 22 次已知的去中心化金融（DeFi）攻击。我们的发现表明，区块链验证器可以实时模仿攻击，以防止 DeFi 中的入侵。</p>\n<h1 id=\"introduction\"><a class=\"anchor\" href=\"#introduction\">#</a> Introduction</h1>\n<p>建立在区块链基础上的去中心化金融（DeFi）已发展成为一个价值数十亿美元的产业。然而，区块链点对点（P2P）网络被描述为黑暗森林，交易者在其中进行竞争性交易，沉溺于对抗性的<strong>前置运行 (front-running)</strong>。</p>\n<blockquote>\n<p>Front-running：经纪人或投资者因为预先知道会影响资产价格的大型机密交易而加入交易，从而获得利益。</p>\n</blockquote>\n<p>由于交易创建和在区块链上提交之间存在固有的时间延迟，因此这种前置运行是可能发生的。这种时间延迟通常只持续几秒钟，这给前置运行者带来了计算上的挑战。为了获得经济收益，DeFi 交易者需要监控错综复杂的市场动态，并及时进行有利可图的交易，这通常需要专业的领域知识。相反，对抗性交易者也可能寻求 &quot;复制粘贴&quot; 和模仿攻击。我们将这种策略称为模仿攻击。一种极其简单的<strong>字符串替换模仿方法</strong>被证明可以在过去的区块链状态下每月产生数千美元的收益。</p>\n<blockquote>\n<p>KaihuaQin,LiyiZhou,andArthurGervais.Quantifyingblockchain extractable value: How dark is the forest? In <em>2022 IEEE Symposium on Security and Privacy (SP)</em>, pages 198–214. IEEE, 2022.</p>\n</blockquote>\n<p>开源社区迅速提出了防御措施，以应对这种简单的模仿方法。在撰写本文时，交易者通常会部署个性化的闭源智能合约，从而增加了利用的难度。已知的模仿算法不再适用，因为这些合约通常通过验证等方式加以保护。</p>\n<p>然而，人们还没有探索出一种通用的模仿攻击能使现有的保护机制失效。这项工作的目标是<span class=\"red\">研究、识别、实施和评估一种通用的模仿方法</span>。我们发现，要成功模仿交易，攻击者需要克服以下三个技术难题。</p>\n<ol>\n<li>前端运行时间窗口较短，可能无法应用强大的程序分析技术，如符号执行，因为符号执行不是为实时任务设计的。</li>\n<li>攻击者需要递归地识别阻碍模仿执行的受害合约，并用新合成的对抗合约替换它们。因此，有必要使用区块链虚拟机工具来确保这一识别过程的效率。</li>\n<li>攻击者必须保证合成的合约被正确调用和执行，而产生的财务收入则在模仿执行后被发送到恶意账户。据我们所知，现有的工作或现成的工具都无法自动复制和合成注入自定义逻辑的智能合约。</li>\n</ol>\n<p>在这项工作中，我们提出了一种自动且通用的模仿方法 APE（参见图 1）。抽象来说，APE 的目的是构建一个模仿交易，复制受害者交易的逻辑。必要时，APE 会合成并部署对抗性智能合约，以绕过验证机制等复制保护。为此，APE 利用动态污点分析、程序合成和高级工具来实现模仿生成。这种通用性源于这样一个事实，即对手不需要事先了解受害者，也不需要了解受害者的交易逻辑，更不需要事先了解交互的去中心化应用程序（DApp）。APE 适用于可替代、不可替代代币的交易活动以及利用交易等。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/apo7w0.png\" alt=\"图1 高级 APE 攻击机制是一种通用的模仿方法，可在事先不了解受害者的交易和合同的情况下合成对抗性合同。APE 会侵占由此产生的任何收入\" /></p>\n<p>尽管基于区块链的 DeFi 领域蓬勃发展，但它也受到数百万美元黑客攻击的困扰。如本作品所述，模仿攻击可为恶意攻击者带来巨大的经济利益。不过，根据深度防御方法，区块链模仿攻击本身也可以通过模仿攻击、挪用易受攻击的资金并将其返还给受害者来充当入侵防御系统。开源社区将这种善意活动称为 &quot;白帽黑客&quot;。</p>\n<p>我们将我们的贡献总结如下：</p>\n<ul>\n<li>我们引入了广义区块链模仿游戏，其中有一类新的对手试图在事先不了解受害者意图或应用逻辑的情况下，模仿受害者的交易和相关合约。我们为基于 EVM 的区块链设计了通用模仿工具 APE。我们首次展示了动态程序分析技术可以实现模仿攻击，从而对区块链用户构成实质性威胁。</li>\n<li>我们在以太坊和 BNB 智能链 (BSC) 上对 APE 进行了为期一年的评估。我们发现，APE 可以在以太坊上产生 1.4896 亿美元的利润，在 BSC 上产生 4270 万美元的利润。我们发现，7374 万美元源于 35 次已知的 DeFi 攻击，而 APE 可以将其消除。通过发现 5 个新漏洞，APE 的影响进一步显现，我们披露了这些新漏洞，因为如果被利用，它们可能会造成 3153 万美元的总损失。</li>\n<li>我们发现，APE 可在以太坊（13.3 秒的区块间时间）和 BSC（3 秒的区块间时间）上实时执行。模仿一次 APE 平均需要 0.07 ± 0.10 秒。由于 APE 的效率很高，在评估时间内，它在 35 次 DeFi 攻击中实现了实时的前置运行。执行 APE 的矿工最终可以选择实施攻击，也可以作为白帽黑客进行防御。</li>\n</ul>\n<h1 id=\"background\"><a class=\"anchor\" href=\"#background\">#</a> Background</h1>\n<p>在本节中，我们将概述所需的背景，并举例说明。</p>\n<h2 id=\"blockchain-and-smart-contract\"><a class=\"anchor\" href=\"#blockchain-and-smart-contract\">#</a> Blockchain and Smart Contract</h2>\n<p>区块链是分布在点对点网络上的区块链条。用户通过账户的公钥签名批准交易，矿工收集交易，并按照区块内的特定顺序进行挖掘。支持智能合约的区块链扩展了账户持有资产和代码的能力，可以执行任意计算。智能合约通过交易进行初始化和执行，一旦部署就不可更改。它们通常用高级语言（如 So-lidity）编写，编译成低级字节码，由区块链虚拟机（如以太坊虚拟机（EVM））执行。EVM 是基于堆栈的虚拟机，支持算术、控制流、加密和其他区块链特定指令（如访问当前区块编号）。每执行一条字节码指令都需要消耗 &quot;gas&quot;，由本地加密货币支付。请注意，所有代码和账户余额通常都是透明可见的。智能合约的应用二进制接口（ABI）定义了智能合约函数的调用方式（包括函数类型、名称、输入参数等）。如果智能合约不是开源的，ABI 很可能不可用。</p>\n<p>DeFi 是一个建立在智能合约区块链之上的新兴金融生态系统，在撰写本文时，其锁定的总价值已达到 3000 亿美元的峰值。DeFi 的核心是一个智能合约编码的金融生态系统，实现了 <strong>自动做市商 (automated market maker)</strong>、借贷平台和 <strong>稳定币 (Stablecoin)</strong> 等功能。用户可以通过向相应的合约发布交易来访问 DeFi 应用程序（DApp）。</p>\n<blockquote>\n<p>market maker：指在证券市场上，由具备一定实力和信誉的独立证券经营法人作为特许交易商，不断向公众投资者报出某些特定证券的买卖价格，并在该价位上接受公众投资者的买卖要求，以其自有资金和证券与投资者进行证券交易。买卖双方不需等待交易对方出现，只要有做市商出面承担交易对手方即可达成交易，做市商从双方赚取买卖价差而从中获利。</p>\n<p>Stablecoin：是加密货币 (Cryptocurrency) 的其中一种类型。稳定币的核心想法是要打造一种底层分散式账本，但维持货币稳定价值的机制。稳定币被有些人认为是中心化资产抵押发行的代币，稳定币价值是与被抵押资产价值直接连动。</p>\n</blockquote>\n<h2 id=\"blockchain-extractable-value\"><a class=\"anchor\" href=\"#blockchain-extractable-value\">#</a> Blockchain Extractable Value</h2>\n<p>众所周知，华尔街的交易员通过前置运行其他投资者的订单（即高频交易）来获利。同样，DeFi 中的交易顺序也对收益提取活动产生了致命影响。默认情况下，矿工按交易费从高到低的顺序排列交易。因此，DeFi 交易商可以通过提供有竞争力的交易费，对待处理（即尚未开采）的交易进行前置和后置操作。然而，矿工对下单交易拥有一手遮天般的特权，这使他们垄断了区块链价值的提取。这种特权引出了 ** 矿工可提取价值 (MEV)** 的概念。</p>\n<blockquote>\n<p>MEV：指 “在给定时间内，矿工可以从操纵交易中提取的 ETH 总量”。以以太坊为例，以太坊网络的运行是依靠矿工对交易进行打包，生成区块来运行的。矿工在打包交易的时候可以做到将某些交易进行排序干预等。通过这些操作，矿工可能获取除了交易费用和区块奖励之外的额外利润，这些多出来的价值就被称为 MEV。</p>\n</blockquote>\n<p>Qin 等人将 MEV 概括为区块链可提取价值（Blockchain Extractable Value，BEV），并表明在 32 个月内，以太坊上提取的 BEV 达 5.4054 亿美元，主要有三个来源：<strong>三明治攻击 [1]</strong>、<strong>清算 [2,3]<strong> 和</strong>套利 [4]</strong>。</p>\n<blockquote>\n<ol>\n<li>LiyiZhou,KaihuaQin,ChristofFerreiraTorres,DucVLe,andArthur Gervais. High-frequency trading on decentralized on-chain exchanges. In <em>2021 IEEE Symposium on Security and Privacy (SP)</em>, pages 428–445. IEEE, 2021.</li>\n<li>KaihuaQin,JensErnstberger,LiyiZhou,PhilippJovanovic,andArthur Gervais. Mitigating decentralized finance liquidations with reversible call options. In <em>International Conference on Financial Cryptography and Data Security</em>. Springer, 2023.</li>\n<li>KaihuaQin,LiyiZhou,PabloGamito,PhilippJovanovic,andArthur Gervais. An empirical study of defi liquidations: Incentives, risks, and instabilities. In <em>Proceedings of the 21st ACM Internet Measurement Conference</em>, page 336–350. ACM, 2021.</li>\n<li>LiyiZhou,KaihuaQin,AntoineCully,BenjaminLivshits,andArthur Gervais. On the just-in-time discovery of profit-generating transactions in defi protocols. In <em>2021 IEEE Symposium on Security and Privacy (SP)</em>, pages 919–936, 2021.</li>\n</ol>\n</blockquote>\n<p>需要注意的是，前台运行即服务（FaaS）（如 flashbots）通过在私有网络中与矿工勾结，降低了提取 BEV 的风险。与贿赂类似，BEV 被证明会威胁到区块链共识的安全性，因为矿工会被激励分叉区块链。关于 DeFi 攻击的 SoK 系统分析了四年来的攻击，确定了各种攻击的原因和影响。在本文中，我们对白帽攻击者和黑帽攻击者进行了区分，其中黑帽攻击者保留了攻击的经济收益，而白帽攻击者则将攻击收入退还给确定的受害者。</p>\n<h2 id=\"naive-transaction-imitation-attack\"><a class=\"anchor\" href=\"#naive-transaction-imitation-attack\">#</a> Naive Transaction Imitation Attack</h2>\n<p>提取实体的 BEV 可采用两种策略：一种是对 DeFi 应用程序进行细致分析（即针对特定应用程序的提取），另一种是采用天真的通用事务模仿攻击（即与应用程序无关的提取）。</p>\n<p>Qin 等人提出了一种天真但有效的事务模仿攻击。<strong>该算法将受害者交易作为输入，并在交易发送者和数据字段中简单地将交易的发送者地址替换为恶意地址</strong>。因此，这种模仿算法相当于字符串替换方法，并不试图合成对抗性智能合约。在对过去的区块链数据进行模拟时，结果表明这种天真的算法可以在 32 个月的时间内产生 3537 万美元。我们在附录 A 中提供了一个天真的模仿示例。但是，当交易者通过认证机制等方式保护自己的交易时，这种算法就会失效，我们将在下文概述。</p>\n<h2 id=\"motivating-examples\"><a class=\"anchor\" href=\"#motivating-examples\">#</a> Motivating Examples</h2>\n<p>DeFi 中的交易者通常使用定制的智能合约来执行金融行为，例如套利和清算。这些交易者尝试保护其交易免受仿冒攻击，例如只允许预定义账户调用其智能合约（参见图 2）。这种保护措施与认证机制相对应，是开源社区采用的一种常见做法。我们以现实世界中的身份验证为例进行说明。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/hxes5m.png\" alt=\"图 2：清算人通过向其定制合约发送交易触发清算。自定义合约包含一个验证（第 3 行）\" /></p>\n<p><em>身份验证保护示例</em>。在图 2 中，我们展示了「清算合约」如何尝试防止交易模仿攻击。图 2 中「清算合约」的实体代码没有开源，因此我们使用最先进的 EVM 合约去编译器对合约字节码进行反编译。要触发清算，清算人需要向增强合约发送交易以及「参数」（如闪贷规模和清算金额）。如果没有保护机制，对手可能通过调用带有相同参数的相同合约来运行清算器。然而，所提交的合约要求交易发送方匹配特定地址（第 3 行）。具体来说，清算函数 <code>printMoney()</code>  只能由硬编码地址调用。如果不满足这一条件，第 2.3 节中的天真模仿攻击就会失败。要规避身份验证保护，一种方法是合成一份恶意合约，复制清算者的定制合约。通过重构字节码，合成的合约既保留了清算逻辑，又绕过了身份验证。要执行攻击，攻击者无需了解清算交易的业务逻辑。对手不调用清算人的定制合约，而是调用合成合约，然后触发清算。</p>\n<p>在这项工作中，我们提出了一种自动化和通用化的模仿方法 APE，可以挫败此类保护。APE 不仅仅局限于身份验证，它还提供了一种全面的方法来克服天真模仿策略无法处理的各种形式的保护机制。再举个例子，我们考虑这样一个场景：交易者发布了一笔盈利交易，并将赚取的收入存入交易者控制的智能合约中。虽然对手可能会通过天真的策略成功执行模仿交易这个过程，但收入仍会留在 &quot;受害者&quot; 交易者的合约中，攻击者不会因此获得任何经济收益。与此相反，APE 通过合成一个作为收益接收者的对抗性合约来解决这一困境。我们将在第 5.3 节中进一步介绍这种情况的细节，并展示真实世界中的一笔交易。</p>\n<h1 id=\"ape-overview\"><a class=\"anchor\" href=\"#ape-overview\">#</a> APE Overview</h1>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/cdietk.png\" alt=\"论文中涉及的符号及含义\" /></p>\n<p>接下来，我们将概述系统和威胁模型。然后，我们将概述 APE 的关键组成部分。</p>\n<h2 id=\"preliminary-models\"><a class=\"anchor\" href=\"#preliminary-models\">#</a> Preliminary Models</h2>\n<ul>\n<li>\n<p><strong>系统模型</strong></p>\n<p>我们考虑采用智能合约的分布式账本和现有的 DeFi 生态系统。交易者通过其区块链账户执行金融操作，签署矿工挖掘的交易。同样，智能合约也由其各自的账户引用。区块链交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span></span></span></span> 代表状态转换函数，将账本状态从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 转换为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>S</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">S&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.751892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span>，即 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>S</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo>=</mo><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mo stretchy=\"false\">(</mo><mi>S</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">S&#x27; = \\mathrm{tx}(S)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.751892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span></span></span></span> 。</p>\n<p>我们假设，在 DeFi 系统中，除了原生区块链加密货币 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span> 之外，还存在各种资产表示形式（如可替代代币）。在区块链状态 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 下，账户 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> 持有的资产 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 余额用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi><mi>a</mi><msubsup><mi>l</mi><mi>a</mi><mi>m</mi></msubsup><mo stretchy=\"false\">(</mo><mi>S</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Bal^{m}_{a} (S)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span></span></span></span> Z 表示，而 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi mathvariant=\"normal\">Δ</mi><mi>a</mi><mi>m</mi></msubsup><mo stretchy=\"false\">(</mo><mi>S</mi><mo separator=\"true\">,</mo><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\Delta^{m}_{a}(S,\\mathrm{tx})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\">Δ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"mclose\">)</span></span></span></span> 表示在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span> 上执行交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span></span></span></span> 后的余额变化（参见公式 1）。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable width=\"100%\"><mtr><mtd width=\"50%\"></mtd><mtd><mrow><msubsup><mi mathvariant=\"normal\">Δ</mi><mi>a</mi><mi>m</mi></msubsup><mo stretchy=\"false\">(</mo><mi>S</mi><mo separator=\"true\">,</mo><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mo stretchy=\"false\">)</mo><mo>=</mo><mi>B</mi><mi>a</mi><msubsup><mi>l</mi><mi>a</mi><mi>m</mi></msubsup><mo stretchy=\"false\">(</mo><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mo stretchy=\"false\">(</mo><mi>S</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mo>−</mo><mi>B</mi><mi>a</mi><msubsup><mi>l</mi><mi>a</mi><mi>m</mi></msubsup><mo stretchy=\"false\">(</mo><mi>S</mi><mo stretchy=\"false\">)</mo></mrow></mtd><mtd width=\"50%\"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\Delta^{m}_{a} (S, \\mathrm{tx}) = Bal^{m}_{a} (\\mathrm{tx}(S)) - Bal^{m}_{a}(S) \\tag{1}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord\">Δ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7143919999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7143919999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7143919999999999em;\"><span style=\"top:-2.4530000000000003em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span></span><span class=\"tag\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord\">(</span><span class=\"mord\"><span class=\"mord\">1</span></span><span class=\"mord\">)</span></span></span></span></span></span></p>\n<p>我们进一步假设存在链上交易所，这些交易所允许从任何资产 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 到原生加密货币 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span> 的交易。</p>\n</li>\n<li>\n<p><strong>威胁模型</strong></p>\n<p>我们的考虑的最强的对抗模型为：一个矿工，它可以单枪匹马地在其开采的区块中进行交易。作为矿工， <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以访问每个待处理的交易和当前的区块链状态。 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 通过多个分布式节点和点对点连接，在 P2P 网络上主动列出数据。此外， <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 还可以充当或与 FaaS 提供商合作，私下接收待处理交易。由于  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 是矿工，因此  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以在任何待处理交易之前进行交易。我们假设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span>  在财务上是理性的，并试图最大化其资产价值。此外，我们假设  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以获得足够的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span> 来执行 APE。</p>\n<p>APE 与应用无关，这意味着  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 无需预先知道受害者交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的逻辑，也无需知道其目标智能合约。不过，我们假设即  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 了解如何与资产代币互动，并且  <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以通过上链交换将代币 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 交换给 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span>。</p>\n<p>我们将旨在复制和替换 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 行为的交易称为模仿交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 。<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 与一组合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{\\mathrm{sc}_{vi}\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span> 交互，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可能需要替换这些合约的子集才能成功执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 。我们认为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以处理任何受害合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，以合成各自的对抗合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n<p><strong>澄清</strong>   APE 无法形成新的攻击，因为 APE 事先不知道以前的区块链攻击，也不知道应用层逻辑。因此，APE 依赖于模板交易和编码攻击逻辑的相关合约。</p>\n</li>\n</ul>\n<h2 id=\"attack-overview\"><a class=\"anchor\" href=\"#attack-overview\">#</a> Attack Overview</h2>\n<p>给定一个有利可图的受害者交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，对手 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以尝试用简单的模仿交易来模仿其逻辑（参见第 3.3 节）。然而，由于现有的各种防御机制（如身份验证），这种天真的方法可能会失败（参见第 3.4 节）。由于缺乏关于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的先验知识，理解一个失败对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 来说具有挑战性。此外，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行可能与多个被调用的合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{\\mathrm{sc}_{vi}\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span> 交织在一起，从而使分析变得更加复杂。最后，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 必须实时攻击，因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 被挖掘出来前的攻击窗口通常只持续几秒钟。</p>\n<p>APE 的目标是生成一个模仿交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，以及一组模仿 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 逻辑的合成合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{\\mathrm{sc}_{ai}\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span>（和相关的受害者合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{\\mathrm{sc}_{vi}\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span>），并具有以下属性：</p>\n<ul>\n<li><strong>事先不了解受害者情况</strong>：任何盈利交易都应被视为潜在受害者，与发行者无关。<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 不需要事先了解受害者的交易、意图或过去的区块链历史。</li>\n<li><strong>不推理受害者逻辑</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 不知道 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的应用逻辑，也不涉及 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</li>\n<li><strong>额外复杂性带来更高回报</strong>：APE 引入了比天真的模仿方法更多的复杂性，因此应该能获得超过原模拟方法的收益。为了进行客观比较，我们在相同的区块链交易历史上对两种模仿方法进行了评估。</li>\n<li><strong>实时性</strong>：我们假设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 只攻击待处理的临时交易。因此，APE 必须快于区块间时间（例如，以太坊上约为 13.3 秒，BSC 上为 3 秒）。因此，必须优先考虑执行速度而不是攻击最优性。请注意，作为矿工的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以选择在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 上分叉区块链，从而获得更长的攻击时间窗口，这超出了本工作的范围。</li>\n</ul>\n<p>APE 的高层逻辑运算如下。给定一个潜在的受害者交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> ，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 首先尝试通过创建并执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 来作为一个天真模仿事务以模仿 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 。如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行出现回退，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 就会找出引发失败的执行轨迹。然后，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 合成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，替换导致 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 回退的<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。为此，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 复制受害者的合约字节码，并修改阻止成功模仿执行的指令。最后，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 在本地验证 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 部署和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的可盈利性。根据 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以领先任何竞争对手的假设（参见第 4.1 节），APE 是无风险的。请注意，利用事务的可组合性，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以在单个事务中原子式地操作 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 部署和模仿执行（即 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span></span></span>）。</p>\n<p>APE （参见图 3）由六个关键部分组成：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/8sfecv.png\" alt=\"图 3：基于 EVM 的区块链交易实时模仿攻击 APE 概述\" /></p>\n<ol>\n<li>\n<p><strong>动态控制流图</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 在当前区块链状态下循环执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，并构建动态控制流图（DCFG）。DCFG 捕获<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">)</span></span></span></span> 在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 执行时 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的合约间调用，以及 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mi>i</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(ii)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">)</span></span></span></span> 调用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的合约字节码执行流。</p>\n</li>\n<li>\n<p><strong>盈利分析器</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 提取 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 触发的资产转移，观察受益账户。然后，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 尝试替换这些账户成为受益人。如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 没有成功成为受益人，则中止攻击。</p>\n</li>\n<li>\n<p><strong>动态污点分析</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 执行动态污点分析，并将分析结果与步骤 1 中构建的 DCFG 进行比较。如果比较结果显示没有差异，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 就继续进行天真交易仿真（参见第 2.3 节）。否则，根据动态污点分析和与 DCFG 的比较，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 识别出妨碍成功执行天真模仿的污点基本块。</p>\n</li>\n<li>\n<p><strong>补丁识别器</strong>：基于检测到的受益人账户和污点智能合约，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 开始识别所有需要替换的智能合约。</p>\n</li>\n<li>\n<p><strong>智能合约合成</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 通过复制 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的字节码合成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可能需要修改 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的字节码，以确保 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 可以执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的逻辑并收取产生的财务收入。</p>\n</li>\n<li>\n<p><strong>验证</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 在本地部署 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 并执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，以验证攻击是否有利可图。如果有利可图，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 就在链上部署 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 并发布 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，前置运行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</p>\n</li>\n</ol>\n<h1 id=\"ape-details\"><a class=\"anchor\" href=\"#ape-details\">#</a> APE Details</h1>\n<p>在本节中，我们将介绍 APE 的设计细节，并讨论其技术局限性。</p>\n<h2 id=\"step-1-dynamic-control-flow-graph\"><a class=\"anchor\" href=\"#step-1-dynamic-control-flow-graph\">#</a> Step 1 : Dynamic Control-Flow Graph</h2>\n<p>智能合约控制流图（CFG）是合约字节码的图形表示法。在 CFG 中，每个节点表示一个基本块，即指令的线性序列。节点由有向边连接，代表控制流中的代码跳转。对于 EVM 字节码， <code>JUMP</code>  和  <code>JUMPI</code>  这两个操作码控制着代码块的执行路径。 <code>JUMP</code>  是无条件跳转到堆栈中的目标，而  <code>JUMPI</code>  则是有条件跳转。CFG 只包含有关合约的静态信息，而 DCFG 是一种专门的 CFG，包含从给定执行中提取的动态信息。</p>\n<p><em>APE 中的动态控制流图构建</em>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 在本地执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，构建 DCFG，表示 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行细节。为了推理 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的控制流，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 记录了每个  <code>JUMPI</code>  的条件值，这是动态分析所必需的（第 3 步，参见第 5.3 节）。通过捕捉合约调用的操作码（即  <code>CALL</code> 、 <code>DELEGATECALL</code> 、 <code>STATICCALL</code>  和  <code>CALLCODE</code> ），<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以识别跨合约的调用。因此，构建的 DCFG 可以跟踪调用的所有智能合约。构建的 DCFG 反映了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的具体执行，而不是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的完整表示。这对本工作很有帮助，因为未执行的基本区块与模仿受害者交易无关。因此，得到的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>（参见步骤 5，第 5.5 节）可能比 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 包含更少的操作码，从而降低攻击成本。</p>\n<h2 id=\"step-2-profitability-analyzer\"><a class=\"anchor\" href=\"#step-2-profitability-analyzer\">#</a> Step 2 : Profitability Analyzer</h2>\n<p>盈利能力分析器旨在过滤掉不可能盈利的受害者交易。直观地说，如果对抗收入（以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span> 度量）大于所需的交易费用，则 APE 尝试是有利可图的（参见定义 5.1）。</p>\n<p><mark><strong>定义 5.1</strong></mark>（盈利条件）。给定一个区块链状态 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>，对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 来说，如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi><mi>a</mi><msubsup><mi>l</mi><mi mathvariant=\"script\">A</mi><mi>E</mi></msubsup><mo stretchy=\"false\">(</mo><msup><mi>S</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo><mo>−</mo><mi>B</mi><mi>a</mi><msubsup><mi>l</mi><mi mathvariant=\"script\">A</mi><mi>E</mi></msubsup><mo stretchy=\"false\">(</mo><mi>S</mi><mo stretchy=\"false\">)</mo><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">Bal^{E}_{\\mathcal{A}}(S&#x27;) - Bal^{E}_{\\mathcal{A}}(S) &gt; 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1166619999999998em;vertical-align:-0.275331em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-2.424669em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathcal mtight\">A</span></span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.275331em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1166619999999998em;vertical-align:-0.275331em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413309999999999em;\"><span style=\"top:-2.424669em;margin-left:-0.01968em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathcal mtight\">A</span></span></span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">E</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.275331em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span>（其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>S</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">S&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.751892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span> 是攻击交易后的区块链状态），则 APE 攻击对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 来说是有利可图的。</p>\n<p>在最简单的情况下，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以通过检查交易发送方的余额变化来推断模仿 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的盈利能力。然而，受害者可能会将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的收入转移到其控制的另一个智能合约，而不是转移到发送者账户。因此，只有当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 确定受益收款人时，模仿 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 才有利可图。因此，为了确定盈利能力，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 有必要确定参与执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的每个账户的利润。为此，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 可以从步骤 1 中构建的 DCFG 中提取资产转移。通过分析资产执行标准（如 <strong>ERC20</strong>）中定义的 EVM 日志，可以直接提取资产转移。我们继续定义 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 执行中的受益人账户（参见定义 5.2）。</p>\n<p><mark><strong>定义 5.2</strong></mark>（受益账户）。如果在执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的过程中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> 收到的金额大于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> 支付的金额，则账户 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span> 被视为受益人。</p>\n<p>我们仅以本地货币 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span> 来衡量盈利能力，以使金融价值比较正常化。这意味着 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 必须在模仿 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 之后将所有收到的资产原封不动地交换到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span>。</p>\n<p>如果在执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的过程中存在受益人账户，那么模仿 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 可能会产生利润。具体来说，有两种情况 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 不会放弃攻击：</p>\n<ol>\n<li>如果发件人是受益账户，则其他账户与盈利能力分析器无关。</li>\n<li>否则，如果发送人不是受益人账户，其他受益人账户的总利润减去发送人账户的潜在损失后必须保持正数。</li>\n</ol>\n<p>然后，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 将受益人账户导出到补丁识别器（步骤 4），以便进一步分析（参见第 5.4 节）。请注意，这种方法可能会带来误报，因为盈利能力分析器不考虑交易是否具有可操作性。例如，从钱包合约中向交易发送方提取资产的交易被归类为可盈利交易，因为发送方是受益人账户。但是，提取交易是无法模仿的。这种误报将在验证阶段（第 6 步）被清除。</p>\n<h2 id=\"step-3-dynamic-taint-analysis\"><a class=\"anchor\" href=\"#step-3-dynamic-taint-analysis\">#</a> Step 3 : Dynamic Taint Analysis</h2>\n<p>动态污点分析是一种程序分析方法，可在程序执行过程中跟踪来自污点源（如不受信任的输入）的信息流。动态污点分析通过污点策略明确确定：</p>\n<ol>\n<li>哪些指令会引入新的污点；</li>\n<li>如何对污点进行预处理；</li>\n<li>如何检查污点值。</li>\n</ol>\n<p><strong>APE 中的动态污点分析</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 开始执行从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 复制的模仿事务 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行相比，如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 包含不一致（例如不同的事务发送者），则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行可能会失败（参见第 3.4 节）。因此，在执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 时，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 会应用动态污点分析来跟踪 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 执行失败的位置和方式。<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 将可能触发不一致执行值的操作码视为污点源，并跟踪其污点传播。下面我们将概述 APE 的污点分析策略：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/iyhih8.jpg\" alt=\"表 2：污点引入规则。在执行 txc 时，ORIGIN 肯定会引入一个不一致的值，而其余操作码（灰色部分）可能会、也可能不会影响 txc 的执行\" /></p>\n<ul>\n<li><strong>污点介绍</strong>：我们检查了所有 EVM 操作码，并找出了那些可能带来不一致的操作码（参见表 2）。例如，`ORIGIN・（交易发送方操作码）肯定会产生不一致值，因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是由恶意地址而不是受害者地址发出的。其余操作码在执行过程中可能会、也可能不会产生不一致值。</li>\n<li><strong>污点传播</strong>：当至少有一个输入是污点时，污点会传播到算术 / 逻辑运算的输出。值得注意的是，如果一个存储变量是从一个污点槽中读取的，那么它就是污点。</li>\n<li><strong>污点检查</strong>：回顾一下，我们在建立 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的 DCFG 时，在步骤 1 中（参见第 5.1 节）记录了每个  <code>JUMPI</code>  条件的具体值。给定 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的污点执行轨迹后，我们比较每个污点  <code>JUMPI</code>  是否与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的记录值相同。通过这种具体的比较，我们可以确定 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 之间的不一致是如何中断 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行的。</li>\n</ul>\n<p>接下来，我们将定义污点基本区块（参见定义 5.3）和污点合约（参见定义 5.4）。</p>\n<p><mark><strong>定义 5.3</strong></mark>（污点基本区块）。如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">)</span></span></span></span> 基本程序块包含一个条件值为污点的  <code>JUMPI</code>  操作码，且 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mi>i</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(ii)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">)</span></span></span></span> 在执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 时条件值不同，则该基本程序块为污点程序块。</p>\n<p><mark><strong>定义 5.4</strong></mark>（污点合约）。如果智能合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 包含至少一个污点基本区块，则该合约为污点合约。</p>\n<p>如果没有污点基本区块，则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行过程完全相同。因此，APE 等同于天真模仿攻击（即 A 只需发出 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 并省略步骤 4 , 5 即可模仿 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>）。但是，如果存在一个有污点的基本区块，则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 不同。为了复制 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 将污点合约替换为对抗合约，保留与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 相同的执行逻辑。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/focthg.png\" alt=\"图 4：示例中模仿事务的污点传播（参见图 2，第 3.4 节）。CALLER 引入一个污点值，并传播到 JUMPI 条件\" /></p>\n<p><strong>污点传播示例</strong>：在图 4 中，我们展示了动态污点分析如何在给定恶意地址 0xab...cd 的情况下，跟踪激励示例（参见图 2，第 3.4 节）中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的执行情况。执行后，污点从  <code>CALLER</code>  传播到  <code>JUMPI</code>  的条件值（参见 PC 0xb27，图 4）。此外，条件值为  <code>False</code> ，与执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 时不同。因此，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 知道定制的清算合约已被玷污，需要替换。</p>\n<h2 id=\"step-4-patch-identifier\"><a class=\"anchor\" href=\"#step-4-patch-identifier\">#</a> Step 4 : Patch Identifier</h2>\n<p>回想一下，污点基本区块可以避免 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 成功退出。因此，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 试图用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{ai}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span>  替换有污点的合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 。此外，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 还需要替换步骤 2 中识别出的受益人账户，以便收取 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 中产生的财务收入。修补标识符的目的是检测 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{\\mathrm{sc}_{vi}\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span></span></span></span>  中所有需要修补和替换的合同，以便成功模仿 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。根据对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 的调用是来自交易还是来自合约，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 需要区分以下两种情况。我们用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">‾</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\overline{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78056em;vertical-align:-0.15em;\"></span><span class=\"mord overline\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.63056em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.55056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"overline-line\" style=\"border-bottom-width:0.04em;\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 表示必须修补和替换的合同。</p>\n<p><strong>从事务中调用</strong>：当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 调用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 时，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 应将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的  <code>to</code>  地址从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 修改为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 。</p>\n<p><strong>从合约调用</strong>：如果对受污染合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 的调用是硬编码（字节码或存储）在调用者合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>j</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vj}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9566680000000001em;vertical-align:-0.286108em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.67056em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span>  中的（参见图 5），则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 应同时替换 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vj}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> ，以修补硬编码语句。即使 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vj}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 没有被污染，这也是必要的。上述修补程序可反复应用于随后的硬编码合约调用。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/d3p0xv.png\" alt=\"图 5：对污点合约 scvi 的调用被硬编码到合约 scv j 中。要执行 APE，A 需要同时替换 scvi 和 scvj\" /></p>\n<h2 id=\"step-5-smart-contract-synthesis\"><a class=\"anchor\" href=\"#step-5-smart-contract-synthesis\">#</a> Step 5 : Smart Contract Synthesis</h2>\n<p><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 开始合成对抗性合约，以替换补丁标识符检测到的每个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">‾</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\overline{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78056em;vertical-align:-0.15em;\"></span><span class=\"mord overline\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.63056em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.55056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"overline-line\" style=\"border-bottom-width:0.04em;\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span>（参见第 5.4 节）。从顶层设计来说，为了合成 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 复制了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">‾</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\overline{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78056em;vertical-align:-0.15em;\"></span><span class=\"mord overline\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.63056em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-3.55056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"overline-line\" style=\"border-bottom-width:0.04em;\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 的字节码，并做了如下修改。</p>\n<p>对于有污点的合约 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 会修改每个有污点的基本代码块，以确保 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 遵循与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 相同的代码路径，尽管  <code>JUMPI</code>  条件可能不一致。具体来说，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi><mo stretchy=\"false\">(</mo><mi>i</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}(i)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">)</span></span></span></span> 将  <code>JUMPI</code>  替换为  <code>JUMP</code> ，导致无条件跳转，或 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>i</mi><mi>i</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(ii)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">i</span><span class=\"mclose\">)</span></span></span></span> 删除  <code>JUMPI</code> ，导致不跳转。如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub><mo stretchy=\"true\">^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\widehat{\\mathrm{sc}_{vi}}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.82056em;vertical-align:-0.15em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6705599999999999em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span class=\"svg-align\" style=\"top:-3.43056em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span style=\"height:0.24em;\"><svg width='100%' height='0.24em' viewBox='0 0 1062 239' preserveAspectRatio='none'><path d='M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span> 的调用被硬编码在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vj}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 中（参见图 5），则 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 需要修改 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{a j}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span>，将合约调用从 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>j</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{aj}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05724em;\">j</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 重定向到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。此外，由于每个新部署的对抗性合约都有一个空存储空间，因此在执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 时，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 可能会从其存储空间中加载一个不一致的值。因此，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 会进一步修改 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 以恢复加载。</p>\n<p>上述修改可确保 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 具有相同的执行路径（代码块和合约），但不能保证 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 获得所产生的收益。例如，在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 中产生的收入可能会被发送到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 中硬编码的账户<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。合成的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 复制了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>v</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{vi}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 中的字节码，并可能按照相同的方式传输（即发送到 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>a</mi><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">a_v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，而不是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 控制的账户）。因此，为了获取所产生的收入，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 需要通过临时修改 EVM 内存和向 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 注入收入收集逻辑来重定向相关的资产转移。最终，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 会根据打补丁后的字节码大小变化更新跳转目的地。</p>\n<h2 id=\"step-6-validation\"><a class=\"anchor\" href=\"#step-6-validation\">#</a> Step 6 : Validation</h2>\n<p>最后，APE 会在交易挖矿前本地验证 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。APE 失败的原因有两个：</p>\n<ol>\n<li>执行可能失败</li>\n<li>财务收入无法弥补部署对抗性合约和执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的成本。</li>\n</ol>\n<p>为了对攻击进行具体验证，恶意矿工会部署每个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">s</mi><mi mathvariant=\"normal\">c</mi></mrow><mrow><mi>a</mi><mi>i</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{sc}_{ai}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">s</span><span class=\"mord mathrm\">c</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，并在本地的最新区块链状态上执行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 将收到的所有代币转换为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span>，以检查 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是否产生利润。只有当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>E</mi></mrow><annotation encoding=\"application/x-tex\">E</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span></span></span></span> 中的收入涵盖所有交易费用（包括智能合约部署费用）时，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 才能产生利润。回想一下，对抗性合约的部署、模仿执行和资产交换可以在一次攻击交易中完成。如果验证成功，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 就会在下一个区块中包含攻击交易（前置运行 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>）。否则，攻击中止，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 无需承担任何费用，即 APE 无风险。</p>\n<h2 id=\"limitations\"><a class=\"anchor\" href=\"#limitations\">#</a> Limitations</h2>\n<p>APE 的设计和实施有许多限制条件。例如，我们假设对手拥有成功执行 APE 所需的足够数量的前期资产。鉴于闪存贷款的广泛使用，前期资本要求已迎刃而解。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/0df427.png\" alt=\"清单 1：任何提供由其私人密钥签名的 ECDSA 签名的账户都可以从 Vault 提取资产\" /></p>\n<p>当需要进行复杂的语义重组时，APE 就不适用了。我们在清单 1 中举例说明，合约 Vault 允许任何提供由其私钥签署的有效 ECDSA 签名 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>v</mi><mo separator=\"true\">,</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(v, r, s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span> 的账户提取资产。由于这种 &quot;任何人都可以提取&quot; 的逻辑，Vault 的设计使得提取交易容易受到模仿攻击。然而，要让对手自动执行攻击，就需要自动进行语义理解和签名生成，而 APE 并不支持这一点。</p>\n<p>此外，APE 无法模仿非原子策略，即跨越多个独立区块链交易的策略。例如，给定一个资产交换受害者交易，三明治攻击者可能会创建两个对抗性交易，从受害者身上榨取利润。APE 的目标不是产生这种攻击。但是，如果三明治攻击的攻击者创建了一个包裹受害者交易所的原子夹心交易，APE 就能成功挑战该交易。</p>\n<p>在我们的工作中，我们假设受害者不知道 APE 对手，特别是 APE 攻击策略。如果受害者意识到了 APE，那么受害者可以重新设计其智能合约，使其交易更坚固，以抵御 APE 对手的攻击。正如我们在第 6 节中所展示的，本文介绍的攻击方法在实践中非常有效。我们将在第 8 节概述可能的反击策略。</p>\n<h1 id=\"ape-historical-evaluation\"><a class=\"anchor\" href=\"#ape-historical-evaluation\">#</a> APE Historical Evaluation</h1>\n<p><strong>实现</strong>：我们用 6582 行 Golang 代码实现了 APE。更多详情可参见附录 B。</p>\n<p>我们开始评估 APE 仿真攻击在以太坊和 BSC 上一年时间内（从 2021 年 8 月 1 日到 2022 年 7 月 31 日） 的表现，以太坊和 BSC 是本文撰写时市值最高的两个支持智能合约的区块链。我们分别对以太坊和 BSC 上的 431,416,565 笔和 2,366,970,381 笔过往交易进行了评估。</p>\n<h2 id=\"methodology-and-setup\"><a class=\"anchor\" href=\"#methodology-and-setup\">#</a> Methodology and Setup</h2>\n<p>我们将过去的每笔交易都视为潜在的受害交易，并对其应用 APE 管道。如果攻击成功，我们会保存相关的合成智能合约，以及产生的收益和执行成本（如合约部署和模仿交易的 'gas' 成本）。如果不需要替换合约，APE 会退回到天真的模仿攻击，我们将其作为基线单独列出。</p>\n<p>虽然完整存档节点可以提供任何过去区块的区块链状态，但它并不直接允许在任意过去区块链状态上执行任意交易。因此，我们通过对 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2V0aGVyZXVtL2dvLWV0aGVyZXVt\">go-ethereum</span> 和 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2JuYi1jaGFpbi9ic2M=\">bsc</span> EVM 进行相应的定制，为以太坊和 BSC 实现了一个仿真器。模拟器从存档节点获取历史状态，并返回任何给定交易的执行结果。我们在 Ubuntu 20.04.3 LTS 上进行实验，该系统配备 AMD 3990X（64 核）、256GB 内存和 8TB NVMe SSD。</p>\n<h2 id=\"evaluation-results\"><a class=\"anchor\" href=\"#evaluation-results\">#</a> Evaluation Results</h2>\n<p>在以太坊上，从总计 431,416,565 个潜在的链上挖掘的受害交易中，我们发现了 43,979 个（0.0102%）容易受到天真模仿攻击的交易（参见表 3）。APE 成功攻击了 26,127 个（0.0061%）受害者交易，其中涉及替换 665 个独特的智能合约。</p>\n<p>从 2,366,970,381 个 BSC 交易中，我们发现天真模仿适用于 516,128 个（0.0218%）受害者交易，而 APE 则捕获了 52,799 个（0.0022%）额外的交易，涉及 1,193 个独特的合约。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/xkstkq.png\" alt=\"表 3：代表成功攻击交易和唯一受害者合同的总体攻击统计数据\" /></p>\n<p><strong>攻击收益</strong>：为了合理衡量攻击利润，我们需要考虑导线部署和模仿交易所需的交易费成本。因为区块空间是有限的（例如，受以太坊区块‘gas’限制），因此在执行 APE 攻击时，我们需要捕捉矿工在不包含受害者交易时放弃交易费的机会成本。因此，我们用 APE 受害交易的交易费来量化这种机会成本。利润以每笔受害者交易时的 ETH (BNB) 价格换算成美元。请注意，ETH (BNB) 是以太坊 (BSC) 上的原生加密货币。</p>\n<p>我们在图 6 中展示了 APE 的累积利润。在以太坊上，与天真模仿相比，APE 可以将模仿攻击的利润提高 973.6%。具体来说，我们发现 APE（包括天真模仿攻击）总共产生了 1.4896 亿美元的利润，而天真模仿攻击在相同时间段内的累计利润仅为 1387 万美元。通过量化模仿攻击所需的前期资金，我们发现 99.31% 的成功攻击所需的资金少于 5 ETH（包括交易费）。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/btxg6m.png\" alt=\"图 6：从 2021 年 8 月 1 日到 2022 年 7 月 31 日，以太坊上的模仿攻击总利润（包括 APE 和天真模仿）达到 1.4896 亿美元，而 APE 的累计利润为 1.3508 亿美元。在 BSC 上，APE 和天真模仿分别产生 2945 万美元和 1325 万美元\" /></p>\n<p>在 BSC 上，天真模仿攻击的利润累计为 1325 万美元，而 APE 则带来了 2 945 万美元的额外利润（+222.3%）。99.48% 的 BSC 模仿攻击所需的预付资金低于 5 BNB。</p>\n<p>我们注意到，与天真模仿相比，APE 获取的平均利润高出一个数量级（参见表 3）。为进一步了解易受 APE 影响的交易，我们将在第 6.3 节中进行分析。</p>\n<p><strong>Gas 消耗</strong>：APE 带来了额外的 'gas' 成本，因为对手可能需要部署对抗性合约。我们确定了两个与 'gas' 相关的约束条件，攻击受此约束。攻击的收入必须能够支付 'gas' 支出，而且用于部署和执行攻击交易的 'gas' 应保持在区块 'gas' 限额以下。</p>\n<p>在以太坊上，我们发现 APE 平均耗费 0.98M±0.74M 'gas'，而天真模仿耗费 0.45M±0.50M 'gas'（参见图 7）。作为参考，在撰写本文时，以太坊采用了动态区块耗气量限制，平均耗气量为 29.77M。在已识别的历史交易中，APE 的最大气体消耗量为 23.11M，低于以太坊的平均块 'gas' 限制。平均而言，对抗性合约部署占攻击气体消耗的 48.42%。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/0zsz8m.jpg\" alt=\"图 7：以太坊上的 APE 每次攻击平均消耗 0.98M±0.74M 瓦斯，而天真模仿攻击消耗 0.45M±0.50M 瓦斯。然而，对 BSC 的天真模仿攻击的平均耗气量（1.74M±4.44B）高于 APE 攻击（1.64M±0.64B）\" /></p>\n<p>平均而言，BSC 的区块 'gas' 限额高于（8 266 万）以太坊，这就为模拟提供了更大的空间。我们发现，APE（1.64M±0.64B）和天真模仿（1.74M±4.44B）在 BSC 上的平均耗气量都较高。对抗性合约部署在 BSC 上的平均耗气量是 APE 耗气量的 53.04%。与以太坊相反，BSC 上的天真模仿平均耗气量高于 APE。因此，我们分析了耗气量超过 3M 的 82192 笔天真的模仿交易。去除 80291 个异常值后，BSC 上天真的模仿交易的平均耗气量为 0.48M±0.55M 。</p>\n<p><strong>对抗性合约</strong>：平均而言，一次 APE 攻击需要在以太坊上替换 1.02 ± 0.15 个合约，在 BSC 上替换 1.05 ± 0.23 个合约。我们发现，与被替换的受害者合约相比，每个合成的对手合约平均小 60.95 ± 19.19%（以字节为单位）（参见表 4）。由于 APE 可能会用合成代码扩展受害方合约，我们还观察到了 - 295.56% 的负缩减，即最坏情况下增加了 295.56%。在 BSC 上，合约大小的平均缩减率为 57.59 ± 18.69%，最大缩减率为 613.33%。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ctmgft.png\" alt=\"表 4：对抗性合约统计。APE 在以太坊和 BSC 上最多创建 3 个对抗性合约，平均值分别为 1.02 和 1.05\" /></p>\n<h2 id=\"historical-analysis\"><a class=\"anchor\" href=\"#historical-analysis\">#</a> Historical Analysis</h2>\n<p>为了从 APE 的成功中获得启示，我们对以太坊和 BSC 上收益最高的前 100 名 APE 受害者进行了人工投资，分别获得了 1.1343 亿美元（83.97%）和 2727 万美元（92.60%）的利润。表 5 列示了整体的跨行动和利润分配情况。接下来，我们将概述研究结果的细节</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/66ipl1.png\" alt=\"表 5：以太坊和 BSC 上收益最高的前 100 名 APE 受害者的交易和利润分布。我们未能对 31 个 BSC 受害者交易进行分类\" /></p>\n<p><strong>已知的 DeFi 攻击和漏洞</strong>：在以太坊上，APE 发现了与 13 个已知 DeFi 攻击相对应的 17 个黑帽交易和 12 个宣称的白帽交易，总共获利 7374 万美元。最易被 APE 攻击的交易 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldGhlcnNjYW4uaW8vdHgvMHhjZDdkYWUxNDNhNGMwMjIzMzQ5YzE2MjM3Y2U0Y2Q3Njk2YjE2MzhkMTE2YTcyNzU1MjMxZWRlODcyYWI3MGZj\">0xcd7d...70fc</span> 是对 Popsicle Finance 智能合约的 DeFi 攻击，产生了 2,025 万美元的 APE 利润。请注意，该 APE 利润低于报告的攻击利润，因为我们将 APE 的收益转换为 ETH。交易所可能会产生过多的滑点，尤其是对于较高的金额。</p>\n<p>我们检测到两笔交易可能与已披露的两个合约漏洞有关。交易 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldGhlcnNjYW4uaW8vdHgvMHgyZTdkN2U3YTZlYjE1N2I5ODk3NGM4Njg3ZmJkODQ4ZDAxNThkMzdlZGMxMzAyZWEwOGVlNWRkYjM3NmJlZmVh\">0x2e7d..efea</span> 和 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldGhlcnNjYW4uaW8vdHgvMHhlMTJhZTAxNWM4MDIzYmJlNjQwNTY2MmEzZGRmNWU4ZTEwNmU3ZjYyNTVlOTA1YjczMTJkY2Y2NWIyN2Q3NTVj\">0xe12a..755c</span> 分别涉及 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmF1Y3R1cy5vcmcvYWN0aW9uLXJlcXVpcmVkLWNyaXRpY2FsLXZ1bG5lcmFiaWxpdHktM2Q0NDhkNGQwZGNi\">Auctus ACOWriter</span> 漏洞和 <span class=\"exturl\" data-url=\"aHR0cHM6Ly90d2l0dGVyLmNvbS9wZWNrc2hpZWxkL3N0YXR1cy8xNTA5MDA5NzQ2NzQ0OTgzNTU2\">BMIZapper</span> 漏洞中报告的受害者合约。但是，我们无法找到披露这些交易公开信息的合同执行者。</p>\n<p>在 BSC 上，APE 共捕获了 22 次 DeFi 攻击，涉及 40 笔交易，共产生了 2239 万美元的仿冒利润。</p>\n<p>表 8 和表 9（附录 C）概述了已识别的 DeFi 攻击和漏洞的详情。请注意，对于每笔攻击交易，我们都会检查 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldGhlcnNjYW4uaW8v\">etherscan.io</span> 是否观察到 P2P 网络上的攻击。如果 etherscan 无法监测到 P2P 网络上的攻击，那么攻击很可能是私下传播给矿工（如 FaaS）的。我们发现，在 12 次白帽攻击交易中，有 10 次（对应 6 次攻击）是私下传播给矿工的。白帽黑客可能出于两个目的而选择私人通信渠道：</p>\n<ol>\n<li>加快链上白帽交易的包含速度；</li>\n<li>减少模仿攻击的可能性。</li>\n</ol>\n<p><strong>新发现的漏洞</strong>：APE 发现了五个未关闭的漏洞。在这些漏洞中，最有利可图的漏洞名为  <code>massDeposit</code> ，在以太坊和 BSC 上分别产生了 2858 万美元和 759.54 万美元的总利润。下文将介绍  <code>massDeposit</code>  漏洞的案例研究，其他新发现漏洞的详情见附录 C。</p>\n<p><em>责任披露</em>：在撰写本报告时，所有已发现的漏洞都已没有可用资金。然而，尽管存在危险，新用户可能会在不知情的情况下与这些合同进行交互。因此，我们选择通过专门的区块链消息服务（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaGF0LmJsb2Nrc2Nhbi5jb20vc3RhcnQ=\">Blockscan Chat</span> by Etherscan）来联系有漏洞的智能合约。不幸的是，我们发现的所有易受攻击的合约都是匿名部署的，没有明显的方法可以识别这些合约背后的实体或个人。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/9arfvr.png\" alt=\"清单 2：APE 易受攻击的存款人合约，任何人都可以调用 massDeposit() 函数并提出一份金库合约。我们的评估结果表明，APE 可能会给该合约造成 2,858 万美元的潜在损失\" /></p>\n<p><em> <code>massDeposit</code>  案例研究</em>： <code>massDeposit</code>  漏洞的前身是以太坊上的一个  <code>Depositer</code>  合约（<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ldGhlcnNjYW4uaW8vYWRkcmVzcy8weGUyYzA3MWUxRTE5NTdBNjJmRERmMDE5OTAxOGUwNjFlYkZEM2FjMkM=\">0xe2c071e1E1957A62fDDf0199018e061ebFD3ac2C</span>）（参见清单 2）。我们发现，由于以下漏洞细节，存入的资金可能是通过 APE 攻击盗取的。存款人合约的  <code>massDeposit()</code>  函数以金库为参数，金库是接收存款人合约全部资金的合约（参见图 8a）。任何人都可以调用  <code>massDeposit()</code>  函数，并且提供一个任意的金库合约地址。然后，允许保险库从存款人账户中收取资产。最后，存款人调用金库的  <code>setOwner()</code>  函数，试图配置金库的所有权。当观察到这样的大量存款交易时，APE 的处理员 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\">A</span></span></span></span></span> 会将 vault 识别为受益人账户。然后，APE 会自动合成一份对抗合约，重新放置 vault 合约（参见图 8b）。回顾一下，在合成受益人合约时，APE 注入了在模仿交易结束前将所有收集的资产转移到对抗账户的逻辑。值得注意的是，即使没有 APE，攻击者也可以手动制作一份敌对金库合约，恶意提取存款人的资产。因此，我们将这一通道设计归类为漏洞。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/hb2t0v.png\" alt=\"图 8：MassDeposit 漏洞\" /></p>\n<h1 id=\"ape-real-time-evaluation\"><a class=\"anchor\" href=\"#ape-real-time-evaluation\">#</a> APE Real-time Evaluation</h1>\n<p>理想情况下，支持 APE 的矿工会尝试实时确定其开采区块的最佳交易顺序。因此，在给定一个未确认交易列表的情况下，矿工可以应用每一种交易组合来确定 APE 的最佳收益。然而，探索这些组合很快就会导致组合爆炸。</p>\n<p>因此，我们将为矿工的交易排序提出一个更现实、但也更尽力的解决方案。我们可以借鉴被广泛采用的假设，即在一个区块链区块中，交易通常按其费用金额排序。因此，在按费用排序的列表中，我们知道对于受害者交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">v_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，APE 交易也应该被放在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 的位置。虽然 EVM 目前只支持交易的顺序执行，但投机并行执行的前景可观，可以加快区块验证以及 APE 中的受害者交易识别。不过，这种并行执行框架超出了本文的研究范围。</p>\n<h2 id=\"methodology-and-setup-2\"><a class=\"anchor\" href=\"#methodology-and-setup-2\">#</a> Methodology and Setup</h2>\n<p>为了评估实时性能，我们将 APE 逻辑注入一个以太坊（BSC）完整节点，称为 APE 节点。APE 节点监听以太坊（BSC）P2P 网络，并对每笔潜在的受害者交易进行 APE 操作，同时不公布生成的攻击交易。重复评估过程将当前区块链高度 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi></mrow><annotation encoding=\"application/x-tex\">h</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">h</span></span></span></span> 和内存池 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">P</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{P}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.08222em;\">P</span></span></span></span></span> 作为输入（参见算法 1）。我们首先排除 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">P</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{P}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.08222em;\">P</span></span></span></span></span> 中的非法交易（例如，nonce 编号错误的交易），并按 'gas' 价格降序对产生的交易进行排序。然后，我们在当前区块链状态上依次应用排序后的交易。给定每一对中间状态 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>S</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">S_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>（应用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{i}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 后）和后续交易 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8234109999999999em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span></span></span></span>，APE 节点异步执行攻击函数 Ape (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>S</mi><mi>i</mi></msub><mo separator=\"true\">,</mo><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">S_i,\\mathrm{tx}_{i+1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.891661em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span></span></span></span>)，并以非阻塞方式继续执行下一对 (<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>S</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub><mo separator=\"true\">,</mo><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mrow><mi>i</mi><mo>+</mo><mn>2</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">S_{i+1},\\mathrm{tx}_{i+2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.891661em;vertical-align:-0.208331em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span></span></span></span>)。如果事务 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是可攻击的，我们就用生成的攻击事务替换（即 &quot;前置运行&quot;）<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>v</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">v</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。该流水线对应于对抗式矿工：</p>\n<ol>\n<li>从内存池中选择并排序交易；</li>\n<li>按顺序应用每个交易以构建下一个区块</li>\n<li>在适用时执行 APE 攻击。APE 节点重复这一过程，并记录以下指标的性能。</li>\n</ol>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/6ma8ol.png\" alt=\"算法 1\" /></p>\n<p><mark>指标 1</mark>（单次交易性能）。在给定一个受害者交易和相应区块链状态的情况下，APE 生成攻击所需的时间（参见算法 1）。</p>\n<p><mark>指标 2</mark>（内存池性能）。考虑到实时交易的动态内存池，从 APE 攻击生成到下一个区块（即应包含 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi mathvariant=\"normal\">t</mi><mi mathvariant=\"normal\">x</mi></mrow><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{tx}_{c}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">t</span><span class=\"mord mathrm\">x</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的目标区块）到达的时间（参见算法 1）。</p>\n<p>我们使用与第 6 节相同的硬件设置和 10 Gbps 的互联网连接进行实时评估。为了迅速捕获待处理交易，我们将 APE 节点的最大网络对等节点从默认的 50 个增加到 500 个，用于以太坊和 BSC。APE 节点会生成 150 个线程，异步执行 Ape 函数（参见算法 1）。</p>\n<p><strong>较弱的威胁模型</strong>：请注意，与第 4.1 节中的威胁模型相反，在本节中，我们不是矿工。此外，我们与 FaaS 没有私人对等协议，因此可能无法观察到只有启用了 FaaS 的矿工才会收到的受害者交易。与之前的威胁模型相比，我们的 APE 节点观察受害者交易的对抗能力较弱。因此，在实时评估中，我们选择关注 APE 在实际应用中的计算实时性能，而忽略 APE 节点在较弱的威胁模型下可能产生的潜在经济利润。我们预计较弱的威胁模型会获得较低的利润，因此将此类分析留待今后的工作中进行。</p>\n<h2 id=\"computational-real-time-performance\"><a class=\"anchor\" href=\"#computational-real-time-performance\">#</a> Computational Real-time Performance</h2>\n<p>我们的以太坊实时实验捕获了 26 天的数据。在实验期间，以太坊 APE 节点平均每秒重新接收 17.86 次独特交易。我们总共检测到 4,045 次模仿机会，其中包括 3,699 次容易受到 APE 攻击的交易。BSC 实时评估的时间跨度为 14 天。我们的 BSC APE 节点平均每秒接收 57.31 次独特交易。我们在 BSC 上识别出 489 个模仿机会和 784 个 APE 机会。</p>\n<p>表 6 列出了单笔交易性能（参见指标 1）和执行时间明细。平均而言，生成一次天真模仿攻击需要 0.01 ± 0.01 秒，而生成一次 APE 攻击需要 0.07 ± 0.10 秒。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/awztx8.png\" alt=\"表 6：原始攻击和 APE 模仿攻击的单笔交易性能（以太坊）。步骤 1、3 和 6 平均占 APE 执行时间的 96.35%。APE 在 BSC 上的单次交易性能相当\" /></p>\n<p>APE 最耗时的步骤是 DCFG（第 1 步）、动态污点分析（第 3 步）和验证（第 6 步），占整个执行时间的 96.35%。</p>\n<p>我们在图 9 中展示了 mempool 性能（参见指标 2）。在以太坊（BSC）上，99.68%（99.49%）的 APE 攻击是在我们的 APE 节点收到目标块之前生成的。从攻击产生到接收到目标块的时间平均为 12.56 ± 12.55 (2.24 ± 0.81) 秒。我们的评估结果表明，以太坊上的 APE（区块间隔为 13.3 秒）和 BSC（区块间隔为 3 秒）具有实时性。</p>\n<h1 id=\"ape-countermeasures\"><a class=\"anchor\" href=\"#ape-countermeasures\">#</a> APE Countermeasures</h1>\n<p>模仿攻击对 DeFi 生态系统及其用户构成了迫在眉睫的威胁。与 EVM 兼容的区块链依赖矿工来执行和验证每笔交易。因此，很难完全防止矿工检查和模仿受害者交易。我们认为以下对策有可能减轻 APE。</p>\n<p><strong>将模仿作为一种防御工具</strong>：一种可能直观但有效的替代方法是将模仿作为一种防御机制。例如，矿工可以通过简单地模仿攻击并将收益退还给受害者的方式，对 DeFi 攻击进行自动白帽黑客攻击。虽然矿工目前被信任来确保区块链共识的安全，但他们可以扩展这种能力到应用层。漏洞悬赏可以激励矿工的利他主义。不过，我们将精确的激励结构留待今后的工作中去探索。</p>\n<p><strong>打破原子性</strong>：打破有利可图的事务的原子性会阻碍 APE，也就是说，用户可以将其事务的逻辑分割成多个独立的事务。这样，APE 就无法捕捉到任何独立交易的全部逻辑，也就无法对其进行模仿。此外，这种防御可以通过一种工具来实现，它可以将单个事务作为输入，并自动将其拆分成具有相同程序逻辑的多个事务。这种方法的主要缺点是不适用于所有情况（如闪存贷款）。打破原子性还可能给用户带来额外风险（例如，部分套利执行导致财务损失）。</p>\n<p><strong>前置运行缓解</strong>：APE 要求攻击者必须能够前置运行受害者交易，因此缓解前置运行可以防止 APE 攻击。文献探讨了各种基于时间的交易排序公平性的前置运行缓解方案。虽然这些公平排序解决方案原则上可以将 APE 的威胁最小化，但它们需要对共识层或应用层进行根本性修改。特别是，[1] 需要对底层区块链进行修改，而 [2, 3] 则引入了一个负责交易排序的额外许可委员会，并需要重新设计 DeFi 应用程序。</p>\n<blockquote>\n<p>[1] Mahimna Kelkar, Fan Zhang, Steven Goldfeder, and Ari Juels. Order- fairness for byzantine consensus. In <em>Annual International Cryptology Conference</em>, pages 451–480. Springer, 2020.</p>\n<p>[2] MahimnaKelkar,SoubhikDeb,SishanLong,AriJuels,andSreeram Kannan. Themis: Fast, strong order-fairness in byzantine consensus. <em>Cryptology ePrint Archive</em>, 2021.</p>\n<p>[3] Yunhao Zhang, Srinath Setty, Qi Chen, Lidong Zhou, and Lorenzo Alvisi. Byzantine ordered consensus without byzantine oligarchy. In <em>14th USENIX Symposium on Operating Systems Design and Implemen- tation (OSDI 20)</em>, pages 633–649, 2020.</p>\n</blockquote>\n<p><strong>代码混淆</strong>：成熟的区块链和 DeFi 应用程序并不容易打补丁和重新设计。在以更系统的方式减少前置运行之前，需要轻量级的变通方法。因此，解决这一问题的一个可行办法是开发字节码级混淆技术。虽然代码混淆作为一种防御机制已经使用了几十年，但还没有人把它作为智能合约攻击和漏洞的对策来研究。可以采用控制流混淆方法，其目的是模糊程序流程，使动态分析难以推理代码。回想一下，为了复制执行路径，APE 会修改受污染的基本模块，并对代码跳转进行硬编码（参见第 5.5 节）。如果在一个受害者事务中同时访问了污点基本块的真分支和假分支，合成对抗性合约就会变得很困难，因为硬编码跳转只能访问一个分支。因此，可以设计一种针对 APE 的混淆方案，使硬编码的代码跳转导致无限循环。尽管混淆技术易于采用，并能提供针对 APE 的可靠保护，但它们仍有局限性。主要问题是，可以开发出复杂的去混淆技术来绕过这些防御。混淆防御也会导致合同更加复杂，增加执行和部署 'gas' 的成本。我们将完整的设计和评估工作留待今后进行。</p>\n<h1 id=\"related-work\"><a class=\"anchor\" href=\"#related-work\">#</a> Related Work</h1>\n<p><strong>漏洞利用工具系统化</strong>：我们在表 7 中对最接近的相关工作进行了系统化，重点关注自动漏洞利用生成工具。我们将它们区分为：</p>\n<ol>\n<li>旨在获取金融价值并捕捉该过程中漏洞的工具；</li>\n<li>检测智能合约中预定义漏洞模式的工具。</li>\n</ol>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/fpuznu.png\" alt=\"表 7：自动智能合约开发相关工作的系统化\" /></p>\n<p>对于基于奖励的漏洞利用工具，我们发现，由于字符串替换方法简单，天真模仿法在实时性能方面优于 APE。不过，在相同的评估时间范围内（参见第 6 节），APE 比天真的方法捕获了更高的经济收益和更多的 DeFi 攻击。 <code>DEFIPOSER</code>  利用 SMT 解算器来识别有利可图的策略，这些策略有可能揭示新的漏洞模式。然而， <code>DEFIPOSER</code>  的有效性依赖于区块链应用的精确建模，这需要大量的人工努力。值得注意的是， <code>DEFIPOSER</code>  的实时性能取决于底层 SMT 解算器以及数学模型的复杂性。</p>\n<p>在智能合约中检测预定义漏洞模式的工具将这些模式作为进行安全分析的输入。因此，这类工具可能不会发现不同的或新的漏洞模式。然而， <code>MAIAN</code>  和  <code>SOLAR</code>  的设计具有实时性。在 APE 之前， <code>SOLAR</code>  是我们所知的唯一能合成合约的工具。不过， <code>SOLAR</code>  需要访问智能合约的 ABI。回顾一下，闭源智能合约可能无法访问 ABI。据我们了解，SOLAR 专注于单个合约中的漏洞，因此不太可能捕捉到可组合（即跨合约）的 DeFi 攻击。</p>\n<p><strong>智能合约攻击与安全</strong>：Atzei 等人对智能合约攻击进行了调查。许多人都专注于通过检测漏洞和生成恶意输入来自动寻找针对脆弱智能合约的漏洞利用。Qin 等人探索了通过闪贷进行 DeFi 攻击。Wu 等人提出了一种独立于平台的方法来恢复高级 DeFi 语义，以检测价格操纵攻击。</p>\n<p><em>静态分析</em>：工具如  <code>Securify</code>  、 <code>Slither</code>  和  <code>Ethainter</code> ，可检测智能合约中的特定漏洞。这类工具通常能实现完整性，但也会报告误报。另一种检测智能合约漏洞的常见方法是采用符号执行。Mythril 和 Oyente 使用基于 SMT 的符号执行来检查 EVM 字节代码，并模拟虚拟机来探索执行路径。其他工具采用模糊技术检测各种漏洞。APE 不采用模糊技术，而是利用 EVM 来一次性动态分析智能合约。最近， <code>SMARTSHIELD</code>  和  <code>sGuard</code>  对用于修补智能合约的字节码重写进行了探索。 <code>EVMPATCH</code>  可以集成多种静态分析工具来检测漏洞，并自动完成部署和管理可升级合约的整个生命周期。</p>\n<h1 id=\"conclusion\"><a class=\"anchor\" href=\"#conclusion\">#</a> Conclusion</h1>\n<p>广义区块链模仿游戏是对智能合约区块链的一类新攻击。采用这种模仿既可能是为了自私的结果，例如，采用 APE 的矿工可以从 DeFi 攻击中获得价值数百万美元的收益；也可能是为了更好的结果，矿工可以作为白帽黑客帮助捍卫 DeFi 生态系统，方法是预先运行攻击，并可能将由此获得的收益退还给受害者。在这项工作中，我们证明了这种模仿游戏是切实可行的，并能在以太坊和 BSC 上产生巨大价值。</p>\n<div class=\"note warning no-icon\">\n<p>附录部分请参考原论文🙏</p>\n</div>\n",
            "tags": [
                "科研",
                "论文阅读",
                "区块链",
                "论文阅读"
            ]
        },
        {
            "id": "https://gality.cn/misc/trail-and-error/RTX4080-tensorflow2/",
            "url": "https://gality.cn/misc/trail-and-error/RTX4080-tensorflow2/",
            "title": "在 RTX 4080 上运行 tensorflow 2",
            "date_published": "2023-12-06T08:58:35.000Z",
            "content_html": "<div class=\"note info no-icon\">\n<ul>\n<li>\n<p><strong>bug 背景</strong>：原本项目使用的是 tensorflow 的 2.1 的版本，该项目在 RTX 1660 上可以正常运行，只是将显卡换到了 RTX 4080 上就运行失败了，所以肯定是显卡（环境）的原因。</p>\n</li>\n<li>\n<p><strong>实际原因</strong>：根据搜集到的资料和项目的报错提示来看，2.1 版本的 tf 还不知道有 4080 这种显卡的存在，所以才会无法识别，导致各种问题，因此，想解决这个问题，是<strong>一定要升级 tf 的版本</strong>的。</p>\n</li>\n<li>\n<p><strong>解决方案</strong>：这里给出一个可以在 4080 上运行的版本：</p>\n<ul>\n<li>python：3.6.x（任意小版本）</li>\n<li>tensorflow：2.6.0</li>\n<li>CUDA：11.2.2（win10 版本也可用于 win11 系统）</li>\n<li>cuDNN：8.1.1</li>\n<li>Keras：2.6（如果需要的话）</li>\n</ul>\n</li>\n</ul>\n</div>\n<h1 id=\"cuda\"><a class=\"anchor\" href=\"#cuda\">#</a> CUDA</h1>\n<p><strong>下载直链</strong>：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9jdWRhLXRvb2xraXQtYXJjaGl2ZQ==\">https://developer.nvidia.com/cuda-toolkit-archive</span></p>\n<p>安装过程没有太多好说的，教程也非常多，这里稍微说点不常见的：</p>\n<p><strong>最好安装在默认路径</strong></p>\n<p>原因在于会涉及到环境变量的配置，大多数教程给出的都是默认的环境变量地址，如果不熟悉的话，安装在默认位置会剩一点力气。</p>\n<p>安装完成后需要添加以下环境变量：</p>\n<pre><code class=\"language-bat\">- CUDA_BIN_PATH_v11.2 = %CUDA_PATH%\\bin\n- CUDA_LIB_PATH_v11.2 = %CUDA_PATH%\\lib\\x64\n- CUDA_SDK_PATH = C:\\ProgramData\\NVIDIA Corporation\\CUDA Samples\\v11.2\n- CUDA_SDK_BIN_PATH = %CUDA_SDK_PATH%\\bin\\win64\n- CUDA_SDK_LIB_PATH = %CUDA_SDK_PATH%\\common\\lib\\x64\n</code></pre>\n<ol>\n<li>\n<p>这里的 <code>CUDA_SDK_PATH</code>  后的环境变量其实就是默认安装地址，若不是默认地址，这里需要修改为实际的安装地址，其他不用变。</p>\n</li>\n<li>\n<p>如果运行时代码报错一堆 dll 找不到，可能就是环境变量没刷新的问题，重启下终端看能不能解决（实在不行就重启电脑，最保险～）</p>\n</li>\n</ol>\n<h1 id=\"cudnn\"><a class=\"anchor\" href=\"#cudnn\">#</a> cuDNN</h1>\n<p><strong>下载直链</strong>：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubnZpZGlhLmNvbS9yZHAvY3Vkbm4tYXJjaGl2ZQ==\">https://developer.nvidia.com/rdp/cudnn-archive</span></p>\n<p>下载：cuDNN v8.1.1 for CUDA 11.0,11.1 and 11.2 版本</p>\n<p>同样不多说了，教程很多。</p>\n<h1 id=\"tensorflow\"><a class=\"anchor\" href=\"#tensorflow\">#</a> Tensorflow</h1>\n<p>tensorflow 建议在 conda 那安装，可以用 anaconda，也可以是 miniconda，这个无所谓，这里假设你已经有了相关知识。</p>\n<pre><code class=\"language-bat\">conda create -n tensorflow2 python=3.6\nconda activate tensorflow2\n\npip install tensorflow-gpu==2.6.0 -i https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre>\n<p>可以通过以下方式来测试是否成功安装：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 在交互式 python 终端中输入：</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> tensorflow <span class=\"token keyword\">as</span> tf</pre></td></tr></table></figure><p>加载可能比较慢，但若没有任何报错，那就是成功安装了。</p>\n<p>至此，就应该可以调用 4080 来跑 tensorflow 的代码了～</p>\n",
            "tags": [
                "杂项",
                "踩坑",
                "机器学习",
                "杂项",
                "踩坑",
                "tensorflow2"
            ]
        },
        {
            "id": "https://gality.cn/note/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%8D%E4%B9%A0%E8%A6%81%E7%82%B9/",
            "url": "https://gality.cn/note/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%8D%E4%B9%A0%E8%A6%81%E7%82%B9/",
            "title": "网络安全复习要点",
            "date_published": "2023-11-24T07:32:12.000Z",
            "content_html": "<h1 id=\"网络安全复习要点\"><a class=\"anchor\" href=\"#网络安全复习要点\">#</a> 网络安全复习要点</h1>\n<h2 id=\"第一章\"><a class=\"anchor\" href=\"#第一章\">#</a> 第一章</h2>\n<h3 id=\"掌握信息安全的四个目标\"><a class=\"anchor\" href=\"#掌握信息安全的四个目标\">#</a> 掌握信息安全的四个目标</h3>\n<ul>\n<li>保密性</li>\n<li>完整性</li>\n<li>可用性</li>\n<li>合法使用</li>\n</ul>\n<h3 id=\"信息系统中常见的威胁有哪些\"><a class=\"anchor\" href=\"#信息系统中常见的威胁有哪些\">#</a> 信息系统中常见的威胁有哪些？</h3>\n<ul>\n<li>\n<p>🌟<strong>基本威胁</strong>：信息泄露、完整性破坏、拒绝服务、非法使用</p>\n</li>\n<li>\n<p><strong>主要的可实现威胁</strong>：</p>\n<ul>\n<li>渗入威胁：假冒攻击、旁路控制、授权侵犯</li>\n<li>植入威胁：特洛伊木马、陷门</li>\n</ul>\n</li>\n<li>\n<p><strong>潜在威胁</strong>：网络窃听、流量分析、操作人员不慎导致信息泄漏、媒体废弃物导致信息泄漏</p>\n</li>\n</ul>\n<h3 id=\"什么是安全策略安全策略分几个等级\"><a class=\"anchor\" href=\"#什么是安全策略安全策略分几个等级\">#</a> 什么是安全策略？安全策略分几个等级？</h3>\n<ul>\n<li>\n<p><strong>安全策略</strong>：某个<strong>安全域</strong>内施加给所有与<strong>安全相关活动</strong>的一套<strong>规则</strong>。</p>\n</li>\n<li>\n<p><strong>安全域</strong>：属于某个组织机构的一系列处理进程和通信资源</p>\n</li>\n<li>\n<p><strong>安全策略等级</strong>：</p>\n<ul>\n<li><strong>安全策略目标</strong>：机构对所保护资源要达到的安全目标而进行的描述</li>\n<li><strong>机构安全策略</strong>：对机构的资源进行保护，以达到安全策略规定目标</li>\n<li><strong>系统安全策略</strong>：在信息系统工程实现时，要支持该机构的安全策略</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"什么是访问控制策略它分为哪两类有何不同\"><a class=\"anchor\" href=\"#什么是访问控制策略它分为哪两类有何不同\">#</a> 什么是访问控制策略？它分为哪两类？有何不同？</h3>\n<ul>\n<li>\n<p><strong>访问控制策略</strong>：访问控制策略隶属于<strong>系统级安全策略</strong>，它迫使计算机系统和网络<strong>自动地执行授权</strong>。</p>\n</li>\n<li>\n<p><strong>分类</strong>：</p>\n<ul>\n<li><strong>强制性访问控制策略</strong>：由操作<strong>系统内核强制</strong>实施<strong>授权</strong>规则，<strong>检查</strong>主体的安全属性，并决定是否可以<strong>访问</strong>。</li>\n<li><strong>自主性访问控制策略</strong>：由客体的<strong>属主</strong>对自己的客体进行管理，由属主决定是否将自己的<strong>客体访问权</strong>或<strong>部分访问权授予</strong>其他主体。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"安全攻击分几大类常见的攻击形式有哪些\"><a class=\"anchor\" href=\"#安全攻击分几大类常见的攻击形式有哪些\">#</a> 安全攻击分几大类？常见的攻击形式有哪些？</h3>\n<ul>\n<li><strong>安全攻击分两大类</strong>：\n<ul>\n<li><strong>被动攻击</strong>：窃听攻击、流量分析</li>\n<li><strong>主动攻击</strong>：伪装攻击、重放攻击、消息篡改、拒绝服务</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"熟记x800标准中的5类安全服务和8种特定安全机制并简述安全服务与安全机制之间的关系\"><a class=\"anchor\" href=\"#熟记x800标准中的5类安全服务和8种特定安全机制并简述安全服务与安全机制之间的关系\">#</a> 🌟熟记 X.800 标准中的 5 类安全服务和 8 种特定安全机制，并简述安全服务与安全机制之间的关系。</h3>\n<p><strong>五类安全服务</strong>：</p>\n<ul>\n<li>认证</li>\n<li>访问控制</li>\n<li>数据保密性</li>\n<li>数据完整性</li>\n<li>不可否认性</li>\n<li>（可用性服务）</li>\n</ul>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/6fwls5.png\" alt=\"安全服务与安全机制的关系\" /></p>\n<p>安全服务通过安全机制实现安全策略</p>\n<h3 id=\"能够理解并画出网络安全模型和网络访问模型\"><a class=\"anchor\" href=\"#能够理解并画出网络安全模型和网络访问模型\">#</a> 能够理解并画出网络安全模型和网络访问模型。</h3>\n<ul>\n<li>\n<p><strong>网络安全模型</strong></p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/x6779c.png\" alt=\"网络安全模型\" /></p>\n</li>\n<li>\n<p><strong>网络访问安全模型</strong></p>\n</li>\n</ul>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/x5wx3k.png\" alt=\"网络访问安全模型\" /></p>\n<h2 id=\"第二章\"><a class=\"anchor\" href=\"#第二章\">#</a> 第二章</h2>\n<h3 id=\"熟记osi的七层参考模型-tcpip的四层模型\"><a class=\"anchor\" href=\"#熟记osi的七层参考模型-tcpip的四层模型\">#</a> 熟记 OSI 的七层参考模型、TCP/IP 的四层模型</h3>\n<ul>\n<li>\n<p><strong>OSI 七层</strong>：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/v6uv8g.png\" alt=\"OSI体系结构参考模型\" /></p>\n</li>\n<li>\n<p><strong>TCP/IP 四层</strong>：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/po4p9x.png\" alt=\"TCP/IP体系结构参考模型\" /></p>\n</li>\n</ul>\n<h3 id=\"什么是面向连接的服务什么是无连接的服务\"><a class=\"anchor\" href=\"#什么是面向连接的服务什么是无连接的服务\">#</a> 什么是面向连接的服务？什么是无连接的服务？</h3>\n<ul>\n<li>\n<p><strong>面向连接的服务</strong>：</p>\n<p>面向连接的服务要求通信双方在<strong>传输数据之前首先建立连接</strong>。数据传输过程包括<strong>建立连接</strong>、<strong>传输数据</strong>和释放连接三个阶段。在 Internet 中，TCP 协议提供面向连接的服务， 为应用程序提供可靠的端到端字节流服务。为保证传输层服务的可靠性与稳定性，TCP 协议提供<strong>检错、重传、流量控制和拥塞控制</strong>等许多功能。</p>\n</li>\n<li>\n<p><strong>无连接的服务</strong>：</p>\n<p>无连接的服务不要求通信双方在传输数据之前建立连接，是 “<strong>尽力传递</strong>”（Best-effort Delivery）的服务。在 Internet 中，IP 协议和 UDP 协议提供的都是无连接的服务。IP 不提供差错检查或者追踪，它尽最大努力使传输数据到达目标，但是并不提供任何服务质量保证。同理，UDP 没有拥塞控制，也不提供可靠交付。无连接的服务也叫数据报服务， 因此通常将 IP 协议的协议数据单元称为 IP 数据报，将 UDP 协议的协议数据单元称为 UDP 数据报。</p>\n</li>\n</ul>\n<h3 id=\"必须知道ipv4及ipv6地址的格式及长度\"><a class=\"anchor\" href=\"#必须知道ipv4及ipv6地址的格式及长度\">#</a> 必须知道 IPv4 及 IPv6 地址的格式及长度</h3>\n<ul>\n<li><strong>IPv4</strong>：32 位； 192.168.1.1</li>\n<li><strong>IPv6</strong>：128 位； 1234:0000:0000:33ff:bbff:aaee:00aa:2233</li>\n</ul>\n<p>IPv6 将 128 位地址按每 16 位分割，每个段用 16 进制数字表示</p>\n<h3 id=\"必须知道mac地址的长度\"><a class=\"anchor\" href=\"#必须知道mac地址的长度\">#</a> 必须知道 MAC 地址的长度</h3>\n<ul>\n<li><strong>MAC</strong>：48 位</li>\n</ul>\n<h3 id=\"ip地址与mac地址转换靠哪个网络协议\"><a class=\"anchor\" href=\"#ip地址与mac地址转换靠哪个网络协议\">#</a> IP 地址与 MAC 地址转换靠哪个网络协议？</h3>\n<ul>\n<li><strong>ARP 协议</strong></li>\n</ul>\n<h3 id=\"ipv4的地址分哪几类给定一个ip地址要能够分析判断出该地址属于哪一类地址\"><a class=\"anchor\" href=\"#ipv4的地址分哪几类给定一个ip地址要能够分析判断出该地址属于哪一类地址\">#</a> IPv4 的地址分哪几类？给定一个 IP 地址，要能够分析判断出该地址属于哪一类地址</h3>\n<ul>\n<li>\n<p>IPv4 地址划分为<strong> 5</strong> 类：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/kbnj9j.png\" alt=\"IP地址的类型\" /></p>\n</li>\n<li>\n<p><strong>特殊地址</strong>：</p>\n<ul>\n<li>网络地址：<strong>主机号全 0</strong>，用来指明某个特定网络。</li>\n<li>直接广播地址：<strong>主机号全 1、网络号不为 0</strong>，表示一个物理网络上的所有主机。</li>\n<li>有限广播地址：<strong>32 位全 1</strong>，向主机所在网络广播，（系统启动时不知道网络号）</li>\n<li>本机地址：<strong>32 位全 0</strong>，拨号上网时暂代本机地址</li>\n</ul>\n</li>\n<li>\n<p><strong>判定 IP 地址类别</strong>（以 192.168.1.1 为例）：</p>\n<ol>\n<li>192 转换为二进制为 1100 0000</li>\n<li>查表知 110 开头为 C 类地址</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"给定一个ipv4地址和子网掩码要求能够计算出网络地址\"><a class=\"anchor\" href=\"#给定一个ipv4地址和子网掩码要求能够计算出网络地址\">#</a> 给定一个 IPv4 地址和子网掩码，要求能够计算出网络地址</h3>\n<p><strong>例题</strong>：已知 IP 地址 202.112.64.19，子网掩码 255.255.255.240，则 IP 地址 202.11264.19 的二进制形式为</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>11000010</mn><mspace width=\"1em\"/><mn>01110000</mn><mspace width=\"1em\"/><mn>01000000</mn><mspace width=\"1em\"/><mn>00010011</mn></mrow><annotation encoding=\"application/x-tex\">11000010 \\quad 01110000 \\quad 01000000 \\quad 00010011\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span></span></span></span></span></p>\n<p>子网掩码 255.255.255.240 的二进制形式为</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>11111111</mn><mspace width=\"1em\"/><mn>11111111</mn><mspace width=\"1em\"/><mn>11111111</mn><mspace width=\"1em\"/><mn>11110000</mn></mrow><annotation encoding=\"application/x-tex\">11111111 \\quad 11111111 \\quad 11111111 \\quad 11110000\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span></span></p>\n<p>上面两式进行逐位 “与” 运算，得出网络地址为</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>11000010</mn><mspace width=\"1em\"/><mn>01110000</mn><mspace width=\"1em\"/><mn>01000000</mn><mspace width=\"1em\"/><mn>00010000</mn></mrow><annotation encoding=\"application/x-tex\">11000010 \\quad 01110000 \\quad 01000000 \\quad 00010000\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span></span></p>\n<p>换算回十进制，可得该网络地址的为</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>202.112.64.16</mn></mrow><annotation encoding=\"application/x-tex\">202.112.64.16\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">2</span><span class=\"mord\">0</span><span class=\"mord\">2</span><span class=\"mord\">.</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">2</span><span class=\"mord\">.</span><span class=\"mord\">6</span><span class=\"mord\">4</span><span class=\"mord\">.</span><span class=\"mord\">1</span><span class=\"mord\">6</span></span></span></span></span></p>\n<h3 id=\"熟悉cidr的表示方法如1281432020表示的地址块范围和子网掩码是什么\"><a class=\"anchor\" href=\"#熟悉cidr的表示方法如1281432020表示的地址块范围和子网掩码是什么\">#</a> 熟悉 CIDR 的表示方法，如：128.14.32.0/20 表示的地址块范围和子网掩码是什么？</h3>\n<p><span class=\"primary\">唯一的重点：地址块范围不包含 host-id 为全 0 和全 1 的两个地址</span></p>\n<ul>\n<li>\n<p><strong>CIDR 表示方法</strong>： <code>128.14.32.0/20</code> ，前面是 IP 地址，后面是网络号位数</p>\n</li>\n<li>\n<p>以 <code>128.14.32.0/20</code>  为例：</p>\n<ol>\n<li>\n<p><strong>子网掩码</strong>：20 即子网掩码前 20 位为 1，所以二进制为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>11111111</mn><mspace width=\"1em\"/><mn>11111111</mn><mspace width=\"1em\"/><mn>11110000</mn><mspace width=\"1em\"/><mn>00000000</mn></mrow><annotation encoding=\"application/x-tex\">11111111 \\quad 11111111 \\quad 11110000 \\quad 00000000\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span></span></span></span></span></p>\n<p>对应十进制为：255.255.240.0</p>\n</li>\n<li>\n<p><strong>地址块范围</strong>：就是 IP 的主机位全 0 和全 1 的范围（<strong>其实是抛去全 0 和全 1</strong>，因为这两个是特殊地址），即：</p>\n<ul>\n<li>起始 IP 地址：</li>\n</ul>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>10000000</mn><mspace width=\"1em\"/><mn>00001110</mn><mspace width=\"1em\"/><mn>00100000</mn><mspace width=\"1em\"/><mn>00000001</mn></mrow><annotation encoding=\"application/x-tex\">10000000 \\quad 00001110 \\quad 00100000 \\quad 00000001\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span></span></span></span></span></p>\n<ul>\n<li>结束 IP 地址</li>\n</ul>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>10000000</mn><mspace width=\"1em\"/><mn>00001110</mn><mspace width=\"1em\"/><mn>00101111</mn><mspace width=\"1em\"/><mn>11111110</mn></mrow><annotation encoding=\"application/x-tex\">10000000 \\quad 00001110 \\quad 00101111 \\quad 11111110\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">0</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">1</span><span class=\"mord\">0</span></span></span></span></span></p>\n<p>即地址块对应的十进制为：128.14.32.1 ～ 128.14.47.254</p>\n</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"什么是端口号端口号在网络通信中起什么作用\"><a class=\"anchor\" href=\"#什么是端口号端口号在网络通信中起什么作用\">#</a> 什么是 “端口号”？“端口号” 在网络通信中起什么作用？</h3>\n<ul>\n<li>\n<p>“<strong>端口号</strong>” 是按照应用进程的<strong>功能</strong>对应用进程实行的<strong>标识</strong>，主要作用是表示一台计算机中的特定进程所提供的服务，长度为 16 位。</p>\n</li>\n<li>\n<p>在通信过程中，<strong>端口号</strong>和<strong> IP 地址</strong>绑定使用，形成的<strong>标识</strong>称为<strong>插口</strong>，在网络中<strong>唯一</strong>对应某个主机的某个进程。</p>\n</li>\n</ul>\n<h2 id=\"第三章\"><a class=\"anchor\" href=\"#第三章\">#</a> 第三章</h2>\n<h3 id=\"熟记httpftptelnetpop3smtpimapsshdns等常用通信协议的功能及端口号\"><a class=\"anchor\" href=\"#熟记httpftptelnetpop3smtpimapsshdns等常用通信协议的功能及端口号\">#</a> 熟记 http/ftp/telnet/pop3/smtp/imap/ssh/dns 等常用通信协议的功能及端口号</h3>\n<ul>\n<li><strong>http</strong>（80）：超文本传输协议，是一个客户端和服务器端请求和应答的标准，是互联网上应用最广泛的一种网络协议。</li>\n<li><strong>ftp</strong>（传输 20 / 控制 21）：文件传输协议，Internet 文件传送的基础，是 TCP/IP 协议族的重要协议之一。</li>\n<li><strong>telnet</strong>（23）：远程登录协议，Internet 远程登录服务的标准协议和主要方式。</li>\n<li><strong>pop3</strong>（110）：邮局协议，邮件协议的第三个版本。</li>\n<li><strong>smtp</strong>（25）：简单邮件传输协议，是一组用于由源地址到目的地址传送邮件的规则，由它来控制信件的中转方式。</li>\n<li><strong>imap4</strong>（143，993）：邮件访问协议，采用 “挑战 / 响应” 实现用户认证，功能更强大。</li>\n<li><strong>ssh</strong>（22）：安全壳协议，一种在不安全的网络上建立安全的远程登录或其他安全网络服务的协议。</li>\n<li><strong>dns</strong>（UDP53）：域名系统是一个分布式数据库系统，用来实现域名和 IP 地址之间的映射。</li>\n</ul>\n<h3 id=\"网际层协议有哪些传输层协议有哪些应用层协议有哪些\"><a class=\"anchor\" href=\"#网际层协议有哪些传输层协议有哪些应用层协议有哪些\">#</a> 网际层协议有哪些？传输层协议有哪些？应用层协议有哪些？</h3>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/uytewn.png\" alt=\"TCP/IP协议族不同层次划分\" /></p>\n<ul>\n<li><strong>网际层</strong>：IP、ARP、ICMP 等</li>\n<li><strong>传输层</strong>：TCP、UDP 等</li>\n<li><strong>应用层</strong>：HTTP、SMTP、POP3、FTP 等</li>\n</ul>\n<h3 id=\"为什么要进行网络地址转换nat\"><a class=\"anchor\" href=\"#为什么要进行网络地址转换nat\">#</a> 为什么要进行网络地址转换（NAT）？</h3>\n<p>解决 IPv4 地址短缺问题。</p>\n<h3 id=\"arp协议的作用是什么\"><a class=\"anchor\" href=\"#arp协议的作用是什么\">#</a> ARP 协议的作用是什么？</h3>\n<p>将局域网中的 IP 地址转化为对应的物理地址（MAC 地址）。</p>\n<h3 id=\"为什么udp比tcp协议更加容易遭到攻击\"><a class=\"anchor\" href=\"#为什么udp比tcp协议更加容易遭到攻击\">#</a> 为什么 UDP 比 TCP 协议更加容易遭到攻击？</h3>\n<p>因为 UDP 没有交换握手信息和序号的过程。</p>\n<h3 id=\"imap协议与pop3协议相比它的安全性有哪些提升\"><a class=\"anchor\" href=\"#imap协议与pop3协议相比它的安全性有哪些提升\">#</a> IMAP 协议与 POP3 协议相比，它的安全性有哪些提升？</h3>\n<ul>\n<li>支持用户对服务器的远程加密访问</li>\n<li>采用 “挑战 / 响应” 机制实现用户认证</li>\n</ul>\n<h3 id=\"ssh协议与telnet协议相比它的安全性有哪些提升\"><a class=\"anchor\" href=\"#ssh协议与telnet协议相比它的安全性有哪些提升\">#</a> SSH 协议与 Telnet 协议相比，它的安全性有哪些提升？</h3>\n<ul>\n<li>提供多种身份认证和数据加密机制</li>\n<li>对所有传输数据进行加密处理</li>\n<li>采用 “挑战 / 响应” 机制替代传统的主机名和口令认证</li>\n</ul>\n<h3 id=\"什么是icmp重定向攻击如何防止此类攻击\"><a class=\"anchor\" href=\"#什么是icmp重定向攻击如何防止此类攻击\">#</a> 什么是 ICMP 重定向攻击？如何防止此类攻击？</h3>\n<ul>\n<li>\n<p><strong>重定向攻击</strong>：攻击者可以利用 ICMP 对消息进行重定向，使得目标机器按照攻击者的信息来<strong>修改路由表</strong>，遭受<strong>连接劫持</strong>和<strong>拒绝服务</strong>等攻击。</p>\n</li>\n<li>\n<p>防护：重定向消息应该仅由产生消息的主机或路由器执行，网管员不应使用 ICMP 创建通往目的地的新路由，应该<strong>禁用 ICMP 协议</strong>或<strong>配置防火墙</strong>的安全策略来预防攻击。</p>\n</li>\n</ul>\n<h3 id=\"在网络中为什么不能仅仅靠识别数据包的ip地址来判断一个数据包就是来自该-ip地址的主机\"><a class=\"anchor\" href=\"#在网络中为什么不能仅仅靠识别数据包的ip地址来判断一个数据包就是来自该-ip地址的主机\">#</a> 在网络中，为什么不能仅仅靠识别数据包的 IP 地址，来判断一个数据包就是来自该 IP 地址的主机？</h3>\n<p>IP 层不能保证 IP 数据报一定是从源地址发送的。攻击者可伪装成另一网络主机，发送含有<strong>伪造源地址</strong>的数据包欺骗接受者。此攻击称为<strong> IP 欺骗攻击</strong>。</p>\n<h2 id=\"第四章\"><a class=\"anchor\" href=\"#第四章\">#</a> 第四章</h2>\n<h3 id=\"按照对明文消息的处理方式不同单钥体制可分为哪两类\"><a class=\"anchor\" href=\"#按照对明文消息的处理方式不同单钥体制可分为哪两类\">#</a> 按照对明文消息的处理方式不同，单钥体制可分为哪两类？</h3>\n<ul>\n<li>分组密码</li>\n<li>流密码</li>\n</ul>\n<h3 id=\"古典密码中的两个常用的变换是什么\"><a class=\"anchor\" href=\"#古典密码中的两个常用的变换是什么\">#</a> 古典密码中的两个常用的变换是什么？</h3>\n<ul>\n<li>置换（扩散）</li>\n<li>代换（混淆）</li>\n</ul>\n<h3 id=\"什么是理论上安全什么是计算上安全理论上安全的密码算法有几个理论上安全的密码是什么密码\"><a class=\"anchor\" href=\"#什么是理论上安全什么是计算上安全理论上安全的密码算法有几个理论上安全的密码是什么密码\">#</a> 什么是理论上安全？什么是计算上安全？理论上安全的密码算法有几个？理论上安全的密码是什么密码？</h3>\n<ul>\n<li><strong>计算上安全</strong>：满足以下两条标准中任意一条就称为计算上安全\n<ul>\n<li>破译密码的代价超出密文信息的价值</li>\n<li>破译密码的时间超出密文信息的有效生命期</li>\n</ul>\n</li>\n<li><strong>理论上安全</strong>（无条件安全）：假定攻击者拥有无限的计算资源，无论有多少可使用的密文，都不足以唯一地确定密文所对应的明文</li>\n<li>只有<strong>一次一密</strong>是理论上安全的</li>\n</ul>\n<h3 id=\"什么是同步流密码-自同步流密码流密码的安全性取決于什么\"><a class=\"anchor\" href=\"#什么是同步流密码-自同步流密码流密码的安全性取決于什么\">#</a> 什么是同步流密码、自同步流密码？流密码的安全性取決于什么？</h3>\n<ul>\n<li><strong>同步流密码</strong>：密钥流独立于明文的流密码</li>\n<li><strong>自同步流密码</strong>：密钥流与明文有关的流密码</li>\n<li>流密码的安全性<strong>完全依赖于伪随机数的强度</strong></li>\n</ul>\n<h3 id=\"des分组长度-密钥长度-轮数是多少1轮加密包括哪些变换des中的非线性变换是什么变换\"><a class=\"anchor\" href=\"#des分组长度-密钥长度-轮数是多少1轮加密包括哪些变换des中的非线性变换是什么变换\">#</a> DES 分组长度、密钥长度、轮数是多少？1 轮加密包括哪些变换？DES 中的非线性变换是什么变换？</h3>\n<h3 id=\"aes分组长度-密钥长度-轮数是多少1轮加密包括哪些变换aes中包含的非线性变换是什么变换\"><a class=\"anchor\" href=\"#aes分组长度-密钥长度-轮数是多少1轮加密包括哪些变换aes中包含的非线性变换是什么变换\">#</a> AES 分组长度、密钥长度、轮数是多少？1 轮加密包括哪些变换？AES 中包含的非线性变换是什么变换？</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">加密算法</th>\n<th style=\"text-align:center\">分组长度</th>\n<th style=\"text-align:center\">密钥长度</th>\n<th style=\"text-align:center\">轮数</th>\n<th style=\"text-align:center\">一轮加密算法</th>\n<th style=\"text-align:center\">非线性变换</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">DES</td>\n<td style=\"text-align:center\">64</td>\n<td style=\"text-align:center\">56</td>\n<td style=\"text-align:center\">16</td>\n<td style=\"text-align:center\">E 盒置换 + 轮密钥加 + S 盒代换 + P 盒置换 + 左右分组交换</td>\n<td style=\"text-align:center\">S 盒置换</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">AES</td>\n<td style=\"text-align:center\">128</td>\n<td style=\"text-align:center\">128/192/256</td>\n<td style=\"text-align:center\">10/12/14</td>\n<td style=\"text-align:center\">字节代换、行移位、列混淆、轮密钥加</td>\n<td style=\"text-align:center\">字节代换 + 列混淆</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"加密轮数是否越多越好密钥是否越长越好将2个算法串联对数据加密是否一定更安全\"><a class=\"anchor\" href=\"#加密轮数是否越多越好密钥是否越长越好将2个算法串联对数据加密是否一定更安全\">#</a> 加密轮数是否越多越好？密钥是否越长越好？将 2 个算法串联对数据加密，是否一定更安全？</h3>\n<ul>\n<li>加密轮数<span class=\"primary\">不</span>是越多越好</li>\n<li>密钥<span class=\"primary\">不</span>是越长越好</li>\n<li>两个算法串联<span class=\"primary\">不</span>一定更安全</li>\n</ul>\n<h3 id=\"分组密码的5种工作模式是什么能画出5种工作模式的原理框图\"><a class=\"anchor\" href=\"#分组密码的5种工作模式是什么能画出5种工作模式的原理框图\">#</a> 🌟分组密码的 5 种工作模式是什么？能画出 5 种工作模式的原理框图。</h3>\n<ul>\n<li>\n<p>ECB</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/yeeu38.png\" alt=\"ECB\" /></p>\n</li>\n<li>\n<p>CBC</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/zoxgx5.png\" alt=\"CBC\" /></p>\n</li>\n<li>\n<p>CFB</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/3rcj5c.png\" alt=\"CFB\" /></p>\n</li>\n<li>\n<p>OFB</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/e1v87j.png\" alt=\"OFB\" /></p>\n</li>\n<li>\n<p>CTR<br />\n<img data-src=\"http://imgcdn.gality.cn/blog/ao17gm.png\" alt=\"CTR\" /></p>\n</li>\n</ul>\n<h3 id=\"分析5种加密模式中哪些加密模式没有误码扩展哪些有误码扩展如果有误码扩展-会影响多少个分组\"><a class=\"anchor\" href=\"#分析5种加密模式中哪些加密模式没有误码扩展哪些有误码扩展如果有误码扩展-会影响多少个分组\">#</a> 分析 5 种加密模式中，哪些加密模式没有误码扩展？哪些有误码扩展？如果有误码扩展， 会影响多少个分组？</h3>\n<ul>\n<li>误码扩展：密文中<strong> 1bit</strong> 错误会影响解密的明文中<strong>多 bit</strong> 错误</li>\n<li><strong>无误码扩展</strong>：OFB、CTR</li>\n<li><strong>有误码扩展</strong>：ECB、CBC、CFB</li>\n<li><strong>错误传播影</strong>响的分组：\n<ul>\n<li>ECB 影响 1 个分组，即当前分组。</li>\n<li>CBC 影响 2 个分组，即当前分组和下个分组（的 1bit）。</li>\n<li>CFB 影响 2 个分组，即当前分组（的 1bit）和下个分组。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"了解中国商用分组密码算法sm4知道它的分组长度-密钥长度和加密轮数\"><a class=\"anchor\" href=\"#了解中国商用分组密码算法sm4知道它的分组长度-密钥长度和加密轮数\">#</a> 了解中国商用分组密码算法 SM4，知道它的分组长度、密钥长度和加密轮数。</h3>\n<ul>\n<li><strong>分组长度</strong>：128 位</li>\n<li><strong>密钥长度</strong>：128 位</li>\n<li><strong>轮数</strong>：32 轮</li>\n</ul>\n<h2 id=\"第五章\"><a class=\"anchor\" href=\"#第五章\">#</a> 第五章</h2>\n<h3 id=\"双钥密码体制是基于数学难题构造的请列举出目前存在的数学难题\"><a class=\"anchor\" href=\"#双钥密码体制是基于数学难题构造的请列举出目前存在的数学难题\">#</a> 双钥密码体制是基于数学难题构造的，请列举出目前存在的数学难题</h3>\n<ul>\n<li>多项式求根</li>\n<li>离散对数</li>\n<li>大整数分解</li>\n<li>背包问题</li>\n<li>D-H 问题</li>\n<li>二次剩余问题</li>\n<li>模 n 的平方根问题</li>\n</ul>\n<h3 id=\"用双钥体制加密时采用谁的公钥解密时采用谁的私钥\"><a class=\"anchor\" href=\"#用双钥体制加密时采用谁的公钥解密时采用谁的私钥\">#</a> 用双钥体制加密时采用谁的公钥？解密时采用谁的私钥？</h3>\n<p>加密采用接收方的公钥，解密时采用接收方的私钥</p>\n<h3 id=\"rsa是基于何种数学难题构造的diffie-hellman是基于何种数学难题构造的\"><a class=\"anchor\" href=\"#rsa是基于何种数学难题构造的diffie-hellman是基于何种数学难题构造的\">#</a> RSA 是基于何种数学难题构造的？Diffie-Hellman 是基于何种数学难题构造的？</h3>\n<p><strong>RSA</strong>：基于大整数分解的困难性</p>\n<p><strong>Diffie-Hellman</strong>：基于 Diffie-Hellman 问题</p>\n<h3 id=\"请写出rsa加密和解密的数学表达式并指出什么是公钥什么是私钥并能做简单的加密和解密计算\"><a class=\"anchor\" href=\"#请写出rsa加密和解密的数学表达式并指出什么是公钥什么是私钥并能做简单的加密和解密计算\">#</a> 🌟请写出 RSA 加密和解密的数学表达式，并指出什么是公钥，什么是私钥？并能做简单的加密和解密计算</h3>\n<ul>\n<li><strong>公钥</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo separator=\"true\">,</mo><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">n, e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span></li>\n<li><strong>私钥</strong>： <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span></li>\n<li><strong>加密</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>→</mo><mi>c</mi><mo>=</mo><msup><mi>m</mi><mi>e</mi></msup><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">m \\rightarrow c = m^e \\space mod \\space n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.664392em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">e</span></span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">n</span></span></span></span></li>\n<li><strong>解密</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>→</mo><mi>m</mi><mo>=</mo><msup><mi>c</mi><mi>d</mi></msup><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">c \\rightarrow m = c^d \\space mod \\space n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.849108em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">d</span></span></span></span></span></span></span></span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">n</span></span></span></span></li>\n</ul>\n<p><strong>简单的加解密计算</strong>：</p>\n<ul>\n<li></li>\n</ul>\n<h3 id=\"rsa在各种参数选择上有哪些原则和限制为什么\"><a class=\"anchor\" href=\"#rsa在各种参数选择上有哪些原则和限制为什么\">#</a> RSA 在各种参数选择上有哪些原则和限制？为什么？</h3>\n<ul>\n<li><strong>n 的选取</strong>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 必须是强素数，否则存在一种可以简单分解 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 的算法</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 之差要大，否则容易推测出<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">p-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7777700000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">q-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7777700000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span> 的最大公因子要小，否则唯密文攻击下容易算出明文</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> 要足够大，来使暴力分解 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 在计算上不可行。</li>\n</ul>\n</li>\n<li><strong>e 的选取</strong>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span> 不可过小，否则容易遭受低指数攻击</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span> 要与 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>φ</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\varphi (n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">φ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 互素，否则模 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>φ</mi><mo stretchy=\"false\">(</mo><mi>n</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\varphi (n)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">φ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">n</span><span class=\"mclose\">)</span></span></span></span> 下 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span> 的逆元不存在。</li>\n</ul>\n</li>\n<li><strong>d 的选取</strong>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>d</mi></mrow><annotation encoding=\"application/x-tex\">d</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">d</span></span></span></span> 要大于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>n</mi><mfrac><mn>1</mn><mn>4</mn></mfrac></msup></mrow><annotation encoding=\"application/x-tex\">n^{1\\over 4}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9540200000000001em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9540200000000001em;\"><span style=\"top:-3.363em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mopen nulldelimiter sizing reset-size3 size6\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8443142857142858em;\"><span style=\"top:-2.656em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">4</span></span></span></span><span style=\"top:-3.2255000000000003em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line mtight\" style=\"border-bottom-width:0.049em;\"></span></span><span style=\"top:-3.384em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.344em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter sizing reset-size3 size6\"></span></span></span></span></span></span></span></span></span></span></span></span></span>，否则容易由已知明文攻击</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"写出eigamal密码体制是基于何种数学难题请写出它的加密表达式和解密表达式\"><a class=\"anchor\" href=\"#写出eigamal密码体制是基于何种数学难题请写出它的加密表达式和解密表达式\">#</a> 写出 EIGamal 密码体制是基于何种数学难题？请写出它的加密表达式和解密表达式？</h3>\n<ul>\n<li>基于<strong>有限域上离散对数问题</strong></li>\n<li><strong>加密</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>→</mo><mo stretchy=\"false\">(</mo><msup><mi>g</mi><mi>k</mi></msup><mo separator=\"true\">,</mo><mi>m</mi><msup><mi>β</mi><mi>k</mi></msup><mo stretchy=\"false\">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">m \\rightarrow (g^k,m\\beta^k)mod \\space p = (y_1,y_2) = c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.099108em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span></li>\n<li><strong>解密</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>=</mo><msub><mi>y</mi><mn>2</mn></msub><msubsup><mi>y</mi><mn>1</mn><mrow><mo>−</mo><mi>a</mi></mrow></msubsup><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">m = y_2 y_1^{-a}mod \\space p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0777700000000001em;vertical-align:-0.266308em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.811462em;\"><span style=\"top:-2.433692em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span><span style=\"top:-3.1031310000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mathnormal mtight\">a</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.266308em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">p</span></span></span></span></li>\n</ul>\n<h3 id=\"ecc公钥密码基于何种数学难题写出ecc公钥密码体制的加密表达式和解密表达式\"><a class=\"anchor\" href=\"#ecc公钥密码基于何种数学难题写出ecc公钥密码体制的加密表达式和解密表达式\">#</a> 🌟ECC 公钥密码基于何种数学难题？写出 ECC 公钥密码体制的加密表达式和解密表达式</h3>\n<ul>\n<li>基于<strong>椭圆曲线离散对数问题</strong></li>\n<li kG,=\"\" m+kP_b=\"\" \\=\"\"><strong>加密</strong>：C = \\{C_1,C_2\\} = \\</li>\n<li><strong>解密</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>m</mi><mo>+</mo><mi>k</mi><msub><mi>P</mi><mi>B</mi></msub><mo stretchy=\"false\">)</mo><mo>−</mo><msub><mi>n</mi><mi>b</mi></msub><mo stretchy=\"false\">(</mo><mi>k</mi><mi>G</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m = (m +kP_B)-n_b(kG) = m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\">G</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span></li>\n</ul>\n<h3 id=\"写出基于ecc的diffie-hellman密钥交换协议\"><a class=\"anchor\" href=\"#写出基于ecc的diffie-hellman密钥交换协议\">#</a> 写出基于 ECC 的 Diffie-Hellman 密钥交换协议。</h3>\n<ol>\n<li>A 选择一小于 n 的整数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 作为私钥， 由 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>A</mi></msub><mo>=</mo><msub><mi>n</mi><mi>A</mi></msub><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">P_A = n_AG</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">G</span></span></span></span> 产生 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>E</mi><mi>p</mi></msub><mo stretchy=\"false\">(</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">E_p(a,b)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span></span></span></span> 上的一点作为公钥。</li>\n<li>B 选取自己的私钥 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>n</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">n_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> ， 并计算自己的公钥 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>B</mi></msub><mo>=</mo><msub><mi>n</mi><mi>B</mi></msub><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">P_B = n_BG</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">G</span></span></span></span> 。</li>\n<li>A 可以获得 B 得公钥 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li>B 可以获得 A 的公钥 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n<li>A 计算：$ K = n_A \\times P_B = n_An_BG$</li>\n<li>B 计算：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi><mo>=</mo><msub><mi>n</mi><mi>B</mi></msub><mo>×</mo><msub><mi>P</mi><mi>A</mi></msub><mo>=</mo><msub><mi>n</mi><mi>A</mi></msub><msub><mi>n</mi><mi>B</mi></msub><mi>G</mi></mrow><annotation encoding=\"application/x-tex\">K = n_B \\times P_A = n_An_BG</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">G</span></span></span></span></li>\n</ol>\n<h3 id=\"rsa和ecc公钥密码算法在加密-解密速度上有何差异请查阅资料比较它们分别采用硬件和软件实现时的加密和解密速度\"><a class=\"anchor\" href=\"#rsa和ecc公钥密码算法在加密-解密速度上有何差异请查阅资料比较它们分别采用硬件和软件实现时的加密和解密速度\">#</a> RSA 和 ECC 公钥密码算法在加密、解密速度上有何差异？请查阅资料，比较它们分别采用硬件和软件实现时的加密和解密速度。</h3>\n<p>在达到同等安全性需求时，ECC 具有更短的密钥长度，虽然计算更复杂，但加密速度更快。</p>\n<p>无论硬件还是软件，ECC 都比 RSA 快！</p>\n<h3 id=\"对公钥密码的攻击有哪些常见的攻击方式它们各有什么特点\"><a class=\"anchor\" href=\"#对公钥密码的攻击有哪些常见的攻击方式它们各有什么特点\">#</a> 对公钥密码的攻击有哪些常见的攻击方式？它们各有什么特点？</h3>\n<ul>\n<li><strong>选择明文攻击（CPA）</strong>：攻击者选择明文并得到相应密文。</li>\n<li><strong>选择密文攻击（CCA）</strong>：攻击者选择密文并得到解密消息。</li>\n<li><strong>适应性选择密文攻击（CCA2）</strong>：攻击者在 CCA 的基础上，永远可以获得解密服务</li>\n</ul>\n<p><strong>注意</strong>：在 CCA 和 CCA2 中，攻击者<strong>不能</strong>直接解密<strong>目标密文</strong>。</p>\n<h3 id=\"了解中国的商用公钥密码算法sm2\"><a class=\"anchor\" href=\"#了解中国的商用公钥密码算法sm2\">#</a> 了解中国的商用公钥密码算法 SM2</h3>\n<ul>\n<li>一组基于<strong>椭圆曲线</strong>的公钥密码算法</li>\n<li>包含<strong>加解密算法、数字签名算法和密钥交换协议</strong></li>\n<li>采取了检错措施，提高了系统的数据完整性和可靠性<br />\n推荐使用<strong> 256 位</strong>素数域上的椭圆曲线<br />\n涉及<strong> 3 类</strong>辅助函数：杂凑函数、密钥派生函数、随机数发生器</li>\n</ul>\n<h2 id=\"第六章\"><a class=\"anchor\" href=\"#第六章\">#</a> 第六章</h2>\n<h3 id=\"请说明hash函数与加密函数有何不同\"><a class=\"anchor\" href=\"#请说明hash函数与加密函数有何不同\">#</a> 请说明 Hash 函数与加密函数有何不同？</h3>\n<ul>\n<li>hash 函数生成定长的消息摘要，加密函数生成的密文长度和明文长度有关</li>\n<li>hash 算法不可逆，加密函数可逆</li>\n</ul>\n<h3 id=\"杂凑函数具有哪些性质\"><a class=\"anchor\" href=\"#杂凑函数具有哪些性质\">#</a> 杂凑函数具有哪些性质？</h3>\n<ol>\n<li><strong>快速性</strong>：由 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 容易</li>\n<li><strong>单向性</strong>：由 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> 计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span> 困难</li>\n<li><strong>无碰撞</strong>：寻找 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo mathvariant=\"normal\">≠</mo><msub><mi>x</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">x_1 \\ne x_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"inner\"><span class=\"mrel\"></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> ，使 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mi>H</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(x_1) = H(x_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 困难</li>\n</ol>\n<h3 id=\"什么是消息认证码mac如何构造\"><a class=\"anchor\" href=\"#什么是消息认证码mac如何构造\">#</a> 什么是消息认证码 MAC？如何构造？</h3>\n<ul>\n<li><strong>MAC</strong>：有密钥参与杂凑运算的算法</li>\n<li><strong>构造方法</strong>：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mi>A</mi><mi>C</mi><mo>=</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mi mathvariant=\"normal\">∣</mi><mi mathvariant=\"normal\">∣</mi><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">MAC = H(m||k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mord\">∣</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span></li>\n</ul>\n<h3 id=\"在不知道密钥的情况下如何对mac算法成功实施攻击167页\"><a class=\"anchor\" href=\"#在不知道密钥的情况下如何对mac算法成功实施攻击167页\">#</a> 在不知道密钥的情况下，如何对 MAC 算法成功实施攻击？（167 页）</h3>\n<ul>\n<li>穷举</li>\n<li>构造</li>\n<li>碰撞</li>\n<li>差分分析</li>\n<li>密码分析</li>\n</ul>\n<h3 id=\"如何采用hash函数和分组加密算法构造mac\"><a class=\"anchor\" href=\"#如何采用hash函数和分组加密算法构造mac\">#</a> 如何采用 Hash 函数和分组加密算法构造 MAC？</h3>\n<ul>\n<li><strong>Hash 函数</strong>构造方法：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>M</mi><mi>A</mi><mi>C</mi><mo>=</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mi mathvariant=\"normal\">∣</mi><mi mathvariant=\"normal\">∣</mi><mi>k</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">MAC = H(m||k)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mord\">∣</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mclose\">)</span></span></span></span>。</li>\n<li><strong>分组加密算法</strong>构造方法：对消息 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 进行分组并填充为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>l</mi></mrow><annotation encoding=\"application/x-tex\">l</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span></span></span></span> 个组，设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub><mo>=</mo><mi>I</mi><mi>V</mi></mrow><annotation encoding=\"application/x-tex\">C_0 = IV</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span></span></span></span> 为随机初始向量，发送者用 CBC 加密：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>←</mo><msub><mi>E</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><msub><mi>m</mi><mi>i</mi></msub><mo>⊕</mo><msub><mi>C</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">C_i \\leftarrow E_k(m_i \\oplus C_{i-1})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">←</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">m</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.311664em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.208331em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> ，数值对 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>I</mi><mi>V</mi><mo separator=\"true\">,</mo><msub><mi>C</mi><mi>l</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(IV, C_l)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 作为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 的 MAC。</li>\n</ul>\n<h3 id=\"什么是消息检测码或消息摘要mdc简述mdc与mac的异同\"><a class=\"anchor\" href=\"#什么是消息检测码或消息摘要mdc简述mdc与mac的异同\">#</a> 什么是消息检测码（或消息摘要）MDC？简述 MDC 与 MAC 的异同。</h3>\n<ul>\n<li><strong>MDC</strong>：无密钥参与杂凑运算的算法</li>\n<li><strong>异同</strong>：\n<ul>\n<li>同：二者都可以检测消息的完整性</li>\n<li>异：MAC 带有身份认证，MDC 不带有身份认证</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"熟悉迭代杂凑函数的构造方法\"><a class=\"anchor\" href=\"#熟悉迭代杂凑函数的构造方法\">#</a> 熟悉迭代杂凑函数的构造方法</h3>\n<ul>\n<li><strong>Rabin 法</strong></li>\n<li><strong>CBC 法</strong></li>\n<li><strong>CFB 法</strong></li>\n<li><strong>修正 Daveis-Meyer 法</strong></li>\n<li><strong>组合明 / 密文链接法</strong></li>\n</ul>\n<h3 id=\"md5的明文输入分组长度-字长-输出长度是多少位\"><a class=\"anchor\" href=\"#md5的明文输入分组长度-字长-输出长度是多少位\">#</a> MD5 的明文输入分组长度、字长、输出长度是多少位？</h3>\n<ul>\n<li><strong>分组长度</strong>：512 位</li>\n<li><strong>字长</strong>：32 位</li>\n<li><strong>输出长度</strong>：128 位</li>\n</ul>\n<h3 id=\"sha-1的明文输入分组长度-字长-输出长度是多少位\"><a class=\"anchor\" href=\"#sha-1的明文输入分组长度-字长-输出长度是多少位\">#</a> SHA-1 的明文输入分组长度、字长、输出长度是多少位？</h3>\n<ul>\n<li><strong>分组长度</strong>：512 位</li>\n<li><strong>字长</strong>：32 位</li>\n<li><strong>输出长度</strong>：160 位</li>\n</ul>\n<h3 id=\"掌握应用杂凑函数的基本方式熟悉图6-1-6-2-6-5-6-6所能够提供的安全功能\"><a class=\"anchor\" href=\"#掌握应用杂凑函数的基本方式熟悉图6-1-6-2-6-5-6-6所能够提供的安全功能\">#</a> 掌握应用杂凑函数的基本方式，熟悉图 6-1、6-2、6-5、6-6 所能够提供的安全功能。</h3>\n<ul>\n<li>\n<p><strong>应用杂凑函数的基本方式</strong></p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ovctrc.png\" alt=\"应用杂凑函数的基本方式\" /></p>\n</li>\n<li>\n<p><strong>消息加密的基本用途</strong></p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/qifhdg.png\" alt=\"消息加密的基本用途\" /></p>\n</li>\n<li>\n<p><strong>内部和外部错误控制</strong></p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/52u4jm.png\" alt=\"内部和外部错误控制\" /></p>\n</li>\n<li>\n<p><strong>MAC 的基本用途</strong></p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/7y2p9e.png\" alt=\"MAC的基本用途\" /></p>\n</li>\n</ul>\n<h3 id=\"熟悉中国商用杂凑函数sm3的构造\"><a class=\"anchor\" href=\"#熟悉中国商用杂凑函数sm3的构造\">#</a> 熟悉中国商用杂凑函数 SM3 的构造</h3>\n<ul>\n<li>SM3 采用<strong> Merkle-Damgard 结构</strong></li>\n<li><strong>分组长度</strong>：512 位</li>\n<li><strong>输出长度</strong>：256 位</li>\n</ul>\n<h2 id=\"第七章\"><a class=\"anchor\" href=\"#第七章\">#</a> 第七章</h2>\n<h3 id=\"数字签名应该具有哪些性质\"><a class=\"anchor\" href=\"#数字签名应该具有哪些性质\">#</a> 数字签名应该具有哪些性质？</h3>\n<ul>\n<li>收方能证实签名，但不能伪造（R1 - 条件）</li>\n<li>收方已收到后不能否认（收报认证）（R2 - 条件）</li>\n<li>发方不能否认签发的消息（S - 条件）</li>\n<li>第三方可以确认双方的消息发送，但不能伪造（T - 条件）</li>\n</ul>\n<h3 id=\"数字签名可以分为哪几类\"><a class=\"anchor\" href=\"#数字签名可以分为哪几类\">#</a> 数字签名可以分为哪几类？</h3>\n<ul>\n<li>按照<strong>消息是否被压缩</strong>分类\n<ul>\n<li>对<strong>整体消息</strong>签名</li>\n<li>对<strong>压缩的消息</strong>签名</li>\n</ul>\n</li>\n<li>🌟按照<strong>消息 / 签名的对应关系</strong>分类\n<ul>\n<li><strong>确定性</strong>签名</li>\n<li><strong>随即化</strong>签名</li>\n</ul>\n</li>\n<li>按照<strong>参与方式</strong>分类\n<ul>\n<li>直接签名</li>\n<li>仲裁签名</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"rsa签名是基于何种数学难题\"><a class=\"anchor\" href=\"#rsa签名是基于何种数学难题\">#</a> RSA 签名是基于何种数学难题？</h3>\n<p>大合数分解困难问题</p>\n<h3 id=\"eigamal签名是基于何种数学难题请写出eigamal的签名方程\"><a class=\"anchor\" href=\"#eigamal签名是基于何种数学难题请写出eigamal的签名方程\">#</a> EIGamal 签名是基于何种数学难题？请写出 EIGamal 的签名方程。</h3>\n<ul>\n<li>\n<p><strong>基于</strong>：离散对数问题</p>\n</li>\n<li>\n<p><strong>签名过程</strong>：</p>\n<ol>\n<li>给定消息 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> ，选择随机数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi><mo>∈</mo><msubsup><mi mathvariant=\"double-struck\">Z</mi><mi>p</mi><mo>∗</mo></msubsup></mrow><annotation encoding=\"application/x-tex\">k \\in \\mathbb{Z}^*_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.73354em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.071998em;vertical-align:-0.383108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.688696em;\"><span style=\"top:-2.4530000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.383108em;\"><span></span></span></span></span></span></span></span></span></span>，使 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>p</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">1\\le k \\le p-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.78041em;vertical-align:-0.13597em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83041em;vertical-align:-0.13597em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7777700000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi><mi>c</mi><mi>d</mi><mo stretchy=\"false\">(</mo><mi>k</mi><mo separator=\"true\">,</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">gcd(k, p-1)=1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">d</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></li>\n<li>计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(m)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mo>≡</mo><msup><mi>g</mi><mi>k</mi></msup><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">r \\equiv g^k mod \\space p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.46375em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.043548em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">p</span></span></span></span> ，计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>≡</mo><mo stretchy=\"false\">[</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo><mo>−</mo><mi>x</mi><mo>⋅</mo><mi>r</mi><mo stretchy=\"false\">]</mo><mo>⋅</mo><msup><mi>k</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mo stretchy=\"false\">(</mo><mi>p</mi><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">s \\equiv [H(m) - x\\cdot r]\\cdot k ^{-1} mod \\space (p-1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.46375em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.44445em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>签名为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>i</mi><msub><mi>g</mi><mrow><mi>s</mi><mi>k</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Sig_{sk}(m)=(r,s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span> ，将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(r,s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span> 发送给接收方。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"schnorr签名与eigamal签名有何不同请比较两者的异同\"><a class=\"anchor\" href=\"#schnorr签名与eigamal签名有何不同请比较两者的异同\">#</a> Schnorr 签名与 EIGamal 签名有何不同？请比较两者的异同。</h3>\n<ul>\n<li>在 EIGamal 体制中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi mathvariant=\"double-struck\">Z</mi><mi>p</mi><mo>∗</mo></msubsup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}^*_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.071998em;vertical-align:-0.383108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.688696em;\"><span style=\"top:-2.4530000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.383108em;\"><span></span></span></span></span></span></span></span></span></span> 的本原元素；在 Schnorr 体制中，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>g</mi></mrow><annotation encoding=\"application/x-tex\">g</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span></span></span></span> 为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi mathvariant=\"double-struck\">Z</mi><mi>p</mi><mo>∗</mo></msubsup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}^*_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.071998em;vertical-align:-0.383108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.688696em;\"><span style=\"top:-2.4530000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.383108em;\"><span></span></span></span></span></span></span></span></span></span> 中的子集 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi mathvariant=\"double-struck\">Z</mi><mi>q</mi><mo>∗</mo></msubsup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}^*_q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.071998em;vertical-align:-0.383108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.688696em;\"><span style=\"top:-2.4530000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">q</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.383108em;\"><span></span></span></span></span></span></span></span></span></span> 的本原元，它不是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi mathvariant=\"double-struck\">Z</mi><mi>p</mi><mo>∗</mo></msubsup></mrow><annotation encoding=\"application/x-tex\">\\mathbb{Z}^*_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.071998em;vertical-align:-0.383108em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathbb\">Z</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.688696em;\"><span style=\"top:-2.4530000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.383108em;\"><span></span></span></span></span></span></span></span></span></span> 的本原元；</li>\n<li><strong>Schnorr 的签名长度要比 EIGamal 短</strong>，由 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>q</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|q|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span><span class=\"mord\">∣</span></span></span></span> 以及 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(m)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span></span></span></span> 决定</li>\n<li>Schnorr 签名的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mo>=</mo><msup><mi>g</mi><mi>k</mi></msup><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">r= g^k mod \\space p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.043548em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">p</span></span></span></span> 可以预先计算，签名只需 1 次乘法和 1 次加法，签名速度快， 适用于智能卡应用</li>\n<li>由于 Schnorr 签名较短， <strong>Schnor 体制安全性比 BIGamal 体制差</strong></li>\n</ul>\n<h3 id=\"请写出dss的签名方程并比较它与eigamal-schnorr的异同\"><a class=\"anchor\" href=\"#请写出dss的签名方程并比较它与eigamal-schnorr的异同\">#</a> 请写出 DSS 的签名方程，并比较它与 EIGamal、Schnorr 的异同</h3>\n<ul>\n<li><strong>签名过程</strong>：\n<ol>\n<li>给定消息 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi><mo>∈</mo><mi>M</mi></mrow><annotation encoding=\"application/x-tex\">m \\in M</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">m</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span></span></span></span> ，选择秘密随机数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> ，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mo>&lt;</mo><mi>k</mi><mo>&lt;</mo><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">0&lt;k&lt;q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68354em;vertical-align:-0.0391em;\"></span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73354em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span>，计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(m)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span></span></span></span></li>\n<li>计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mo>≡</mo><mo stretchy=\"false\">(</mo><msup><mi>g</mi><mi>k</mi></msup><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>p</mi><mo stretchy=\"false\">)</mo><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">r \\equiv (g^k mod \\space p) mod \\space q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.46375em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.099108em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.849108em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\">p</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span> ，计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi><mo>≡</mo><mo stretchy=\"false\">[</mo><msup><mi>k</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⋅</mo><mo stretchy=\"false\">(</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>x</mi><mi>r</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">]</mo><mi>m</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>q</mi></mrow><annotation encoding=\"application/x-tex\">s \\equiv [k^{-1} \\cdot (H(m) + xr)] mod \\space q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.46375em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≡</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.064108em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mclose\">)</span><span class=\"mclose\">]</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\"> </span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">q</span></span></span></span></li>\n<li>签名为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>i</mi><msub><mi>g</mi><mrow><mi>s</mi><mi>k</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>m</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Sig_{sk}(m) = (r,s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\">i</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span>， 将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>r</mi><mo separator=\"true\">,</mo><mi>s</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(r,s)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span></span></span></span> 发送给接收方</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"在以上三种签名方案中每次签名时用户都要选择一个随机数k-若将随机数k替换成为常数会出现什么安全问题请加以分析\"><a class=\"anchor\" href=\"#在以上三种签名方案中每次签名时用户都要选择一个随机数k-若将随机数k替换成为常数会出现什么安全问题请加以分析\">#</a> 在以上三种签名方案中，每次签名时，用户都要选择一个随机数 k。若将随机数 k 替换成为常数，会出现什么安全问题？请加以分析。</h3>\n<p>可以通过 2 个使用相同随机数的签名解密出私钥。</p>\n<h3 id=\"diffie-hellman能用来做数字签名吗\"><a class=\"anchor\" href=\"#diffie-hellman能用来做数字签名吗\">#</a> Diffie-Hellman 能用来做数字签名吗？</h3>\n<p>不能</p>\n<h3 id=\"单钥体制能用来做数字签名吗\"><a class=\"anchor\" href=\"#单钥体制能用来做数字签名吗\">#</a> 单钥体制能用来做数字签名吗？</h3>\n<p>不能</p>\n<h3 id=\"试比较数字签名在密钥的使用上与公钥加密算法存在的区别\"><a class=\"anchor\" href=\"#试比较数字签名在密钥的使用上与公钥加密算法存在的区别\">#</a> 试比较数字签名在密钥的使用上，与公钥加密算法存在的区别</h3>\n<p>数字签名是用签名者的私钥进行签名，用签名者的公钥进行验证，双钥加密为发送方用接受方的公钥进行消息的加密，接受方用自己的私钥进行解密</p>\n<h3 id=\"请列举具有特殊功能的数字签名体制有哪些它们各有什么用途\"><a class=\"anchor\" href=\"#请列举具有特殊功能的数字签名体制有哪些它们各有什么用途\">#</a> 请列举具有特殊功能的数字签名体制有哪些？它们各有什么用途？</h3>\n<ul>\n<li><strong>不可否认签名</strong>：签名者合作下才能验证签名（知识产权保护）</li>\n<li>防失败签名：防范有充足计算资源的攻击者，及时攻击者分析出私钥也难以伪造（一次性签名方案）</li>\n<li><strong>盲签名</strong>：文件所有者不想让签名者知道文件的内容（选举投票、电子商务等）</li>\n<li><strong>群签名</strong>：群众成员可签、外界不可知谁签、争议时群成员或可信赖三方可鉴别签名者（项目投标）</li>\n<li><strong>代理签名</strong>：委托人授权某个代理人签名，签名密钥无需交给代理人</li>\n<li><strong>指定证实人签名</strong>：一个机构中，指定一个人负责证实所有人签名（有助于防止签名失效）</li>\n<li><strong>一次性签名</strong>：每个签名采用一个新的公钥，优点是签名和验证速度非常快</li>\n</ul>\n<h3 id=\"了解中国商用数字签名算法sm2\"><a class=\"anchor\" href=\"#了解中国商用数字签名算法sm2\">#</a> 了解中国商用数字签名算法 SM2。</h3>\n<h2 id=\"第八章\"><a class=\"anchor\" href=\"#第八章\">#</a> 第八章</h2>\n<h3 id=\"构成协议的三个主要特征含义是什么\"><a class=\"anchor\" href=\"#构成协议的三个主要特征含义是什么\">#</a> 构成协议的三个主要特征（含义）是什么？</h3>\n<ul>\n<li>必须依次执行</li>\n<li>至少两个参与者</li>\n<li>必须能够完成某项任务</li>\n</ul>\n<h3 id=\"什么是仲裁协议什么是裁决协议什么是自执行协议\"><a class=\"anchor\" href=\"#什么是仲裁协议什么是裁决协议什么是自执行协议\">#</a> 什么是仲裁协议？什么是裁决协议？什么是自执行协议？</h3>\n<ul>\n<li>\n<p><strong>仲裁协议</strong>：可信赖第三方 Trent 参与协议。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/i5azx3.png\" alt=\"仲裁协议\" /></p>\n</li>\n<li>\n<p><strong>裁决协议</strong>：Trent 不直接参与协议，纠纷时裁决。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/uaowkw.png\" alt=\"裁决协议\" /></p>\n</li>\n<li>\n<p><strong>自执行协议</strong>：最好的协议，若一方试图欺骗另一方，那么另一方回立刻检测到该欺骗的发生并终止协议。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/jatgdg.png\" alt=\"自执行协议\" /></p>\n</li>\n</ul>\n<h3 id=\"如果按照密码协议的功能分类密码协议可以分为哪几类\"><a class=\"anchor\" href=\"#如果按照密码协议的功能分类密码协议可以分为哪几类\">#</a> 如果按照密码协议的功能分类，密码协议可以分为哪几类？</h3>\n<ul>\n<li><strong>认证协议</strong></li>\n<li><strong>密钥建立协议</strong></li>\n<li><strong>认证的密钥建立协议</strong></li>\n</ul>\n<h3 id=\"什么是中间人攻击如何对diffie-hellman协议进行中间人攻击请用画图分析对diffie-hellman协议进行中间人攻击的详细过程\"><a class=\"anchor\" href=\"#什么是中间人攻击如何对diffie-hellman协议进行中间人攻击请用画图分析对diffie-hellman协议进行中间人攻击的详细过程\">#</a> 什么是中间人攻击？如何对 Diffie-Hellman 协议进行中间人攻击？请用画图分析对 Diffie- Hellman 协议进行中间人攻击的详细过程。</h3>\n<ul>\n<li>\n<p><strong>中间人攻击</strong>参考</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ax4nha.png\" alt=\"中间人攻击\" /></p>\n<p>当 B 与 A 会话时，M 可以冒充 B，当 A 与 B 会话时，M 可以冒充 A。</p>\n</li>\n</ul>\n<h3 id=\"dh协议不能抵抗中间人攻击的原因是什么如何改造dh协议可以使其抵抗中间人攻击\"><a class=\"anchor\" href=\"#dh协议不能抵抗中间人攻击的原因是什么如何改造dh协议可以使其抵抗中间人攻击\">#</a> DH 协议不能抵抗中间人攻击的原因是什么？如何改造 DH 协议可以使其抵抗中间人攻击？</h3>\n<ul>\n<li>DH 不抵抗中间人攻击的本质原因：通信双方没有进行<strong>实体认证</strong>。</li>\n<li>改造 DH：引入 CA，用公钥向 CA 请求证书，将证书发送给对方</li>\n</ul>\n<h3 id=\"掌握大嘴青蛙协议-yahalom-kerberos协议安全协议设计的思想\"><a class=\"anchor\" href=\"#掌握大嘴青蛙协议-yahalom-kerberos协议安全协议设计的思想\">#</a> 掌握大嘴青蛙协议、Yahalom、Kerberos 协议安全协议设计的思想。</h3>\n<ul>\n<li>\n<p><strong>大嘴青蛙协议</strong>：A 和 B 均与 T 共享一个密钥，只需要传两条消息，就可以将一个会话密钥发送给 B。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/n2uuvf.png\" alt=\"大嘴青蛙\" /></p>\n</li>\n<li>\n<p><strong>Yahalom</strong>：由 B 先向 T 接触，T 仅向 A 发送一条消息</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/j6ey3r.png\" alt=\"Yahalom\" /></p>\n</li>\n<li>\n<p><strong>Kerberos</strong>：A 和 B 均与 T 共享一个密钥，采用时戳。会话密钥由 A 生成。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/wyke2u.png\" alt=\"Kerberos\" /></p>\n</li>\n</ul>\n<h3 id=\"请画图分析第218页的skid协议为什么不能抵抗中间人攻击如何改造这个协议可以有效抵抗中间人攻击\"><a class=\"anchor\" href=\"#请画图分析第218页的skid协议为什么不能抵抗中间人攻击如何改造这个协议可以有效抵抗中间人攻击\">#</a> 请画图分析第 218 页的 SKID 协议为什么不能抵抗中间人攻击？如何改造这个协议，可以有效抵抗中间人攻击？</h3>\n<ul>\n<li>SKID 采用 MAC 来提供安全性，并假设 A 和 B 共享一个密钥 K</li>\n<li>SKID2 是单向身份识别协议（只有 1～3 步）</li>\n<li>SKID3 是双向身份识别协议，如下图</li>\n</ul>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/b9tzhp.png\" alt=\"SKID3\" /></p>\n<ul>\n<li>\n<p><strong>中间人攻击</strong>：采用预言者会话攻击</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/seury5.png\" alt=\"预言者会话攻击\" /></p>\n</li>\n<li>\n<p><strong>改造协议</strong>：在这个协议中，A 无法确定消息来源于 B，所以会导致中间人攻击，所以可以引入数字签名、数字证书来解决这个问题。</p>\n</li>\n</ul>\n<h3 id=\"对密码协议的攻击方法有哪些\"><a class=\"anchor\" href=\"#对密码协议的攻击方法有哪些\">#</a> 对密码协议的攻击方法有哪些？</h3>\n<ul>\n<li><strong>已知明文攻击</strong>：通过长期窃听获得一个加密表</li>\n<li><strong>选择密文攻击</strong>：可选择将明文转换为密文，可选择全 “0” 或全 “1” 的密文串来加速解密</li>\n<li><strong>预言者会话攻击</strong>：将一方当作另一方的预言者 “解密服务器”</li>\n<li><strong>并行会话攻击</strong>：曾经使用过的信息流在新的协议执行过程中被使用</li>\n</ul>\n<h3 id=\"密码协议的安全性分析的常用方法有哪些\"><a class=\"anchor\" href=\"#密码协议的安全性分析的常用方法有哪些\">#</a> 密码协议的安全性分析的常用方法有哪些？</h3>\n<ul>\n<li><strong>攻击检验法</strong></li>\n<li><strong>形式语言逻辑分析法</strong></li>\n<li><strong>可证明安全性分析法</strong></li>\n</ul>\n<h2 id=\"第九章\"><a class=\"anchor\" href=\"#第九章\">#</a> 第九章</h2>\n<h3 id=\"什么是pkipki由哪几部分组成每个组成部分的作用是什么\"><a class=\"anchor\" href=\"#什么是pkipki由哪几部分组成每个组成部分的作用是什么\">#</a> 什么是 PKI？PKI 由哪几部分组成？每个组成部分的作用是什么？</h3>\n<ul>\n<li><strong>PKI</strong>：公钥基础设施（Public Key Infrastructure），一种遵循<strong>标准</strong>的利用<strong>公钥</strong>理论和技术建立的提供<strong>安全服务</strong>的基础设施。</li>\n<li><strong>组成部分和功能</strong>：\n<ul>\n<li>证书机构 CA：发放和管理证书等。（生成和颁发数字证书）</li>\n<li>注册机构 RA：证书注册和审批。（接受与验证信息，为用户生成密钥，接受撤销请求）</li>\n<li>证书发布库：集中存放 CA 颁发的证书和撤销列表。</li>\n<li>密钥备份与恢复：备份和恢复用户的私钥（用于数据加密的私钥才会备份）。</li>\n<li>证书撤销：当证书作废时警告其他用户不要继续使用该证书。</li>\n<li>PKI 应用接口：使用户更方便的使用加密、数字签名等安全服务。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"什么是数字证书一个数字证书包含哪些内容\"><a class=\"anchor\" href=\"#什么是数字证书一个数字证书包含哪些内容\">#</a> 什么是数字证书？一个数字证书包含哪些内容？</h3>\n<ul>\n<li>\n<p><strong>数字证书</strong>：数字证书就是一个用户的<strong>身份</strong>与其所持有的<strong>公钥</strong>的结合，在结合之前由一个可信任的<strong>权威机构 CA</strong> 来证实用户的身份，然后由该机构对用户身份及对应公钥相结合的证书进行<strong>数字签名</strong>，以证明其证书的有效性。</p>\n</li>\n<li>\n<p><strong>包含</strong>：</p>\n<ul>\n<li>主体名</li>\n<li>公钥</li>\n<li>序号</li>\n<li>有效期</li>\n<li>签发者名</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"了解x509标准规定的数字证书的格式\"><a class=\"anchor\" href=\"#了解x509标准规定的数字证书的格式\">#</a> 了解 X.509 标准规定的数字证书的格式。</h3>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/lvyvyh.png\" alt=\"数字证书的格式\" /></p>\n<h3 id=\"实际中由谁来签发证书签发证书时是由谁的何种密钥私钥还是公钥进行签名验证证书时是用谁的何种密钥来验证\"><a class=\"anchor\" href=\"#实际中由谁来签发证书签发证书时是由谁的何种密钥私钥还是公钥进行签名验证证书时是用谁的何种密钥来验证\">#</a> 实际中，由谁来签发证书？签发证书时，是由谁的何种密钥（私钥还是公钥）进行签名？验证证书时，是用谁的何种密钥来验证？</h3>\n<p>实际中，由<strong> CA</strong> 签发证书。签发时采用<strong> CA 的私钥</strong>，验证时采用<strong> CA 的公钥</strong>。</p>\n<h3 id=\"数字证书的作用是什么它本质上是为解决网络安全中的何种问题\"><a class=\"anchor\" href=\"#数字证书的作用是什么它本质上是为解决网络安全中的何种问题\">#</a> 数字证书的作用是什么？它本质上是为解决网络安全中的何种问题？</h3>\n<p><strong>作用</strong>：证明网络实体在特定安全应用的相关信息。解决了公钥的可信性问题。</p>\n<h3 id=\"在实际应用中若采用层次化的ca架构如何实现两个位于不同子ca中的用户之间的数字证书验证\"><a class=\"anchor\" href=\"#在实际应用中若采用层次化的ca架构如何实现两个位于不同子ca中的用户之间的数字证书验证\">#</a> 在实际应用中，若采用层次化的 CA 架构，如何实现两个位于不同子 CA 中的用户之间的数字证书验证？</h3>\n<p>逐级往上，直到验证到根 CA</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/8muxvf.png\" alt=\"逐级验证\" /></p>\n<p>以 Alice 要验证 Bob 的证书为例：</p>\n<ol>\n<li>Bob 发送自己的证书</li>\n<li>Alice 请求 B11 的公钥</li>\n<li>Bob 发送 B11 的证书</li>\n<li>Alice 请求 A3 的公钥</li>\n<li>Bob 发送 A3 的证书</li>\n<li>Alice 用根 CA 证书验证 A3 的证书</li>\n</ol>\n<h3 id=\"什么是交叉证书\"><a class=\"anchor\" href=\"#什么是交叉证书\">#</a> 什么是交叉证书？</h3>\n<p>交叉证书可以让不同 PKI 域的根 CA 进行交叉认证，从而解决根 CA 不同的信任问题</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ozoosm.png\" alt=\"交叉证书\" /></p>\n<h3 id=\"如何实现数字证书的撤销如何实现数字证书的在线查询\"><a class=\"anchor\" href=\"#如何实现数字证书的撤销如何实现数字证书的在线查询\">#</a> 如何实现数字证书的撤销？如何实现数字证书的在线查询？</h3>\n<ul>\n<li>\n<p>撤销检查：维护证书撤销列表（CRL）或是执行联机证书状态协议，对证书的撤销状态进行检查</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/mgvclr.png\" alt=\"数字证书的撤销\" /></p>\n</li>\n<li>\n<p><strong>在线查询</strong>：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/qpq32e.png\" alt=\"数字证书在线查询\" /></p>\n</li>\n</ul>\n<h3 id=\"什么是漫游证书简述其基本工作原理\"><a class=\"anchor\" href=\"#什么是漫游证书简述其基本工作原理\">#</a> 什么是漫游证书？简述其基本工作原理。</h3>\n<ul>\n<li><strong>漫游证书</strong>：通过第三方软件提供，在任何系统中，只需正确配置，该软件就可以允许用户访问自己的公 / 私钥对。</li>\n<li><strong>工作原理</strong>：\n<ul>\n<li>将数字证书和私钥存储于安全的中央服务器</li>\n<li>用户需要数字证书时，可向该服务器认证自己</li>\n<li>认证成功后，该服务器将证书和私钥发给用户</li>\n<li>当用户完成工作后，该软件自动删除证书和私钥</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"一个pkica数字证书系统由哪几部分构成\"><a class=\"anchor\" href=\"#一个pkica数字证书系统由哪几部分构成\">#</a> 一个 PKI/CA 数字证书系统由哪几部分构成？</h3>\n<p>证书机构、注册机构、密钥备份与恢复、证书发布库、证书撤销</p>\n<h2 id=\"第十章\"><a class=\"anchor\" href=\"#第十章\">#</a> 第十章</h2>\n<h3 id=\"什么是链路加密有什么优缺点\"><a class=\"anchor\" href=\"#什么是链路加密有什么优缺点\">#</a> 什么是链路加密？有什么优缺点？</h3>\n<ul>\n<li>\n<p><strong>链路加密</strong>：对网络中两个相邻节点之间传输的数据进行加密保护</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/dsh1yj.png\" alt=\"链路加密\" /></p>\n</li>\n<li>\n<p>优点：</p>\n<ul>\n<li>\n<p>加密对用户是透明的，通过链路发送的任何信息在发送前都先被加密。</p>\n</li>\n<li>\n<p>每个链路只需要一对密钥。</p>\n</li>\n<li>\n<p>提供了信号流安全机制。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>缺点：</p>\n<ul>\n<li>数据在中间结点以明文形式出现，维护结点安全性的代价较高</li>\n<li>密钥分配困难</li>\n<li>节点增多后密码机需求量大</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"什么是节点加密有什么优缺点\"><a class=\"anchor\" href=\"#什么是节点加密有什么优缺点\">#</a> 什么是节点加密？有什么优缺点？</h3>\n<ul>\n<li>\n<p><strong>节点加密</strong>：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/wvu0tt.png\" alt=\"节点加密\" /></p>\n</li>\n<li>\n<p>优点：</p>\n<ul>\n<li>\n<p>消息的加、解密在安全模块中进行，这使消息内容不会被泄密。</p>\n</li>\n<li>\n<p>加密对用户透明。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>缺点：</p>\n<ul>\n<li>\n<p>某些信息（如报头和路由信息）必须以明文形式传输，可能遭到流量分析攻击。</p>\n</li>\n<li>\n<p>因为所有节点都必须有密钥，密钥分发和管理变的困难。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"什么是端到端加密有什么优缺点\"><a class=\"anchor\" href=\"#什么是端到端加密有什么优缺点\">#</a> 什么是端到端加密？有什么优缺点？</h3>\n<ul>\n<li>\n<p><strong>端到端加密</strong>：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/sedhyp.png\" alt=\"端到端加密\" /></p>\n</li>\n<li>\n<p>优点：</p>\n<ul>\n<li>\n<p>对两个终端之间的整个通信线路进行加密。</p>\n</li>\n<li>\n<p>只需要 2 台加密机，1 台在发端，1 台在收端。</p>\n</li>\n<li>\n<p>从发端到收端的传输过程中，报文始终以密文存在。</p>\n</li>\n<li>\n<p>比链路和节点加密更安全可靠，更容易设计和维护。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>缺点：不能防止业务流分析攻击</p>\n</li>\n</ul>\n<h3 id=\"什么是混合加密有什么优缺点\"><a class=\"anchor\" href=\"#什么是混合加密有什么优缺点\">#</a> 什么是混合加密？有什么优缺点？</h3>\n<ul>\n<li>\n<p><strong>混合加密</strong>：链路加密 + 端到端加密</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/2cmzmh.png\" alt=\"混合加密\" /></p>\n</li>\n<li>\n<p>优点：报文被两次加密，保护了报头的敏感信息，不会被业务流分析攻击。</p>\n</li>\n<li>\n<p>缺点：信息的安全设计较复杂，成本高，系统开销大。</p>\n</li>\n</ul>\n<h3 id=\"什么是密钥管理它包括哪些方面的管理\"><a class=\"anchor\" href=\"#什么是密钥管理它包括哪些方面的管理\">#</a> 什么是密钥管理？它包括哪些方面的管理？</h3>\n<ul>\n<li><strong>密钥管理</strong>：处理密钥从产生到最终销毁的整个过程中的有关问题，包括系统的初始化及密钥的<strong>产生</strong>、<strong>存储</strong>、<strong>备份 / 恢复</strong>、<strong>装入</strong>、<strong>分配</strong>、<strong>保护</strong>、<strong>更新</strong>、<strong>控制</strong>、<strong>丢失</strong>、<strong>撤销</strong>和<strong>销毁</strong>等内容。</li>\n</ul>\n<h3 id=\"密钥有哪些种类它们各自有什么用途\"><a class=\"anchor\" href=\"#密钥有哪些种类它们各自有什么用途\">#</a> 密钥有哪些种类？它们各自有什么用途？</h3>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/3wsz9b.png\" alt=\"密钥的种类\" /></p>\n<h3 id=\"有哪些密钥分配的基本方法\"><a class=\"anchor\" href=\"#有哪些密钥分配的基本方法\">#</a> 有哪些密钥分配的基本方法？</h3>\n<ul>\n<li>\n<p><strong>利用安全信道</strong>实现密钥传递</p>\n</li>\n<li>\n<p><strong>利用双钥体制</strong>建立安全信道</p>\n</li>\n<li>\n<p><strong>利用量子技术</strong>实现密钥传递</p>\n</li>\n</ul>\n<h3 id=\"在用密钥枪注入密钥时如何验证密钥注入的正确性\"><a class=\"anchor\" href=\"#在用密钥枪注入密钥时如何验证密钥注入的正确性\">#</a> 在用密钥枪注入密钥时，如何验证密钥注入的正确性？</h3>\n<ol>\n<li>密钥枪将一随机数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>R</mi><mi>N</mi></msub></mrow><annotation encoding=\"application/x-tex\">R_N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 注入保密机</li>\n<li>保密机用主密钥 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>K</mi><mi>m</mi></msub></mrow><annotation encoding=\"application/x-tex\">K_m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 加密：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>E</mi><mrow><mi>K</mi><mi>m</mi></mrow></msub><mo stretchy=\"false\">(</mo><msub><mi>R</mi><mi>N</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">E_{Km}(R_N)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></li>\n<li>保密机计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>K</mi><mi>m</mi></msub></mrow><annotation encoding=\"application/x-tex\">K_m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的杂凑函数值：<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mo stretchy=\"false\">(</mo><msub><mi>K</mi><mi>m</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">h(K_m)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></li>\n<li>保密机将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>E</mi><mrow><mi>K</mi><mi>m</mi></mrow></msub><mo stretchy=\"false\">(</mo><msub><mi>R</mi><mi>N</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">E_{Km}(R_N)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">K</span><span class=\"mord mathnormal mtight\">m</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 和 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">)</mo><msub><mi>k</mi><mi>m</mi></msub></mrow><annotation encoding=\"application/x-tex\">h()k_m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 回送到密钥枪</li>\n<li>密钥枪检验 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mo stretchy=\"false\">(</mo><msub><mi>K</mi><mi>m</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">h(K_m)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">h</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">m</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> 值，并检验解密的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>R</mi><mi>N</mi></msub></mrow><annotation encoding=\"application/x-tex\">R_N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></li>\n</ol>\n<h3 id=\"密钥管理为什么要将密钥划分成不同的层次\"><a class=\"anchor\" href=\"#密钥管理为什么要将密钥划分成不同的层次\">#</a> 密钥管理为什么要将密钥划分成不同的层次？</h3>\n<p>利于<strong>分级管理</strong>。极少数密钥以明文形式存储在有严密物理保护的主机密码器件中，其余密钥则以密文形式存储在密码器之外。这样，密钥管理就可以大大简化，安全性也高。</p>\n<h3 id=\"一个密钥管理系统由哪几部分构成\"><a class=\"anchor\" href=\"#一个密钥管理系统由哪几部分构成\">#</a> 🌟一个密钥管理系统由哪几部分构成？</h3>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/l0cgkn.png\" alt=\"密钥管理系统\" /></p>\n<h3 id=\"密钥的生存期分哪四个阶段了解密钥管理的12个工作步骤\"><a class=\"anchor\" href=\"#密钥的生存期分哪四个阶段了解密钥管理的12个工作步骤\">#</a> 密钥的生存期分哪四个阶段？了解密钥管理的 12 个工作步骤。</h3>\n<ul>\n<li>\n<p><strong>四个阶段</strong>：</p>\n<ol>\n<li><strong>预运行阶段</strong>：此时密钥还不能用</li>\n<li><strong>运行阶段</strong>：正常使用</li>\n<li><strong>后运行阶段</strong>：不能正常使用，特殊目的下可以脱机下接入</li>\n<li><strong>报废阶段</strong>：将有关密钥从所有记录中删掉，不能使用</li>\n</ol>\n</li>\n<li>\n<p><strong>12 个工作步骤</strong>：</p>\n<ul>\n<li>用户注册</li>\n<li>用户初始化</li>\n<li>密钥生成</li>\n<li>密钥输入</li>\n<li>密钥注册</li>\n<li>正常使用</li>\n<li>密钥备份</li>\n<li>密钥更新</li>\n<li>密钥档案</li>\n<li>密钥注销与销毁</li>\n<li>密钥恢复</li>\n<li>密钥吊销</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"查找资料了解一个好的密钥应具备哪些数学特性\"><a class=\"anchor\" href=\"#查找资料了解一个好的密钥应具备哪些数学特性\">#</a> 查找资料，了解一个好的密钥应具备哪些数学特性？</h3>\n<ol>\n<li>真正随机、等概率。</li>\n<li>避免使用特定算法的弱密钥。</li>\n<li>双钥系统的密钥必须满足一定的数学关系。</li>\n<li>密钥一般会选伪随机数，循环周期应尽可能大。</li>\n<li>采用密钥揉搓或杂凑技术，将易记的长句子变换成伪随机串存放。</li>\n</ol>\n<h2 id=\"第十一章\"><a class=\"anchor\" href=\"#第十一章\">#</a> 第十一章</h2>\n<h3 id=\"无线网络面临哪些主要安全威胁要能识别哪些是主动攻击哪些是被动攻击\"><a class=\"anchor\" href=\"#无线网络面临哪些主要安全威胁要能识别哪些是主动攻击哪些是被动攻击\">#</a> 无线网络面临哪些主要安全威胁？要能识别哪些是主动攻击，哪些是被动攻击。</h3>\n<ul>\n<li><strong>被动攻击</strong>：\n<ol>\n<li>通话窃听</li>\n<li>服务区标志符泄露</li>\n</ol>\n</li>\n<li><strong>主动攻击</strong>：\n<ol>\n<li>数据注入与篡改</li>\n<li>中间人攻击</li>\n<li>通信阻断</li>\n<li>客户端假冒</li>\n<li>接入点伪装</li>\n<li>重放攻击</li>\n<li>匿名攻击</li>\n<li>端对端攻击</li>\n<li>隐匿无线信道</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"请画图分析gsm蜂窝系统保密与认证协议的工作过程指出三元组认证向量中的每个元素所发挥的安全性作用\"><a class=\"anchor\" href=\"#请画图分析gsm蜂窝系统保密与认证协议的工作过程指出三元组认证向量中的每个元素所发挥的安全性作用\">#</a> 请画图分析 GSM 蜂窝系统保密与认证协议的工作过程，指出三元组认证向量中的每个元素所发挥的安全性作用。</h3>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/npn3eg.png\" alt=\"GSM蜂窝系统保密与认证协议的工作过程\" /></p>\n<ul>\n<li><strong>三元组</strong>\n<ul>\n<li>RAND：随机数，用于用户认证和会话密钥的产生时的挑战值。</li>\n<li>SRES'：签名回应，即挑战的答案，用于比对用户是否成功响应。</li>\n<li>Kc：会话密钥，用于手机与 GSM 网络之间的通信数据加密的密钥。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"gsm系统有哪些主要安全缺陷\"><a class=\"anchor\" href=\"#gsm系统有哪些主要安全缺陷\">#</a> GSM 系统有哪些主要安全缺陷？</h3>\n<ol>\n<li><strong>首次开机时泄漏 IMSI 信息</strong>，可能导致用户身份泄漏。</li>\n<li><strong>用户无法验证基站</strong>，伪基站向用户发送欺诈信息。</li>\n<li><strong>骨干网数据传输无加密</strong>，中间节点可截获会话密钥。</li>\n<li><strong>无数据完整性验证机制</strong>，不能检测数据是否被篡改。</li>\n<li><strong>主密钥 K 直接参与认证与加密</strong>，存在泄漏主密钥的风险。</li>\n<li><strong>主密钥 K 存在 SIM 卡中</strong>，有复制 SIM 卡的风险。</li>\n</ol>\n<h3 id=\"请画图分析3g蜂窝系统保密与认证协议的工作过程指出五元组认证向量中的每个元素所发挥的安全性作用\"><a class=\"anchor\" href=\"#请画图分析3g蜂窝系统保密与认证协议的工作过程指出五元组认证向量中的每个元素所发挥的安全性作用\">#</a> 请画图分析 3G 蜂窝系统保密与认证协议的工作过程，指出五元组认证向量中的每个元素所发挥的安全性作用</h3>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/kybz27.png\" alt=\"3G蜂窝系统保密与认证协议的工作过程\" /></p>\n<ul>\n<li><strong>五元组</strong>：\n<ul>\n<li>RAND：随机数</li>\n<li>XRES：认证应答</li>\n<li>CK：保密性令牌</li>\n<li>IK：完整性令牌</li>\n<li>AUTH：网络认证令牌</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"3g系统有哪些安全功能有哪些主要安全缺陷与2g相比3g作出了哪些安全性改进\"><a class=\"anchor\" href=\"#3g系统有哪些安全功能有哪些主要安全缺陷与2g相比3g作出了哪些安全性改进\">#</a> 3G 系统有哪些安全功能？有哪些主要安全缺陷？与 2G 相比，3G 作出了哪些安全性改进？</h3>\n<ul>\n<li><strong>安全功能</strong>：\n<ul>\n<li>实现了用户和网络<strong>双向认证</strong></li>\n<li>增加了<strong>数据完整性验证</strong>功能</li>\n<li>建立了了用户与网络之间的<strong>会话密钥</strong></li>\n<li>保持了会话密钥的<strong>新鲜性</strong></li>\n</ul>\n</li>\n<li><strong>安全缺陷</strong>：\n<ul>\n<li><strong>首次开机时泄漏 IMSI 信息</strong>，可能导致用户身份泄漏。</li>\n<li><strong>骨干网上传输无加密</strong>：中间节点可截获会话密钥。</li>\n<li><strong>K 直接参与认证与加密</strong>：主密钥缺乏层次化保护。</li>\n<li><strong>CK 和 IK 直接传输</strong>，存在窃听风险。</li>\n<li><strong>主密钥 K 存在 SIM 卡中</strong>，有复制 SIM 卡的风险。</li>\n<li><strong>采用 10 种安全算法</strong>，算法过多存在被攻破风险。</li>\n</ul>\n</li>\n<li><strong>改进点</strong>：\n<ul>\n<li>双向认证</li>\n<li>数据完整性</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"4g系统有哪些安全功能有哪些主要安全缺陷与3g相比4g作出了哪些安全性改进\"><a class=\"anchor\" href=\"#4g系统有哪些安全功能有哪些主要安全缺陷与3g相比4g作出了哪些安全性改进\">#</a> 4G 系统有哪些安全功能？有哪些主要安全缺陷？与 3G 相比，4G 作出了哪些安全性改进？</h3>\n<ul>\n<li><strong>安全功能</strong>：\n<ul>\n<li>实现了用户与网络<strong>双向认证</strong></li>\n<li>建立了用户与网络的<strong>会话密钥</strong></li>\n<li>增加了数据的<strong>完整性校验</strong></li>\n<li>实现了<strong>层次化密钥管理</strong></li>\n<li><strong>隐藏</strong>了加密密钥 CK 和数据完整性验证密钥 IK</li>\n</ul>\n</li>\n<li>安全缺陷\n<ul>\n<li><strong>首次开机泄漏 IMSI</strong></li>\n<li><strong>骨干网无加密</strong></li>\n</ul>\n</li>\n<li>改进点：\n<ul>\n<li>层次化密钥管理</li>\n<li>隐藏 CK 和 IK</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"为何2g3g4g系统的挑战值rand是一个随机数而不能是常数如果挑战值rand为常数会产生何种安全问题请加以分析\"><a class=\"anchor\" href=\"#为何2g3g4g系统的挑战值rand是一个随机数而不能是常数如果挑战值rand为常数会产生何种安全问题请加以分析\">#</a> 为何 2G/3G/4G 系统的挑战值 RAND 是一个随机数而不能是常数？如果挑战值 RAND 为常数，会产生何种安全问题？请加以分析。</h3>\n<p><strong>可以防止强力攻击</strong>：以 2G 为例，一个 128 比特的随机数意味着 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3.4</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>38</mn></msup></mrow><annotation encoding=\"application/x-tex\">3.4×10^{38}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">3</span><span class=\"mord\">.</span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">3</span><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span></span> 种可能的组合。因此即使黑客知道 A3 算法，也很难猜出正确的 RAND/SRES。</p>\n<p>若替换为常数值，即每一次 SRES 相同，一旦被截获，用户就有可能被攻击者冒充。</p>\n<h3 id=\"与2g3g4g相比5g在哪些方面提升了安全性\"><a class=\"anchor\" href=\"#与2g3g4g相比5g在哪些方面提升了安全性\">#</a> 与 2G/3G/4G 相比，5G 在哪些方面提升了安全性？</h3>\n<p>新增了<strong>身份标识隐私保护</strong></p>\n",
            "tags": [
                "学习笔记",
                "网络安全",
                "复习要点"
            ]
        },
        {
            "id": "https://gality.cn/note/PNT/IRIG-B/",
            "url": "https://gality.cn/note/PNT/IRIG-B/",
            "title": "IRIG-B编码",
            "date_published": "2023-10-27T09:00:02.000Z",
            "content_html": "<h1 id=\"irig-简介\"><a class=\"anchor\" href=\"#irig-简介\">#</a> IRIG 简介</h1>\n<p>IRIG 时间码原本是由美国军方为了靶场间的时间同步于 1960 年提出的，最新版本于 2004 年 9 月更新，名为：“IRIG Serial Time Code Formats”。</p>\n<p>IRIG 时间码有两大类：一类是并行时间码格式，这类码由于是并行格式，传输距离较近，且是二进制，因此远不如串行格式广泛；另一类是串行时间码，共有六种格式，即 A、B、D、E、G、H。它们的主要差别是时间码的帧速率不同。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Format</th>\n<th style=\"text-align:left\">Pulse Rate（or Bit Rate）</th>\n<th style=\"text-align:left\">Index Count Interval</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">IRIG-A</td>\n<td style=\"text-align:left\">1000 PPS (pulse per second)</td>\n<td style=\"text-align:left\">1 ms</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">IRIG-B</td>\n<td style=\"text-align:left\">100 PPS</td>\n<td style=\"text-align:left\">10 ms</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">IRIG-D</td>\n<td style=\"text-align:left\">1 PPM</td>\n<td style=\"text-align:left\">1 minute</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">IRIG-E</td>\n<td style=\"text-align:left\">10 PPS</td>\n<td style=\"text-align:left\">100 ms</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">IRIG-G</td>\n<td style=\"text-align:left\">10000 PPS</td>\n<td style=\"text-align:left\">0.1 ms</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">IRIG-H</td>\n<td style=\"text-align:left\">1 PPS</td>\n<td style=\"text-align:left\">1 second</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"irig-b\"><a class=\"anchor\" href=\"#irig-b\">#</a> IRIG-B</h2>\n<p>IRIG-B 为 IRIG 中的 B 型码，是每秒一帧的时间码，最适合使用的习惯，而且传输也较容易，所以应用最为广泛；每帧可传递 100 位的信息。</p>\n<p>为了便于传递，可用标准正弦波载频进行幅度调制。标准正弦波载频的频率与码元速率严格相关。B 码的标准正弦波载频频率为 1KHz。同时，其正交过零点与所调制格式码元的前沿相符合，标准的调制比为 10 比 3。调制后的 B 码通常称 IRIG-B（AC）码，未经幅度调制的通常称 IRIG-B（DC）码。</p>\n<p>IRIG-B (DC) 码的接口通常采用 TTL 接口和 RS422（V.11）接口。IRIG-B (AC) 码的接口采用平衡接口。IRIG-B (DC) 码的同步精度可达几十纳秒量级，IRIG-B (AC) 码的同步精度一般为 10～20us (微秒)。</p>\n<h1 id=\"irig-b-格式\"><a class=\"anchor\" href=\"#irig-b-格式\">#</a> IRIG-B 格式</h1>\n<p>概念引入：</p>\n<ul>\n<li><strong>帧</strong>：B 码每秒<span class=\"red\"> 1 帧</span>。</li>\n<li><strong>脉宽码</strong>：用脉冲的宽度（脉宽，即持续时间）来表示数字信息。不同的数字或字符由不同宽度的脉冲表示。</li>\n<li><strong>码元</strong>：时间格式里的每个脉冲称为码元。码元的 “准时”（OnTime）参考点是其脉冲前沿。每个码元的宽度为<span class=\"red\"> 10 ms</span>。</li>\n<li><strong>码元速率</strong>：码元的传输速率称为码元速率。B 码的码元速率为<span class=\"red\"> 100 pps</span>，代表每秒有 100 个脉冲或码元传输。</li>\n<li><strong>索引计数</strong>：每个码元对应一个索引计数。两个相邻码元前沿之间的时间间隔为索引计数间隔，B 码的索引计数间隔（其实也就是码元宽度）为<span class=\"red\"> 10 ms</span>。索引计数在帧参考点处以 “0” 开始，以后每隔一个索引计数间隔增加 1，直至这帧结束。B 码每帧有 100 个码元，所以索引计数数字是 0～99。</li>\n<li><strong>位置识别标志（P 码）</strong>：位置识别标志的宽度是对应时码的索引计数间隔的 0.8，所以，B 码为<span class=\"red\"> 8 ms</span>。位置识别标志 P0 的前沿在帧参考点（PR）前一个索引计数间隔处，以后每十个码元有一个位置识别标志，分别为 P1、P2……，P9 位置识别标志的重复速率为码元速率的十分之一即位置标识的码元速率为 10 pps。</li>\n<li><strong>码字</strong>：所有的时间格式都是脉宽码。二进制 <code>1</code>  和 <code>0</code>  的脉宽分别为码宽度的 0.5 和 0.2。所以，B 码的二进制 <code>1</code>  和 <code>0</code>  的脉宽分别为<span class=\"red\"> 5 ms</span> 和<span class=\"red\"> 2 ms</span>（类似莫斯电码的思想，只不过只有两种类型）。</li>\n</ul>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/7gk5g9.png\" alt=\"脉宽\" /></p>\n<h1 id=\"时间编码\"><a class=\"anchor\" href=\"#时间编码\">#</a> 时间编码</h1>\n<p>B 码以两个连续的 P 码作为帧的分割标识，第一个 P 码是 P0，第二个 P 码是 PR，注意，从第二个 P 码（PR）作为帧起始标志，即第 0 个码元为 PR。</p>\n<p>在 B 码时间格式中含有天、时、分、秒，时序为秒 - 分 - 时 - 天，所占信息位为：</p>\n<ul>\n<li>秒：7 位。第 1，2，3，4，6，7，8 码元。</li>\n<li>分：7 位。第 10，11，12，13，15，16，17 码元。</li>\n<li>时：6 位。第 20，21，22，23，25，26 码元。</li>\n<li>天：10 位。第 30，31，32，33，35，36，37，38，40，41 码元。</li>\n</ul>\n<p>位置在 P0～P5 之间，P6～P0 包含其他控制信息。第 5，14，24 为索引标志，宽度为 2ms。时、分、秒均采用 BCD 码表示，低位在前，高位在后；个位在前，十位在后；个位和十位间有一个脉冲宽度为 2ms 的索引标志码元。</p>\n<blockquote>\n<p>BCD 码将每个十进制数字（0 到 9）表示为 4 位二进制数，每个十进制数的 4 位二进制编码之间通常使用特定的分隔符或标志码元分隔。</p>\n<p>例如，如果要表示十进制数 25，BCD 码会将其表示为两个 4 位二进制数，分别是 0010（十进制的 2）和 0101（十进制的 5）。</p>\n</blockquote>\n<p>从 P8 开始是 SBS 时间码，共 17 位二进制信号，每天重复。</p>\n<blockquote>\n<p>&quot;SBS 码&quot; 指的是 &quot;Second, Bits, and Status&quot;（秒、位和状态）编码。SBS 码是 IRIG-B 编码的一部分，用于传输与时间同步和时间标记相关的信息。</p>\n</blockquote>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/91kavc.png\" alt=\"IRIG-B结构\" /></p>\n<p>「图中的 <code>1,2,4,8 </code> 或 <code>10,20,40</code>  指的是如果该位置 <code>1</code> ，时间的大小」</p>\n<p>给出一张更详细的参考图：<br />\n<img data-src=\"http://imgcdn.gality.cn/blog/5y0rng.jpg\" alt=\"IRIG-B详细结构\" /></p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3liZXItc2NpZW5jZXMuY29tL3dwLWNvbnRlbnQvdXBsb2Fkcy8yMDE5LzAxL1ROLTEwMl9JUklHLUIucGRm\">https://www.cyber-sciences.com/wp-content/uploads/2019/01/TN-102_IRIG-B.pdf</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2R5eDE5OTMvYXJ0aWNsZS9kZXRhaWxzLzExNDY1NTkyMg==\">https://blog.csdn.net/dyx1993/article/details/114655922</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9JUklHLUIvMTU5ODYwOA==\">https://baike.baidu.com/item/IRIG-B/1598608</span></li>\n</ul>\n",
            "tags": [
                "学习笔记",
                "PNT",
                "通信",
                "授时",
                "学习笔记",
                "协议"
            ]
        },
        {
            "id": "https://gality.cn/ponder/Gresham-law/",
            "url": "https://gality.cn/ponder/Gresham-law/",
            "title": "劣币驱逐良币 ｜ 一次网购经历的反思",
            "date_published": "2023-10-26T11:12:26.000Z",
            "content_html": "<blockquote>\n<p>📖 <strong>Gresham’s law</strong>, observation in economics that “bad money drives out good.” More exactly, if coins containing metal of different value have the same value as legal tender, the coins composed of the cheaper metal will be used for payment, while those made of more expensive metal will be hoarded or exported and thus tend to disappear from circulation</p>\n</blockquote>\n<p><strong>劣币驱逐良币</strong>（<strong>Bad money drives out good</strong>），在经济学上也被称为<strong>葛兰辛法则</strong>、<strong>格勒善定律</strong>（<strong>Gresham's Law</strong>），是一种货币规律，指的是：如果有两种形式的商品货币流通，消费者会保留储存成色高（贵金属含量高）的货币，在市面使用成色低的货币进行市场交易，而使得在民间流通的大多为劣币，良币则较少见于世。</p>\n<h1 id=\"起源\"><a class=\"anchor\" href=\"#起源\">#</a> 起源</h1>\n<p>古罗马时代，货币价值还是由贵金属本身来锚定的（货币本身就是贵金属而非无价值的纸钞），这时的人们会私自从金银钱币上削下一小角，再将此种货币充当买卖媒介；因货币本身的贵金属含量减少，货币的价值也减小。久而久之，人们很快就觉察到市面上的贵金属货币越来越轻，就把未遭毁损的足值金银货币积存起来，只用那些不足值的货币进行买卖，而劣币则渐渐把良币从流通领域中排挤出去 [1]。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/izk3hd.png\" alt=\"西里克银币\" /></p>\n<h1 id=\"娱乐至死\"><a class=\"anchor\" href=\"#娱乐至死\">#</a> 娱乐至死</h1>\n<div class=\"note primary no-icon\">\n<p>❗️劣币驱逐良币的说法逐渐被广泛应用于非经济学的层面，人们用这一法则来泛指<strong>价值不高的东西会把价值较高的东西挤出流通领域</strong>，主要指假冒劣质产品在多种渠道向正牌商品挑战，并具有膨胀和蔓延的趋势。虽然这样的定义容易在学术讨论中引起争议，不过我并不准备进行严肃的学术讨论，so～</p>\n<p>关于劣币驱逐良币的讨论已经非常多了，这个词也已经被大众熟知且熟练使用了，所以不再过多赘述。引起我思考的是 “<strong>互联网时代</strong>” 的劣币驱逐良币。所以，请容我先介绍另外一个概念。</p>\n</div>\n<p>《<strong>娱乐至死</strong>》（Amusing Ourselves to Death）是尼尔・波兹曼 1985 年的著作。他指出，现实社会（书中主要以美国社会为例）的一切公众话语日渐以娱乐的方式出现，并成为一种文化精神。我们的政治、宗教、新闻、体育、教育和商业都心甘情愿的成为娱乐的附庸，其结果是我们成了一个娱乐至死的物种。它被认为是最重要的媒介生态学专著之一。</p>\n<p>但这里我不想讨论政治、宗教或新闻等，我只想借用书中的一点核心思想 “<strong>媒介即隐喻</strong>”，</p>\n<h2 id=\"媒介\"><a class=\"anchor\" href=\"#媒介\">#</a> 媒介</h2>\n<p>“媒介” 非常好理解，就是 “内容” 的载体，就像瓶子之于水一样，“瓶子” 就是媒介，而 “水” 则是内容。如果我们更加具体一点，聚焦到信息传播这个方面，那么报纸、电视、手机就是不同的媒介，这是一种浅显的理解；更深一层，博客、短视频也是不同的媒介，而” 内容 “就是信息本身。</p>\n<p>直觉一点来说，我们会认为媒介不影响内容，就像无论水用什么样的瓶子装着，水还是水，不会发生什么变化。但是我们再进一步，其实瓶子也是会影响水的，就像是拿铁桶装水，水中就会有更多的铁元素，这个过程并不明显，但是却在潜移默化的影响我们，而波兹曼强调的就是：媒介也会影响信息，甚至，媒介直接决定了信息。</p>\n<h2 id=\"隐喻\"><a class=\"anchor\" href=\"#隐喻\">#</a> 隐喻</h2>\n<p>从我们熟悉的 “比喻” 开始，我们从小学开始就在接收这样的训练：” 以下的句子中使用了那些修辞手法并简要分析 “，而” 比喻 “应该是我们最早学会的修辞手法了。这就像我们学数学会从加法学起一样，这是因为加法更加的通用和基础；最先学” 比喻 “的原因也是这样的，我们日常生活中也会经常使用。</p>\n<p>那么 “隐喻” 是什么呢？隐喻其实就是去掉了 “像” 的比喻，比如 “天空的乌云就像一只死了三个月的猫”，这就是比喻。 但如果用 “隐喻” 的方式来表达，就不会用 “像、似、如同” 这样的喻词来提醒你这是一种比喻，比如 “天空中有一只死了三个月的猫”，这就是 “隐喻”。</p>\n<p>乍一看 “隐喻” 和 “比喻” 也没什么区别，不过是去掉了喻词，我们还是能识别出隐喻也是在做比喻。但想想，如果我们平时说话的方式都是隐喻，如果每个人都是说 “天空中有一朵一只死了三个月的猫”，如果孩子从出生开始我们就告诉他乌云是死了三个月的猫，那慢慢的，我们就会忘记这是一种比喻，习惯于把 “乌云” 真的理解为 “死了三个月的猫”。</p>\n<p>进一步的，假设在 A 国，人们把乌云说成 “死了三个月的猫”，而在 B 国，人们把乌云说成 “一只生病的猫”，那么 A 国人的世界观可能就要比 B 国人更加现实和悲观。但人们却很难意识到这种世界观的差异来自于隐喻方式的差异 [2]，但是影响是客观存在的，这就是隐喻的力量。</p>\n<h2 id=\"媒介即隐喻\"><a class=\"anchor\" href=\"#媒介即隐喻\">#</a> 媒介即隐喻</h2>\n<p>“媒介即隐喻” 本身就是 “隐喻”，直白的说应该是 “媒介具有隐喻的特点”。<strong>媒介的特点就是帮助我们把客观事物看成虚构的符号（文字、图形）来理解客观事物，但在这个过程中，媒介本身却被忽视了。</strong></p>\n<p>举几个更加具体的例子，“书” 或者说是 “纸质” 作为一种信息传播媒介，其隐喻的结果就是 “理性、抽象、逻辑、严谨、全面...”。在过去，我们把写书称为 “著书立说”，只有某领域的 “大家” 才有资格去写书，如果某人没有能力，写出来的书也没有人看，这一点相信大家都能意识到。但是还有一点的事，书作为信息的媒介，除了其承载的内容在塑造读者，媒介本身也在塑造读者，“书” 这种媒介鼓励读者进行思辨、鼓励批判性，也正是如此，又反推得写书的人更加严谨、更加全面，这种双向的过程推动社会思维方式向 “理性” 的方向发展。</p>\n<p>对比来看 “短视频” 这种媒介，其隐喻的结果就是 “麻木、轻信、盲目...”。就拿我自身的观察来看，“搞笑的、滥俗的、擦边的” 主播涨粉非常快，只要你短视频足够搞笑，哪怕只是 “尴尬” 产生的节目效果，也会有非常多人乐意关注，对比来说，如果视频的内容是严肃的哲学思辨，那么甚至不会被平台的 “算法” 推流。同时，人一种很容易麻木的生物，之前喝一杯奶茶就可以满足，过一段时间就需要喝两杯才可以。久而久之，发视频的人越来越 “娱乐”，看视频的人也越来越 “娱乐”。手机这种媒介，本身就淘汰了过于严肃、艰涩的思辨，选择了夸张的音乐、配色、话语。</p>\n<h1 id=\"互联网时代的劣币\"><a class=\"anchor\" href=\"#互联网时代的劣币\">#</a> 互联网时代的劣币</h1>\n<p>劣币驱逐良币的过程往往伴随着 “信息差”：如果几天内所有人都知道 “良币” 需要收藏了，此时 “劣币” 还未来得及铺开，那么收藏的 “良币” 的价值就会下降。这里面蕴含的点在于，在过去，想主动靠 “劣币与良币” 的差异来获利是非常困难的：过长的共识统一时间、谨慎的交易态度、关注实际的思想、同类替代物的缺少等等都是阻碍。</p>\n<p>听起来是不是很熟悉，互联网时代完全解决了这些问题：物品种类的极大丰富、激进的交易态度、虚拟交易的接收...，最重要的是 “信息的高速传播”，在加之虚拟主体的出现于有限责任制度，用 “劣币驱逐良币” 的土壤也太肥沃了，以下商品运作方式完全是可行的：</p>\n<p>将融资的钱中的 10% 用于购买廉价低质原材料，30% 用于精致的包装设计和生产，余下 60% 用于各大平台的宣发，雇佣大量的水军和头部博主作宣传，然后将商品高价卖出。最终在获利开始减少的时候，注销该品牌和公司，然后再注册一家，开始新的赚钱轮回。</p>\n<p>这样的事相信大家一定都能举出一两个例子来，我们至少是我，一直是懂这个道理的，但是对于这个 “融资” 规模的认知还是不够的，在现在这个时代，其实并不需要很大的融资规模就可以达到这个效果，这代表” 劣币 “出现的成本非常下，同时也就意味着就在我们身边，非常常见。让我产生深刻认知的是我在购买某商品时观察到的真实现象：</p>\n<p>我在 “x 红书” 平台上搜索了某类商品的测评推荐，其中有两个品牌几乎被推荐，列为性价比最高、效果最好的那一批，但是很有意思的一点是，在推荐 A 商品的文章中，压根找不到 B 商品的影子，而在推荐 B 商品的文章中也根本找不到 A 商品。这件事是非常奇怪的，按理来说，如果某个商品非常推荐，那么即使在另外的文章中也至少应该被提到，但现实是完全没有！</p>\n<p>于是我开始在去需要这两个牌子的旗舰店，并去搜索其营业执照及相关资质，最终发现这两家都是非常新的品牌，其源头厂商在这类商品的生产商中也并不出众，理论来说没有足够的资质来生产顶级的产品，顺便提一下，按实际成分来算，A、B 商品的单位有效成分价格比头部厂商更贵，那么到此时，真相也就浮出水面了，幸好，我没有成为 2.3 万订单中的一个。</p>\n<p>互联网时代对于 “劣币” 真的是最好的时代，人类本身就是从众的，而互联网可以很方便的针对某一群体构建专属的” 信息茧房 “从而操控人的选择。同时，这种信息茧房可以让 “<strong>信息不包含信息</strong>”（第一个信息指 “消息”，第二个信息指 “用于决策的知识”）：当你看见推荐，你会怀疑是 “广”；当你看见差评，你会怀疑是其他品牌的 “踩”。人的选择本来是基于知识的，当人接触到的无数信息本身却不包含任何知识的时候，人该怎么做出正确的选择呢？</p>\n<h1 id=\"对策\"><a class=\"anchor\" href=\"#对策\">#</a> 对策</h1>\n<p>当然，这个可行方案并不完善，其最本质的基于的逻辑是 “楚门的世界无法<strong>完全</strong>模拟整个世界”，商家无法影响到生活的方方面面，那么就一定会有一些背离逻辑的地方。我认为可行的方法论如下：</p>\n<ul>\n<li>交叉对比多个文章中的共同项，对于所有差异项都持谨慎态度。</li>\n<li>对 “强推” 的东西提高警惕，特别是你感觉刷到的所有文章都在吹怎么怎么好。</li>\n<li>要认识到事物的延续性，凡事吹嘘立刻见效的东西，持谨慎态度。</li>\n<li>交叉对比不同信息渠道，这个不同是指不同严肃程度的信息渠道，“d 音” 和 “x 红书” 不是两个渠道，“z 乎” 和 “x 红书” 才基本算，如果有论文，就更好了。</li>\n</ul>\n<p>总的来说，就是持怀疑的态度做选择，用理性克制冲动，有交叉比对对抗信息茧房，主动破开他。</p>\n<h1 id=\"思考\"><a class=\"anchor\" href=\"#思考\">#</a> 思考</h1>\n<h2 id=\"真就无法可治吗\"><a class=\"anchor\" href=\"#真就无法可治吗\">#</a> 真就无法可治吗？</h2>\n<p>在我开始思考这个问题的时候，我觉得是监管不力、制度缺失、惩罚不够导致的 “劣币” 泛滥，但仔细想想，其实不是这样的，“劣币驱逐良币” 是一种根植于人类贪婪本性的原理，制度本身是为人服务的，也就自然会为 “劣币” 开绿灯。一个简单的例子是：国家层面可以对所有市场上的企业进行严苛的监管，每天都派专人检查核对；所有有欺骗行为的商家直接全部死刑。想想很解气是吧？但是谁会来当商家呢？如果商品总体的选择变少了，人们的生活是变好了还是变差了呢？</p>\n<p>我承认，现行制度、监管一定是有可以改进的地方，但是要认识到制度、监管在进步，而 “劣币” 也在进步，根植于人类深处的东西是不会被人类发明的东西打败的，所以，我得出的结论是：真的无法可治，我们只能 “自我救赎”。</p>\n<h2 id=\"可能的自我救赎\"><a class=\"anchor\" href=\"#可能的自我救赎\">#</a> 可能的自我救赎？</h2>\n<p>曾经有两大人类自由终结的预言：</p>\n<ul>\n<li>\n<p><em>“奥尔威的《1984》：人类受到外来的压迫失去自由”</em>。</p>\n</li>\n<li>\n<p><em>“赫胥黎的《美丽新世界》：人类爱上工业技术带来的娱乐和文化不再思考。”</em></p>\n</li>\n</ul>\n<p>但此时，我不禁在想，会不会有另外一种可能性，现代的人类经过各种广告的洗礼，从个人利益的角度出发，重新掌握批判性思维来捍卫自己的利益。互联网确实会让很多人上当受骗，但仔细想想，现在大家的反诈意识不也有所提高了嘛？我知道这样的认识确实很乐观，但乐观一点有何不好呢？</p>\n<h2 id=\"魔法对抗魔法\"><a class=\"anchor\" href=\"#魔法对抗魔法\">#</a> 魔法对抗魔法？</h2>\n<p>由于最近在学习网络内容安全和机器学习的知识，我不禁想，这件事应该是可以通过机器学习来解决的，如果说互联网时代的” 劣币 “传播的相似点是 “<strong>用海量的信息去瘫痪人的信息处理能力</strong> “，那为什么不让信息处理能力更强的 “机器” 去处理这些信息并分析出端倪呢？我认为这件事应该是可以做到的，但是，显而易见的利益原因可能使他的诞生困难重重，但是，“太阳一定会升起”。</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li>[1] <span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU1JThBJUEzJUU1JUI5JUEzJUU5JUE5JTg1JUU5JTgwJTkwJUU4JTg5JUFGJUU1JUI5JUEz\">https://zh.wikipedia.org/wiki/ 劣幣驅逐良幣</span></li>\n<li>[2] <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ib29rLmRvdWJhbi5jb20vcmV2aWV3LzEyMTE4OTQxLw==\">https://book.douban.com/review/12118941/</span></li>\n</ul>\n",
            "tags": [
                "思考与沉淀",
                "思考"
            ]
        },
        {
            "id": "https://gality.cn/note/PNT/fiber-optic-and-WDM/",
            "url": "https://gality.cn/note/PNT/fiber-optic-and-WDM/",
            "title": "光纤通信原理与技术",
            "date_published": "2023-10-25T08:19:46.000Z",
            "content_html": "<h1 id=\"光纤通信原理\"><a class=\"anchor\" href=\"#光纤通信原理\">#</a> 光纤通信原理</h1>\n<h2 id=\"理论前提\"><a class=\"anchor\" href=\"#理论前提\">#</a> 理论前提</h2>\n<p>“光纤” 这个词可以拆开来理解，“光” 是指信息的传输形式是依靠光的形式；“纤” 是指传输介质为玻璃纤维。让 “光” 来传输信息的前提是 **“全反射”** 现象的发现。</p>\n<blockquote>\n<p><strong>” 全反射 “</strong> 现象是指当光线从光密介质进入光疏介质，且入射角大于临界角时，折射光线完全消失，只留下反射光线的现象。</p>\n</blockquote>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/o2g0de.png\" alt=\"全反射\" /></p>\n<p>基于这个现象，我们可以设计出一种圆形的导线结构（其实就是光纤），只需要在更中心的位置选用合适的光密材料，外围选用合适的光疏材料，再结合一个合适的入射角，就可以使光在导线不断的反射，并不断向前传播。</p>\n<p>光纤的纤芯主要采用高纯度的二氧化硅 (SiO<sub>2</sub>)，并掺有少量的掺杂剂，提高纤芯的光折射率 n1；包层也是高纯度的二氧化 (SiO<sub>2</sub>)，也掺有一些的掺杂剂，以降低包层的光折射率 n2， 且 n1＞n2，发生全反射；涂覆层采用丙烯酸酯、硅橡胶、尼龙，增加机械强度和可弯曲性。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/puwff9.png\" alt=\"光纤示意图\" /></p>\n<p>这就是可以用光来传递信息的理论基础和材料基础，至此，用光来传输信息有了理论上的可行性。</p>\n<h2 id=\"光纤工作原理\"><a class=\"anchor\" href=\"#光纤工作原理\">#</a> 光纤工作原理</h2>\n<p>光纤只是光传输的通道，具体光的怎么传输的呢？</p>\n<p>首先，发射端把要传输的信息（如话音等）转换为电信号，然后通过激光器发射到激光束上，光的强度会随电信号的频率一起变化，并通过光纤发射出去；在接收端，检测器受到光信号后把它变成电信号，经过处理后恢复原信息。</p>\n<p>单一的光纤信道容量有限，于是我们考虑将多个光纤结合在一起来增大容量：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/gwq3av.jpg\" alt=\"光缆示意图\" /></p>\n<p>光纤内部用玻璃纤维制成的光导纤维，可以把光信号传输到几千公里外，将几百上千根光导纤维组合在一起，制成像电缆一样的光缆，这样既提高了光导纤维的强度，又大大增加了通讯容量。</p>\n<p>光信号就是在光纤内经过一次次的折射传输到终点的，光信号在一次次折射后会分散或者衰减，因此需要把光信号每 50 公里放大一次。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/y72w4r.png\" alt=\"光信号传输\" /></p>\n<h1 id=\"数据传输\"><a class=\"anchor\" href=\"#数据传输\">#</a> 数据传输</h1>\n<h2 id=\"信道容量\"><a class=\"anchor\" href=\"#信道容量\">#</a> 信道容量</h2>\n<p>光纤信道容量的大小受很多因素的影响，例如：调制技术、光纤质量、带宽、光源检测器、WDM 技术等等等，我们先来考虑单根光纤、单一光线且没有任何调制技术的情况，<strong>香农 - 哈特利定理</strong>给出了在存在噪声的情况下，信息可以通过给定带宽的通信信道中传输的最大速率（信道容量）：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>C</mi><mo>=</mo><mi>B</mi><mo>⋅</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mn>1</mn><mo>+</mo><mi>S</mi><mi>N</mi><mi>R</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">C = B \\cdot log_2(1+SNR)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>其中：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi></mrow><annotation encoding=\"application/x-tex\">C</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span></span></span></span> 代表信道的容量，单位为比特每秒或奈特每秒，为理论上的不包含纠错码的最大比特率。</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>B</mi></mrow><annotation encoding=\"application/x-tex\">B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span></span></span></span> 代表信道的带宽，单位为赫兹（Hz）。</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>N</mi><mi>R</mi></mrow><annotation encoding=\"application/x-tex\">SNR</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span></span></span></span> 代表信噪比，是信号功率与噪声功率之比，通常以线性比值来表示（<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi mathvariant=\"normal\">/</mi><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">S /over N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord\">/</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span> ）。</li>\n</ul>\n<p>这个公式表明，信道容量与带宽和信噪比之间存在对数关系。增加带宽或提高信噪比都可以增加信道的容量。</p>\n<h2 id=\"传输速率\"><a class=\"anchor\" href=\"#传输速率\">#</a> 传输速率</h2>\n<p>需要注意的是，光在光纤中的传输速度并不是 “光速”（真空中，约为 299,792,458 米 / 秒），而是速度略慢，大约为真空中光速的 2/3 左右，这是由光纤材质的折射率来决定的，折射率的定义为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>n</mi><mo>=</mo><mfrac><mi>c</mi><mi>v</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">n = \\frac{c}{v}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.7935600000000003em;vertical-align:-0.686em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.10756em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></p>\n<p>其中：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 是折射率（真空的折射率被定义为 1）。</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span> 真空中的光速。</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span> 是光在特定介质中的传播速度，通常以米 / 秒为单位。</li>\n</ul>\n<p>折射率是一个材料特性，材料制造完成后就已经确定了，代表了光在该材料中传播速度相对于真空中光速的比值。在光纤中，通常会选择具有高折射率的材料作为光纤内芯，而折射率越高，光速就越慢，因此光在光纤内芯中传播时速度较慢。</p>\n<h2 id=\"增大信道容量\"><a class=\"anchor\" href=\"#增大信道容量\">#</a> 增大信道容量</h2>\n<p>在实际应用中，我们会想要尽可能的增大信道的容量，使得光纤可以传输更多的信息，除了将多根光纤绑在一起形成光缆这样暴力的增加方式外，还可以考虑怎么提高单根光纤的信道容量。这时我们会联想到光的 “色散” 现象。</p>\n<h3 id=\"色散\"><a class=\"anchor\" href=\"#色散\">#</a> 色散</h3>\n<p>我们知道，光的频率和波长之间关系为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>c</mi><mo>=</mo><mi>λ</mi><mo>⋅</mo><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">c = \\lambda \\cdot f\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span></span></p>\n<p>其中：</p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span> 是光速，指的是材料中的光速。</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span> 是光的波长，通常以米为单位。</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi></mrow><annotation encoding=\"application/x-tex\">f</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span></span></span></span> 是光的频率，通常以赫兹（Hz）为单位。</li>\n</ul>\n<div class=\"note primary\">\n<p>严格意义上来说，公式中的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span> 应该是通过 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi><mo>=</mo><mfrac><msub><mi>c</mi><mn>0</mn></msub><mi>n</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">c=\\frac{c_0}{n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.056492em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7114919999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4101em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31731428571428577em;\"><span style=\"top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.143em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> 计算得到的，其中 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>c</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">c_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 为真空中光速，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 为材料的折射率。在实际情况中通常情况下，对于一般工程和计算，不考虑材料的将 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span> 当作真空光速也是可以的，对于大多数应用来说其误差可以忽略不计。</p>\n</div>\n<p>上面的公式告诉我们，不同颜色（频率）的光在光纤中传输速度是不一样的，这就是光的 “<strong>色散</strong>”，在光纤传输中，我们可以将不同颜色的光复合起来一起传播，接收端在接收时再将这些光分离出来就可以了，这就是 “<strong>波分复用（Wavelength Division Multiplexing，WDM）</strong>” 技术的思想。</p>\n<h3 id=\"波分复用技术\"><a class=\"anchor\" href=\"#波分复用技术\">#</a> 波分复用技术</h3>\n<p>波分复用（Wavelength Division Multiplexing，WDM）技术用于增大光通信系统的信道容量，是一种光通信中常用的多路复用技术。WDM 技术允许同时在光纤中传输多个不同波长（或频率）的光信号，每个波长光信号都可以携带独立的数据流，从而有效地增加了光纤通信系统的信道容量。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/8z24ob.png\" alt=\"波分复用示意图\" /></p>\n<p>WDM 技术的核心思想是利用<strong>光的不同波长来传输不同的信号</strong>，就像广播电视中使用不同频道来传输不同节目一样。通过将多个波长的光信号合并到同一根光纤中，使得多个独立的通信信道在相同的物理基础设施上共存，从而大幅提高了通信系统的容量</p>\n<p>对于采用 WDM 的系统来说，想让其正常运行，需要控制各个光信号的波长，如果波长间隔太短的话，很容易区分不开；而如果波长间隔过长，利用率又会降低。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ufhx5g.png\" alt=\"WDM波长示意图\" /></p>\n<p>早期的时候，技术条件有限，波长间隔会控制在几十纳米，这种比较分散的 WDM 被称为 “<strong>稀疏波分复用（ Coarse WDM，CWDM）</strong>”。后来，技术越来越先进，波长间隔压得越来越短，到了几 纳米 的级别，就成了紧密的 WDM，叫做 “<strong>密集波分复用（Dense WDM，DWDM）</strong>”</p>\n<p>CWDM 的波长间隔 20nm，波长范围从 1270nm 到 1610nm，有 18 个波段。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/hefojm.png\" alt=\"CWDM中心波段\" /></p>\n<p>「因为 1270-1470nm 波段有明显的衰减增加，很多旧型光纤不能正常使用，所以 CWDM 一般优先使用 1470~1610nm 的 8 个波段。」</p>\n<p>DWDM 的波长间隔可以是 1.6nm、0.8nm、0.4nm、0.2nm，可以容纳 40、80、160 个波（最大可支持 192 波）。DWDM 的波长范围为 1525nm 至 1565nm（C 波段）和 1570nm 至 1610nm（L 波段）。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/0yra5z.png\" alt=\"DWDM波段\" /></p>\n<p>DWDM 常用 C 波段，波长间隔 0.4nm，通路频率间隔 50GHz。</p>\n<p>以上就是光纤通信最基本的原理和波分复用技术，在实际的传输过程中，在最基本的物理层之上为了实现不同的目的，还会对信号进行编码，我们会在下一篇文章中讨论。</p>\n",
            "tags": [
                "学习笔记",
                "PNT",
                "通信",
                "授时",
                "学习笔记",
                "PNT"
            ]
        },
        {
            "id": "https://gality.cn/ml/regularization/",
            "url": "https://gality.cn/ml/regularization/",
            "title": "ML Regularization",
            "date_published": "2023-10-24T11:39:12.000Z",
            "content_html": "<div class=\"note info no-icon\">\n<p>之前写大作业的时候涉及到了正则化的知识，但由于在实际训练过程中发现效果不是很好，就没有深入研究了，这里记录一下。</p>\n</div>\n<h1 id=\"问题引入\"><a class=\"anchor\" href=\"#问题引入\">#</a> 问题引入</h1>\n<p>我们假设这样一个问题：给出房屋大小和对应的房屋售价，寻找某一个函数来描述大小和售价的关系（具体数据是什么样的不重要，我们要看思想）。</p>\n<h2 id=\"一次方程\"><a class=\"anchor\" href=\"#一次方程\">#</a> 一次方程</h2>\n<p>首先，我们考虑用一个线性方程去拟合，例如：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>b</mi><mo>+</mo><mi>w</mi><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">y=b+wx\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mord mathnormal\">x</span></span></span></span></span></p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span>：房屋售价</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>：房屋面积</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi></mrow><annotation encoding=\"application/x-tex\">w</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span></span></span></span>：权重（weight）</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>：偏差（bias）</li>\n</ul>\n<p>此时，机器学习的目标就是去寻找到一组参数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>w</mi><mrow><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>b</mi><mrow><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(w_{best}, b_{best})</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> ，使得 loss 最小，一个可能的函数图像为：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/onm4vf.png\" alt=\"线性方程\" height=\"210\" /></p>\n<p>可以看到，线性方程不太能描述房屋大小和售价的关系，这种情况我们称为 <strong>“欠拟合”</strong> 。</p>\n<h2 id=\"二次方程\"><a class=\"anchor\" href=\"#二次方程\">#</a> 二次方程</h2>\n<p>尝试用二次函数去描述二者关系，例如：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>b</mi><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">y = b + w_1x + w_2x^2\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>那么机器学习的目标就是找到一组参数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>w</mi><mrow><mn>1</mn><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo separator=\"true\">,</mo><msub><mi>w</mi><mrow><mn>2</mn><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub><mo separator=\"true\">,</mo><mi>b</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(w_{1best}, w_{2best}, b)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mord mathnormal mtight\">b</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.33610799999999996em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span><span class=\"mord mathnormal mtight\">b</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">t</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">)</span></span></span></span> 使 loss 最小。可以看到，可学习的参数多了一个，模型的学习能力也会增强，理论来说，机器可以找到一个具有更强的描述能力的函数，此时，学习到的模型的函数图像可能为：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/9ratys.jpg\" alt=\"二次方程\" height=\"210\" /></p>\n<p>可以看到，描述效果更好了一些。那我们可以很容易的想到，只需要更高次的多项式，就可以达到更好的学习效果，为了对比明显一点，我们看看选用八次多项式作为模型时的效果。</p>\n<h2 id=\"八次多项式\"><a class=\"anchor\" href=\"#八次多项式\">#</a> 八次多项式</h2>\n<p>当利用八次多项式来描述二者关系时，机器可学习的参数就有 9 个，学习能力大大提升，八次多项式形如：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>y</mi><mo>=</mo><mi>b</mi><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><mi>x</mi><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo>+</mo><msub><mi>w</mi><mn>8</mn></msub><msup><mi>x</mi><mn>8</mn></msup></mrow><annotation encoding=\"application/x-tex\">y = b + w_1x+w_2x^2+...+w_8x^8\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.77777em;vertical-align:-0.08333em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.73333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.66666em;vertical-align:-0.08333em;\"></span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0141079999999998em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>此时，学习到的模型的函数图像可能为：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/gprobe.png\" alt=\"8次多项式\" height=\"210\" /></p>\n<p>由于我这里的数据点比较少，理论来说八次多项式已经可以近乎完美的拟合出样例的函数曲线了，事实也正是如此，但是我们发现了此时的曲线中，在部分面积下，售价甚至出现了负数的情况，这显然是不可能，这种情况我们称为 <strong>“过拟合”</strong>。</p>\n<h1 id=\"正则化\"><a class=\"anchor\" href=\"#正则化\">#</a> 正则化</h1>\n<p>正则化就是为了解决模型的过拟合问题而提出的，回顾我们的 loss 函数（用 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>y</mi><mo>^</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\hat y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.19444em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span></span></span></span> 代指 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span> 的实际值）：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>L</mi><mo>=</mo><mo>∑</mo><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>y</mi><mo>^</mo></mover><mo>−</mo><mi>y</mi><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>=</mo><mo>∑</mo><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>y</mi><mo>^</mo></mover><mo>−</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>+</mo><mo>∑</mo><msub><mi>w</mi><mi>i</mi></msub><mi>x</mi><mo stretchy=\"false\">)</mo><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">L = \\sum (\\hat y - y)^2 = \\sum (\\hat y -(b + \\sum w_ix))^2\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.19444em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.19444em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>此时我们可以引入一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi><mo>∑</mo><mo stretchy=\"false\">(</mo><msub><mi>w</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\lambda \\sum(w_i)^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064118em;vertical-align:-0.25001em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> 项，此时公式变为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>L</mi><mo>=</mo><mo>∑</mo><mo stretchy=\"false\">(</mo><mover accent=\"true\"><mi>y</mi><mo>^</mo></mover><mo>−</mo><mo stretchy=\"false\">(</mo><mi>b</mi><mo>+</mo><mo>∑</mo><msub><mi>w</mi><mi>i</mi></msub><mi>x</mi><mo stretchy=\"false\">)</mo><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup><mo>+</mo><mi>λ</mi><mo>∑</mo><mo stretchy=\"false\">(</mo><msub><mi>w</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">L = \\sum (\\hat y -(b + \\sum w_ix))^2 + \\lambda \\sum(w_i)^2\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">L</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.19444em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.6000100000000002em;vertical-align:-0.55001em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol large-op\" style=\"position:relative;top:-0.000004999999999977245em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<p>引入的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi><mo>∑</mo><mo stretchy=\"false\">(</mo><msub><mi>w</mi><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\lambda \\sum(w_i)^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.064118em;vertical-align:-0.25001em;\"></span><span class=\"mord mathnormal\">λ</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span> 项（称为正则项），是用于限制了 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">w_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 的大小的，我们希望 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">w_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 尽可能的小，来使得曲线相对更加平滑。我们看八次多项式的拟合曲线，某种意义上来说，就是因为曲线太陡峭，变化太过剧烈，才导致对显示情况的描述的失真，在实际中，变化一般都是相对平缓的，所以，更加平滑的曲线一般来说会更加贴近现实一些，防止过拟合。</p>\n<p>但是需要注意的是，我们追求的是曲线的 <strong>“相对”</strong> 平滑，而非 <strong>“绝对”</strong> 平滑，直线就是最平滑的曲线了，但并不能很好的描述现实。那么，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span> 就是由于控制这个平滑程度的，称为 <strong>“正则化参数”</strong> 。如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span> 非常下，模型相当于基本没有被修正；如果 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span> 非常大，loss 想更小只能让 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub><mo>→</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">w_i  \\rightarrow 0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> ，此时寻找到的模型就会趋向于一条直线，所以，在实际情况下，我们需要选取合适的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>λ</mi></mrow><annotation encoding=\"application/x-tex\">\\lambda</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">λ</span></span></span></span> 值。</p>\n<p>以上就是正则化的基本思想，正则项其实限制了模型的复杂程度，引入正则化后，机器需要找到一个 <strong>选择经验风险</strong>（第一项）和 <strong>模型复杂度</strong>（正则项）同时较小的模型，从而降低了 “过拟合” 的风险。</p>\n<p>还有一点需要注意的是：正则项中无需包含参数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>，因为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span> 的改变只会让曲线平移而已，对于曲线本身的形态不产生影响，所以正则项无需包含。</p>\n<p>常见的有正则项有 <strong>L1 正则</strong> 和 <strong>L2 正则</strong> ，其中 L2 正则 的控制过拟合的效果比 L1 正则 的好。这两个正则项在框架中都已经实现了，直接用就可以了，就不过多赘述了。当然，控制过拟合风险的方法还有 <strong>Dropout</strong>，我觉得会更好用一些。</p>\n<h1 id=\"画图所用网站\"><a class=\"anchor\" href=\"#画图所用网站\">#</a> 画图所用网站</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5xaW5tcy5jb20vd2ViYXBwL2N1cnZlZml0L2NmLmFzcHg=\">http://www.qinms.com/webapp/curvefit/cf.aspx</span></li>\n</ul>\n",
            "tags": [
                "机器学习",
                "机器学习",
                "深度学习",
                "正则化"
            ]
        },
        {
            "id": "https://gality.cn/misc/trail-and-error/Mac-Latex/",
            "url": "https://gality.cn/misc/trail-and-error/Mac-Latex/",
            "title": "Mac下Latex论文一条龙",
            "date_published": "2023-10-23T12:12:12.000Z",
            "content_html": "<div class=\"note info no-icon\">\n<p>先说最终结论：</p>\n<ul>\n<li>Visual Studio Code：LaTex 论文编写 IDE</li>\n<li>MacTex：LaTex 编译引擎</li>\n<li>Zotero：论文管理工具</li>\n<li>vscode 插件：\n<ul>\n<li>LaTex Workshop：使用 VSCode 编写 LaTex 的核心插件，必需</li>\n<li>LaTex Utilities：基于 LaTex Workshop 的增强插件，非必需</li>\n<li>Code Spell Checker：自动拼写检查插件，非必需</li>\n<li>Ultra Math Preview：数学公式自动预览插件，非必需</li>\n</ul>\n</li>\n</ul>\n</div>\n<div class=\"note primary no-icon\">\n<p>懒狗看这里：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cub3ZlcmxlYWYuY29tLw==\">在线 LaTex 编辑器</span></p>\n<p>开箱即用，包含了编辑 LaTex 所需要的一切，还是在线编译保存，如果不是像我一样就喜欢在本地编写的话可以选用这个。</p>\n</div>\n<h1 id=\"环境\"><a class=\"anchor\" href=\"#环境\">#</a> 环境</h1>\n<h2 id=\"visual-studio-code\"><a class=\"anchor\" href=\"#visual-studio-code\">#</a> Visual Studio Code</h2>\n<p>跨环境 IDE，自身非常轻量的同时，还可以通过丰富的扩展插件来支持各种语言，安装过程就是下载点击，非常简单，就不过多赘述了。</p>\n<h2 id=\"mactex\"><a class=\"anchor\" href=\"#mactex\">#</a> MacTex</h2>\n<p>Mac 环境下的 LaTex 编译引擎，将 LaTex 编译成 pdf 的必需核心。</p>\n<p>下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly90dWcub3JnL21hY3RleC9tYWN0ZXgtZG93bmxvYWQuaHRtbA==\">https://tug.org/mactex/mactex-download.html</span></p>\n<p>下载后同样是点击安装，但是安装程序本身没有自动添加环境变量，所以说，如果想跟 VSCode 联合使用的话，还需要自行添加环境变量。就 2023 年而言，默认安装地址为： <code>/usr/local/texlive/2023/</code> ，其应用的位置为： <code>./bin/universal-darwin</code> ，所以，我们可以用如下命令添加环境变量：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"export PATH=/usr/local/texlive/2023/bin/universal-darwin:<span class=\"token variable\">$&#123;<span class=\"token environment constant\">PATH</span>&#125;</span>\"</span> <span class=\"token operator\">>></span> ~/.zshrc</pre></td></tr></table></figure><h2 id=\"zotero\"><a class=\"anchor\" href=\"#zotero\">#</a> Zotero</h2>\n<p>Zotero 是一个免费、开源、易用的文献管理软件，可以高效的组织需要的文献，配合浏览器插件可以一键将 Web 中的论文保存到 Zotero 中，结合 Better BibTeX for Zotero 还可以便捷的将论文引用到文章中。</p>\n<p>下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuem90ZXJvLm9yZy9kb3dubG9hZC8=\">https://www.zotero.org/download/</span></p>\n<p>浏览器插件安装地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJzdG9yZS9kZXRhaWwvem90ZXJvLWNvbm5lY3Rvci9la2hhZ2tsY2piZHBhamdwamdtYmlvbm9obHBkYmpnYw==\">https://chrome.google.com/webstore/detail/zotero-connector/ekhagklcjbdpajgpjgmbionohlpdbjgc</span></p>\n<h2 id=\"vscode-插件\"><a class=\"anchor\" href=\"#vscode-插件\">#</a> VSCode 插件</h2>\n<p>VSCode 的插件都是在插件市场中点击安装的，所以安装过程就不细说了。</p>\n<h3 id=\"latex-workshop\"><a class=\"anchor\" href=\"#latex-workshop\">#</a> LaTex Workshop</h3>\n<p>网上很多教程都比较老了，说是需要配置一大堆东西，但其实现在的 LaTex Workshop 的默认配置已经很好了，我们只需要对配置文件的编译工具 <code>latex-workshop.latex.tools</code>  稍做修改即可：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token property\">\"latex-workshop.latex.tools\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>          <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"latexmk\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>          <span class=\"token property\">\"command\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"latexmk\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>          <span class=\"token property\">\"args\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token string\">\"-synctex=1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token string\">\"-interaction=nonstopmode\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token string\">\"-file-line-error\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token string\">\"-xelatex\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token string\">\"-outdir=%OUTDIR%\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token string\">\"-cd\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token string\">\"%DOC%\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>          <span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token property\">\"latex-workshop.synctex.afterBuild.enabled\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>另外，配置编译完成后将 pdf 自动同步到代码中光标位置：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/tdeh1n.png\" alt=\"配置\" /></p>\n<p>很多教程中还使用到了外部的 pdf 浏览工具例如 skim 等，实际测试中内置 pdf 浏览器功能已经足够强大了，个人认为无需额外下载 pdf 工具并配置。</p>\n<h3 id=\"latex-utilities\"><a class=\"anchor\" href=\"#latex-utilities\">#</a> LaTex Utilities</h3>\n<p>对 LaTex Workshop 的功能进行增强，配合 Better BibTeX for Zotero 和 Zotero 可以便捷的进行论文引用。总之，安装就对了。</p>\n<h3 id=\"code-spell-checker\"><a class=\"anchor\" href=\"#code-spell-checker\">#</a> Code Spell Checker</h3>\n<p>英语单词拼写检查插件，个人觉得还是挺有用的，平时在打英文的时候偶尔脑子抽筋，打错了又不容易看出来，这个插件可以很好的帮助到我。</p>\n<h3 id=\"ultra-math-preview\"><a class=\"anchor\" href=\"#ultra-math-preview\">#</a> Ultra Math Preview</h3>\n<p>实时数学公式预览插件，插件说明中有详细的演示，对于我这种初学 LaTex 公式、根本对于自己打的是什么没太大概念的人很有帮助，无需等待编译看结果了，数学公式可以试试反馈。</p>\n<h1 id=\"使用\"><a class=\"anchor\" href=\"#使用\">#</a> 使用</h1>\n<p>我们以 IEEE 的模版为例来演示如何使用。</p>\n<p>官方模版下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWVlZS5vcmcvY29udGVudC9kYW0vaWVlZS1vcmcvaWVlZS93ZWIvb3JnL3B1YnMvY29uZmVyZW5jZS1sYXRleC10ZW1wbGF0ZV8xMC0xNy0xOS56aXA=\">https://www.ieee.org/content/dam/ieee-org/ieee/web/org/pubs/conference-latex-template_10-17-19.zip</span></p>\n<p>下载解压后，直接在 VSCode 中打开文件夹，当 VSCode 检测到 LaTex 相关文件后，会在右边显示出 <code>TEX</code>  的标签</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/48ni7f.jpg\" alt=\"界面图\" /></p>\n<p>在 <code>TEX</code>  页面有更多功能且带有说明，可根据说明自行探索：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/b1g359.jpg\" alt=\"Tex界面\" /></p>\n<h1 id=\"快捷键\"><a class=\"anchor\" href=\"#快捷键\">#</a> 快捷键</h1>\n<p>一些使用中的 Tips：</p>\n<ul>\n<li>正向定位：<span class=\"kbd\">⌘</span> + <span class=\"kbd red\">⌥</span> +  <span class=\"kbd purple\">J</span> 将 pdf 定位到代码中光标位置。</li>\n<li>反向定位：在内置 pdf 预览中使用 <span class=\"kbd\">⌘</span> + <span class=\"kbd red\">左键</span> 点击单词，实现反向定位 <code>.tex</code>  中代码位置。</li>\n<li>拼写纠错：光标移动到有问题的拼写上，使用 <span class=\"kbd\">⌘</span> + <span class=\"kbd red\">.</span> 显示纠正备选。</li>\n</ul>\n",
            "tags": [
                "杂项",
                "踩坑",
                "杂项",
                "踩坑",
                "Latex"
            ]
        },
        {
            "id": "https://gality.cn/ml/homework/HW-1/",
            "url": "https://gality.cn/ml/homework/HW-1/",
            "title": "李宏毅ML2022-Spring大作业01｜COVID-19 Cases Prediction (Regression)",
            "date_published": "2023-10-18T06:22:27.000Z",
            "content_html": "<div class=\"note info no-icon\">\n<p>李宏毅老师 2022 年春季学习机器中留的第一次大作业，需要根据各项疫情相关数据，自行实现网络结构并训练模型，最终实现一个可以精准预测疫情增长人数的深度学习模型。</p>\n</div>\n<h1 id=\"大作业内容\"><a class=\"anchor\" href=\"#大作业内容\">#</a> 大作业内容</h1>\n<p>根据人们填写的日常调查问卷，设计并实现一个深度学习模型用于 COVID-19 感染人数的预测。</p>\n<p>具体的作业手册请参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jb2xhYi5yZXNlYXJjaC5nb29nbGUuY29tL2RyaXZlLzFGVGNHNkNFLUhJTG52Rnp0RUZLZGF1TWxQS2ZRdm01Wg==\">官方手册</span>。</p>\n<h2 id=\"详细描述\"><a class=\"anchor\" href=\"#详细描述\">#</a> 详细描述</h2>\n<ul>\n<li>目标：预测 COVID-19 感染人数</li>\n<li>数据来源：Delphi group @ CMU「A daily survey April 2020 via facebook」</li>\n<li>输入输出要求：提供美国某州过去 4 天的调查问卷结果，然后预测第 5 天的新增阳性病例的百分比。</li>\n</ul>\n<h2 id=\"数据格式\"><a class=\"anchor\" href=\"#数据格式\">#</a> 数据格式</h2>\n<ul>\n<li>州（37 个，用 one-hot 向量的方式编码）</li>\n<li>类似新冠的疾病\n<ul>\n<li>cli、ili ...</li>\n</ul>\n</li>\n<li>行为指标\n<ul>\n<li>wearing_mask、travel_out_state ...</li>\n</ul>\n</li>\n<li>精神健康指标\n<ul>\n<li>anxious、depressed ...</li>\n</ul>\n</li>\n<li>确诊阳性病例\n<ul>\n<li>Tested_positive（这个就是我们希望预测的指标）</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"评价指标\"><a class=\"anchor\" href=\"#评价指标\">#</a> 评价指标</h2>\n<p>采用均方误差（Mean Squared Error，MSE）来评价误差。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>M</mi><mi>S</mi><mi>E</mi><mo>=</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mo stretchy=\"false\">(</mo><msub><mi>y</mi><mi>i</mi></msub><mo>−</mo><msub><mover accent=\"true\"><mi>y</mi><mo>^</mo></mover><mi>i</mi></msub><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><annotation encoding=\"application/x-tex\">MSE = {1 \\over N} \\sum_{i=1}^{N}(y_i- \\hat y_i)^2\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">M</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.106005em;vertical-align:-1.277669em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8283360000000002em;\"><span style=\"top:-1.872331em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.3000050000000005em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.277669em;\"><span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1141079999999999em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.19444em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641079999999999em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span></span></span></p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>：模型预测值</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mover accent=\"true\"><mi>y</mi><mo>^</mo></mover><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\hat y_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.19444em;\"><span class=\"mord\">^</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.19444em;\"><span></span></span></span></span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>：实际值</li>\n</ul>\n<h2 id=\"作业目的\"><a class=\"anchor\" href=\"#作业目的\">#</a> 作业目的</h2>\n<ul>\n<li>通过深度神经网络（deep neural networks，DNN）解决一个回归问题</li>\n<li>理解基本的 DNN 训练技巧\n<ul>\n<li>超参数调优、特征选择、正则化、...</li>\n</ul>\n</li>\n<li>熟悉 PyTorch</li>\n</ul>\n<hr />\n<h1 id=\"环境准备\"><a class=\"anchor\" href=\"#环境准备\">#</a> 环境准备</h1>\n<h2 id=\"conda\"><a class=\"anchor\" href=\"#conda\">#</a> Conda</h2>\n<p>本文不在赘述 Conda 的安装，参考另一篇<a href=\"https://gality.cn/misc/trail-and-error/conda-mamba/\">博客</a>。</p>\n<h2 id=\"数据集\"><a class=\"anchor\" href=\"#数据集\">#</a> 数据集</h2>\n<p><code>gdown</code>  是一个<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3drZW50YXJvL2dkb3du\"> github 项目</span>，是一个由 python 实现的从 Google Drive 下载大文件的工具（由于安全策略无法使用 wget/curl 进行下载）。如果之前从未用 <code>gdown</code>  下载过东西，需要现在 <code>conda</code>  的 <code>base</code>  环境安装 <code>gdown</code> 。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mamba <span class=\"token function\">install</span> gdown</pre></td></tr></table></figure><p>然后就可以直接用 gdown 下载文件了：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>gdown <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token builtin\">id</span> <span class=\"token string\">'1kLSW_-cW2Huj7bh84YTdimGBOJaODiOS'</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>output covid<span class=\"token punctuation\">.</span>train<span class=\"token punctuation\">.</span>csv</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>down <span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token builtin\">id</span> <span class=\"token string\">'1iiI5qROrAhZn-o4FPqsE97bMzDEFvIdg'</span> <span class=\"token operator\">-</span><span class=\"token operator\">-</span>output covid<span class=\"token punctuation\">.</span>test<span class=\"token punctuation\">.</span>csv</pre></td></tr></table></figure><p>此时，就得到了训练数据集和测试数据集。</p>\n<h2 id=\"依赖库\"><a class=\"anchor\" href=\"#依赖库\">#</a> 依赖库</h2>\n<p>作业需要依赖一些库，提前安装一下，作业中给出了 <code>import</code>  部分的代码：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Numerical Operations</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> math</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Reading/Writing Data</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> os</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> csv</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># For Progress Bar</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">from</span> tqdm <span class=\"token keyword\">import</span> tqdm</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># Pytorch</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> torch </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">import</span> torch<span class=\"token punctuation\">.</span>nn <span class=\"token keyword\">as</span> nn</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">import</span> Dataset<span class=\"token punctuation\">,</span> DataLoader<span class=\"token punctuation\">,</span> random_split</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># For plotting learning curve</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>tensorboard <span class=\"token keyword\">import</span> SummaryWriter</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># For plot</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">import</span> seaborn <span class=\"token keyword\">as</span> sns</pre></td></tr></table></figure><p>因此，我们创建一个虚拟环境并安装对应的库：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>mamba create <span class=\"token parameter variable\">-n</span> MLlearnEnv <span class=\"token assign-left variable\">python</span><span class=\"token operator\">=</span><span class=\"token number\">3.9</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conda activate MLlearnEnv</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>mamba <span class=\"token function\">install</span> pytorch::pytorch torchvision torchaudio <span class=\"token parameter variable\">-c</span> pytorch</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>mamba <span class=\"token function\">install</span> pandas tqdm packaging tensorboard matplotlib seaborn</pre></td></tr></table></figure><p>注意，由于电脑原因，这里安装 PyTorch 的命令是安装 CPU 版本的，对于初学者来说 CPU 的算力其实已经够了，如果安装 GPU 版本需要去对应安装 CUDA 驱动，所以具体安装命令请参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9weXRvcmNoLm9yZy8=\"> PyTorch 官网</span>。</p>\n<h1 id=\"知识准备\"><a class=\"anchor\" href=\"#知识准备\">#</a> 知识准备</h1>\n<p>这里仅对已给出的源代码进行解释，请自行进行成体系的工具学习。</p>\n<h2 id=\"可视化\"><a class=\"anchor\" href=\"#可视化\">#</a> 可视化</h2>\n<p>我们可以使用 <code>tensorboard</code>  来可视化训练过程，使用起来非常简单，只需要在作业目录下执行：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>tensorboard <span class=\"token parameter variable\">--logdir</span><span class=\"token operator\">=</span>runs</pre></td></tr></table></figure><p><code>logdir</code>  指向训练过程中生成的运行数据文件夹，默认为 <code>./runs</code> 。</p>\n<p>执行后会在本地监听 <code>6006</code>  端口，访问对应的 web 页面即可看到训练过程的图表。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/70c9ny.png\" alt=\"tensorboard\" /></p>\n<h2 id=\"实用函数\"><a class=\"anchor\" href=\"#实用函数\">#</a> 实用函数</h2>\n<p>针对源代码给出的无需修改的工具函数，简单做一些解释。</p>\n<h3 id=\"设置随机数种子\"><a class=\"anchor\" href=\"#设置随机数种子\">#</a> 设置随机数种子</h3>\n<p>为了保证 reproducibility（可复现性），需要设置随机数生成种子，<span class=\"exturl\" data-url=\"aHR0cHM6Ly9weXRvcmNoLm9yZy9kb2NzL3N0YWJsZS9ub3Rlcy9yYW5kb21uZXNzLmh0bWw=\">官方文档</span>给出了详细解释，这里简单说明一下。</p>\n<div class=\"note info no-icon\">\n<p>由于机器学习中涉及到很多随机数和随机过程，那么这些随机数和随机过程就可能直接对结果产生影响，从实验的可复现性来讲，我们希望同一个代码的多次运行结果是一致的，我们分别讨论。</p>\n<ul>\n<li>\n<p><strong>随机数</strong>：计算机生成随机数的方法其实是根据一个随机数 “种子”，然后以某种确定性的算法来实现的，这个种子常常是一个变化的值（例如时间戳），以此来保证生成的随机序列不可预测。那么在当前环境下，我们就可以通过给定一个随机数种子的方式来尽可能的保证随机数序列相同，减少对可复现性的干扰。</p>\n<p>由于程序中可能涉及到多个库，而不同库又采用不同的随机数生成器，所以需要分别对所有涉及到的库设置随机数种子，如代码中就同时设置了 <code>PyTorch</code>  和 <code>numpy</code>  的种子。</p>\n</li>\n<li>\n<p><strong>随机过程</strong>：在使用 CUDA 对训练过程进行加速时，cuDNN 可能会通过基准测试来从多个卷积中选择最快的卷积，成为可能的不确定来源之一。</p>\n<p>另一方面，cuDNN 在训练过程中采用的某些算法本身可能就是不确定的，每次运算会产生不同的结果。这些都是我们需要避免的。</p>\n</li>\n</ul>\n<p>遗憾的是，即使我们选用相同的随机数种子，PyTorch 仍无法确保可复现性，设置同一随机数种子和确定过程仅能保证在同一平台、同一硬件、同一 PyTorch 版本的下，多次实验结果一致。</p>\n</div>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># seed: 自行设定的随机数种子</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">same_seed</span><span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"Fixes random number generator seeds for reproducibility.\"\"\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    torch<span class=\"token punctuation\">.</span>backends<span class=\"token punctuation\">.</span>cudnn<span class=\"token punctuation\">.</span>deterministic <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span> <span class=\"token comment\"># 强制使用确定性算法</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    torch<span class=\"token punctuation\">.</span>backends<span class=\"token punctuation\">.</span>cudnn<span class=\"token punctuation\">.</span>benchmark <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span> <span class=\"token comment\"># 禁用 cuDNN 的卷积基准测试</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    np<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 设置 numpy 的随机数生成</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    torch<span class=\"token punctuation\">.</span>manual_seed<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 设置 PyTorch 的随机数生成</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>is_available<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 可以不要，新版本 PyTorch 中 manual_seed 会同时设置 CPU 和 GPU 版本的随机数种子</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>manual_seed_all<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"数据集分割\"><a class=\"anchor\" href=\"#数据集分割\">#</a> 数据集分割</h3>\n<p>由于需要计算损失函数来对模型参数进行动态的调整，我们需要将 <code>训练数据集</code> 分割成 <code>训练集</code> 和 <code>验证集</code> ，源代码中给出了一个通用的分割函数。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># data: 训练集（矩阵）</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># valid_ratio: 验证集的比例 (validation_size = train_size * valid_ratio)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># seed: 随机数种子</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">train_valid_split</span><span class=\"token punctuation\">(</span>data_set<span class=\"token punctuation\">,</span> valid_ratio<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"Split provided training data into training set and validation set\"\"\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    valid_set_size <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>valid_ratio <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>data_set<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    train_set_size <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>data_set<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> valid_set_size</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    train_set<span class=\"token punctuation\">,</span> valid_set <span class=\"token operator\">=</span> random_split<span class=\"token punctuation\">(</span>data_set<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>train_set_size<span class=\"token punctuation\">,</span> valid_set_size<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> generator<span class=\"token operator\">=</span>torch<span class=\"token punctuation\">.</span>Generator<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>manual_seed<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 将一个数据集随机拆成两个无重叠的数据集，两个数据集的大小由第二个参数指定</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>train_set<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>valid_set<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"预测函数\"><a class=\"anchor\" href=\"#预测函数\">#</a> 预测函数</h3>\n<p>一个预测函数，当我们希望用我们之前训练的模型去预测未知数据时可以调用这个函数，其中：</p>\n<ul>\n<li><code>model.eval()</code>  将模型设置为 eval 模式，此时，模型中的某些层会不起作用，来保证预测的同时不会改变训练好的模型参数。</li>\n<li>tqdm 是一个<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3RxZG0vdHFkbQ==\"> github 项目</span>，用于展示进度条。注意 <code>tqdm(test_loader)</code>  只会对进度计数，而不会改变迭代逻辑，即 <code>x</code>  是从 <code>test_loader</code>  中取出的 <code>tensor</code>  类型数据。</li>\n<li><code>model(x)</code> =  <code>model.forward(x)</code> ，在 PyTorch 中直接调用模型并传递输入数据时，会自动调用模型的 <code>forward</code>  方法。即这一行的代码的含义是：调用模型进行预测。</li>\n<li><code>Tensor.detach()</code>  从当前计算图中分离出新的 tensor，该 tensor 不具有梯度，也不会反向传播。由于在 PyTorch 中，变量不仅是数值和数据类型，还包含了该变量的计算过程，而通过 <code>detach()</code>  可以将计算过程剥离只剩下数值。</li>\n<li><code>.cpu()</code>  将变量放在 cpu 上。</li>\n<li><code>torch.cat()</code>  用于将两个 <code>tensor</code>  拼接在一起， <code>dim</code>  参数指定了是横着拼接还是竖着拼接（对于矩阵）</li>\n<li><code>.numpy()</code>  用于将 <code>Tensor</code>  类型转成 <code>Numpy</code>  类型。CUDA 只接受 <code>Tensor</code>  类型，不接受其他变量类型。</li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">predict</span><span class=\"token punctuation\">(</span>test_loader<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    model<span class=\"token punctuation\">.</span><span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># Set your model to evaluation mode.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    preds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> tqdm<span class=\"token punctuation\">(</span>test_loader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># test_loader 是测试数据</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 将模型加载到 CPU 上                    </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 禁用梯度计算，节省时间               </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            pred <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 调用模型进行预测</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            preds<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">.</span>detach<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>cpu<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># pred 可直接当参数也不会报错，这里是标准化处理</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    preds <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>cat<span class=\"token punctuation\">(</span>preds<span class=\"token punctuation\">,</span> dim<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>numpy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">return</span> preds</pre></td></tr></table></figure><h3 id=\"预测结果保存\"><a class=\"anchor\" href=\"#预测结果保存\">#</a> 预测结果保存</h3>\n<p>将模型预测的结果保存成 csv，这个其实是因为原本本作业的完成方式是上传保存的文件，我们也就保留下来了。由于只涉及 csv 的操作比较简单，就不过多解释了。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">save_pred</span><span class=\"token punctuation\">(</span>preds<span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\" Save predictions to specified file \"\"\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">file</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> fp<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        writer <span class=\"token operator\">=</span> csv<span class=\"token punctuation\">.</span>writer<span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        writer<span class=\"token punctuation\">.</span>writerow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tested_positive'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 保存成 id, tested_positive 两列</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> p <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>preds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            writer<span class=\"token punctuation\">.</span>writerow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"数据集-2\"><a class=\"anchor\" href=\"#数据集-2\">#</a> 数据集</h2>\n<h3 id=\"自定义数据集\"><a class=\"anchor\" href=\"#自定义数据集\">#</a> 自定义数据集</h3>\n<p>当我们不使用 PyTorch 官方整理好的数据集，而是使用自己的数据集时，就必须按照 PyTorch 的定义，自行实现一个继承 <code>torch.utils.data.Dataset</code>  这个抽象类的子类，PyTorch 才可以正确处理。</p>\n<p>自定义数据集必须继承 <code>Dataset</code>  并至少覆盖以下两个方法:</p>\n<ul>\n<li><code>__len__</code> ： 实现  <code>len(dataset)</code>  返还数据集的尺寸。</li>\n<li><code>__getitem__</code> ：用来获取索引数据，例如 <code>dataset[i]</code></li>\n</ul>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">COVID19Dataset</span><span class=\"token punctuation\">(</span>Dataset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    x: Features.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    y: Targets, if none, do prediction.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    \"\"\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 定义初始化方法</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">if</span> y <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            self<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> y</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            self<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>FloatTensor<span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 预测目标是浮点数</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        self<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>FloatTensor<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 特征也是浮点数</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__getitem__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 定义数据集索引方法</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>y <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__len__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 定义获取数据长度方法</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"dataloader\"><a class=\"anchor\" href=\"#dataloader\">#</a> Dataloader</h3>\n<ul>\n<li><code>pd.read_csv()</code> ：从指定位置读取 csv 表格，并转化为 <code>DataFrame</code>  的类型，可以通过 <code>.values</code>  取出 <code>DataFrame</code>  中的值并转换为多维列表。</li>\n<li><code>select_feat()</code> ：从数据集中提取特征，该函数的实现会在下面讲到。</li>\n</ul>\n<p>整体过程其实就是：</p>\n<ol>\n<li>读取 csv 表格中的数据</li>\n<li>提取数据中的特征</li>\n<li>将特征转化为数据集 <code>Dataset</code></li>\n<li>根据配置，将 <code>Dataset</code>  转化成 <code>DataLoader</code>  用于后续训练</li>\n</ol>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Set seed for reproducibility</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>same_seed<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'seed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># train_data size: 2699 x 118 (id + 37 states + 16 features x 5 days) </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># test_data size: 1078 x 117 (without last day's positive rate)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>train_data<span class=\"token punctuation\">,</span> test_data <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">'./covid.train.csv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">,</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">'./covid.test.csv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>train_data<span class=\"token punctuation\">,</span> valid_data <span class=\"token operator\">=</span> train_valid_split<span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'valid_ratio'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'seed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># Print out the data size.</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"\"\"train_data size: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>train_data<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\"> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>valid_data size: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>valid_data<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\"> </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>test_data size: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>test_data<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"\"\"</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># Select features</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>x_train<span class=\"token punctuation\">,</span> x_valid<span class=\"token punctuation\">,</span> x_test<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">,</span> y_valid <span class=\"token operator\">=</span> select_feat<span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">,</span> valid_data<span class=\"token punctuation\">,</span> test_data<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'select_all'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># Print out the number of features.</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'number of features: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>x_train<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># initialize datasets with the data</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>train_dataset<span class=\"token punctuation\">,</span> valid_dataset<span class=\"token punctuation\">,</span> test_dataset <span class=\"token operator\">=</span> COVID19Dataset<span class=\"token punctuation\">(</span>x_train<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \\</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                                            COVID19Dataset<span class=\"token punctuation\">(</span>x_valid<span class=\"token punctuation\">,</span> y_valid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \\</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                                            COVID19Dataset<span class=\"token punctuation\">(</span>x_test<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># Pytorch data loader loads pytorch dataset into batches.</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>train_loader <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>train_dataset<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> pin_memory<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>valid_loader <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>valid_dataset<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> pin_memory<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>test_loader <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>test_dataset<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> pin_memory<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h1 id=\"全局配置\"><a class=\"anchor\" href=\"#全局配置\">#</a> 全局配置</h1>\n<ul>\n<li><code>device</code> ：设置训练使用的硬件，优先 CUDA，如果没有的话就使用 CPU。</li>\n</ul>\n<p><code>config</code>  中的内容比较顾名思义了，稍微有点机器学习基础应该都能看懂。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>device <span class=\"token operator\">=</span> <span class=\"token string\">'cuda'</span> <span class=\"token keyword\">if</span> torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>is_available<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token string\">'cpu'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>config <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string\">'seed'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5201314</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\"># Your seed number, you can pick your lucky number. :)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">'select_all'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\"># Whether to use all features.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token string\">'valid_ratio'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\"># validation_size = train_size * valid_ratio</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token string\">'n_epochs'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\"># Number of epochs.            </span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">256</span><span class=\"token punctuation\">,</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string\">'learning_rate'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1e-5</span><span class=\"token punctuation\">,</span>              </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token string\">'early_stop'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\"># If model has not improved for this many consecutive epochs, stop training.     </span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token string\">'save_path'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'./models/model.ckpt'</span>  <span class=\"token comment\"># Your model will be saved here.</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"关键函数编写\"><a class=\"anchor\" href=\"#关键函数编写\">#</a> 关键函数编写</h1>\n<p>由于关键函数的编写也正是作业的内容，所以将该内容放在了最后，我们需要完成 3 个关键函数的编 / 改写，分别是：</p>\n<ol>\n<li>模型  <code>My_Model()</code></li>\n<li>特征提取算法  <code>select_feat()</code></li>\n<li>训练算法  <code>trainer()</code></li>\n</ol>\n<h2 id=\"my_model\"><a class=\"anchor\" href=\"#my_model\">#</a> My_Model()</h2>\n<p>基础模型如下：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">My_Model</span><span class=\"token punctuation\">(</span>nn<span class=\"token punctuation\">.</span>Module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> input_dim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 定义模型初始化方法</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>My_Model<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 调用父类的__init__方法</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\"># TODO: modify model's structure, be aware of dimensions.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        self<span class=\"token punctuation\">.</span>layers <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>Sequential<span class=\"token punctuation\">(</span> <span class=\"token comment\"># Sequential 中前一层输出大小必须与下一层的输入大小一致</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span>input_dim<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># 定义一个全连接层</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>ReLU<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># 使用 ReLU 作为激活函数</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># 该层输入 tensor 为 16，输出 tensor 为 8</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>ReLU<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 定义前向传播算法</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        x <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 将 x 传递给 layers 的各层进行运算，默认写法。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>squeeze<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># (B, 1) -> (B)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token keyword\">return</span> x</pre></td></tr></table></figure><p>使用该模型训练出的 loss 为：</p>\n<p><code>Epoch [1869/3000]: Train loss: 41.3380, Valid loss: 37.6867</code></p>\n<p>同时，使用此训练的模型去预测会发现预测出的 <code>tested_positive</code>  都会是同一个值，这显然是不对的，猜测可能是因为模型神经元数目太少，而特征又太多，导致模型无法学习到有效特征，loss 的下降其实也只是类似求一个最佳均值的过程，所以我们尝试通过增加层数的方法来优化他（称为优化 1）：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>self<span class=\"token punctuation\">.</span>layers <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>Sequential<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span>input_dim<span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>ReLU<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>ReLU<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>ReLU<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>loss 有显著降低：</p>\n<p><code>Epoch [3000/3000]: Train loss: 1.5405, Valid loss: 1.5447</code></p>\n<p>为了防止过拟合问题，我们跑一下验证集试试，结果为</p>\n<p><code>Loss:  tensor(3.2558, dtype=torch.float64)</code></p>\n<h2 id=\"select_feat\"><a class=\"anchor\" href=\"#select_feat\">#</a> select_feat()</h2>\n<p>默认的特征提取函数默认情况下是使用全部特征（不提取特征）的，代码如下：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">select_feat</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">,</span> valid_data<span class=\"token punctuation\">,</span> test_data<span class=\"token punctuation\">,</span> select_all<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"Selects useful features to perform regression\"\"\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    y_train<span class=\"token punctuation\">,</span> y_valid <span class=\"token operator\">=</span> train_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> valid_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    raw_x_train<span class=\"token punctuation\">,</span> raw_x_valid<span class=\"token punctuation\">,</span> raw_x_test <span class=\"token operator\">=</span> train_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> valid_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> test_data <span class=\"token comment\"># 分离 tested_positive 列和其他特征列</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">if</span> select_all<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        feat_idx <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>raw_x_train<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        feat_idx <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\"># TODO: Select suitable feature columns.</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">return</span> raw_x_train<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> feat_idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> raw_x_valid<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> feat_idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> raw_x_test<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> feat_idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">,</span> y_valid</pre></td></tr></table></figure><p>其中 <code>train_data</code>  和 <code>valid_data</code>  都是多维数组， <code>train_data[:, -1]</code>  是指将列表中的每一个子列表的最后一项提取出来组成一个新的列表：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">[</mo><mn>1</mn><mo separator=\"true\">,</mo><mn>2</mn><mo separator=\"true\">,</mo><mn>3</mn><mo stretchy=\"false\">]</mo><mo separator=\"true\">,</mo><mo stretchy=\"false\">[</mo><mn>4</mn><mo separator=\"true\">,</mo><mn>5</mn><mo separator=\"true\">,</mo><mn>6</mn><mo stretchy=\"false\">]</mo><mo separator=\"true\">,</mo><mo stretchy=\"false\">[</mo><mn>7</mn><mo separator=\"true\">,</mo><mn>8</mn><mo separator=\"true\">,</mo><mn>9</mn><mo stretchy=\"false\">]</mo><mo stretchy=\"false\">]</mo><mo>→</mo><mo stretchy=\"false\">[</mo><mn>3</mn><mo separator=\"true\">,</mo><mn>6</mn><mo separator=\"true\">,</mo><mn>9</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[[1,2,3],[4,5,6],[7,8,9]] \\rightarrow [3,6,9]\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mopen\">[</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">2</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">3</span><span class=\"mclose\">]</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">4</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">5</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">6</span><span class=\"mclose\">]</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">7</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">8</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">9</span><span class=\"mclose\">]</span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">3</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">6</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">9</span><span class=\"mclose\">]</span></span></span></span></span></p>\n<p>观察训练集可以发现，最后一列就是 <code>tested_positive</code>  列，即 <code>y_train</code>  为训练集的 <code>tested_positive</code>  列表， <code>y_valid</code>  为验证集的 <code>tested_positive</code>  列表；另外， <code>raw_x_train</code>  就是将 <code>tested_positive</code>  排除的其他数据特征， <code>raw_x_valid</code>  同理。</p>\n<p>若配置 <code>select_all=true</code>  时，会将其他特征全部返回，否则只会返回指定的特征列。考虑到原本数据集中的部分特征可能对我们想要的预测的内容没什么贡献，反倒可能会影响机器的学习，那么我们就可以考虑人为分析一下样本中的不同字段对结果的贡献从而优化机器学习的效果（称为优化 2）。</p>\n<p>先分析一下样本数据：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">样本列</th>\n<th style=\"text-align:center\">含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">AL、AK、AZ、AR、......</td>\n<td style=\"text-align:center\">美国不同州的缩写</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">cli、ili</td>\n<td style=\"text-align:center\">COVID-like illness、influenza-like illness</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">hh_cmnty_cli、nohh_cmnty_cli</td>\n<td style=\"text-align:center\">社区报告病例（包括 / 不包括家庭）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">wearing_mask</td>\n<td style=\"text-align:center\">戴口罩</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">travel_outside_state、work_outside_home</td>\n<td style=\"text-align:center\">外出旅行、非居家办公</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">shop、restaurant</td>\n<td style=\"text-align:center\">商场、餐厅</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">spent_time</td>\n<td style=\"text-align:center\">过去 24 小时内与当前不在身边的人在一起</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">large_event</td>\n<td style=\"text-align:center\">出席 10 人以上的活动</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">public_transit</td>\n<td style=\"text-align:center\">过去 24 小时使用公共交通</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">anxious、depressed、worried_finances</td>\n<td style=\"text-align:center\">焦虑、压力、担心财务状况</td>\n</tr>\n</tbody>\n</table>\n<p>如果纯靠人为经验来分析的话，可能会觉得都有关系，这个时候我们可以借助 Person 相关性分析方法，来分析各个变量与 <code>tested_positive</code>  的相关性，通过具体的数值来找到最相关的列。 <code>pandas</code>  库提供了封装好的 Person 相关性分析算法，直接使用即可：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>df <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">'./data/covid.train.csv'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">.</span>corr<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'tested_positive'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>sort_values<span class=\"token punctuation\">(</span>ascending<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 降序排列</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># ---- Output ----</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>tested_positive      <span class=\"token number\">1.000000</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>tested_positive<span class=\"token punctuation\">.</span><span class=\"token number\">1</span>    <span class=\"token number\">0.985053</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>tested_positive<span class=\"token punctuation\">.</span><span class=\"token number\">2</span>    <span class=\"token number\">0.969467</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>tested_positive<span class=\"token punctuation\">.</span><span class=\"token number\">3</span>    <span class=\"token number\">0.953463</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>tested_positive<span class=\"token punctuation\">.</span><span class=\"token number\">4</span>    <span class=\"token number\">0.935388</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                       <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>   </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>public_transit      <span class=\"token operator\">-</span><span class=\"token number\">0.411916</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>public_transit<span class=\"token punctuation\">.</span><span class=\"token number\">1</span>    <span class=\"token operator\">-</span><span class=\"token number\">0.415510</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>public_transit<span class=\"token punctuation\">.</span><span class=\"token number\">2</span>    <span class=\"token operator\">-</span><span class=\"token number\">0.418523</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>public_transit<span class=\"token punctuation\">.</span><span class=\"token number\">3</span>    <span class=\"token operator\">-</span><span class=\"token number\">0.421868</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>public_transit<span class=\"token punctuation\">.</span><span class=\"token number\">4</span>    <span class=\"token operator\">-</span><span class=\"token number\">0.424169</span></pre></td></tr></table></figure><p>我们把这些强相关的列作为特征在优化 1 的基础上去优化模型（称为优化 2）。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>feat_idx <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">38</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>            <span class=\"token number\">53</span><span class=\"token punctuation\">,</span> <span class=\"token number\">69</span><span class=\"token punctuation\">,</span> <span class=\"token number\">85</span><span class=\"token punctuation\">,</span> <span class=\"token number\">101</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># tested_positive</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token number\">49</span><span class=\"token punctuation\">,</span> <span class=\"token number\">65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">97</span><span class=\"token punctuation\">,</span> <span class=\"token number\">113</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># public_transit</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token number\">40</span><span class=\"token punctuation\">,</span> <span class=\"token number\">41</span><span class=\"token punctuation\">,</span> <span class=\"token number\">56</span><span class=\"token punctuation\">,</span> <span class=\"token number\">57</span><span class=\"token punctuation\">,</span> <span class=\"token number\">72</span><span class=\"token punctuation\">,</span> <span class=\"token number\">73</span><span class=\"token punctuation\">,</span> <span class=\"token number\">88</span><span class=\"token punctuation\">,</span> <span class=\"token number\">89</span><span class=\"token punctuation\">,</span> <span class=\"token number\">104</span><span class=\"token punctuation\">,</span> <span class=\"token number\">105</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># hh_cmnty_cli &amp; nohh_cmnty_cli</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token number\">38</span><span class=\"token punctuation\">,</span> <span class=\"token number\">39</span><span class=\"token punctuation\">,</span> <span class=\"token number\">54</span><span class=\"token punctuation\">,</span> <span class=\"token number\">55</span><span class=\"token punctuation\">,</span> <span class=\"token number\">70</span><span class=\"token punctuation\">,</span> <span class=\"token number\">71</span><span class=\"token punctuation\">,</span> <span class=\"token number\">86</span><span class=\"token punctuation\">,</span> <span class=\"token number\">87</span><span class=\"token punctuation\">,</span> <span class=\"token number\">102</span><span class=\"token punctuation\">,</span> <span class=\"token number\">103</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># cli &amp; ili</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">66</span><span class=\"token punctuation\">,</span> <span class=\"token number\">82</span><span class=\"token punctuation\">,</span> <span class=\"token number\">98</span><span class=\"token punctuation\">,</span> <span class=\"token number\">114</span> <span class=\"token comment\"># anxious</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">]</span>  <span class=\"token comment\"># TODO: Select suitable feature columns.</span></pre></td></tr></table></figure><p>此时，模型在训练集上的 loss 有所上升，但是在验证集上有所下降。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># --- 测试集 ---</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Epoch <span class=\"token punctuation\">[</span><span class=\"token number\">2547</span><span class=\"token operator\">/</span><span class=\"token number\">3000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> Train loss<span class=\"token punctuation\">:</span> <span class=\"token number\">1.8915</span><span class=\"token punctuation\">,</span> Valid loss<span class=\"token punctuation\">:</span> <span class=\"token number\">1.6332</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># --- 验证集 ---</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Loss<span class=\"token punctuation\">:</span>  tensor<span class=\"token punctuation\">(</span><span class=\"token number\">3.1981</span><span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span>torch<span class=\"token punctuation\">.</span>float64<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"trainer\"><a class=\"anchor\" href=\"#trainer\">#</a> trainer()</h2>\n<p>源码中给出基本的 <code>trainer()</code>  函数，注释已经非常清楚了，代码如下：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">trainer</span><span class=\"token punctuation\">(</span>train_loader<span class=\"token punctuation\">,</span> valid_loader<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">,</span> device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    criterion <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>MSELoss<span class=\"token punctuation\">(</span>reduction<span class=\"token operator\">=</span><span class=\"token string\">'mean'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Define your loss function, do not modify this.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\"># Define your optimization algorithm.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\"># TODO: Please check https://pytorch.org/docs/stable/optim.html to get more available algorithms.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\"># TODO: L2 regularization (optimizer(weight decay...) or implement by your self).</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    optimizer <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>optim<span class=\"token punctuation\">.</span>SGD<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> lr<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'learning_rate'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> momentum<span class=\"token operator\">=</span><span class=\"token number\">0.9</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    writer <span class=\"token operator\">=</span> SummaryWriter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Writer of tensoboard.</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>isdir<span class=\"token punctuation\">(</span><span class=\"token string\">'./models'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        os<span class=\"token punctuation\">.</span>mkdir<span class=\"token punctuation\">(</span><span class=\"token string\">'./models'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Create directory of saving models.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    n_epochs<span class=\"token punctuation\">,</span> best_loss<span class=\"token punctuation\">,</span> step<span class=\"token punctuation\">,</span> early_stop_count <span class=\"token operator\">=</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'n_epochs'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> math<span class=\"token punctuation\">.</span>inf<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span> <span class=\"token comment\"># initialize some variables</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">for</span> epoch <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n_epochs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        model<span class=\"token punctuation\">.</span>train<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Set your model to train mode.</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        loss_record <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token comment\"># tqdm is a package to visualize your training progress.</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        train_pbar <span class=\"token operator\">=</span> tqdm<span class=\"token punctuation\">(</span>train_loader<span class=\"token punctuation\">,</span> position<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> leave<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span> y <span class=\"token keyword\">in</span> train_pbar<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            optimizer<span class=\"token punctuation\">.</span>zero_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Set gradient to zero.</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            x<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Move your data to device.</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            pred <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            loss <span class=\"token operator\">=</span> criterion<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            loss<span class=\"token punctuation\">.</span>backward<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Compute gradient(backpropagation).</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            optimizer<span class=\"token punctuation\">.</span>step<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Update parameters.</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            step <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            loss_record<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>detach<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token comment\"># Display current epoch number and loss on tqdm progress bar.</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            train_pbar<span class=\"token punctuation\">.</span>set_description<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Epoch [</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>epoch <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>n_epochs<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">]'</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            train_pbar<span class=\"token punctuation\">.</span>set_postfix<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">'loss'</span><span class=\"token punctuation\">:</span> loss<span class=\"token punctuation\">.</span>detach<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        mean_train_loss <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>loss_record<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>loss_record<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        writer<span class=\"token punctuation\">.</span>add_scalar<span class=\"token punctuation\">(</span><span class=\"token string\">'Loss/train'</span><span class=\"token punctuation\">,</span> mean_train_loss<span class=\"token punctuation\">,</span> step<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        model<span class=\"token punctuation\">.</span><span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Set your model to evaluation mode.</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        loss_record <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span> y <span class=\"token keyword\">in</span> valid_loader<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            x<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                pred <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                loss <span class=\"token operator\">=</span> criterion<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            loss_record<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        mean_valid_loss <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>loss_record<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>loss_record<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Epoch [</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>epoch <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>n_epochs<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">]: Train loss: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mean_train_loss<span class=\"token punctuation\">:</span><span class=\"token format-spec\">.4f</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">, Valid loss: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mean_valid_loss<span class=\"token punctuation\">:</span><span class=\"token format-spec\">.4f</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        writer<span class=\"token punctuation\">.</span>add_scalar<span class=\"token punctuation\">(</span><span class=\"token string\">'Loss/valid'</span><span class=\"token punctuation\">,</span> mean_valid_loss<span class=\"token punctuation\">,</span> step<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 向 tensoboard 添加图表</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">if</span> mean_valid_loss <span class=\"token operator\">&lt;</span> best_loss<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>            best_loss <span class=\"token operator\">=</span> mean_valid_loss</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            torch<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>state_dict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'save_path'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Save your best model</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">'Saving model with loss &#123;:.3f&#125;...'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>best_loss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>            early_stop_count <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>            early_stop_count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token keyword\">if</span> early_stop_count <span class=\"token operator\">>=</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'early_stop'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">'\\nModel is not improving, so we halt the training session.'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token keyword\">return</span></pre></td></tr></table></figure><p>提示中给出了两个优化方向，引入 L2 正则化和寻找更好的 <code>optimizer</code> ，经过实际测试，如果不引入 L2 正则化就直接换用别的 <code>optimizer</code>  会导致过拟合的问题，所以我们先引入 L2 正则化。</p>\n<h3 id=\"l2-regularization-dropout\"><a class=\"anchor\" href=\"#l2-regularization-dropout\">#</a> L2 regularization &amp; Dropout</h3>\n<p>简单来说，L2 正则化可以直观理解为它<strong>对于大数值的权重向量进行严厉惩罚</strong>，倾向于更加分散的权重向量。由于输入和权重之间的乘法操作，这样就有了一个优良的<strong>特性</strong>：<strong>使网络更倾向于使用所有输入特征，而不是严重依赖输入特征中某些小部分特征</strong>。 L2 惩罚倾向于更小更分散的权重向量，这就会鼓励分类器最终将所有维度上的特征都用起来，而不是强烈依赖其中少数几个维度。这样做可以提高模型的泛化能力，<strong>降低过拟合的风险</strong>。</p>\n<p>与 L2 正则化类似的是 L1 正则化，也是引入惩罚措施来降低过拟合的风险，一般情况下，L2 正则化模型效果会更好一些。</p>\n<p>👆理论来说是这样的，但是在实际测试中，引入 L2 正则化之后仍然会有过拟合的问题，效果不是很好，我们可以使用 <code>Dropout</code>  的方法来缓解过拟合问题。</p>\n<p><code>Dropout</code>  的思想是在训练过程中随机让部分神经元 “失活”，通过这种方式丢失部分特征，限制模型的学习能力，通过这种方法，可以使神经网络更加关注于 “通用的” 特征，而不是训练集中的特化特征。使用 <code>Dropout</code>  需要对模型做出变化：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">My_Model</span><span class=\"token punctuation\">(</span>nn<span class=\"token punctuation\">.</span>Module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> input_dim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>My_Model<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\"># TODO: modify model's structure, be aware of dimensions.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        self<span class=\"token punctuation\">.</span>layers <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>Sequential<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span>input_dim<span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>LeakyReLU<span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Dropout<span class=\"token punctuation\">(</span>p<span class=\"token operator\">=</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 添加 Dropout，指定丢弃概率</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>LeakyReLU<span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>LeakyReLU<span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>在实际测试中，将激活函数从 <code>ReLU</code>  替换成了 <code>LeakyReLU</code>  并增加模型神经元数，取得了更好的效果（关于激活函数后面单独拿一章讲）。</p>\n<h3 id=\"optimizer\"><a class=\"anchor\" href=\"#optimizer\">#</a> optimizer</h3>\n<p>经过测试，选用 <code>Adam</code>  作为 <code>optimizer</code>  会有更好的效果， <code>Adam</code>  是一个自适应的梯度下降算法，自动的调整 <code>learning-rate</code> ，我们知道，设置合适的超参数 <code>learning-rate</code>  是非常困难的，若 <code>lr</code>  过大，会导致 loss 在最低点出震荡；若 <code>lr</code>  过小，则会导致训练速度过慢。直接使用 <code>Adam</code>  可以帮助我们解决这个烦恼，我们只需要在学习的开始设置一个较大的 <code>lr</code> ， <code>Adam</code>  会自动随着计算调整合适的 <code>lr</code> ，代码如下：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>optimizer <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>optim<span class=\"token punctuation\">.</span>Adam<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> lr<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'learning_rate'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 调整 超参数</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>config <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token string\">'seed'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">194343431</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token string\">'select_all'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token string\">'valid_ratio'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token string\">'n_epochs'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">256</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token string\">'learning_rate'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1e-3</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># 这里从 1e-5 改成了 1e-3</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string\">'early_stop'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string\">'save_path'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'./models/model.ckpt'</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>这样的优化（称为优化 3）的结果为：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># --- 测试集 ---</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Epoch <span class=\"token punctuation\">[</span><span class=\"token number\">498</span><span class=\"token operator\">/</span><span class=\"token number\">15000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> Train loss<span class=\"token punctuation\">:</span> <span class=\"token number\">1.3171</span><span class=\"token punctuation\">,</span> Valid loss<span class=\"token punctuation\">:</span> <span class=\"token number\">5.3677</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># --- 验证集 ---</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Loss<span class=\"token punctuation\">:</span>  tensor<span class=\"token punctuation\">(</span><span class=\"token number\">2.2407</span><span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span>torch<span class=\"token punctuation\">.</span>float64<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>通过选取合适的特征，loss 可以进一步下降：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 修改 feat 选取</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>feat_idx <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">38</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>            <span class=\"token number\">53</span><span class=\"token punctuation\">,</span> <span class=\"token number\">69</span><span class=\"token punctuation\">,</span> <span class=\"token number\">85</span><span class=\"token punctuation\">,</span> <span class=\"token number\">101</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># tested_positive</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token number\">49</span><span class=\"token punctuation\">,</span> <span class=\"token number\">65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">97</span><span class=\"token punctuation\">,</span> <span class=\"token number\">113</span><span class=\"token punctuation\">,</span> <span class=\"token comment\"># public_transit</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">]</span>  <span class=\"token comment\"># TODO: Select suitable feature columns.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># --- 测试集 ---</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Epoch <span class=\"token punctuation\">[</span><span class=\"token number\">447</span><span class=\"token operator\">/</span><span class=\"token number\">3000</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> Train loss<span class=\"token punctuation\">:</span> <span class=\"token number\">1.6422</span><span class=\"token punctuation\">,</span> Valid loss<span class=\"token punctuation\">:</span> <span class=\"token number\">2.8130</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># --- 验证集 ---</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Loss<span class=\"token punctuation\">:</span>  tensor<span class=\"token punctuation\">(</span><span class=\"token number\">1.4970</span><span class=\"token punctuation\">,</span> dtype<span class=\"token operator\">=</span>torch<span class=\"token punctuation\">.</span>float64<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><div class=\"note warning\">\n<p>在实际测试中，如果不加上州的特征（前 38 个）的话，Loss 会比较高，加上之后，在测试集上的 loss 会低一些。理论来说，州的特征与 <code>tested_positive</code>  的相关性并不高，如果只是解释为过拟合的话我觉得不是很合理，所以这里的特征选择就没有什么理论指导了，纯粹是试出来的，如果有大佬能解释为什么求求解释一下 Orz</p>\n</div>\n<h1 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h1>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/jvocmh.png\" alt=\"拟合函数\" /></p>\n<p>可以看到随着预测的准确率提升，预测结果和实际结果的拟合是越来越好的。整个项目至此先告一段落了，来来回回测试了不下 100 多种优化的组合，感觉继续胡乱尝试没有什么意义，通过这个作业熟悉 PyTorch、学习神经网络知识的目标也已经达到了，接下来将会继续往后学习，进一步提高能力才是王道。</p>\n<h2 id=\"整体代码\"><a class=\"anchor\" href=\"#整体代码\">#</a> 整体代码</h2>\n<details class=\"primary\"><summary>main.py</summary><div>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Numerical Operations</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> math</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Reading/Writing Data</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">import</span> os</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">import</span> csv</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># For Progress Bar</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">from</span> tqdm <span class=\"token keyword\">import</span> tqdm</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># Pytorch</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">import</span> torch</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">import</span> torch<span class=\"token punctuation\">.</span>nn <span class=\"token keyword\">as</span> nn</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">import</span> Dataset<span class=\"token punctuation\">,</span> DataLoader<span class=\"token punctuation\">,</span> random_split</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># For plotting learning curve</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>tensorboard <span class=\"token keyword\">import</span> SummaryWriter</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># For plot</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token keyword\">import</span> seaborn <span class=\"token keyword\">as</span> sns</pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>device <span class=\"token operator\">=</span> <span class=\"token string\">'cuda'</span> <span class=\"token keyword\">if</span> torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>is_available<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token string\">'cpu'</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>config <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token string\">'seed'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">7777777</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\"># Your seed number, you can pick your lucky number. :)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token string\">'select_all'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\"># Whether to use all features.</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token string\">'valid_ratio'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0.2</span><span class=\"token punctuation\">,</span>   <span class=\"token comment\"># validation_size = train_size * valid_ratio</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token string\">'n_epochs'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\"># Number of epochs.</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">256</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token string\">'learning_rate'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1e-3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token string\">'early_stop'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\"># If model has not improved for this many consecutive epochs, stop training.</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token string\">'save_path'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'./models/model.ckpt'</span>  <span class=\"token comment\"># Your model will be saved here.</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">same_seed</span><span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"Fixes random number generator seeds for reproducibility.\"\"\"</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    torch<span class=\"token punctuation\">.</span>backends<span class=\"token punctuation\">.</span>cudnn<span class=\"token punctuation\">.</span>deterministic <span class=\"token operator\">=</span> <span class=\"token boolean\">True</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    torch<span class=\"token punctuation\">.</span>backends<span class=\"token punctuation\">.</span>cudnn<span class=\"token punctuation\">.</span>benchmark <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    np<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>seed<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    torch<span class=\"token punctuation\">.</span>manual_seed<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">if</span> torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>is_available<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        torch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>manual_seed_all<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\"># Set seed for reproducibility</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>same_seed<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'seed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">train_valid_split</span><span class=\"token punctuation\">(</span>data_set<span class=\"token punctuation\">,</span> valid_ratio<span class=\"token punctuation\">,</span> seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"Split provided training data into training set and validation set\"\"\"</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    valid_set_size <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>valid_ratio <span class=\"token operator\">*</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>data_set<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    train_set_size <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>data_set<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> valid_set_size</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    train_set<span class=\"token punctuation\">,</span> valid_set <span class=\"token operator\">=</span> random_split<span class=\"token punctuation\">(</span>data_set<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>train_set_size<span class=\"token punctuation\">,</span> valid_set_size<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                                        generator<span class=\"token operator\">=</span>torch<span class=\"token punctuation\">.</span>Generator<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>manual_seed<span class=\"token punctuation\">(</span>seed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token keyword\">return</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>train_set<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>valid_set<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">predict</span><span class=\"token punctuation\">(</span>test_loader<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    model<span class=\"token punctuation\">.</span><span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Set your model to evaluation mode.</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    preds <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> tqdm<span class=\"token punctuation\">(</span>test_loader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            pred <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>            preds<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">.</span>detach<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>cpu<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    preds <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>cat<span class=\"token punctuation\">(</span>preds<span class=\"token punctuation\">,</span> dim<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>numpy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token keyword\">return</span> preds</pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">save_pred</span><span class=\"token punctuation\">(</span>preds<span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\" Save predictions to specified file \"\"\"</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">file</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> fp<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        writer <span class=\"token operator\">=</span> csv<span class=\"token punctuation\">.</span>writer<span class=\"token punctuation\">(</span>fp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        writer<span class=\"token punctuation\">.</span>writerow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tested_positive'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token keyword\">for</span> i<span class=\"token punctuation\">,</span> p <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>preds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>            writer<span class=\"token punctuation\">.</span>writerow<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">COVID19Dataset</span><span class=\"token punctuation\">(</span>Dataset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>    x: Features.</pre></td></tr><tr><td data-num=\"85\"></td><td><pre>    y: Targets, if none, do prediction.</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>    \"\"\"</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token keyword\">if</span> y <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>            self<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> y</pre></td></tr><tr><td data-num=\"91\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>            self<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>FloatTensor<span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>        self<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>FloatTensor<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__getitem__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>        <span class=\"token keyword\">if</span> self<span class=\"token punctuation\">.</span>y <span class=\"token keyword\">is</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>            <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">[</span>idx<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__len__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">My_Model</span><span class=\"token punctuation\">(</span>nn<span class=\"token punctuation\">.</span>Module<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> input_dim<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span>My_Model<span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>        <span class=\"token comment\"># TODO: modify model's structure, be aware of dimensions.</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>        self<span class=\"token punctuation\">.</span>layers <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>Sequential<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span>input_dim<span class=\"token punctuation\">,</span> <span class=\"token number\">32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>LeakyReLU<span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Dropout<span class=\"token punctuation\">(</span>p<span class=\"token operator\">=</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 添加 Dropout，指定丢弃概率</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>LeakyReLU<span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>LeakyReLU<span class=\"token punctuation\">(</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>            nn<span class=\"token punctuation\">.</span>Linear<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>        <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>    <span class=\"token keyword\">def</span> <span class=\"token function\">forward</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>        x <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>layers<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>        x <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>squeeze<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># (B, 1) -> (B)</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>        <span class=\"token keyword\">return</span> x</pre></td></tr><tr><td data-num=\"124\"></td><td><pre></pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">select_feat</span><span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">,</span> valid_data<span class=\"token punctuation\">,</span> test_data<span class=\"token punctuation\">,</span> select_all<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"Selects useful features to perform regression\"\"\"</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>    y_train<span class=\"token punctuation\">,</span> y_valid <span class=\"token operator\">=</span> train_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> valid_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>    raw_x_train<span class=\"token punctuation\">,</span> raw_x_valid<span class=\"token punctuation\">,</span> raw_x_test <span class=\"token operator\">=</span> train_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> valid_data<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> test_data</pre></td></tr><tr><td data-num=\"130\"></td><td><pre></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>    <span class=\"token keyword\">if</span> select_all<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>        feat_idx <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>raw_x_train<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>        feat_idx <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">38</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>            <span class=\"token number\">53</span><span class=\"token punctuation\">,</span> <span class=\"token number\">69</span><span class=\"token punctuation\">,</span> <span class=\"token number\">85</span><span class=\"token punctuation\">,</span> <span class=\"token number\">101</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># tested_positive</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>            <span class=\"token number\">49</span><span class=\"token punctuation\">,</span> <span class=\"token number\">65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">81</span><span class=\"token punctuation\">,</span> <span class=\"token number\">97</span><span class=\"token punctuation\">,</span> <span class=\"token number\">113</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># public_transit</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>        <span class=\"token punctuation\">]</span>  <span class=\"token comment\"># TODO: Select suitable feature columns.</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>    <span class=\"token keyword\">return</span> raw_x_train<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> feat_idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> raw_x_valid<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> feat_idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> raw_x_test<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">,</span> feat_idx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">,</span> y_valid</pre></td></tr><tr><td data-num=\"140\"></td><td><pre></pre></td></tr><tr><td data-num=\"141\"></td><td><pre></pre></td></tr><tr><td data-num=\"142\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">trainer</span><span class=\"token punctuation\">(</span>train_loader<span class=\"token punctuation\">,</span> valid_loader<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">,</span> device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>    criterion <span class=\"token operator\">=</span> nn<span class=\"token punctuation\">.</span>MSELoss<span class=\"token punctuation\">(</span>reduction<span class=\"token operator\">=</span><span class=\"token string\">'mean'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Define your loss function, do not modify this.</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>    <span class=\"token comment\"># Define your optimization algorithm.</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>    <span class=\"token comment\"># TODO: Please check https://pytorch.org/docs/stable/optim.html to get more available algorithms.</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>    <span class=\"token comment\"># TODO: L2 regularization (optimizer(weight decay...) or implement by your self).</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>    optimizer <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>optim<span class=\"token punctuation\">.</span>Adam<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>parameters<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> lr<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'learning_rate'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>    writer <span class=\"token operator\">=</span> SummaryWriter<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Writer of tensoboard.</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>isdir<span class=\"token punctuation\">(</span><span class=\"token string\">'./models'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>        os<span class=\"token punctuation\">.</span>mkdir<span class=\"token punctuation\">(</span><span class=\"token string\">'./models'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Create directory of saving models.</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre></pre></td></tr><tr><td data-num=\"155\"></td><td><pre>    n_epochs<span class=\"token punctuation\">,</span> best_loss<span class=\"token punctuation\">,</span> step<span class=\"token punctuation\">,</span> early_stop_count <span class=\"token operator\">=</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'n_epochs'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> math<span class=\"token punctuation\">.</span>inf<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>    <span class=\"token keyword\">for</span> epoch <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n_epochs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>        model<span class=\"token punctuation\">.</span>train<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Set your model to train mode.</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>        loss_record <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>        <span class=\"token comment\"># tqdm is a package to visualize your training progress.</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>        train_pbar <span class=\"token operator\">=</span> tqdm<span class=\"token punctuation\">(</span>train_loader<span class=\"token punctuation\">,</span> position<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> leave<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>        <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span> y <span class=\"token keyword\">in</span> train_pbar<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>            optimizer<span class=\"token punctuation\">.</span>zero_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Set gradient to zero.</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>            x<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Move your data to device.</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>            pred <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>            loss <span class=\"token operator\">=</span> criterion<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>            loss<span class=\"token punctuation\">.</span>backward<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Compute gradient(backpropagation).</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>            optimizer<span class=\"token punctuation\">.</span>step<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Update parameters.</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>            step <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>            loss_record<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>detach<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>            <span class=\"token comment\"># Display current epoch number and loss on tqdm progress bar.</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre>            train_pbar<span class=\"token punctuation\">.</span>set_description<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Epoch [</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>epoch <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>n_epochs<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">]'</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre>            train_pbar<span class=\"token punctuation\">.</span>set_postfix<span class=\"token punctuation\">(</span><span class=\"token punctuation\">&#123;</span><span class=\"token string\">'loss'</span><span class=\"token punctuation\">:</span> loss<span class=\"token punctuation\">.</span>detach<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>        mean_train_loss <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>loss_record<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>loss_record<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>        writer<span class=\"token punctuation\">.</span>add_scalar<span class=\"token punctuation\">(</span><span class=\"token string\">'Loss/train'</span><span class=\"token punctuation\">,</span> mean_train_loss<span class=\"token punctuation\">,</span> step<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre></pre></td></tr><tr><td data-num=\"181\"></td><td><pre>        <span class=\"token comment\"># 在验证集上进行模型准确率的分析验证。</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>        model<span class=\"token punctuation\">.</span><span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Set your model to evaluation mode.</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>        loss_record <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>        <span class=\"token keyword\">for</span> x<span class=\"token punctuation\">,</span> y <span class=\"token keyword\">in</span> valid_loader<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>            x<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> x<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>            <span class=\"token keyword\">with</span> torch<span class=\"token punctuation\">.</span>no_grad<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>                pred <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>                loss <span class=\"token operator\">=</span> criterion<span class=\"token punctuation\">(</span>pred<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>            loss_record<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>loss<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>        mean_valid_loss <span class=\"token operator\">=</span> <span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>loss_record<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>loss_record<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>        tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'Epoch [</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>epoch <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">/</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>n_epochs<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">]: Train loss: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mean_train_loss<span class=\"token punctuation\">:</span><span class=\"token format-spec\">.4f</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">, '</span></span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>                   <span class=\"token string-interpolation\"><span class=\"token string\">f'Valid loss: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>mean_valid_loss<span class=\"token punctuation\">:</span><span class=\"token format-spec\">.4f</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>        writer<span class=\"token punctuation\">.</span>add_scalar<span class=\"token punctuation\">(</span><span class=\"token string\">'Loss/valid'</span><span class=\"token punctuation\">,</span> mean_valid_loss<span class=\"token punctuation\">,</span> step<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>        <span class=\"token keyword\">if</span> mean_valid_loss <span class=\"token operator\">&lt;</span> best_loss<span class=\"token punctuation\">:</span>  <span class=\"token comment\"># 如果当前 loss 低于过去最低的 loss，则记录 loss，并保存当前最好的模型。</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre>            best_loss <span class=\"token operator\">=</span> mean_valid_loss</pre></td></tr><tr><td data-num=\"199\"></td><td><pre>            torch<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>model<span class=\"token punctuation\">.</span>state_dict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'save_path'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># Save your best model</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>            tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">'Saving model with loss &#123;:.3f&#125;...'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>best_loss<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>            early_stop_count <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>            early_stop_count <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>        <span class=\"token keyword\">if</span> early_stop_count <span class=\"token operator\">>=</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'early_stop'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>            tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">'\\nModel is not improving, so we halt the training session.'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>            <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre></pre></td></tr><tr><td data-num=\"209\"></td><td><pre></pre></td></tr><tr><td data-num=\"210\"></td><td><pre><span class=\"token comment\"># train_data size: 2699 x 118 (id + 37 states + 16 features x 5 days)</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre><span class=\"token comment\"># test_data size: 1078 x 117 (without last day's positive rate)</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre>train_data<span class=\"token punctuation\">,</span> test_data <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">'./data/covid.train.csv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">,</span> pd<span class=\"token punctuation\">.</span>read_csv<span class=\"token punctuation\">(</span><span class=\"token string\">'./data/covid.test.csv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>values</pre></td></tr><tr><td data-num=\"213\"></td><td><pre>train_data<span class=\"token punctuation\">,</span> valid_data <span class=\"token operator\">=</span> train_valid_split<span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'valid_ratio'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'seed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre></pre></td></tr><tr><td data-num=\"215\"></td><td><pre><span class=\"token comment\"># Print out the data size.</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre>tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"\"\"</pre></td></tr><tr><td data-num=\"217\"></td><td><pre>train_data size: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>train_data<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\"> </pre></td></tr><tr><td data-num=\"218\"></td><td><pre>valid_data size: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>valid_data<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\"> </pre></td></tr><tr><td data-num=\"219\"></td><td><pre>test_data size: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>test_data<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"\"\"</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre></pre></td></tr><tr><td data-num=\"221\"></td><td><pre><span class=\"token comment\"># Select features</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre>x_train<span class=\"token punctuation\">,</span> x_valid<span class=\"token punctuation\">,</span> x_test<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">,</span> y_valid <span class=\"token operator\">=</span> select_feat<span class=\"token punctuation\">(</span>train_data<span class=\"token punctuation\">,</span> valid_data<span class=\"token punctuation\">,</span> test_data<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">[</span><span class=\"token string\">'select_all'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre></pre></td></tr><tr><td data-num=\"224\"></td><td><pre><span class=\"token comment\"># Print out the number of features.</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre>tqdm<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'number of features: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>x_train<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre></pre></td></tr><tr><td data-num=\"227\"></td><td><pre>train_dataset<span class=\"token punctuation\">,</span> valid_dataset<span class=\"token punctuation\">,</span> test_dataset <span class=\"token operator\">=</span> COVID19Dataset<span class=\"token punctuation\">(</span>x_train<span class=\"token punctuation\">,</span> y_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \\</pre></td></tr><tr><td data-num=\"228\"></td><td><pre>                                            COVID19Dataset<span class=\"token punctuation\">(</span>x_valid<span class=\"token punctuation\">,</span> y_valid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> \\</pre></td></tr><tr><td data-num=\"229\"></td><td><pre>                                            COVID19Dataset<span class=\"token punctuation\">(</span>x_test<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre></pre></td></tr><tr><td data-num=\"231\"></td><td><pre><span class=\"token comment\"># Pytorch data loader loads pytorch dataset into batches.</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre>train_loader <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>train_dataset<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> pin_memory<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre>valid_loader <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>valid_dataset<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> pin_memory<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"234\"></td><td><pre>test_loader <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>test_dataset<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'batch_size'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> pin_memory<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre></pre></td></tr><tr><td data-num=\"236\"></td><td><pre>model <span class=\"token operator\">=</span> My_Model<span class=\"token punctuation\">(</span>input_dim<span class=\"token operator\">=</span>x_train<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>to<span class=\"token punctuation\">(</span>device<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># put your model and data on the same computation device.</span></pre></td></tr><tr><td data-num=\"237\"></td><td><pre><span class=\"token comment\"># 开始训练模型</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre>trainer<span class=\"token punctuation\">(</span>train_loader<span class=\"token punctuation\">,</span> valid_loader<span class=\"token punctuation\">,</span> model<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">,</span> device<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre></pre></td></tr><tr><td data-num=\"240\"></td><td><pre><span class=\"token comment\"># 使用进行模型预测</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre><span class=\"token comment\"># model.load_state_dict(torch.load(config['save_path']))</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre><span class=\"token comment\"># preds = predict(test_loader, model, device)</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre><span class=\"token comment\"># save_pred(preds, 'pred.csv')</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre><span class=\"token comment\">#</span></pre></td></tr><tr><td data-num=\"245\"></td><td><pre><span class=\"token comment\"># predict_data, real_data = pd.read_csv('./pred.csv'), pd.read_csv('./data/covid.test.csv')</span></pre></td></tr><tr><td data-num=\"246\"></td><td><pre><span class=\"token comment\"># # 计算预测值和实际值的 MSE</span></pre></td></tr><tr><td data-num=\"247\"></td><td><pre><span class=\"token comment\"># loss = nn.MSELoss()</span></pre></td></tr><tr><td data-num=\"248\"></td><td><pre><span class=\"token comment\"># out = loss(torch.tensor(predict_data['tested_positive'].values), torch.tensor(real_data['tested_positive'].values))</span></pre></td></tr><tr><td data-num=\"249\"></td><td><pre><span class=\"token comment\"># print('Loss: ', out)</span></pre></td></tr><tr><td data-num=\"250\"></td><td><pre><span class=\"token comment\"># df = pd.concat ([predict_data ['tested_positive'], real_data ['tested_positive']], axis=1)  # 拼接两个 Series</span></pre></td></tr><tr><td data-num=\"251\"></td><td><pre><span class=\"token comment\"># df.columns = ['predicted', 'ground truth']  # 重命名列名</span></pre></td></tr><tr><td data-num=\"252\"></td><td><pre><span class=\"token comment\"># sns.lmplot (x='predicted', y='ground truth', data=df)  # 绘制拟合线性回归图</span></pre></td></tr><tr><td data-num=\"253\"></td><td><pre><span class=\"token comment\"># plt.show()</span></pre></td></tr></table></figure></div></details>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zcGVlY2guZWUubnR1LmVkdS50dy9+aHlsZWUvbWwvbWwyMDIyLWNvdXJzZS1kYXRhL0hXMDEucGRm\">https://speech.ee.ntu.edu.tw/~hylee/ml/ml2022-course-data/HW01.pdf</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMW0zNDExcDd3RD9wPTE=\">https://www.bilibili.com/video/BV1m3411p7wD?p=1</span></li>\n</ul>\n",
            "tags": [
                "机器学习",
                "作业",
                "大作业",
                "机器学习",
                "深度学习",
                "神经网络"
            ]
        },
        {
            "id": "https://gality.cn/misc/trail-and-error/conda-mamba/",
            "url": "https://gality.cn/misc/trail-and-error/conda-mamba/",
            "title": "机器学习-环境搭建踩坑-conda&mamba",
            "date_published": "2023-10-16T12:26:41.000Z",
            "content_html": "<h1 id=\"conda\"><a class=\"anchor\" href=\"#conda\">#</a> Conda</h1>\n<p>由于机器学习会依赖大量不同环境，环境之间可能有冲突，所以推荐用 Miniconda 或 Anaconda 这种的 python <code>库+虚拟环境</code> 管理器来对 python 进行统一管理。 <code>conda</code>  其实是 Miniconda 或 Anaconda 中的主程序，用于执行各种命令。</p>\n<h2 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> 安装</h2>\n<p>Miniconda 是 Anaconda 的轻量化版本，只包含 <code>conda</code>  和 <code>python</code> ，而 Anaconda 则默认包含更多的库，所以 Miniconda 只有几十 M 的大小，而 Anaconda 则有几百 M 的大小。二者在使用中几乎没有差别，可以根据空间自行选取。</p>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYW5hY29uZGEuY29tL2Rvd25sb2Fk\">Anaconda Download</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmNvbmRhLmlvL3Byb2plY3RzL21pbmljb25kYS9lbi9sYXRlc3QvaW5kZXguaHRtbA==\">Miniconda Download</span></li>\n</ul>\n<p>无论安装 Anaconda 还是 Miniconda，在安装完成后，应该会默认在当前命令行工具的配置文件中写好环境变量，可以直接用 <code>source ~/.zshrc</code> （zsh）来读取一下环境变量。</p>\n<p>推荐在安装完成后，<strong>立刻</strong>对 <code>conda</code>  进行更新，可以减少出现未知问题的概率...</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>conda update <span class=\"token parameter variable\">-n</span> base conda</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conda update <span class=\"token parameter variable\">--all</span></pre></td></tr></table></figure><h1 id=\"mamba\"><a class=\"anchor\" href=\"#mamba\">#</a> Mamba</h1>\n<p><code>mamba</code>  相比 <code>conda</code>  的优势如下：</p>\n<ul>\n<li>用 C 重新实现了依赖解析器，大幅提高依赖解析速度。</li>\n<li>并行下载所需要的包</li>\n<li>在解析依赖时给出步骤提醒，不像 conda 仅仅是一直 <code>solving</code></li>\n</ul>\n<p>同时， <code>mamba</code>  基本实现了所有 conda 的功能，使用起来仅需把上述所有命令中的 <code>conda</code>  替换成 <code>mamba</code>  即可。 <code>mamba</code>  需要通过 <code>conda</code>  来进行安装：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>conda <span class=\"token function\">install</span> <span class=\"token parameter variable\">-n</span> base <span class=\"token parameter variable\">-c</span> conda-forge mamba</pre></td></tr></table></figure><p>综合来说，可以一定程度解决 <code>conda</code>  过长的 <code>Solving environment</code>  的时间，推荐安装并替换 <code>conda</code>  使用。</p>\n<h1 id=\"bug-解决\"><a class=\"anchor\" href=\"#bug-解决\">#</a> bug 解决</h1>\n<h2 id=\"frozen-solve问题\"><a class=\"anchor\" href=\"#frozen-solve问题\">#</a> frozen solve 问题</h2>\n<p>在用 <code>conda install</code>  包时出现报错：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Solving environment: unsuccessful initial attempt using frozen solve. Retrying with flexible solve.</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Solving environment: unsuccessful attempt using repodata from current_repodata.json, retrying with next repodata source.</pre></td></tr></table></figure><p>请按步骤进行排查：</p>\n<ol>\n<li>\n<p>添加 <code>conda-forge</code>  频道</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 添加频道</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conda config <span class=\"token parameter variable\">--add</span> channels conda-forge</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 查看已添加的频道</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>conda config --show-sources</pre></td></tr></table></figure></li>\n<li>\n<p>更新 conda 到最新版本</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>conda update <span class=\"token parameter variable\">-n</span> base conda</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conda update <span class=\"token parameter variable\">--all</span></pre></td></tr></table></figure></li>\n<li>\n<p>重新安装，若解决，到此结束</p>\n</li>\n<li>\n<p>若未解决：新建一个虚拟环境</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 创建虚拟环境</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conda create <span class=\"token parameter variable\">-n</span> <span class=\"token operator\">&lt;</span>EnvName<span class=\"token operator\">></span> <span class=\"token assign-left variable\">python</span><span class=\"token operator\">=</span><span class=\"token number\">3.11</span></pre></td></tr></table></figure></li>\n<li>\n<p>再次安装即可解决</p>\n</li>\n</ol>\n<h1 id=\"卸载\"><a class=\"anchor\" href=\"#卸载\">#</a> 卸载</h1>\n<p>如果在安装过程中莫名问题（正常操作却出现各种 error），然后通过各种教程仍无法修复，建议卸载重装，可能可以解决问题（博主就是这么解决的）</p>\n<ol>\n<li>\n<p>清除环境变量：清除 <code>~/.zshrc</code>  或 <code>~/.bashrc</code>  中的类似下列的内容：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># >>> conda initialize >>></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># !! Contents within this block are managed by 'conda init' !!</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">__conda_setup</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>'/Your/Conda/Path/bin/conda<span class=\"token string\">' '</span>shell.zsh<span class=\"token string\">' '</span>hook' <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span> /dev/null<span class=\"token variable\">)</span></span>\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$?</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token builtin class-name\">eval</span> <span class=\"token string\">\"<span class=\"token variable\">$__conda_setup</span>\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token parameter variable\">-f</span> <span class=\"token string\">\"Your/Conda/Path/etc/profile.d/conda.sh\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token builtin class-name\">.</span> <span class=\"token string\">\"Your/Conda/Path/etc/profile.d/conda.sh\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"/Your/Conda/Path/miniconda3/bin:<span class=\"token environment constant\">$PATH</span>\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token builtin class-name\">unset</span> __conda_setup</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;</span></pre></td></tr></table></figure></li>\n<li>\n<p>删除文件夹： <code>rm -rf &lt;Your/Conda/Path&gt;</code></p>\n</li>\n</ol>\n<h1 id=\"conda-常用命令\"><a class=\"anchor\" href=\"#conda-常用命令\">#</a> Conda 常用命令</h1>\n<h2 id=\"环境\"><a class=\"anchor\" href=\"#环境\">#</a> 环境</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 新建虚拟环境</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conda create <span class=\"token parameter variable\">-n</span> <span class=\"token operator\">&lt;</span>EnvName<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>conda create <span class=\"token parameter variable\">-n</span> <span class=\"token operator\">&lt;</span>EnvName<span class=\"token operator\">></span> <span class=\"token assign-left variable\">python</span><span class=\"token operator\">=</span><span class=\"token number\">3.9</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 列出所有虚拟环境</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>conda info <span class=\"token parameter variable\">-e</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 进入虚拟环境</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>conda activate <span class=\"token operator\">&lt;</span>EnvName<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 退出虚拟环境</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>conda deactivate</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 删除虚拟环境</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>conda remove <span class=\"token parameter variable\">-n</span> <span class=\"token operator\">&lt;</span>EnvName<span class=\"token operator\">></span> <span class=\"token parameter variable\">--all</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 复制虚拟环境</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>conda create <span class=\"token parameter variable\">--name</span> <span class=\"token operator\">&lt;</span>NewEnvName<span class=\"token operator\">></span> <span class=\"token parameter variable\">--clone</span> <span class=\"token operator\">&lt;</span>OldEnvName<span class=\"token operator\">></span></pre></td></tr></table></figure><h2 id=\"更新\"><a class=\"anchor\" href=\"#更新\">#</a> 更新</h2>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 查看版本</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conda <span class=\"token parameter variable\">-V</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 更新 conda 环境</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>conda update <span class=\"token parameter variable\">-n</span> base conda</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 更新 conda 的所有包</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>conda update <span class=\"token parameter variable\">--all</span></pre></td></tr></table></figure><h2 id=\"频道\"><a class=\"anchor\" href=\"#频道\">#</a> 频道</h2>\n<p>conda 频道是存储 <code>包</code> 的位置，安装包时 conda 会搜索现有的频道集合，并选取其中一个频道来安装包，一般用 <code>conda-forge</code>  这个免费频道</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 添加新频道</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>conda config <span class=\"token parameter variable\">--add</span> channels <span class=\"token operator\">&lt;</span>channel-name<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 查看所有频道</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>conda config --show-sources</pre></td></tr></table></figure><h1 id=\"\"><a class=\"anchor\" href=\"#\">#</a> </h1>\n",
            "tags": [
                "杂项",
                "踩坑",
                "机器学习",
                "杂项",
                "踩坑",
                "conda",
                "mamba"
            ]
        },
        {
            "id": "https://gality.cn/misc/Monte-Carlo-method/",
            "url": "https://gality.cn/misc/Monte-Carlo-method/",
            "title": "数理统计大作业 ｜ Monte Carlo方法",
            "date_published": "2023-10-11T09:23:31.000Z",
            "content_html": "<div class=\"note info no-icon\">\n<p>菜狗完成数理统计第一次大作业的记录，记录了在完成的过程中对已学习的数理统计知识进行的回顾和总结，其实就是怕忘了 QwQ，有问题的话及时喷我，谢谢各位大佬 Orz</p>\n</div>\n<h1 id=\"大作业内容\"><a class=\"anchor\" href=\"#大作业内容\">#</a> 大作业内容</h1>\n<p><strong>用 Monte Carlo 方法进行统计量分布和分位数计算</strong></p>\n<h2 id=\"题目\"><a class=\"anchor\" href=\"#题目\">#</a> 题目</h2>\n<p>已知统计量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mrow><mo stretchy=\"false\">(</mo><msub><mi mathvariant=\"normal\">z</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mi mathvariant=\"normal\">n</mi></msub><mo stretchy=\"false\">)</mo></mrow><mo>=</mo><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mroot><mrow><mfrac><mn>1</mn><mi>n</mi></mfrac><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mo stretchy=\"false\">(</mo><msub><mi>z</mi><mi>i</mi></msub><mo>−</mo><mover accent=\"true\"><mi>z</mi><mo>ˉ</mo></mover><msup><mo stretchy=\"false\">)</mo><mn>2</mn></msup></mrow><mrow></mrow></mroot><mrow><mover accent=\"true\"><mi>z</mi><mo>ˉ</mo></mover><mo>−</mo><msub><mi>z</mi><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msub></mrow></mfrac></mstyle></mrow><annotation encoding=\"application/x-tex\">T \\mathrm{(z_1,z_2,...,z_n)}=\\dfrac{\\sqrt[]{ {1\\over n } \\sum\\nolimits_{i=1}^{n}(z_i-\\bar{z})^2 } }{\\bar z -{z_{(1)} } }</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:3.2712em;vertical-align:-1.0412em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.23em;\"><span style=\"top:-2.549054em;\"><span class=\"pstrut\" style=\"height:3.235054em;\"></span><span class=\"mord\"><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.56778em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.19444em;\"><span class=\"mord\">ˉ</span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:-0.04398em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mtight\">1</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.465054em;\"><span class=\"pstrut\" style=\"height:3.235054em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-4.23em;\"><span class=\"pstrut\" style=\"height:3.235054em;\"></span><span class=\"mord\"><span class=\"mord sqrt\"><span class=\"root\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.37806480000000003em;\"><span style=\"top:-2.3780648em;\"><span class=\"pstrut\" style=\"height:2em;\"></span><span class=\"sizing reset-size6 size1 mtight\"><span class=\"mord mtight\"></span></span></span></span></span></span></span><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.235054em;\"><span class=\"svg-align\" style=\"top:-3.8em;\"><span class=\"pstrut\" style=\"height:3.8em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.845108em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:-0.0000050000000000050004em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.804292em;\"><span style=\"top:-2.40029em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.29971000000000003em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.56778em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.19444em;\"><span class=\"mord\">ˉ</span></span></span></span></span></span></span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.740108em;\"><span style=\"top:-2.9890000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.195054em;\"><span class=\"pstrut\" style=\"height:3.8em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.8800000000000001em;\"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90\nl0 -0\nc4,-6.7,10,-10,18,-10 H400000v40\nH1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7\ns-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744\nc-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30\nc26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722\nc56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5\nc53.7,-170.3,84.5,-266.8,92.5,-289.5z\nM1001 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.604946em;\"><span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0412em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>，其中<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi mathvariant=\"normal\">z</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mi mathvariant=\"normal\">n</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\mathrm{z_1,z_2,...,z_n}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></span> 独立同分布，均服从<br />\n（a）标准正态分布<br />\n（b）参数为 1 的指数分布</p>\n<p>请在 (a)，(b) 两种条件下分别计算：</p>\n<ol>\n<li>画出概率分布 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">{</mo><mi>T</mi><mrow><mo stretchy=\"false\">(</mo><msub><mi mathvariant=\"normal\">z</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mi mathvariant=\"normal\">n</mi></msub><mo stretchy=\"false\">)</mo></mrow><mo>&lt;</mo><mi>t</mi><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">P\\{T\\mathrm{(z_1,z_2,...,z_n)} &lt; t\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">{</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">}</span></span></span></span> 的近似分布曲线</li>\n<li>对给定的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.01</mn><mo separator=\"true\">,</mo><mn>0.05</mn><mo separator=\"true\">,</mo><mn>0.1</mn></mrow><annotation encoding=\"application/x-tex\">\\alpha=0.01, 0.05, 0.1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">0</span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">0</span><span class=\"mord\">5</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">0</span><span class=\"mord\">.</span><span class=\"mord\">1</span></span></span></span>，计算满足 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">{</mo><mi>T</mi><mrow><mo stretchy=\"false\">(</mo><msub><mi mathvariant=\"normal\">z</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mi mathvariant=\"normal\">n</mi></msub><mo stretchy=\"false\">)</mo></mrow><mo>&lt;</mo><msub><mi>t</mi><mi>α</mi></msub><mo stretchy=\"false\">}</mo><mo>=</mo><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">P\\{T\\mathrm{(z_1,z_2,...,z_n)} &lt; t_\\alpha\\}=\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">{</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.0037em;\">α</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span> 的分位数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>α</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.0037em;\">α</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。</li>\n</ol>\n<h2 id=\"目的\"><a class=\"anchor\" href=\"#目的\">#</a> 目的</h2>\n<p>提升统计软件的使用能力（本题目可以使用任意软件），熟练使用 Monte Carlo 方法进行概率计算，并能把其用于科学研究。</p>\n<h2 id=\"基本要求\"><a class=\"anchor\" href=\"#基本要求\">#</a> 基本要求</h2>\n<ol>\n<li>用 Monte Carlo 方法给出计算方法过程，输出计算结果。</li>\n<li>讨论 Monte Carlo 方法计算结果随着样本容量变化时计算误差的变化，并进行总结。</li>\n<li>作业书写图文并茂，具有较强的可读性与可视性。</li>\n</ol>\n<p>注：除完成基本要求外，可以增加自己感兴趣的研究内容。</p>\n<hr />\n<h1 id=\"算法引入\"><a class=\"anchor\" href=\"#算法引入\">#</a> 算法引入</h1>\n<p>考虑这么一种情况：我们在一张纸上画了一个圆圈，此时我们想求圆圈的面积。如果圆圈时正圆形的话，面试非常好求，但如果不是一个正圆，该怎么求面积呢？</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/5a84t1.png\" alt=\"Mentor Carlo问题引入\" height=\"176\" width=\"406\" /></p>\n<p>此时我们可以考虑这么一种情况：抓一把绿豆，随机的撒在整个纸上，然后去计算 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><msub><mi>N</mi><mrow><mi>c</mi><mi>i</mi><mi>r</mi><mi>c</mi><mi>l</mi><mi>e</mi></mrow></msub><msub><mi>N</mi><mrow><mi>p</mi><mi>a</mi><mi>p</mi><mi>e</mi><mi>r</mi></mrow></msub></mfrac><mo>×</mo><msub><mi>S</mi><mrow><mi>p</mi><mi>a</mi><mi>p</mi><mi>e</mi><mi>r</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\frac{N_{circle} }{N_{paper} } \\times S_{paper}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.4365109999999999em;vertical-align:-0.5423199999999999em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.894191em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.16454285714285716em;\"><span style=\"top:-2.357em;margin-left:-0.10903em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">p</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2818857142857143em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.41586em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3487714285714287em;margin-left:-0.10903em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">c</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">c</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">e</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15122857142857138em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5423199999999999em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.969438em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">p</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">p</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 即可计算出圆的面积。显然的是，绿豆的个数越多，算出的圆的面积就会越接近实际答案，这其实就是 <strong>蒙特卡洛（Mento Carlo）</strong> 算法的基本思想。</p>\n<p>从上述可以看出，Monte-Carlo 算法区别于确定性算法，它的解不一定是准确或正确的，其准确性或正确性依赖于概率和统计，但在某些问题上，当重复实验次数足够大时，可以从很大概率上（这个概率是可以在数学上证明的，但依赖于具体问题）确保解的准确或正确性，所以，我们可以根据具体的概率分析，设定实验的次数，从而将误差或错误率降到一个可容忍的程度。</p>\n<p>下面给出严格的证明：</p>\n<details class=\"primary\"><summary>证明</summary><div>\n<p>为不失一般性，可以设纸的面积为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi></mrow><annotation encoding=\"application/x-tex\">S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span></span>，不规则图形面积为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>S</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">S&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.751892em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span> ，设事件 A：随机投掷一粒绿豆，绿豆落在圆内。</p>\n<p>显然，投掷落点符合二维均匀分布，所以 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>A</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><msup><mi>S</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mi>S</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">p(A)=\\frac{S&#x27;}{S}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.31848em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.97348em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8278285714285715em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>。</p>\n<p>设 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>k</mi></mrow><annotation encoding=\"application/x-tex\">k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span> 是 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span> 次投掷中，都在不规则圆形的次数，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ε</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">\\varepsilon&gt;0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">ε</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">0</span></span></span></span> 为任意正数，根据伯努利大数定律：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><munder><mo><mi>lim</mi><mo>⁡</mo></mo><mrow><mi>n</mi><mo>→</mo><mi mathvariant=\"normal\">∞</mi></mrow></munder><mi>P</mi><mrow><mo fence=\"true\">{</mo><mrow><mo fence=\"true\">∣</mo><mfrac><mi>k</mi><mi>n</mi></mfrac><mo>−</mo><mi>p</mi><mo stretchy=\"false\">(</mo><mi>A</mi><mo stretchy=\"false\">)</mo><mo fence=\"true\">∣</mo></mrow><mo>&lt;</mo><mi>ε</mi><mo fence=\"true\">}</mo></mrow><mo>=</mo><munder><mo><mi>lim</mi><mo>⁡</mo></mo><mrow><mi>n</mi><mo>→</mo><mi mathvariant=\"normal\">∞</mi></mrow></munder><mi>P</mi><mrow><mo fence=\"true\">{</mo><mrow><mo fence=\"true\">∣</mo><mfrac><mi>k</mi><mi>n</mi></mfrac><mo>−</mo><mfrac><msup><mi>S</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mi>S</mi></mfrac><mo>&lt;</mo><mi>ε</mi><mo fence=\"true\">∣</mo></mrow><mo fence=\"true\">}</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">\\lim_{n \\to \\infty} P\\left \\{  \\left | \\frac{k}{n} - p(A) \\right |&lt;  \\varepsilon \\right \\} = \\lim_{n \\to \\infty} P \\left \\{ \\left | \\frac{k}{n} - \\frac{S&#x27;}{S} &lt; \\varepsilon \\right | \\right \\} = 1\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.43em;vertical-align:-0.95003em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-2.4em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mrel mtight\">→</span><span class=\"mord mtight\">∞</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">lim</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">{</span></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">ε</span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">}</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.43em;vertical-align:-0.95003em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.69444em;\"><span style=\"top:-2.4em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span><span class=\"mrel mtight\">→</span><span class=\"mord mtight\">∞</span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\">lim</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">{</span></span><span class=\"minner\"><span class=\"mopen\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">n</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.428892em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.751892em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord mathnormal\">ε</span><span class=\"mclose\"><span class=\"delimsizing mult\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.4799700000000002em;\"><span style=\"top:-1.65598em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.25698em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.85798em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-2.87897em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span><span style=\"top:-3.47997em;\"><span class=\"pstrut\" style=\"height:2.606em;\"></span><span class=\"delimsizinginner delim-size1\"><span>∣</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500199999999999em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">}</span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></span></p>\n<p>这就证明了，当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi><mo>→</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">n \\rightarrow \\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord\">∞</span></span></span></span> 时，频率 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mi>k</mi><mi>n</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">k\\over n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2251079999999999em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8801079999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span> 依概率收敛于 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><msup><mi>S</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mi>S</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">S&#x27;\\over S</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.31848em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.97348em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8278285714285715em;\"><span style=\"top:-2.931em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>, 由于纸的面积是很好算的，也就可以轻松算出不规则圆的面积了。</p>\n</div></details>\n<p>上述证明从数学上说明用频率估计不规则图形面积的合理性，进一步可以给出误差分析，从而选择合适的实验次数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>n</mi></mrow><annotation encoding=\"application/x-tex\">n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">n</span></span></span></span>，来将误差控制在可以容忍的范围内，Monte-Carlo 算法虽然不能保证解一定是准确和正确，但并不是 “撞大运”，其正确性和准确性依赖概率论，有严格的数学基础，也因此 Mento Carlo 算法也称统计模拟法、统计实验法。</p>\n<h1 id=\"解题流程\"><a class=\"anchor\" href=\"#解题流程\">#</a> 解题流程</h1>\n<h2 id=\"画出概率分布近似分布曲线\"><a class=\"anchor\" href=\"#画出概率分布近似分布曲线\">#</a> 画出概率分布近似分布曲线</h2>\n<p>由于是使用 Monte Carlo 算法来近似的求解问题，那么我们首先需要生成足够多的满足题目要求的随机数据，这里以 “标准正态分布” 数据为例进行说明：</p>\n<p>首先我们要生成足够多的数据去 “撒绿豆”，先随机生成一组样本容量为 2000 的标准正态分布样本数据，并画出他的概率密度曲线：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> seaborn <span class=\"token keyword\">as</span> sns</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>num_arr <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>sns<span class=\"token punctuation\">.</span>histplot<span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">,</span> kde<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"http://imgcdn.gality.cn/blog/nwslof.png\" alt=\"标准正态分布图\" /></p>\n<p>根据 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mrow><mo stretchy=\"false\">(</mo><msub><mi mathvariant=\"normal\">z</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi mathvariant=\"normal\">z</mi><mi mathvariant=\"normal\">n</mi></msub><mo stretchy=\"false\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">T \\mathrm{(z_1,z_2,...,z_n)}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mord mathrm\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathrm\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathrm mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span> 的公式算出一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>，并将其加入到：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>t_arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>z_a <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>z_1 <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>n <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tmp <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  tmp <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>z_a<span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>t <span class=\"token operator\">=</span> math<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span>tmp<span class=\"token operator\">/</span>n<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>z_a <span class=\"token operator\">-</span> z_1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>t_arr<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>此时，只需要重复这个算法，算出多个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span> 值去估计概率分布即可。但是还有一个需要注意的点，由于 <code>seaborn</code>  库函数的原因，如果想画出概率密度的话，必须将生成的数组格式，使用 <code>pandas</code>  库转换成 <code>DataFrame</code>  格式才可以正确处理。</p>\n<p>最终代码如下：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> math</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> seaborn <span class=\"token keyword\">as</span> sns</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>sns<span class=\"token punctuation\">.</span>set_style<span class=\"token punctuation\">(</span><span class=\"token string\">\"whitegrid\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>t_arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>loop <span class=\"token operator\">=</span> <span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>loop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    num_arr <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    z_a <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本平均值</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    z_1 <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本最小值</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    n <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本容量</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    tmp <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        tmp <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>z_a<span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span> <span class=\"token comment\"># 中心二阶距</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    t <span class=\"token operator\">=</span> math<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span>tmp<span class=\"token operator\">/</span>n<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>z_a <span class=\"token operator\">-</span> z_1<span class=\"token punctuation\">)</span> <span class=\"token comment\"># t 值</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    t_arr<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>t_arr<span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>reverse<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 对 t 进行排序，方便计算概率分布</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>t_arr_final <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>loop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 格式化列表， 为生成 DataFrame 做准备</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> k <span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">(</span>loop <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        t_arr_final<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>loop<span class=\"token operator\">-</span>k<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>loop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">(</span> k <span class=\"token operator\">==</span> loop <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        t_arr_final<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">(</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">continue</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>data <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>t_arr_final<span class=\"token punctuation\">,</span> columns<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>sns<span class=\"token punctuation\">.</span>scatterplot<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 绘制散点图</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>sns<span class=\"token punctuation\">.</span>lineplot<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">,</span> x<span class=\"token operator\">=</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">,</span>estimator<span class=\"token operator\">=</span><span class=\"token string\">'max'</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">'red'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 绘制分布曲线</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 展示</span></pre></td></tr></table></figure><p><img data-src=\"http://imgcdn.gality.cn/blog/hcs6xb.png\" alt=\"函数概率分布\" /></p>\n<p>当 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>z</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>z</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><msub><mi>z</mi><mi>n</mi></msub></mrow><annotation encoding=\"application/x-tex\">z_1, z_2, ..., z_n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mord\">.</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.04398em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 服从参数为 1 的指数分布时，整体代码不变，只需要将随机值生成时用到的函数改变一下，使生成的随机值满足指数分布即可，代码只需要变动一行：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> math</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> seaborn <span class=\"token keyword\">as</span> sns</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>sns<span class=\"token punctuation\">.</span>set_style<span class=\"token punctuation\">(</span><span class=\"token string\">\"whitegrid\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>t_arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>loop <span class=\"token operator\">=</span> <span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>loop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\"># num_arr = np.random.normal(0,1,1000)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    num_arr <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>exponential<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 使随机值服从指数分布</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    z_a <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本平均值</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    z_1 <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本最小值</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    n <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本容量</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    tmp <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        tmp <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>z_a<span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span> <span class=\"token comment\"># 中心二阶距</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    t <span class=\"token operator\">=</span> math<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span>tmp<span class=\"token operator\">/</span>n<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>z_a <span class=\"token operator\">-</span> z_1<span class=\"token punctuation\">)</span> <span class=\"token comment\"># t 值</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    t_arr<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>t_arr<span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>reverse<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 对 t 进行排序，方便计算概率分布</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>t_arr_final <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>loop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 格式化列表， 为生成 DataFrame 做准备</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> k <span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">(</span>loop <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        t_arr_final<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>loop<span class=\"token operator\">-</span>k<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>loop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">(</span> k <span class=\"token operator\">==</span> loop <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        t_arr_final<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">(</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">continue</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>data <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>t_arr_final<span class=\"token punctuation\">,</span> columns<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>sns<span class=\"token punctuation\">.</span>scatterplot<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 绘制散点图</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>sns<span class=\"token punctuation\">.</span>lineplot<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">,</span> x<span class=\"token operator\">=</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">,</span>estimator<span class=\"token operator\">=</span><span class=\"token string\">'max'</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">'red'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 绘制分布曲线</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 展示</span></pre></td></tr></table></figure><p>其概率分布如下：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/af4s0h.png\" alt=\"指数分布的概率分布\" /></p>\n<h2 id=\"求分位数\"><a class=\"anchor\" href=\"#求分位数\">#</a> 求分位数</h2>\n<p>根据分位数的定义：</p>\n<details class=\"primary\"><summary>分位数定义</summary><div>\n<p>设随机变量 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> 的分布函数为 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">F(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>，对任意给定的实数 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mn>0</mn><mo>&lt;</mo><mi>p</mi><mo>&lt;</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">p(0&lt;p&lt;1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7335400000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">&lt;</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span>，若存在 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>p</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 使得</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo>⩽</mo><msub><mi>x</mi><mi>p</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mi>F</mi><mo stretchy=\"false\">(</mo><msub><mi>x</mi><mi>p</mi></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">P(X \\leqslant x_p ) = F(x_p) = p\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">⩽</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span></span></p>\n<p>则称 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>p</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.716668em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15139200000000003em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">p</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span> 为此概率分布的 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span> 分位数。</p>\n</div></details>\n<p>所以其实本质上就是在分布函数上求某一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>t</mi></mrow><annotation encoding=\"application/x-tex\">t</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.61508em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">t</span></span></span></span>，使得 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>F</mi><mo stretchy=\"false\">(</mo><mi>t</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>t</mi><mi>α</mi></msub></mrow><annotation encoding=\"application/x-tex\">F(t)=t_\\alpha</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">F</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">t</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.0037em;\">α</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，而这一步我们在完成列表向 <code>DataFrame</code>  转化的时候就已经完成了，我们只需要把他找出来就可以了。</p>\n<p>代码如下：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 计算分位数</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>a_1 <span class=\"token operator\">=</span>  data<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>isin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>a_2 <span class=\"token operator\">=</span>  data<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>isin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.05</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>a_3 <span class=\"token operator\">=</span>  data<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>isin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a = 0.1 的分位数为：'</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>a_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a = 0.05 的分位数为：'</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>a_2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a = 0.01 的分位数为：'</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>a_3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p><img data-src=\"http://imgcdn.gality.cn/blog/9vm1ew.png\" alt=\"样本为标准正态分布时的分位数\" /></p>\n<p>同样的代码，也可以求出样本服从指数分布时的分位数：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/4gd3s5.png\" alt=\"样本为指数分布时的分位数\" /></p>\n<h1 id=\"思考题\"><a class=\"anchor\" href=\"#思考题\">#</a> 思考题</h1>\n<p>Monte Carlo 方法计算结果随着样本容量变化时计算误差的变化</p>\n<p>我们分别给出模拟次数为 100、200、1000、10000 次时的概率分布函数曲线：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/e197si.png\" alt=\"不同次数的蒙特卡洛对比图\" /></p>\n<p>我们可以明显看到随着模拟次数的增多，概率分布曲线越来越光滑，意味着其准确度和正确性都有较大提升，这一点也是非常直观的，我们可以考虑更极端一点的，如果只有 10 次模拟次数呢？</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ndkfo2.png\" alt=\"10模拟次数情况下的概率分布曲线\" /></p>\n<p>可以看到，每次的近似概率分布曲线差别非常大，这是符合我们的预期的，当模拟次数较少时，得到的结果的准确度和正确性都有较大误差，无法真实反应统计情况。</p>\n<h1 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h1>\n<p>在深入了解 Monte Carlo 算法后，我有种深深的感触：Monte Carlo 算法简直就是为计算机而生的。计算机解决问题时具有天然的计算优势，对于人类来说，解决问题的过程是拆解问题的过程。通过将复杂问题拆解成一个一个的简单问题，将不能 “计算” 的问题转化成能 “计算” 的问题，也因此，在这种过程中，人类会尽量寻找简单的模型去描述事物，哪怕与实际有些 “失真”，也是可以接受的。计算机则恰恰相反，计算机强在计算能力，强在运算速度，这时，如果还用人类解决问题的方法来让计算机解决问题，那其实就无法发挥出计算机的优势。</p>\n<p>Monte Carlo 算法就从根本上改变了这个问题，就以求面积问题来说，我们无需输入复杂的公式，构造复杂的循环、判断逻辑来计算面积的确切值，只需要使用足够多次的模拟值，就可以以极大把握接受算出的结果，就从这次大作业来看，模拟 1 万次操作也只需 2 秒左右的时间，可谓是找到了计算机解决问题的正确逻辑。</p>\n<p>在学习 “机器学习” 的内容时，了解到机器学习的底层逻辑是基于概率的，那时我还非常不理解为什么依赖是 “概率”，现在想来，统计与概率才是计算机的底层 “基因”，这才是计算机最擅长的东西，感谢这次大作业，感谢 Monte Carlo 算法。</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20veHVtYW9qdW4vcC84NTQxNjM3Lmh0bWw=\">https://www.cnblogs.com/xumaojun/p/8541637.html</span></li>\n<li>孙海燕，周梦等 著，应用数理统计。北京航空航天大学出版社，2008.8</li>\n</ul>\n<h1 id=\"附录\"><a class=\"anchor\" href=\"#附录\">#</a> 附录</h1>\n<p>大作业整体代码如下：</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> math</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>pyplot <span class=\"token keyword\">as</span> plt</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">import</span> seaborn <span class=\"token keyword\">as</span> sns</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>sns<span class=\"token punctuation\">.</span>set_style<span class=\"token punctuation\">(</span><span class=\"token string\">\"whitegrid\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>t_arr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>loop <span class=\"token operator\">=</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>loop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    num_arr <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">.</span>normal<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\"># num_arr = np.random.exponential (1, 1000) # 使随机值服从指数分布</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    z_a <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>mean<span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本平均值</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    z_1 <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本最小值</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    n <span class=\"token operator\">=</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 样本容量</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    tmp <span class=\"token operator\">=</span> <span class=\"token number\">0.0</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        tmp <span class=\"token operator\">+=</span> <span class=\"token punctuation\">(</span>num_arr<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token operator\">-</span>z_a<span class=\"token punctuation\">)</span><span class=\"token operator\">**</span><span class=\"token number\">2</span> <span class=\"token comment\"># 中心二阶距</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    t <span class=\"token operator\">=</span> math<span class=\"token punctuation\">.</span>sqrt<span class=\"token punctuation\">(</span>tmp<span class=\"token operator\">/</span>n<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token punctuation\">(</span>z_a <span class=\"token operator\">-</span> z_1<span class=\"token punctuation\">)</span> <span class=\"token comment\"># t 值</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    t_arr<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>t_arr<span class=\"token punctuation\">.</span>sort<span class=\"token punctuation\">(</span>reverse<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 对 t 进行排序，方便计算概率分布</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>t_arr_final <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>loop<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 格式化列表， 为生成 DataFrame 做准备</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> k <span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">(</span>loop <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">and</span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        t_arr_final<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>loop<span class=\"token operator\">-</span>k<span class=\"token punctuation\">)</span><span class=\"token operator\">/</span>loop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">(</span> k <span class=\"token operator\">==</span> loop <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        t_arr_final<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">elif</span> <span class=\"token punctuation\">(</span>t_arr<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> t_arr<span class=\"token punctuation\">[</span>k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">continue</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>data <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>t_arr_final<span class=\"token punctuation\">,</span> columns<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>sns<span class=\"token punctuation\">.</span>scatterplot<span class=\"token punctuation\">(</span>x<span class=\"token operator\">=</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 绘制散点图</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>sns<span class=\"token punctuation\">.</span>lineplot<span class=\"token punctuation\">(</span>data<span class=\"token operator\">=</span>data<span class=\"token punctuation\">,</span> x<span class=\"token operator\">=</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">,</span> y<span class=\"token operator\">=</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">,</span>estimator<span class=\"token operator\">=</span><span class=\"token string\">'max'</span><span class=\"token punctuation\">,</span> color<span class=\"token operator\">=</span><span class=\"token string\">'red'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 绘制分布曲线</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>plt<span class=\"token punctuation\">.</span>show<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 展示</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\"># 计算分位数</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>a_1 <span class=\"token operator\">=</span>  data<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>isin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>a_2 <span class=\"token operator\">=</span>  data<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>isin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.05</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>a_3 <span class=\"token operator\">=</span>  data<span class=\"token punctuation\">[</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'probability'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>isin<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">0.01</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'value'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>values<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a = 0.1 的分位数为：'</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>a_1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a = 0.05 的分位数为：'</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>a_2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a = 0.01 的分位数为：'</span> <span class=\"token operator\">+</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>a_3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "杂项",
                "数理统计",
                "蒙特卡洛法",
                "大作业"
            ]
        },
        {
            "id": "https://gality.cn/misc/Polar-code-&-channel-polarization%20copy/",
            "url": "https://gality.cn/misc/Polar-code-&-channel-polarization%20copy/",
            "title": "Polar code & channel polarization",
            "date_published": "2023-10-01T07:59:21.000Z",
            "content_html": "<div class=\"note info no-icon\">\n<p><strong>极化码</strong>（Polar code）是一种前向错误更正编码方式，用于讯号传输。</p>\n<p>构造的核心是通过信道极化（channel polarization）处理，在编码侧采用方法使各个子信道呈现出不同的可靠性，当码长持续增加时，部分信道将趋向于容量近于 1 的完美信道（无误码），另一部分信道趋向于容量接近于 0 的纯噪声信道，选择在容量接近于 1 的信道上直接传输信息以逼近信道容量，是首个被证明能够达到香农极限的方法。</p>\n<p>在解码侧，极化后的信道可用简单的逐次干扰抵消解码的方法，以较低的复杂度获得与最大似然解码相近的性能。</p>\n<p>如果你没有信息论基础，请先看 Information Theory Primer 章节。</p>\n</div>\n<h1 id=\"introduction\"><a class=\"anchor\" href=\"#introduction\">#</a> Introduction</h1>\n<p>Polar codes were introduced by Erdal Arıkan in 2009 and they provide the first deterministic construction of capacity-achieving codes for binary memoryless symmetric (BMS) channels.</p>\n<p>Notice that there is only one channel to transmission data, in order to facilitate the understanding, we logically separate one channel to two channel.</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/c0vryg.png\" alt=\"Figure 1\" /></p>\n<p>In particular, consider a setup where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>U</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(U_1, U_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> are two equiprobable bits that are encoded into <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>1</mn></msub><mo>⊕</mo><msub><mi>U</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><msub><mi>U</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X_1, X_2) = (U_1 ⊕ U_2, U_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>. Then, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X_1, X_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> are mapped to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(Y_1, Y_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> by two independent BMS channels with transition probabilities <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>Y</mi><mn>1</mn></msub><mo>=</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><msub><mi>X</mi><mn>1</mn></msub><mo>=</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>P</mi><mo stretchy=\"false\">(</mo><msub><mi>Y</mi><mn>2</mn></msub><mo>=</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><msub><mi>X</mi><mn>2</mn></msub><mo>=</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>W</mi><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">P(Y_1 = y | X_1 = x) = P(Y_2 = y | X_2 = x) = W(y|x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>.  Since the mapping from <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>U</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(U_1, U_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X_1, X_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> is invertible, one finds that</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>U</mi><mn>2</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>X</mi><mn>2</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mo>+</mo><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>2</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mi>I</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I(U_1,U_2;Y_1,Y_2) = I(X_1,X_2;Y_1,Y_2) = I(X_1; Y_1) + I(X_2;Y_2) = 2I(W)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>where <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>C</mi><mo>=</mo><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mi>I</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">C = I(X_1; Y_1) = I(W)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span></span></span></span> is the capacity of symmetric BMS channel because <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>X</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">X_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> is equiprobable and</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo>≜</mo><mstyle scriptlevel=\"0\" displaystyle=\"true\"><munder><mo>∑</mo><mi>y</mi></munder><mi>W</mi><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mn>0</mn><mo stretchy=\"false\">)</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mo stretchy=\"false\">[</mo><mrow><mi>W</mi><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mn>0</mn><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mo stretchy=\"false\">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>W</mi><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mn>0</mn><mo stretchy=\"false\">)</mo><mo>+</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>W</mi><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mn>1</mn><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">]</mo><mo>=</mo><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mstyle></mrow><annotation encoding=\"application/x-tex\">I(W) \\triangleq \\displaystyle\\sum_y W(y|0)log_{2}[{W(y|0)/({\\frac{1}{2}}W(y|0) + \\frac{1}{2}W(y|1))}] = I(X_1;Y_1)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1666699999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">≜</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.707553em;vertical-align:-1.386113em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0500050000000003em;\"><span style=\"top:-1.8999949999999999em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.386113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord\">1</span><span class=\"mclose\">)</span><span class=\"mclose\">)</span></span><span class=\"mclose\">]</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>Thus, the transformation <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><msub><mi>X</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>X</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>1</mn></msub><mo>⊕</mo><msub><mi>U</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><msub><mi>U</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X_1, X_2) = (U_1 ⊕ U_2, U_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">⊕</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span> preserves the sum capacity of the system.</p>\n<p>Also, the chain rule decomposition</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>U</mi><mn>2</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>1</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo><mo>+</mo><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>2</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mi mathvariant=\"normal\">∣</mi><msub><mi>U</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mo>=</mo><mn>2</mn><mi>I</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I(U_1, U_2; Y_1, Y_2) = I(U_1; Y_1, Y_2) + I(U_2; Y_1, Y_2|U_1) = 2I(W)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>implies that one can also achieve the rate <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mi>I</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">2I(W)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span></span></span></span> using two steps. First, information is transmitted through the first virtual channel <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mo>−</mo></msup><mo>:</mo><msub><mi>U</mi><mn>1</mn></msub><mo>→</mo><mo stretchy=\"false\">(</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">W^- : U_1 → (Y_1, Y_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.771331em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.771331em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">−</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>. By coding over multiple channel uses, one can achieve any rate up to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>1</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I(U_1; Y_1, Y_2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>. If all the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>U</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">U_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>’s are known from the first stage, then one can decode the information transmitted through the second virtual channel <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>W</mi><mo>+</mo></msup><mo>:</mo><msub><mi>U</mi><mn>2</mn></msub><mo>→</mo><mo stretchy=\"false\">(</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mo separator=\"true\">,</mo><msub><mi>U</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">W^+ : U_2 → (Y_1, Y_2, U_1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.771331em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.771331em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>. Again, coding allows one to achieve any rate up to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><msub><mi>U</mi><mn>2</mn></msub><mo separator=\"true\">;</mo><msub><mi>Y</mi><mn>1</mn></msub><mo separator=\"true\">,</mo><msub><mi>Y</mi><mn>2</mn></msub><mi mathvariant=\"normal\">∣</mi><msub><mi>U</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I(U_2; Y_1, Y_2|U_1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">∣</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">U</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>.</p>\n<p>If one chooses convolutional codes with sequential decoding, however, the expected decoding-complexity per bit becomes unbounded for rates above the computational cutoff rate</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>R</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn><mo>−</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mrow><mo stretchy=\"false\">(</mo><mn>1</mn><mo>+</mo><mi>Z</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo></mrow></mrow><annotation encoding=\"application/x-tex\">R_0(W) = 1 - log_{2}{(1 + Z(W))}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.72777em;vertical-align:-0.08333em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mclose\">)</span></span></span></span></span></span></p>\n<p>where</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>Z</mi><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo>≜</mo><mstyle scriptlevel=\"0\" displaystyle=\"true\"><munder><mo>∑</mo><mi>y</mi></munder><msqrt><mrow><mi>W</mi><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mn>0</mn><mo stretchy=\"false\">)</mo><mi>W</mi><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mn>1</mn><mo stretchy=\"false\">)</mo></mrow></msqrt></mstyle></mrow><annotation encoding=\"application/x-tex\">Z(W) \\triangleq \\displaystyle\\sum_y \\sqrt{W(y|0)W(y|1) }\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1666699999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">≜</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4361180000000004em;vertical-align:-1.386113em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0500050000000003em;\"><span style=\"top:-1.8999949999999999em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.386113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.983875em;\"><span class=\"svg-align\" style=\"top:-3.2em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"mord\" style=\"padding-left:1em;\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord\">0</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span><span style=\"top:-2.9438750000000002em;\"><span class=\"pstrut\" style=\"height:3.2em;\"></span><span class=\"hide-tail\" style=\"min-width:1.02em;height:1.28em;\"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119\nc34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120\nc340,-704.7,510.7,-1060.3,512,-1067\nl0 -0\nc4.7,-7.3,11,-11,19,-11\nH40000v40H1012.3\ns-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232\nc-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1\ns-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26\nc-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z\nM1001 80h400000v40h-400000z'/></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.25612499999999994em;\"><span></span></span></span></span></span></span></span></span></span></p>\n<p>is the Bhattacharyya parameter of the channel . Arıkan’s key observation was that, while the sum capacity of the two virtual channels is preserved, the sum cutoff rate satisfies</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>R</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><msup><mi>W</mi><mo>+</mo></msup><mo stretchy=\"false\">)</mo><mo>+</mo><msub><mi>R</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><msup><mi>W</mi><mo>−</mo></msup><mo stretchy=\"false\">)</mo><mo>≥</mo><mn>2</mn><msub><mi>R</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">R_0(W^+) + R_0(W^-) ≥ 2R_0(W)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.071331em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.821331em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">+</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.071331em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.821331em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">−</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">≥</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">2</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>with equality <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>R</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>W</mi><mo stretchy=\"false\">)</mo><mo>∈</mo><mrow><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn></mrow></mrow><annotation encoding=\"application/x-tex\">R_0(W) ∈ {0, 1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8388800000000001em;vertical-align:-0.19444em;\"></span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span></span></span></span></span>. Thus, repeated transformations of this type cause the implied virtual channels to polarize into extremal channels whose capacities approach 0 or 1. But, for these extremal channels, coding is trivial and one either sends an information bit or a dummy bit. From a theoretical point of view, polar codes are beautifully simple. Practically, they approach capacity rather slowly as their blocklength increases. Still, based on recent advances, they have been chosen as the short-block codes for the 5G standard.</p>\n<h1 id=\"information-theory-primer\"><a class=\"anchor\" href=\"#information-theory-primer\">#</a> Information Theory Primer</h1>\n<h2 id=\"discrete-random-variables\"><a class=\"anchor\" href=\"#discrete-random-variables\">#</a> Discrete Random variables</h2>\n<p>A discrete random variable <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> is completely defined by the set of values it can take, $\\mathcal{X} $ , which we assume to be a finite set, and its probability distribution <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mo fence=\"true\">{</mo><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo fence=\"true\">}</mo></mrow><mrow><mi>x</mi><mo>∈</mo><mi mathvariant=\"script\">X</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\left \\{p(x) \\right \\}_{x \\in \\mathcal{X} }</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.07707em;vertical-align:-0.32706999999999997em;\"></span><span class=\"minner\"><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">{</span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mclose delimcenter\" style=\"top:0em;\">}</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.17863099999999998em;\"><span style=\"top:-2.4003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">∈</span><span class=\"mord mtight\"><span class=\"mord mathcal mtight\" style=\"margin-right:0.14643em;\">X</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32706999999999997em;\"><span></span></span></span></span></span></span></span></span></span> .</p>\n<p><strong>Definition.</strong> The value <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">p(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> is the probability that the random variable <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> takes the value <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>. The probability distribution p : <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">X</mi><mo>→</mo><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1</mn><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\mathcal{X}  → [0, 1]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathcal\" style=\"margin-right:0.14643em;\">X</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">]</span></span></span></span> must satisfy the normalization condition:</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mstyle scriptlevel=\"0\" displaystyle=\"true\"><munder><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><mi>χ</mi></mrow></munder><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mn>1</mn></mstyle></mrow><annotation encoding=\"application/x-tex\">\\displaystyle\\sum_{x \\in \\chi} p(x) = 1\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4361180000000004em;vertical-align:-1.386113em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0500050000000003em;\"><span style=\"top:-1.8999949999999999em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">∈</span><span class=\"mord mathnormal mtight\">χ</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.386113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span></span></p>\n<p>We shall denote by <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">P</mi><mo stretchy=\"false\">(</mo><mi>A</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\mathbb{P}(A)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">P</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">A</span><span class=\"mclose\">)</span></span></span></span> the probability of an event $A \\subseteq \\mathcal{X} $, so that <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi mathvariant=\"double-struck\">P</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo>=</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">p(x) = \\mathbb{P}(X=x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">P</span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span></p>\n<h2 id=\"self-information\"><a class=\"anchor\" href=\"#self-information\">#</a> Self-information</h2>\n<p>Claude Shannon's definition of self-information was chosen to meet several axioms:</p>\n<ol>\n<li>An event with probability 100% is perfectly unsurprising and yields no information.</li>\n<li>The less probable an event is, the more surprising it is and the more information it yields.</li>\n<li>If two independent events are measured separately, the total amount of information is the sum of the self-informations of the individual events.</li>\n</ol>\n<p>The units of information in follow formula is 'bit':</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mfrac><mn>1</mn><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mo stretchy=\"false\">(</mo><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I(x) = \\log_{2}({1 \\over p(x)}) = -\\log_{2}({p(x)})\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.25744em;vertical-align:-0.936em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>The concept of self-information is associated with variable values based on the observation of an information source. Consequently, multiple different values will be used to describe the same <span class=\"exturl\" data-url=\"aHR0cDovL3NvdXJjZS5Jbg==\">source.In</span> order to avoid this situation, we introduce the concept of entropy.</p>\n<h2 id=\"entropy\"><a class=\"anchor\" href=\"#entropy\">#</a> Entropy</h2>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/k95c3u.png\" alt=\"entropy\" height=\"261\" width=\"378\" /></p>\n<p><strong>Definition .</strong> The entropy (unit: bit/sig) of a discrete random variable <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> with probability distribution <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">p(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span> is denoted</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo stretchy=\"false\">)</mo><mo>≜</mo><mstyle scriptlevel=\"0\" displaystyle=\"true\"><munder><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><mi>χ</mi></mrow></munder><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mfrac><mn>1</mn><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo>=</mo><mi mathvariant=\"double-struck\">E</mi><mo stretchy=\"false\">[</mo><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mfrac><mn>1</mn><mrow><mi>p</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo stretchy=\"false\">]</mo></mstyle></mrow><annotation encoding=\"application/x-tex\">H(X) \\triangleq \\displaystyle\\sum_{x \\in \\chi} p(x) \\log_{2}{1\\over p(x)} = \\mathbb{E} [\\log_{2}{1\\over p(x)}]\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1666699999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">≜</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.707553em;vertical-align:-1.386113em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0500050000000003em;\"><span style=\"top:-1.8999949999999999em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">∈</span><span class=\"mord mathnormal mtight\">χ</span></span></span></span><span style=\"top:-3.050005em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.386113em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.25744em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">E</span></span><span class=\"mopen\">[</span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mclose\">]</span></span></span></span></span></p>\n<p>The unit of entropy is determined by the base of the logarithm with base-2 resulting in “bits” and the natural log (i.e., base-e) resulting in “nats”.</p>\n<p>The <strong>understanding</strong> of entropy：</p>\n<ol>\n<li>Refers to the <strong>mathematical expectation</strong> of the self-information of various messages output by the information source, which is the average self-information of the source.</li>\n<li>Describe the <strong>average uncertainty</strong> of the information source <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span></li>\n<li>Describe the average amount of information <strong>carried by</strong> each source symbol</li>\n</ol>\n<h3 id=\"joint-entropy\"><a class=\"anchor\" href=\"#joint-entropy\">#</a> joint entropy</h3>\n<p><strong>Definition .</strong> The <strong>joint entropy</strong> (in bits) of a pair of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>∽</mo><msub><mi>p</mi><mrow><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X, Y) \\backsim p_{X, Y}(x, y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">∽</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.328331em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span> is denoted</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>≜</mo><mstyle scriptlevel=\"0\" displaystyle=\"true\"><munder><mo>∑</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo>∈</mo><mrow><mi mathvariant=\"script\">X</mi><mo>×</mo><mi mathvariant=\"script\">Y</mi></mrow></mrow></munder><msub><mi>p</mi><mrow><mi>X</mi><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mfrac><mn>1</mn><mrow><msub><mi>p</mi><mrow><mi>X</mi><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo>=</mo><mi mathvariant=\"double-struck\">E</mi><mo stretchy=\"false\">[</mo><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mfrac><mn>1</mn><mrow><msub><mi>p</mi><mrow><mi>X</mi><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo stretchy=\"false\">]</mo></mstyle></mrow><annotation encoding=\"application/x-tex\">H(X, Y) \\triangleq \\displaystyle\\sum_{(x, y) \\in \\mathcal{X\\times Y}  } p_{XY}(x, y) \\log_{2}{1\\over p_{XY}(x, y)} = \\mathbb{E} [\\log_{2}{1\\over p_{XY}(x, y)}]\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1666699999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">≜</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.8374449999999998em;vertical-align:-1.516005em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.808995em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose mtight\">)</span><span class=\"mrel mtight\">∈</span><span class=\"mord mtight\"><span class=\"mord mathcal mtight\" style=\"margin-right:0.14643em;\">X</span><span class=\"mbin mtight\">×</span><span class=\"mord mathcal mtight\" style=\"margin-right:0.08222em;\">Y</span></span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.516005em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.25744em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">E</span></span><span class=\"mopen\">[</span><span class=\"mop\"><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.20696799999999996em;\"><span style=\"top:-2.4558600000000004em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.24414em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mclose\">]</span></span></span></span></span></p>\n<p>Notice that this is identical to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>Z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H (Z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span><span class=\"mclose\">)</span></span></span></span> with <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Z</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Z = (X, Y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">Z</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span></span></span></span>.</p>\n<h3 id=\"conditional-entropy\"><a class=\"anchor\" href=\"#conditional-entropy\">#</a> conditional entropy</h3>\n<p>For a pair of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>∽</mo><msub><mi>p</mi><mrow><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X, Y ) \\backsim p_{X,Y} (x, y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">∽</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.328331em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>, the <strong>conditional entropy</strong> (in bits) of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> given <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> is denoted</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mi mathvariant=\"normal\">∣</mi><mi>X</mi><mo stretchy=\"false\">)</mo><mo>≜</mo><msub><mi>p</mi><mrow><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mfrac><mn>1</mn><mrow><msub><mi>p</mi><mrow><mi>Y</mi><mi mathvariant=\"normal\">∣</mi><mi>X</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo>=</mo><mi mathvariant=\"double-struck\">E</mi><mo stretchy=\"false\">[</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mfrac><mn>1</mn><mrow><msub><mi>p</mi><mrow><mi>Y</mi><mi mathvariant=\"normal\">∣</mi><mi>X</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>y</mi><mi mathvariant=\"normal\">∣</mi><mi>x</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">H(Y|X) \\triangleq p_{X,Y}(x,y)log_{2}{1 \\over p_{Y|X}(y|x)} = \\mathbb{E}[log_{2}{1 \\over p_{Y|X}(y|x)}]\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1666699999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">≜</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.36264em;vertical-align:-1.0412em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.328331em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord mtight\">∣</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0412em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.36264em;vertical-align:-1.0412em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">E</span></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.32144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.34480000000000005em;\"><span style=\"top:-2.5198em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord mtight\">∣</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3551999999999999em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.0412em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mclose\">]</span></span></span></span></span></p>\n<p>conditional entropy <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mi mathvariant=\"normal\">∣</mi><mi>X</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(Y|X)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span></span></span></span> means the uncertainty of the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> when the <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> is known.</p>\n<h3 id=\"mutual-information\"><a class=\"anchor\" href=\"#mutual-information\">#</a> mutual information</h3>\n<p><strong>Definition .</strong> For a pair of <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>∽</mo><msub><mi>p</mi><mrow><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(X, Y ) \\backsim p_{X,Y} (x, y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">∽</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.036108em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.328331em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>, the <strong>mutual information</strong> (in bits) between <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> is denoted</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">;</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>≜</mo><mstyle scriptlevel=\"0\" displaystyle=\"true\"><munder><mo>∑</mo><mrow><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mo>∈</mo><mrow><mi mathvariant=\"script\">X</mi><mo>×</mo><mi mathvariant=\"script\">Y</mi></mrow></mrow></munder><msub><mi>p</mi><mrow><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mfrac><mrow><msub><mi>p</mi><mrow><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><mrow><msub><mi>P</mi><mi>X</mi></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><msub><mi>p</mi><mi>Y</mi></msub><mo stretchy=\"false\">(</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo>=</mo><mi mathvariant=\"double-struck\">E</mi><mo stretchy=\"false\">[</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mfrac><mrow><msub><mi>p</mi><mrow><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi></mrow></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><mrow><msub><mi>P</mi><mi>X</mi></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><msub><mi>p</mi><mi>Y</mi></msub><mo stretchy=\"false\">(</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow></mfrac><mo stretchy=\"false\">]</mo></mstyle></mrow><annotation encoding=\"application/x-tex\">I(X;Y) \\triangleq \\displaystyle\\sum_{(x,y) \\in \\mathcal{X\\times Y}}p_{X,Y}(x,y)log_{2}{p_{X,Y}(x,y) \\over P_X(x)p_Y(y)} = \\mathbb{E}[log_{2}{p_{X,Y}(x,y) \\over P_X(x)p_Y(y)}]\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1666699999999999em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel amsrm\">≜</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.9430050000000003em;vertical-align:-1.516005em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.050005em;\"><span style=\"top:-1.808995em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose mtight\">)</span><span class=\"mrel mtight\">∈</span><span class=\"mord mtight\"><span class=\"mord mathcal mtight\" style=\"margin-right:0.14643em;\">X</span><span class=\"mbin mtight\">×</span><span class=\"mord mathcal mtight\" style=\"margin-right:0.08222em;\">Y</span></span></span></span></span><span style=\"top:-3.0500049999999996em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.516005em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.328331em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.328331em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.363em;vertical-align:-0.936em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">E</span></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.427em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">p</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.328331em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct mtight\">,</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.22222em;\">Y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.936em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mclose\">]</span></span></span></span></span></p>\n<h3 id=\"lemma\"><a class=\"anchor\" href=\"#lemma\">#</a> Lemma</h3>\n<p><strong>Lemma .</strong> Basic properties of joint entropy and mutual information:</p>\n<ol>\n<li>(<em>chain rule of entropy</em>) <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mi mathvariant=\"normal\">∣</mi><mi>X</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H (X, Y) = H (X) + H (Y|X)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span></span></span></span>. If <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>X</mi></mrow><annotation encoding=\"application/x-tex\">X</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span></span></span></span> and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Y</mi></mrow><annotation encoding=\"application/x-tex\">Y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span></span></span></span> are independent, <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">H(X, Y) = H(X) + H(Y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span></span></span></span>.</li>\n<li>The mutual information satisfies <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">;</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>I</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mo separator=\"true\">;</mo><mi>X</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I(X; Y) = I(Y ; X)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span></span></span></span> and</li>\n</ol>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>I</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">;</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo stretchy=\"false\">)</mo><mo>+</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>−</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo separator=\"true\">,</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mo stretchy=\"false\">)</mo><mo>−</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>X</mi><mi mathvariant=\"normal\">∣</mi><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mo stretchy=\"false\">)</mo><mo>−</mo><mi>H</mi><mo stretchy=\"false\">(</mo><mi>Y</mi><mi mathvariant=\"normal\">∣</mi><mi>X</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">I(X;Y) = H(X) + H(Y) - H(X,Y) = H(X) -H(X|Y) = H(Y) - H(Y|X)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.16666666666666666em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.08125em;\">H</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">Y</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">X</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<h1 id=\"references\"><a class=\"anchor\" href=\"#references\">#</a> References</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU2JUE1JUI1JUU1JThDJTk2JUU3JUEyJUJD\">https://zh.wikipedia.org/wiki/ 極化碼</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3BmaXN0ZXIuZWUuZHVrZS5lZHUvY291cnNlcy9lY2VuNjU1L3BvbGFyLnBkZg==\">http://pfister.ee.duke.edu/courses/ecen655/polar.pdf</span></li>\n</ul>\n",
            "tags": [
                "杂项",
                "极化码",
                "信道极化",
                "信道编码",
                "通信"
            ]
        },
        {
            "id": "https://gality.cn/note/PNT/timing/",
            "url": "https://gality.cn/note/PNT/timing/",
            "title": "授时过程详述",
            "date_published": "2023-09-29T08:17:34.000Z",
            "content_html": "<h1 id=\"时间的产生\"><a class=\"anchor\" href=\"#时间的产生\">#</a> 时间的产生</h1>\n<h2 id=\"时间的历史\"><a class=\"anchor\" href=\"#时间的历史\">#</a> 时间的历史</h2>\n<p>时间其实有两个内涵：一个是时刻，一个是时间间隔。比如我们通知会议 “明天上午 8 点开会，会期半天”，会议开始时间就是时刻，会期就是时间间隔。</p>\n<h3 id=\"世界时ut\"><a class=\"anchor\" href=\"#世界时ut\">#</a> 世界时（UT）</h3>\n<p><strong>原理</strong>：地球每天都在自转，相对稳定的自转特性使地球成为一个天然的时钟。天空的恒星好比钟面上的刻度，天文学家使用的望远镜或者其他观星仪器好比钟面上的指针，当望远镜对准某颗恒星时，我们就知道了它指示的准确时刻（看上去 “指针” 不动，“钟面” 在转动），这种方法测定的时间叫做 “世界时”。</p>\n<p><strong>定义</strong>：世界时的一天就是太阳两次过头顶的时间间隔，而一秒则是一天的 1/86400。（24 小时乘以 60 分乘以 60 秒）</p>\n<p><strong>问题</strong>：地球自转速率受月球等天体摄动的影响（存在着潮汐现象），以及天文观测的技术能力限制，世界时的测量只能达到毫秒量级，远不能满足人类发展航天技术、精密测地等需求。</p>\n<h3 id=\"原子时at\"><a class=\"anchor\" href=\"#原子时at\">#</a> 原子时（AT）</h3>\n<p><strong>原理</strong>：随着量子力学的发展，实验发现一些分子和原子内部的量子跃迁能够产生周期非常稳定的信号，非常适合时间测量，于是人们就开始研制原子钟，原子钟也成了人类最早应用量子力学研制的测量仪器；</p>\n<p><strong>定义</strong>：使用原子能级跃迁时释放的精确微波讯号来计时。秒长定义为铯 -133 原子基态的两个超精细能级间在零磁场下跃迁辐射 9192631770 周所持续的时间。</p>\n<p><strong>分类</strong>：</p>\n<ul>\n<li>守时型原子钟：守时型原子钟环境适应性强，能够常年连续可靠运行，用于连续产生和记录时间信号。</li>\n<li>基准型原子钟：基准型原子钟则更为精准，通过调整和控制外界电磁场振荡频率，使原子能级跃迁概率始终保持最大，使得外加电磁场振荡频率和原子辐射或吸收电磁波频率一样，从而获得更加精准的时间频率。<br />\n<strong>铯原子喷泉钟</strong>是目前世界上最好的基准型原子钟。</li>\n<li>用于北斗卫星导航的星载钟、仪器中使用的芯片大小的微型原子钟、光钟等等</li>\n</ul>\n<p><strong>问题</strong>：原子钟提供原子时，十分稳定，用于测量时间间隔，但是它没有确切的时刻含义。</p>\n<h3 id=\"协调世界时utc\"><a class=\"anchor\" href=\"#协调世界时utc\">#</a> 协调世界时（UTC）</h3>\n<p>世界时秒长不够稳定，但是它的时刻对应着太阳在天空中的特定位置，反映着地球在空间自转角度的变化，与地极坐标等一起构成地球定向参数，与人们日常生活密切相关。我们熟知的大地测量、天文观测、飞行器跟踪定位，以及战略武器试验等都需要世界时。</p>\n<p>世界时具有重要应用价值，而一些精密物理测量研究则需要稳定的原子时。在应用需求上，这形成了一对矛盾。</p>\n<p>1958 年 1 月 1 日 0 时，科学家把 “原子时” 和 “世界时” 对准，同时开始运行。但随着时间的推移，受潮汐作用等的影响，两者差异越来越大，地球自转速率长期变慢。为了解决这一问题，人们引入另外一种非常重要的时间尺度，叫 “协调世界时”，它利用原子时的均匀性，采用原子时的 “秒长”，而在 “时刻” 上尽量靠近世界时。当它与世界时的偏差接近 0.9 秒时，全世界在同一时间，统一对协调世界时进行加 1 秒或减 1 秒的调整，这就是我们所说的 “闰秒”。</p>\n<p>1972 年，协调世界时正式成为国际标准时间。</p>\n<p>PS：1972 年之前，格林威治时间（GMT）一直是世界时间的标准，在不需要精确到秒的情况下，二者可以视为等同。每年格林尼治天文台会发调时信息，基于 UTC。</p>\n<h2 id=\"全球校准\"><a class=\"anchor\" href=\"#全球校准\">#</a> 全球校准</h2>\n<ol>\n<li>全球不同国家和地区的 90 个守时实验室，有 500 多台守时型原子钟，每天通过卫星进行时间比对。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlwbS5vcmcvZW4v\">国际权度局</span>根据每个原子钟的性能，利用专门的算法计算得到一个稳定的自由原子时</li>\n<li>通过运行在部分守时实验室的十几台基准型原子钟，其中主要是铯原子喷泉钟，对这个自由原子时进行校准，形成既稳定又准确的国际原子时（TAI）数据。</li>\n<li>根据国际地球自转服务组织提供的世界时测量数据，对国际原子时进行闰秒调整，形成了国际标准时间，即协调世界时。</li>\n<li>正常情况下，国际权度局一个月给出一个结果「例如：Final Report: CCTF-K001.UTC (2023-08)」，用于各国的标准时间与国际进行比对，各国会使用该时间对自身时间进行校准。</li>\n</ol>\n<h2 id=\"北京时间\"><a class=\"anchor\" href=\"#北京时间\">#</a> 北京时间</h2>\n<div class=\"note primary no-icon\">\n<p><strong>即然已经有了国际标准时间，我们为什么还要产生我们自己的北京时间？</strong></p>\n<p>因为国际标准时间不是一个实际的物理信号，是滞后一个月发布的一个纸面数据。而我们需要的是真正能实时应用的实际物理信号。所以北京时间应该是国际标准时间在中国的一个具体实现，是中国版的协调世界时。</p>\n</div>\n<h3 id=\"定义\"><a class=\"anchor\" href=\"#定义\">#</a> 定义</h3>\n<ul>\n<li>\n<p>全世界的时间采用<strong>区时制</strong>，我们按照地理经度把全球划分为<strong> 24 个时区</strong>，每个时区以其<strong>中央经线</strong>所在的地方时作为该时区的标准时间。</p>\n</li>\n<li>\n<p>1949 年 9 月，在中国人民政治协商会议第一届全体会议上，确定了新中国的标准时间是首都北京所在的<strong>东八区区时</strong>，即东经 120 度经线所在的地方。</p>\n</li>\n<li>\n<p>北京市当地时间，与北京时间有一定的差异，因为北京的地理经度为东经 116°21′，并不是东经 120 度；西安的地方时比 “北京时间” 晚了大约 44 分钟。</p>\n</li>\n</ul>\n<h3 id=\"生成\"><a class=\"anchor\" href=\"#生成\">#</a> 生成</h3>\n<ul>\n<li>” 北京时间 “在西安临潼的国家授时中心产生，使用了 40 多台不同性能的守时型原子钟，综合产生连续稳定的原子时，利用铯原子喷泉基准钟对其进行校准。按照国际统一部署对其进行闰秒，与世界时进行协调，形成我国的标准时间。</li>\n<li>我们的原子钟每天参与国际比对，正常情况下，我们应用滞后 1 个月的反馈数据进行校准，这样实现了北京时间与国际标准时间的一致性，专业上称 “时间溯源”。其实，各国标准时间都是这样产生的。</li>\n</ul>\n<h1 id=\"时间的分发\"><a class=\"anchor\" href=\"#时间的分发\">#</a> 时间的分发</h1>\n<h2 id=\"时间换算\"><a class=\"anchor\" href=\"#时间换算\">#</a> 时间换算</h2>\n<ul>\n<li>1 秒 (s) ＝ 1000 毫秒 (ms)</li>\n<li>1 毫秒 (ms) ＝ 1000 微秒 (us)</li>\n<li>1 微秒 (us) ＝ 1000 纳秒 (ns)</li>\n<li>1 纳秒 (ns) ＝ 1000 皮秒 (ps)</li>\n<li>1 皮秒 (ps) = 1000 飞秒 (fs)</li>\n<li>1 飞秒 (fs) = 1000 阿秒 (zs)</li>\n</ul>\n<p>阿秒 (AttoSecond) 是目前实验上能测量的最小时间尺度。</p>\n<h2 id=\"授时方式\"><a class=\"anchor\" href=\"#授时方式\">#</a> 授时方式</h2>\n<p>按授时精度从低到高排序：</p>\n<ol>\n<li>地基短波授时（波长 20-120 米）主要依靠电离层反射来传播时间信号，毫秒量级</li>\n<li>地基长波授时（波长 3 公里），百纳秒量级</li>\n<li>电话 / 网络授时，依靠网络中的时间服务器以及 NTP/PTP 协议授时，百纳秒量级</li>\n<li>北斗卫星系统，10 纳秒量级</li>\n<li>地基光纤授时，百皮秒量级</li>\n<li>空间站时间频率实验系统，10 皮秒量级</li>\n</ol>\n<h2 id=\"高精度授时时间同步技术\"><a class=\"anchor\" href=\"#高精度授时时间同步技术\">#</a> 高精度授时时间同步技术</h2>\n<h3 id=\"卫星授时技术\"><a class=\"anchor\" href=\"#卫星授时技术\">#</a> 卫星授时技术</h3>\n<ul>\n<li>卫星校准：星载原子钟 + 地面站校准</li>\n<li>卫星授时：导航电文中提供了当前时刻所在的 “周数”，这个周数是从北斗或者 GPS 系统的起始时间开始计数的，另外通过计算调制在载波上的伪随机码的信息可以知道当前的周内秒，有了这些信息就可以计算出卫星播报的绝对时间了，利用这个绝对时间来授时。</li>\n</ul>\n<h4 id=\"卫星单向法\"><a class=\"anchor\" href=\"#卫星单向法\">#</a> 卫星单向法</h4>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/6pt7rj.jpg\" alt=\"卫星单向法\" /></p>\n<p>人们平时使用的手机 GPS 授时导航定位、车载 GPS 授时导航定位，以及能接收军码的军用设施授时定位就是卫星单向法的典型应用。这种方法能够满足大多数中低同步精度要求的用户，应用最为广泛。</p>\n<p>GNSS 接收设备能够单向接收导航卫星所播发的<strong>导航电文</strong>。导航电文之中包含<strong>时间基准信息</strong>、<strong>导航卫星星历</strong>和<strong>电文发播时刻</strong>等信息。用户至少需要接收来自<strong>四颗导航卫星</strong>的信号，综合解析这些卫星的报文信息，以此求解三维位置和接收机本地时间四个变量，计算并修正自身时标体系，最终完成本地时定时。如果能收到多于四颗卫星的信号，会提高授时定位精度，并加快计算响应时间。</p>\n<p>假设卫星在<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>s</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> (星载原子钟时间) 时刻播发导航电文，用户在<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>u</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> (终端设备时间) 时刻接收到该报文，则卫星和设备之间的伪时延为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>δ</mi><msub><mi>t</mi><mrow><mi>s</mi><mi>u</mi></mrow></msub><mo>=</mo><msub><mi>t</mi><mi>u</mi></msub><mo>−</mo><msub><mi>t</mi><mi>s</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\delta t_{su} = t_u-t_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">u</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，这时接收设备和卫星的时间差值为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.15999999999999992em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>Δ</mi><msub><mi>t</mi><mrow><mi>s</mi><mi>u</mi></mrow></msub><mo>=</mo><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><msub><mi>d</mi><mrow><mi>s</mi><mi>u</mi></mrow></msub><mi>c</mi></mfrac></mstyle><mo>−</mo><mi>δ</mi><msub><mi>t</mi><mrow><mi>s</mi><mi>u</mi></mrow></msub><mo>−</mo><msub><mi>ε</mi><mrow><mi>s</mi><mi>u</mi></mrow></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin {array}{c}\n\n\\varDelta t_{su} = \\dfrac{d_{su}}{c} - \\delta t_{su} - \\varepsilon_{su}\n\n\\end {array}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.05744em;vertical-align:-0.77872em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.2787200000000003em;\"><span style=\"top:-3.27872em;\"><span class=\"pstrut\" style=\"height:3.3714399999999998em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathit\">Δ</span></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.37144em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03785em;\">δ</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ε</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.77872em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></span></p>\n<p>其中<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mrow><mi>s</mi><mi>u</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">d_{su}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是卫星和接收设备之间的距离，由卫星星历可知卫星所在的位置，由四颗卫星的报文可解算得到接收位置的坐标，由两者可以得到<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mrow><mi>s</mi><mi>u</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">d_{su}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，c 是光速，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>ε</mi><mrow><mi>s</mi><mi>u</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\varepsilon_{su}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ε</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">u</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是传输过程中的误差。单向法的误差来源是卫星位置与星历的偏差、电离层层扰动以及接收设备误差等。能接收到多颗卫星信号，并进行长时间平均的十分理想的情况下，该方法可以达到接近 1ns 左右的时标同步精度。</p>\n<h4 id=\"卫星共视法\"><a class=\"anchor\" href=\"#卫星共视法\">#</a> 卫星共视法</h4>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/iq0ctd.png\" alt=\"卫星共视法\" /></p>\n<p>两个地面站 A 和 B 同时观测一枚 GNSS 卫星，卫星在<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>s</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 时刻广播发出报文。如果两个地面站分别距离卫星<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">d_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>d</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">d_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.84444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>，则传输时间延迟分别是<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>τ</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\tau_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>τ</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\tau_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.58056em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>。A 和 B 两地的电子计数器分别在<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 接收本地产生的时标信号作为开门信号，接收到来自导航卫星的信号时关门，计数器的测量值如下式所示：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.15999999999999992em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>A</mi></msub><mo>=</mo><msub><mi>t</mi><mi>A</mi></msub><mo>−</mo><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>s</mi></msub><mo>+</mo><msub><mi>τ</mi><mi>A</mi></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>B</mi></msub><mo>=</mo><msub><mi>t</mi><mi>B</mi></msub><mo>−</mo><mo stretchy=\"false\">(</mo><msub><mi>t</mi><mi>s</mi></msub><mo>+</mo><msub><mi>τ</mi><mi>B</mi></msub><mo stretchy=\"false\">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin {array}{c}\n\nTIC_A = t_A - (t_s + \\tau_A) \\\\\n\nTIC_B = t_B - (t_s + \\tau_B)\n\n\\end {array}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4000000000000004em;vertical-align:-0.9500000000000004em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.151392em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">s</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></span></p>\n<p>之后可以求得 A 地和 B 地的钟差为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Δ</mi><mi>t</mi><mo>=</mo><msub><mi>t</mi><mi>A</mi></msub><mo>−</mo><msub><mi>t</mi><mi>B</mi></msub><mo>=</mo><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>A</mi></msub><mo>−</mo><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>B</mi></msub><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>τ</mi><mi>A</mi></msub><mo>−</mo><msub><mi>τ</mi><mi>B</mi></msub><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\varDelta t = t_A - t_B = TIC_A - TIC_B + (\\tau_A - \\tau_B)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.68333em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord mathit\">Δ</span></span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.1132em;\">τ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.1132em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>，上式中消去了卫星星载钟时间参考系内的时刻值 ts，这样卫星星载钟的误差就不会对共视法的同步精度造成影响。</p>\n<h4 id=\"卫星双向时频传递法twstft\"><a class=\"anchor\" href=\"#卫星双向时频传递法twstft\">#</a> 卫星双向时频传递法（TWSTFT）</h4>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/bnsp9s.png\" alt=\"卫星双向时频传递法\" /></p>\n<p>目前较为成熟的卫星时频同步方法，精度较高，应用也最为广泛。BIPM 推荐利用该方法同步协调散布于世界各地的原子钟，各地的原子钟信号经过分析调整之后合成国际原子时 (TAI) 和世界协调时 (UTC)。卫星双向时间频率传递的优点是两地面站间信号的传播路径是近似对称的，这样一来，电离层扰动、对流层扰动、几何路径不对称等<strong>误差的影响大部分将被抵消</strong>。</p>\n<p>以两站点时间同步过程为例：</p>\n<p>两站把时标脉冲信号调制到载波上再向卫星发送，卫星分别将信号转发到目标站。每个站均利用时间间隔计数器测量接收到的对方传来的时间脉冲信号和本站产生的时间脉冲信号之间的差值。如下式所示，A 站和 B 站的计数器测量值分别为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.15999999999999992em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>A</mi></msub><mo>=</mo><msub><mi>T</mi><mi>A</mi></msub><mo>−</mo><msub><mi>T</mi><mi>B</mi></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>B</mi><mi>T</mi><mi>X</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>B</mi><mi>U</mi><mi>P</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>S</mi><mi>B</mi><mi>A</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>D</mi><mi>o</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>R</mi><mi>X</mi></mrow></msub><mo>+</mo><msub><mi>S</mi><mi>B</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>B</mi></msub><mo>=</mo><msub><mi>T</mi><mi>B</mi></msub><mo>−</mo><msub><mi>T</mi><mi>A</mi></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>T</mi><mi>X</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>U</mi><mi>P</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>S</mi><mi>A</mi><mi>B</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>B</mi><mi>D</mi><mi>o</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>B</mi><mi>R</mi><mi>X</mi></mrow></msub><mo>+</mo><msub><mi>S</mi><mi>A</mi></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin {array}{c}\n\nTIC_A = T_A - T_B + t_{BTX} + t_{BUP} + t_{SBA} + t_{ADo} + t_{ARX} + S_B \\\\\n\nTIC_B = T_B - T_A + t_{ATX} + t_{AUP} + t_{SAB} + t_{BDo} + t_{BRX} + S_A\n\n\\end {array}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4000000000000004em;vertical-align:-0.9500000000000004em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">U</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\">A</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal mtight\">o</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">U</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal mtight\">o</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></span></p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">TIC_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">TIC_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 分别是 A 站和 B 站的时间间隔计数器测量值</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">T_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">T_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 分别是 A 站和 B 站的主钟时间值</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>A</mi><mi>T</mi><mi>X</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{ATX}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>B</mi><mi>T</mi><mi>X</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{BTX}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 分别是 A 站和 B 站内部的发射时延值；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>A</mi><mi>U</mi><mi>P</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{AUP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">U</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>B</mi><mi>U</mi><mi>P</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{BUP}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">U</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 分别是 A 站和 B 站的信号上行传输时延值；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>S</mi><mi>B</mi><mi>A</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{SBA}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\">A</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>S</mi><mi>A</mi><mi>B</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{SAB}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 分别是 GNSS 卫星将信号由 B 站转到 A 站和由 A 站转到 B 站的转发时延值；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>A</mi><mi>D</mi><mi>o</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{ADo}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal mtight\">o</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>B</mi><mi>D</mi><mi>o</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{BDo}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal mtight\">o</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 分别是 A 站和 B 站接收卫星信号下行的传输时延值；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>A</mi><mi>R</mi><mi>X</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{ARX}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>B</mi><mi>R</mi><mi>X</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{BRX}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 分别是 A 站和 B 站内部的接收时延值；</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>S</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">S_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 和<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>S</mi><mi>B</mi></msub></mrow><annotation encoding=\"application/x-tex\">S_B</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 分别是 A 站和 B 站的 Sagnac 效应修正量，两者大小严格相等，正负相反。</li>\n</ul>\n<p>A 站和 B 站进行通信，交换两地测得的时间间隔计数器读数值，TICA 和 TICB 两值相减可以求得 A 站和 B 站两地的主钟钟差，如下式所示：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.15999999999999992em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>T</mi><mi>A</mi></msub><mo>−</mo><msub><mi>T</mi><mi>B</mi></msub><mo>=</mo><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mrow><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>A</mi></msub><mo>−</mo><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>B</mi></msub></mrow><mn>2</mn></mfrac></mstyle><mo>+</mo><msub><mi>t</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msub><mo>+</mo><mstyle displaystyle=\"true\" scriptlevel=\"0\"><mfrac><mrow><msub><mi>t</mi><mrow><mi>S</mi><mi>A</mi><mi>B</mi></mrow></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>S</mi><mi>B</mi><mi>A</mi></mrow></msub></mrow><mn>2</mn></mfrac></mstyle><mo>+</mo><msub><mi>S</mi><mi>A</mi></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi></mrow></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin {array}{c}\n\nT_A - T_B =  \\dfrac{TIC_A - TIC_B}{2} + t_{site} + \\dfrac{t_{SAB} - t_{SBA}}{2} + S_A + t_{trans}\n\n\\end {array}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.04633em;vertical-align:-0.773165em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.273165em;\"><span style=\"top:-3.273165em;\"><span class=\"pstrut\" style=\"height:3.3603300000000003em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.36033em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">e</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.29208em;\"><span style=\"top:-2.314em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.677em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\">A</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.686em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2805559999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.773165em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></span></p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{site}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">e</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是指两站内部仪器电路引入的发送和接收时延值差，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>s</mi><mi>i</mi><mi>t</mi><mi>e</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>t</mi><mrow><mi>A</mi><mi>T</mi><mi>X</mi></mrow></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>R</mi><mi>X</mi></mrow></msub></mrow><mn>2</mn></mfrac><mo>−</mo><mfrac><mrow><msub><mi>t</mi><mrow><mi>B</mi><mi>T</mi><mi>X</mi></mrow></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>B</mi><mi>R</mi><mi>X</mi></mrow></msub></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">t_{site}={t_{ATX}-t_{ARX} \\over 2} - {t_{BTX}-t_{BRX} \\over 2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.31166399999999994em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">e</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1858609999999998em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8408609999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.410305em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1858609999999998em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8408609999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.410305em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">X</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">t_{trans}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2805559999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是指 A 站和 B 站信号上行下行的时延值差，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>t</mi><mrow><mi>A</mi><mi>U</mi><mi>P</mi></mrow></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>D</mi><mi>o</mi></mrow></msub></mrow><mn>2</mn></mfrac><mo>−</mo><mfrac><mrow><msub><mi>t</mi><mrow><mi>B</mi><mi>U</mi><mi>P</mi></mrow></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>B</mi><mi>D</mi><mi>o</mi></mrow></msub></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">t_{trans}={t_{AUP}-t_{ADo} \\over 2} - {t_{BUP}-t_{BDo} \\over 2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.76508em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2805559999999999em;\"><span style=\"top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">s</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1858609999999998em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8408609999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.410305em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">U</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal mtight\">o</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1858609999999998em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8408609999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.410305em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">U</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">P</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal mtight\">o</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span></li>\n<li>上式中的<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>A</mi></msub><mo>−</mo><mi>T</mi><mi>I</mi><msub><mi>C</mi><mi>B</mi></msub></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">{TIC_A -TIC_B \\over 2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2336359999999997em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8886359999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.410305em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:-0.07153em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07847em;\">I</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.07153em;\">C</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:-0.07153em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span> 是指两站的时间间隔计数器测量结果的差值</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><msub><mi>t</mi><mrow><mi>S</mi><mi>A</mi><mi>B</mi></mrow></msub><mo>−</mo><msub><mi>t</mi><mrow><mi>S</mi><mi>B</mi><mi>A</mi></mrow></msub></mrow><mn>2</mn></mfrac></mrow><annotation encoding=\"application/x-tex\">{t_{SAB} - t_{SBA} \\over 2}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1858609999999998em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8408609999999999em;\"><span style=\"top:-2.6550000000000002em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">2</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.410305em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal mtight\">A</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">S</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord mathnormal mtight\">A</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.14329285714285717em;\"><span></span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></span> 是由于卫星转发引起的时延差</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>S</mi><mi>A</mi></msub></mrow><annotation encoding=\"application/x-tex\">S_A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">S</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 表征由于<span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU2FnbmFjX2VmZmVjdA==\"> Sagnac 效应</span>引入的时延差值</li>\n</ul>\n<p>在中继 GNSS 卫星位置对于两地面站比较理想，传输路径比较对称，大气状况较好，并且地面站和卫星相关仪器设施经过了很好的标定时，卫星双向时间频率传递法可以获得亚纳秒量级的精度，相较于单向法有很大的提高。但是该方法要求租用卫星使用时间，且设备操作复杂造价高昂，目前主要应用在科研计量部门。</p>\n<h3 id=\"互联网授时\"><a class=\"anchor\" href=\"#互联网授时\">#</a> 互联网授时</h3>\n<p>主要采用 NTP (Network Time Protocol) 或 PTP (Precision Time Protocol) 协议进行时间同步，其中 NTP 是目前应用最广泛的时间同步协议。</p>\n<h4 id=\"ntp\"><a class=\"anchor\" href=\"#ntp\">#</a> NTP</h4>\n<p>NTP 工作在应用层，协议中时间服务器 A 和客户端 B 之间进行时间同步是利用了梯形时间戳算法，如下图所示：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/hqez23.png\" alt=\"NTP协议梯形时间戳同步算法\" /></p>\n<ul>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是客户端 B 发送时间查询请求信息的时间 (以客户端 B 自身时间为参照)</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>2</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是时间服务器 A 收到客户端的查询请求信息的时间 (以时间服务器 A 自身时间为参照)</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>3</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是时间服务器 A 发送回复信息的时间 (以时间服务器 A 自身时间为参照)</li>\n<li><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>T</mi><mn>4</mn></msub></mrow><annotation encoding=\"application/x-tex\">T_4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span> 是客户端 B 收到时间服务器 A 回复信息的时间 (以客户端 B 自身时间为参照)。</li>\n</ul>\n<p>而图中的<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>γ</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span></span></span></span> 是请求信息在网络中传输消耗的时间；<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi><mi>e</mi><mi>t</mi><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span></span></span></span> 是回复信息在网络中传输消耗的时间；<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span> 是时间服务器 A 和客户端 B 之间的时间差。根据图中关系可以得到：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.15999999999999992em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>T</mi><mn>2</mn></msub><mo>=</mo><msub><mi>T</mi><mn>1</mn></msub><mo>+</mo><mi>θ</mi><mo>+</mo><mi>γ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mrow><msub><mi>T</mi><mn>4</mn></msub><mo>=</mo><msub><mi>T</mi><mn>3</mn></msub><mo>−</mo><mi>θ</mi><mo>+</mo><mi>β</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin {array}{c}\n\nT_2 = T_1 + \\theta + \\gamma \\\\\n\nT_4 = T_3 - \\theta + \\beta\n\n\\end {array}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4000000000000004em;vertical-align:-0.9500000000000004em;\"></span><span class=\"mord\"><span class=\"mtable\"><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span></span></span><span style=\"top:-2.4099999999999997em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9500000000000004em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span></span></span></span></span></span></span></p>\n<p>如果假设请求信息和回复信息的网上传播时延相等，即<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>γ</mi><mo>=</mo><mi>β</mi></mrow><annotation encoding=\"application/x-tex\">\\gamma = \\beta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span></span></span></span>。那么就可以利用<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi><mo>=</mo><mo stretchy=\"false\">[</mo><mo stretchy=\"false\">(</mo><msub><mi>T</mi><mn>2</mn></msub><mo>=</mo><msub><mi>T</mi><mn>1</mn></msub><mo stretchy=\"false\">)</mo><mo>+</mo><mo stretchy=\"false\">(</mo><msub><mi>T</mi><mn>3</mn></msub><mo>−</mo><msub><mi>T</mi><mn>4</mn></msub><mo stretchy=\"false\">)</mo><mo>+</mo><mo stretchy=\"false\">(</mo><mi>β</mi><mo>−</mo><mi>γ</mi><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">]</mo><mi mathvariant=\"normal\">/</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">\\theta = [(T_2 = T_1) + (T_3 - T_4)+(\\beta - \\gamma)]/2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.30110799999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.05278em;\">β</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05556em;\">γ</span><span class=\"mclose\">)</span><span class=\"mclose\">]</span><span class=\"mord\">/</span><span class=\"mord\">2</span></span></span></span> 算出时间服务器 A 和客户端 B 之间的时间差值。</p>\n<h4 id=\"ptp\"><a class=\"anchor\" href=\"#ptp\">#</a> PTP</h4>\n<p>为满足部分网络中高精度时间同步需求，PTP 在 NTP 协议的基础之上进行了改进，与 NTP 协议纯软件的实现方式相比，PTP 采用软硬件结合的方式，在时间服务器端和客户端的通信接口处加装外围电路模块，用以在物理层打时间戳，精确的标记出报文离开和到达的时刻。该协议将精度提高到了 ns 量级，但由于在应用时需要额外购买加装外围硬件接口电路，成本较高，使用也较复杂，目前只能应用于工业自动化、精密测控、电力系统、通信基站等特定领域，而不能在广域网中直接应用</p>\n<p>PTP 协议在时间同步精度上存在上限瓶颈，对于千兆以太网，串行数据收发器的参考时钟频率为 125 MHz，也就是说即使不考虑任何其它误差因素的影响，PTP 协议的时间同步精度上限是 8ns。</p>\n<p>所以又引入了数字双混频时差法 (DDMTD method,Digital Dual Mixer Time Diﬀerence method) 来对时标脉冲的相位差值进行精细测量，形成了 PTP 协议负责粗测解模糊，数字双混频法负责细测的分工模式，突破了 8ns 的时间同步精度瓶颈。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/9bpmae.png\" alt=\"数字双混频时差法\" /></p>\n<p>通过双混频操作，将高频信号之间的相位差<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Δ</mi><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\Delta \\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.69444em;vertical-align:0em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span> 测量转变成低频信号之间的同样大小角弧度的相位差测量。都换算成相位时间以后，这一相位差就按照高低频信号的频率比例放大了，这样就降低了对测量设备的要求，提高了测量的精度。</p>\n<h3 id=\"光纤时间传输同步技术\"><a class=\"anchor\" href=\"#光纤时间传输同步技术\">#</a> 光纤时间传输同步技术</h3>\n<p>现阶段光频原子钟的不准确度已经达到了<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>18</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">10^{-18}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span></span></span></span></span> 量级，而基于卫星的频率同步手段最多能达到<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>15</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">10^{-15}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span></span></span></span></span> 的量级。考虑到光纤链路这一信息传输通道具有抗电磁干扰、传输损耗小等优点，比卫星通信利用的自由空间电磁波通道更加理想。</p>\n<h4 id=\"仿卫星twstft双向传输方案\"><a class=\"anchor\" href=\"#仿卫星twstft双向传输方案\">#</a> 仿卫星 TWSTFT 双向传输方案</h4>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/zo08qd.png\" alt=\"TWSTFT光纤链路时间传输与同步方案\" /></p>\n<p>与卫星上的 TWSTFT 方法相比，光纤上的时间双向传递比对不用考虑卫星转发、多径效应、几何路径不对称、电离层对流层扰动等因素的影响，但也要面对一些光纤链路中出现的新问题。比如两站所使用的激光器波长和偏振的不同会造成传输路径不对称；加入光学器件后，系统的标定难度也会比纯电子微波器件的标定难度更大；光学器件在面对温度波动、磁场变化等外界扰动时也可能更易受影响；卫星传输中的 Sagnac 效应在光纤传输时依然存在等。</p>\n<h4 id=\"光纤链路波动补偿传输方案\"><a class=\"anchor\" href=\"#光纤链路波动补偿传输方案\">#</a> 光纤链路波动补偿传输方案</h4>\n<p>利用补偿模块对光纤链路时延波动进行补偿，以便让复现的时标信号处于稳定状态，再通过标定修正实现接收端时标信号与发射端的钟源信号精准对齐，这就是光纤链路补偿传输方案的基本原理。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/3dhj8h.jpg\" alt=\"光纤链路波动补偿传输方案\" /></p>\n<p>将输入发射端 (Local module) 的标准秒脉冲信号 (PPS) 嵌入 10 MHz 频率信号之后，受到了可变延迟线的延迟调控，延迟后的信号经电 - 光 (E-O) 转换过程后通过环形器被发射到光纤链路中。光信号在接收端 (Remotemodule)，又经过了光 - 电 (O-E) 和电 - 光转换过程，部分接收的信号被解除嵌入状态分离为频率信号和秒脉冲信号输出，另一部分被原路环回发射端。在发射端收到的回传信号经光 - 电转换过程和可变延迟线延迟后，也被重新分离为频率信号和秒脉冲信号。频率信号和发射前的 10 MHz 频率信号被输入鉴相器 (Phase Detector)，鉴相器的输出用作误差信号，经过环路滤波器后反馈控制两条可变延迟线，最终使回传频率信号的相位稳定。</p>\n<p>以上就是常见的授时技术的说明了。</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY2FzLmNuL2t4L2twd3ovMjAyMjAzL3QyMDIyMDMyMV80ODI4ODYwLnNodG1s\">https://www.cas.cn/kx/kpwz/202203/t20220321_4828860.shtml</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLWhhbnMvJUU1JThFJTlGJUU1JUFEJTkwJUU5JTkwJTk4\">https://zh.wikipedia.org/zh-hans/ 原子鐘</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ueHBpeWFvLm54bmV3cy5uZXQvcW1weS8yMDIzMDMvdDIwMjMwMzI3Xzc4OTk4MjEuaHRtbA==\">https://nxpiyao.nxnews.net/qmpy/202303/t20230327_7899821.html</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80NTgyOTM0Nzk=\">https://zhuanlan.zhihu.com/p/458293479</span></li>\n</ul>\n",
            "tags": [
                "学习笔记",
                "PNT",
                "授时",
                "学习笔记",
                "PNT"
            ]
        },
        {
            "id": "https://gality.cn/ml/nndl/nndl-1/",
            "url": "https://gality.cn/ml/nndl/nndl-1/",
            "title": "《神经网络与深度学习》笔记（1）",
            "date_published": "2023-09-28T00:26:21.000Z",
            "content_html": "<div class=\"note info\">\n<p>本系列文章是博主跟着<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ubmRsLmdpdGh1Yi5pby9ubmRsLWJvb2sucGRm\"> github 项目</span>：《神经网络与深度学习》学习的笔记，目标是理解机器学习的原理，了解不同的深度学习模型并最终可以运用到科研生活中。</p>\n<p>本文内容主要是机器学习的绪论部分，包括：人工智能历史、流派，机器学习介绍，表示学习，深度学习，神经网络，常用框架，推荐阅读。</p>\n</div>\n<h1 id=\"绪论\"><a class=\"anchor\" href=\"#绪论\">#</a> 绪论</h1>\n<blockquote>\n<p>一个人在不接触对方的情况下，通过一种特殊的方式，和对方进行一系列的问答。如果在相当长时间内，他无法根据这些问题判断对方是人还是计算机，那么就可以认为这个计算机是智能的。</p>\n<p>—— 阿兰・图灵（Alan Turing）《Computing Machinery and Intelligence 》</p>\n</blockquote>\n<p>人工智能、机器学习、深度学习、神经网络概念辨析：</p>\n<ul>\n<li>人工智能：为机器赋予人的智能，是最广泛的概念。</li>\n<li>机器学习：一种实现人工智能的方法，通过使用算法来解析有限数据、从中学习，然后对真实世界中的未知事件做出决策和预测。</li>\n<li>深度学习：一种机器学习模型，利用深度（3 层以上）的神经网络，将模型处理得更为复杂，从而使模型对数据的理解更加深入。</li>\n<li>神经网络：一种机器学习模型，深度学习可以采用神经网络模型，也可以采用其他模型（例如深度信念网络）；神经网络是深度学习中主要采用的模型。</li>\n</ul>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/vvtz40.png\" alt=\"人工智能概念辨析\" height=\"221\" width=\"578\" /></p>\n<p>如上图所示，深度学习是机器学习的一个子领域，近年来发展十分迅速，从根源讲，深度学习是指一类问题以及解决这类问题的方法。深度学习一般采用的模型比较<strong>复杂</strong>「指样本的原始输入到输出目标之间的数据流经多个线性或非线性组件」，所以会出现<strong>贡献度分配问题</strong>「指不清楚每个组件的贡献度」。而贡献度分配问题在深度学习中是一个很关键的问题，关系到如何学习每个组件中的参数。</p>\n<p><strong>人工神经网络</strong>（Artificial Neural Network，ANN）是一种比较好解决贡献度分配问题的模型，简称为<strong>神经网络</strong>，是一种受人脑神经系统的工作方式启发而构造的数学模型。可以把神经网络看作是由一组参数控制的用于处理信息的复杂函数，其参数可以通过机器学习的方式从数据中自动学习。由于神经网络一般都比较复杂，所以复杂神经网络可以看成一种深度的机器学习，即深度学习。由于神经网络模型可以较容易地解决贡献度分配问题，因此神经网络模型成为深度学习中<strong>主要采用</strong>的模型。</p>\n<h2 id=\"人工智能\"><a class=\"anchor\" href=\"#人工智能\">#</a> 人工智能</h2>\n<p>在 1956 年的达特茅斯会议上，“人工智能” 被正式确定为本研究领域的名称，John McCarthy 提出了人工智能的定义：<strong>人工智能就是要让机器的行为看起来就像是人所表现出的智能行为一样</strong>。</p>\n<p>根据<strong>图灵测试</strong>的理论，如果计算机想通过图灵测试，就必须具有理解语言、学习、记忆、推理、决策等能力，目前人工智能研究的主要领域大体可分为：</p>\n<ul>\n<li><strong>感知</strong>：模拟人的感知能力，对外部刺激（视觉和语音等）进行感知和加工，主要研究领域包括：语音信息处理和计算机视觉等</li>\n<li><strong>学习</strong>：模拟人的学习能力，主要研究如何从样例或从与环境的交互中进行学习，主要研究领域包括监督学习、无监督学习和强化学习等</li>\n<li><strong>认知</strong>：模拟人的认知能力，主要研究领域包括知识表示、自然语言理解、推理、规划、决策等</li>\n</ul>\n<h3 id=\"人工智能发展历史\"><a class=\"anchor\" href=\"#人工智能发展历史\">#</a> 人工智能发展历史</h3>\n<p>人工智能从诞生至今，经历了一次又一次繁荣与低谷，大体上可分为 “推理期”、“知识期”、“学习期”。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/7kkweu.png\" alt=\"人工智能发展史\" /></p>\n<h4 id=\"推理期\"><a class=\"anchor\" href=\"#推理期\">#</a> 推理期</h4>\n<p>早期研究者都通过人类的经验，基于逻辑或者事实归纳出来一些规则，然后通过编写程序来让计算机完成一个任务。这个时期中，研究者开发了一系列的智能系统，例如：几何定理证明器、语言翻译器等。但随着研究的深入，研究者意识到这些推理规则过于简单，对项目难度评估不足，原来的乐观预期受到严重打击，人工智能开始陷入第一次大低谷。</p>\n<h4 id=\"知识期\"><a class=\"anchor\" href=\"#知识期\">#</a> 知识期</h4>\n<p>到了 20 世纪 70 年代，研究者意识到知识对于人工智能系统的重要性。特别是对于一些复杂的任务，需要专家来构建知识库。在这一时期，出现了各种各样的专家系统（Expert System），并在特定的专业领域取得了很多成果。专家系统可以简单的理解为 “知识库 + 推理机”，是一类具有专门知识和经验的计算机智能程序系统。一个专家系统必须具备三要素：</p>\n<ol>\n<li>领域专家级知识</li>\n<li>模拟专家思维</li>\n<li>达到专家水平</li>\n</ol>\n<p>在这一时期，Prolog（Programming in Logic）语言是主要的开发工具，用来建造专家系统、智能知识库以及处理自然语言理解等。</p>\n<h4 id=\"学习期\"><a class=\"anchor\" href=\"#学习期\">#</a> 学习期</h4>\n<p>人类的很多智能行为（比如语言理解、图像理解等），我们很难知道其中的原理，也无法描述这些智能行为背后的 “知识”。因此，我们也很难通过知识和推理的方式来实现这些行为的智能系统。为了解决这类问题，研究者开始将研究重点转向让计算机从数据中自己学习。事实上，“学习” 本身也是一种智能行为。</p>\n<p>从人工智能的萌芽时期开始，就有一些研究者尝试让机器来自动学习，即机器学习（Machine Learning，ML），但是由于各种其他交叉学科还不完善，一直没有很受重视。直到 1980 年后，机器学习在很多领域有出色表现，逐渐成为热门学科。</p>\n<h3 id=\"人工智能流派\"><a class=\"anchor\" href=\"#人工智能流派\">#</a> 人工智能流派</h3>\n<p>由于人们对人类智能的机理依然知之甚少，没有一个通用的理论来指导如何构建一个人工智能系统，因此在研究过程中产生了很多流派，例如有些研究者认为人工智能应该通过研究人类的智能机理来实现一个仿生模拟器，而另外一些学者则认为可以使用其他方法来实现人类的某种智能行为（想想我们制造的飞机不需要想鸟一样扇动翅膀也可以飞起来）。</p>\n<p>各种流派总的来说可以归结为一下两种：</p>\n<ul>\n<li><strong>符号主义</strong>（Symbolism）：又称逻辑主义、心理学派或计算机学派，是指通过分析人类智能的功能，然后用计算机来实现这些功能的一类方法。符号主义有两个基本假设：1）信息可以用符号表示；2）符号可以通过显式的规则（比如逻辑运算）来操作。人类认知的过程可以看做符号操作的过程。在推理期和知识期，符号主义比较盛行，并取得了大量成果。</li>\n<li><strong>连接主义</strong>（Connectionism）：又称仿生学派或生理学派，是认知科学领域中的一类信息处理的方法和理论。在认知科学领域，人类的认知过程可以看作一种信息处理过程。连接主义认为人类的认知过程是由大量简单神经元构成的神经网络中的信息处理过程，而不是符号运算。因此，连接主义模型的主要结构是由大量简单的信息处理单元组成的互联网络，具有非线性、分布式、并行化、局部性计算以及自适应性等特性。</li>\n</ul>\n<p>符号主义方法的一个优点是可解释性，而这也正是连接主义方法的弊端。深度学习的主要模型神经网络就是一种连接主义模型。随着深度学习的发展，越来越多的研究者开始关注如何融合符号主义和连接主义，建立一种高效并且具有可解释性的模型。</p>\n<h2 id=\"机器学习\"><a class=\"anchor\" href=\"#机器学习\">#</a> 机器学习</h2>\n<p><strong>机器学习</strong>（Machine Learning，ML）是指从有限的观测数据中学习（或 “猜测”）出具有一般性的规律，并用这些规律对未知数据进行预测的方法。</p>\n<p>传统机器学习主要关注如何学习一个<strong>预测模型</strong>，一般需要首先将数据表示为一组<strong>特征</strong>（Feature），特征可以是连续的数值、离散符号或其他形式，然后将这些特征输入到预测模型，并输出预测结果。这类学习可以看作是<strong>浅层学习</strong>（Shallow Learning）。浅层学习的一个重要特点是不涉及特征学习，其特征主要靠人工经验或特征转换方法来抽取。</p>\n<p>但实际情况下，不同类型的数据（声音、图像、文本等）的特征构造方式差异很大，很难找到合适的特征表示方式，因此在实际任务中使用机器学习模型一般会包含以下几个步骤：</p>\n<ol>\n<li><strong>数据预处理</strong>：对数据的原始形式进行初步的数据清理（比如去掉一些有缺失特征的样本，或去掉一些冗余的数据特征等）和加工（对数值特征进行缩放和归一化等），并构建成可用于训练机器学习模型的数据集。</li>\n<li><strong>特征提取</strong>：从数据的原始特征中提取一些对特定机器学习任务有用的高质量特征。比如在图像分类中提取边缘、尺度不变特征变换（Scale Invariant Feature Transform，SIFT）特征，在文本分类中去除停用词等。</li>\n<li><strong>特征转换</strong>：对特征进行进一步的加工，比如降维和升维。降维包括特征抽取（Feature Extraction）和特征选择（Feature Selection）两种途径。常用的特征转换方法有主成分分析（Principal Components Analysis，PCA）、 线性判别分析（Linear Discriminant Analysis，LDA）等</li>\n<li><strong>预测</strong>：机器学习的核心部分，学习一个函数并进行预测。</li>\n</ol>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/0gsavr.png\" alt=\"传统机器学习数据处理流程\" /></p>\n<p>上述流程的每一步都是分开处理的，在实际操作中，不同预测模型的准确性相差不大，而前三步中的特征处理对最终结果却有着十分关键的作用。由于特征处理一般都需要人工干预完成，利用人类的经验来选取好的特征，最终提高机器学习系统的性能。因此，很多的机器学习问题变成了<strong>特征工程</strong>（Feature Engineering）问题。开发一个机器学习系统的主要工作量都消耗在了预处理、特征提取以及特征转换上。</p>\n<h2 id=\"表示学习\"><a class=\"anchor\" href=\"#表示学习\">#</a> 表示学习</h2>\n<p>为了提高机器学习系统的准确率，我们就需要将输入信息转换为有效的<strong>特征</strong>，或者更一般性地称为<strong>表示</strong>（Representation）。如果有一种算法可以自动地学习出有效的特征，并提高最终机器学习模型的性能，那么这种学习就可以叫作<strong>表示学习</strong>（Representation Learning）。</p>\n<p>表示学习的关键是解决<strong>语义鸿沟</strong>（Semantic Gap）问题；<strong>语义鸿沟</strong>问题是指输入数据的底层特征和高层语义信息之间的不一致性和差异性。比如给一些关于 “车” 的照片，其高层含义（车）与底层特征（照片中的各个像素点）之间有极大的差异。我们对于这些图片的理解是站在比较抽象的高层语义概念上的。如果模型直接建立在底层特征上，会导致对预测模型的能力要求过高，这时，如果我们有一个好的表示，可以在某种程度上反映出数据的高层语义特征，那么我们就能相对容易的构建后续的机器学习模型。</p>\n<p>在表示学习中，有两个<strong>核心问题</strong>：</p>\n<ol>\n<li>什么是一个好的表示</li>\n<li>如何学习到好的表示</li>\n</ol>\n<h3 id=\"局部表示与分布式表示\"><a class=\"anchor\" href=\"#局部表示与分布式表示\">#</a> 局部表示与分布式表示</h3>\n<p>「<strong>好的表示</strong>」是一个非常主观的概念，没有一个明确的标准。但一般而言，一个好的表示具有以下几个优点：</p>\n<ol>\n<li>一个好的表示应该具有很强的表示能力，即同样大小的向量可以表示更多信息。</li>\n<li>一个好的表示应该使后续的学习任务变得简单，即需要包含更高层的语义信息。</li>\n<li>一个好的表示应该具有一般性，是任务或领域独立的。虽然目前的大部分表示学习方法还是基于某个任务来学习，但我们期望其学到的表示可以比较容易地迁移到其他任务上。</li>\n</ol>\n<p>在机器学习中，我们常有两种方式来表示特征：</p>\n<ul>\n<li><strong>局部表示</strong>（Local Rep-resentation）</li>\n<li><strong>分布式表示</strong>（Distributed Representation）</li>\n</ul>\n<p>以颜色为例，在语言中，我们可以通过不同的词来形容颜色：“红”、“中国红”、“正红” 等等。在计算机中，颜色主要有两种表示方式</p>\n<h4 id=\"局部表示\"><a class=\"anchor\" href=\"#局部表示\">#</a> 局部表示</h4>\n<p>又称为<strong>离散表示</strong>或<strong>符号表示</strong>，经常可以表示为<strong> one-hot</strong> 向量「有且只有一个元素为 1，其余元素都为 0 的向量」的形式。逻辑上是以不同的名字来命名不同的颜色，假设所有颜色的名字构成一个词表 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>v</mi></mrow><annotation encoding=\"application/x-tex\">v</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.43056em;vertical-align:0em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span></span></span>，词表大小为<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>v</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|v|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord\">∣</span></span></span></span>，我们可以用一个 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∣</mi><mi>v</mi><mi mathvariant=\"normal\">∣</mi></mrow><annotation encoding=\"application/x-tex\">|v|</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">∣</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord\">∣</span></span></span></span> 维的 one-hot 向量来表示每一种颜色，第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 种颜色对应的 one-hot 向量中，第 <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.65952em;vertical-align:0em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span> 维的值为 1，其他都为 0。</p>\n<p><strong>优点</strong>：</p>\n<ol>\n<li>这种离散的表示方式具有很好的解释性，有利于人工归纳和总结特征，并通过特征组合进行高效的特征工程</li>\n<li>通过多种特征组合得到的表示向量通常是稀疏的二值向量，当用于线性模型时计算效率非常高</li>\n</ol>\n<p><strong>缺点</strong>：</p>\n<ol>\n<li>one-hot 向量的维数很高，且不能扩展。如果有一种新的颜色，我们就需要增加一维来表示</li>\n<li>不同颜色之间的相似度都为 0，即我们无法知道 “红色” 和 “中国红” 的相似度要高于 “红色” 和 “黑色” 的相似度</li>\n</ol>\n<h4 id=\"分布式表示\"><a class=\"anchor\" href=\"#分布式表示\">#</a> 分布式表示</h4>\n<p>其实就是 “分散式表示”，将一种颜色的语义分散到语义空间中的不同基向量上。其实就是我们熟悉的用 RGB 值来表示颜色，不同颜色对应到 R、G、B 三维空间中一个点。分布式表示通常可以表示为低维的稠密向量。</p>\n<p>和局部表示相比，分布式表示的表示能力要强很多，分布式表示的向量维度一般都比较低。我们只需要用一个三维的稠密向量就可以表示所有颜色。并且，分布式表示也很容易表示新的颜色名。此外，不同颜色之间的相似度也很容易计算。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/0vymkm.png\" alt=\"局部表示和分布式表示\" height=\"200\" width=\"450\" /></p>\n<p>通过分布式表示，可以将高维的局部表示空间映射到一个非常低维的分布式表示空间。在这个地位空间中，每个特征不再是坐标轴上的点，而是分散在整个低维空间中。在机器学习中，这个过程称为<strong>嵌入</strong>（Embedding）。</p>\n<p>嵌入通常指将一个度量空间中的一些对象映射到另一个低维的度量空间中，并尽可能保持不同对象之间的拓扑关系。比如自然语言中词的分布式表示，也经常叫作词嵌入。</p>\n<h3 id=\"表示学习-2\"><a class=\"anchor\" href=\"#表示学习-2\">#</a> 表示 “学习”</h3>\n<p>「<strong>学到好的表示</strong>」通常需要从底层特征开始经过多步非线性转换才能得到。深层结构的优点是可以增加特征的重用性，从而指数级地增加表示能力。因此，表示学习的关键是构建具有一定深度的多层次特征表示。在传统机器学习中，由于特征的学习和最终预测模型的学习是分开进行的，所以学习到的特征不一定可以提升最终模型的性能。</p>\n<h2 id=\"深度学习\"><a class=\"anchor\" href=\"#深度学习\">#</a> 深度学习</h2>\n<p>为了学习一种好的表示，需要构建具有一定 “深度” 的模型，并通过学习算法来让模型自动学习出好的特征表示（从底层特征，到中层特征，再到高层特征），从而最终提升预测模型的准确率。所谓 “深度” 是指原始数据进行非线性特征转换的次数。如果把一个表示学习系统看作一个有向图结构，深度也可以看作从输入节点到输出节点所经过的最长路径的长度。由于学习过程是自动的，所以可以避免 “特征工程”，即无需提供人为标注的特征数据。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/5gu4eo.png\" alt=\"深度学习数据处理流程\" /></p>\n<p>深度学习是将原始的数据特征通过多步的特征转换得到一种特征表示，并进一步输入到预测函数得到最终结果。由于整体是黑盒的过程（又称<strong>端到端学习</strong>），所以需要解决 “<strong>贡献度分配问题</strong>”，但是这非常困难。从某种意义上讲，深度学习可以看作一种<strong>强化学习</strong>（Reinforcement Learning，RL），每个内部组件并不能直接得到监督信息，需要通过整个模型的最终监督信息（奖励）得到，并且有一定的延时性。</p>\n<p>目前，深度学习采用的模型主要是神经网络模型，其主要原因是神经网络模型可以使用误差反向传播算法，从而可以比较好地解决贡献度分配问题。只要是超过一层的神经网络都会存在贡献度分配问题，因此可以将超过一层的神经网络都看作深度学习模型。随着深度学习的快速发展，模型深度也从早期的 5 ∼ 10 层增加到目前的数百层。随着模型深度的不断增加，其特征表示的能力也越来越强，从而使后续的预测更加容易。</p>\n<h2 id=\"神经网络\"><a class=\"anchor\" href=\"#神经网络\">#</a> 神经网络</h2>\n<p>随着神经科学、认知科学的发展，我们逐渐知道人类的智能行为都和大脑活动有关。人类大脑是一个可以产生意识、思想和情感的器官。受到人脑神经系统的启发，早期的神经科学家构造了一种模仿人脑神经系统的数学模型，称为<strong>人工神经网络</strong>，简称<strong>神经网络</strong>。在机器学习领域，神经网络是指由很多<strong>人工神经元</strong>构成的网络结构模型，这些人工神经元之间的<strong>连接强度</strong>是可学习的参数。</p>\n<h3 id=\"人脑神经网络\"><a class=\"anchor\" href=\"#人脑神经网络\">#</a> 人脑神经网络</h3>\n<p>「抢救下要死未死的高中生物」人脑是人体最复杂的器官，由神经元、神经胶质细胞、神经干细胞和血管组成。其中，神经元（Neuron），也叫神经细胞（Nerve Cell），是携带和传输信息的细胞，是人脑神经系统中最基本的单元。人脑中包含近 860 亿个神经元，每个神经元有上千个突触和其他神经元相连接。这些神经元和它们之间的连接形成巨大的复杂网络，其中神经连接的总长度可达数千公里。我们人造的复杂网络，比如全球的计算机网络，和大脑神经网络相比要 “简单” 得多。</p>\n<p>典型的神经元结构大致可分为<strong>细胞体</strong>和细胞突起：</p>\n<ol>\n<li><strong>细胞体</strong>（Soma）中的神经细胞膜上有各种受体和离子通道，胞膜的受体可与相应的化学物质神经递质结合，引起离子通透性及膜内外电位差发生改变，产生相应的生理活动：兴奋或抑制</li>\n<li><strong>细胞突起</strong>是由细胞体延伸出来的细长部分，又可分为树突和轴突\n<ul>\n<li>树突（Dendrite）可以接收刺激并将兴奋传入细胞体。每个神经元可以有一或多个树突</li>\n<li>轴突（Axon）可以把自身的兴奋状态从胞体传送到另一个神经元或其他组织。每个神经元只有一个轴突</li>\n</ul>\n</li>\n</ol>\n<p>神经元可以接收其他神经元的信息，也可以发送信息给其他神经元。神经元之间没有物理连接，两个 “连接” 的神经元之间留有 20 纳米左右的缝隙，并靠<strong>突触</strong>（Synapse）进行互联来传递信息。一个神经元可被视为一种只有两种状态的细胞：<strong>兴奋</strong>和<strong>抑制</strong>。神经元的状态取决<br />\n于从其他的神经细胞收到的输入信号量，以及突触的强度（抑制或加强）。当信号量总和超过了某个阈值时，细胞体就会兴奋，产生电脉冲。电脉冲沿着轴突并通过突触传递到其他神经元。一个典型的神经元结构如下图所示。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/tad23p.png\" alt=\"典型神经元结构\" height=\"221\" width=\"412\" /></p>\n<p>人的智力不完全由遗传决定，大部份来自生活经验，即人脑神经网路就是一个具有学习能力的系统，人脑的学习能力是通过改变神经元之间的突触强度来实现的，不同神经元之前的突触有强有弱，通过学习（训练）可以改变强度，进而实现我们所谓的 “学习”。</p>\n<h3 id=\"人工神经网络\"><a class=\"anchor\" href=\"#人工神经网络\">#</a> 人工神经网络</h3>\n<p><strong>人工神经网络</strong>是为模拟人脑神经网络而设计的一种计算模型，它从结构、实现机理和功能上模拟人脑神经网络。人工神经网络与生物神经元类似，由多个节点（人工神经元）互相连接而成，可以用来对数据之间的复杂关系进行建模。不同节点之间的连接被赋予了不同的权重，每个权重代表了一个节点对另一个节点的影响大小。每个节点代表一种特定函数，来自其他节点的信息经过其相应的权重综合计算，输入到一个激活函数中并得到一个新的活性值（兴奋或抑制）。从系统观点看，人工神经元网络是由大量神经元通过极其丰富和完善的连接而构成的自适应非线性动态系统。</p>\n<p>构造人工神经网络很简单，但是如何实现网络的学习并不容易，早期的神经网络模型并不具备学习能力（早期神经网络并不是用于解决机器学习问题的）。首个可学习的人工神经网络是<strong>赫布网络</strong>，采用一种基于<strong>赫布规则</strong>「」的无监督学习方法。<strong>感知器</strong>是最早的具有机器学习思想的神经网络，但其学习方法无法扩展到多层的神经网络上。 直到 1980 年左右，<strong>反向传播算法</strong>才有效地解决了多层神经网络的学习问题，并成为最为流行的神经网络学习算法。</p>\n<blockquote>\n<p>” 赫布规则 “或” 赫布理论 “：</p>\n<p>当神经元 A 的一个轴突和神经元 B 很近，足以对它产生影响，并且持续地、重复地参与了对神经元 B 的兴奋，那么在这两个神经元或其中之一会发生某种生长过程或新陈代谢变化，以致神经元 A 作为能使神经元 B 兴奋的细胞之一，它的效能加强了。</p>\n</blockquote>\n<p>由于神经网络可以用作一个通用的函数逼近器（一个两层的神经网络可以逼近任意的函数），因此我们可以将人工神经网络看作一个可学习的函数，并将其应用到机器学习中。理论上，只要有足够的训练数据和神经元数量，人工神经网络就可以学到很多复杂的函数。我们可以把一个人工神经网络塑造复杂函数的能力称为<strong>网络容量</strong>（Network Capacity），这与可以被储存在网络中的信息的复杂度以及数量相关。</p>\n<h3 id=\"神经网络的发展历史\"><a class=\"anchor\" href=\"#神经网络的发展历史\">#</a> 神经网络的发展历史</h3>\n<p>神经网络的发展大致经过五个阶段</p>\n<p><strong>第一阶段：模型提出</strong></p>\n<p>1943～1969 年，神经网络发展的第一个高潮期，提出了许多神经元模型和学习规则，包括<strong> MP 模型</strong>、<strong>感知机</strong>等。在这一时期，神经网络以其独特的结构和处理信息的方法，在许多实际应用领域（自动控制、模式识别等）中取得了显著的成效。</p>\n<p><strong>第二阶段：冰河期</strong></p>\n<p>1969 年～1983 年，是神经网络发展的第一个低谷期。在此期间，神经网络的研究处于长年停滞及低潮状态。当时的神经网络有两个关键缺陷：</p>\n<ol>\n<li>感知机无法处理 “异或” 回路问题</li>\n<li>当时的计算机无法支持处理大型神经网络所需要的算力</li>\n</ol>\n<p>但是这个时期也提出很多有用的模型或算法，如：<strong>反向传播算法</strong>、新知机等</p>\n<p><strong>第三阶段：反向传播算法引起的复兴</strong></p>\n<p>1983 年～1995 年，是神经网络发展的第二个高潮期，这个时期中，反向传播算法重新激发了人们对神经网络的兴趣。<strong>Hopfield 网络</strong>在旅行商问题上取得了当时的最好结果，随后又在 Hopfield 网络的基础上提出了随机化版本的网络 “<strong>玻尔兹曼机</strong>”。</p>\n<p>20 世纪 80 年代中期，连接主义模型开始流行，即<strong>分布式并行处理</strong>（Parallel Distributed Pro-cessing，PDP）模型。反向传播算法逐渐成为 PDP 模型的主要学习算法，通过引入该算法的卷机神经网络在手写体数字识别上取得了很大成功。反向传播算法是迄今为止最为成功的网络学习算法，目前深度学习中主要使用的自动微可以看作是反向传播算法的一种扩展。</p>\n<p>但是，<strong>梯度消失问题</strong>（Vanishing Gradient Problem）阻碍神经网络的进一步发展。</p>\n<p><strong>第四阶段：流行度降低</strong></p>\n<p>1995 年～2006 年，在此期间，支持向量机和其他更简单的方法（例如线性分类器）在机器学习领域的流行度逐渐超过了神经网络。原因在于：</p>\n<ol>\n<li>当时算力不足以支撑复杂的神经网络</li>\n<li>神经网络理论基础不清晰、优化困难、可解释性差</li>\n</ol>\n<p><strong>第五阶段：深度学习的崛起</strong></p>\n<p>2006 年开始至今，在这一时期研究者逐渐掌握了训练深层神经网络的方法，使得神经网络重新崛起。随着大规模并行计算以及 GPU 设备的普及，计算机的计算能力得以大幅提高。此外，可供机器学习的数据规模也越来越大。在强大的计算能力和海量的数据规模支持下，以神经网络为基础的<strong>深度学习</strong>迅速崛起，在语音识别和图像分类等任务上取得巨大成功。</p>\n<h2 id=\"知识体系图\"><a class=\"anchor\" href=\"#知识体系图\">#</a> 知识体系图</h2>\n<p>主要对神经网络和深度学习所涉及的知识提出一个较全面的基础性介绍，可以分为三大块：机器学习、神经网络、概率图模型。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/crks8k.png\" alt=\"知识体系图\" height=\"400\" width=\"678\" /></p>\n<h2 id=\"常用的深度学习框架\"><a class=\"anchor\" href=\"#常用的深度学习框架\">#</a> 常用的深度学习框架</h2>\n<p>在深度学习中，一般通过误差反向传播算法来进行参数学习。采用手工方式来计算梯度再写代码实现的方式会非常低效，并且容易出错。此外，深度学习模型需要的计算机资源比较多，一般需要在 CPU 和 GPU 之间不断进行切换，开发难度也比较大。因此，一些支持自动梯度计算、无缝 CPU 和 GPU 切换等功能的深度学习框架就应运而生。比较有代表性的框架包括：Theano、Caffe、TensorFlow、Pytorch、飞桨（PaddlePaddle）、Chainer 和 MXNet 等</p>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5kZWVwbGVhcm5pbmcubmV0L3NvZnR3YXJlL3RoZWFubw==\">Theano</span>：<s>由蒙特利尔大学的 Python 工具包，用来高效地定义、优化和计算张量数据的数学表达式。Theano 可以透明地使用 GPU 和高效的符号微分</s>「项目已停止维护」</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2NhZmZlLmJlcmtlbGV5dmlzaW9uLm9yZy8=\">Caffe</span>：<s>由加州大学伯克利分校开发的针对卷积神经网络的计算框架，主要用于计算机视觉。Caffe 用 C++ 和 Python 实现，但可以通过配置文件来实现所要的网络结构，不需要编码</s>「已被并入 PyTorch 中」</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudGVuc29yZmxvdy5vcmcv\">TensorFlow</span>：由 Google 公司开发的深度学习框架，可以在任意具备 CPU 或者 GPU 的设备上运行。TensorFlow 的计算过程使用数据流图来表示。TensorFlow 的名字来源于其计算过程中的操作对象为多维数组，即张量（Tensor）。TensorFlow 1.0 版本采用静态计算图，2.0 版本之后也支持动态计算图。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3B5dG9yY2gub3JnLw==\">PyTorch</span>：由 Facebook、NVIDIA、Twitter 等公司开发维护的深度学习框架，其前身为 Lua 语言的 Torch3。PyTorch 也是基于动态计算图的框架，在需要动态改变神经网络结构的任务中有着明显的优势。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3BhZGRsZXBhZGRsZS5vcmcv\">飞桨（PaddlePaddle）</span>4：由百度开发的一个高效和可扩展的深度学习框架，同时支持动态图和静态图。飞桨提供强大的深度学习并行技术，可以同时支持稠密参数和稀疏参数场景的超大规模深度学习并行训练，支持千亿规模参数和数百个节点的高效并行训练。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubWluZHNwb3JlLmNuLw==\">MindSpore</span>：由华为开发的一种适用于端边云场景的新型深度学习训练 / 推理框架。MindSpore 为 Ascend AI 处理器提供原生支持，以及软硬件协同优化</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9teG5ldC5hcGFjaGUub3JnLw==\">Chainer</span>：一个最早采用动态计算图的深度学习框架，其核心开发团队为来自日本的一家机器学习创业公司 Preferred Networks。和 Tensorflow、Theano、Caffe 等框架使用的静态计算图相比，动态计算图可以在运行时动态地构建计算图，因此非常适合进行一些复杂的决策或推理任务。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9teG5ldC5hcGFjaGUub3JnLw==\">MXNet</span>：由亚马逊、华盛顿大学和卡内基・梅隆大学等开发维护的深度学习框架。MXNet 支持混合使用符号和命令式编程来最大化效率和生产率，并可以有效地扩展到多个 GPU 和多台机器。</li>\n</ol>\n<p>在这些基础框架上，还有一些建立在这些框架之上的高度模块化的神经网络库，其中比较有名的模块化神经网络框架有：</p>\n<ol>\n<li>基于 TensorFlow 和 Theano 的 <span class=\"exturl\" data-url=\"aHR0cDovL2tlcmFzLmlvLw==\">Keras</span></li>\n<li>基于 Theano 的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0xhc2FnbmUvTGFzYWduZQ==\">Lasagne</span></li>\n<li>面向图结构数据的 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZGdsLmFpLw==\">DGL</span></li>\n</ol>\n<h2 id=\"推荐阅读\"><a class=\"anchor\" href=\"#推荐阅读\">#</a> 推荐阅读</h2>\n<ol>\n<li>斯坦福大学的 <span class=\"exturl\" data-url=\"aHR0cDovL2NzMjMxbi5zdGFuZm9yZC5lZHUv\">CS231n</span> 和 <span class=\"exturl\" data-url=\"aHR0cDovL3dlYi5zdGFuZm9yZC5lZHUvY2xhc3MvY3MyMjRuLw==\">CS224n</span> 是两门非常好的深度学习入门课程，分别从计算机视觉和自然语言处理两个角度来讲授深度学习的基础知识和最新进展。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5pY2xyLmNjLw==\">国际表示学习会议</span>（International Conference on Learning Representations，ICLR）：主要聚焦于深度学习。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9uaXBzLmNjLw==\">神经信息处理系统年会</span>（Annual Conference on Neural Information Processing Systems，NeurIPS）：交叉学科会议，但偏重于机器学习。主要包括神经信息处理、统计方法、学习理论以及应用等。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9pY21sLmNjLw==\">国际机器学习会议</span>（International Conference on Machine Learning，ICML）：机器学习顶级会议，深度学习作为近年来的热点，也占据了 ICML 的很大比例。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuaWpjYWkub3JnLw==\">国际人工智能联合会议</span>（International Joint Conference on Artificial Intelligence，IJCAI）：人工智能领域最顶尖的综合性会议。历史悠久，从 1969 年开始举办。</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5hYWFpLm9yZy8=\">美国人工智能协会年会</span>（AAAI Conference on Artificial Intelligence，AAAI）：人工智能领域的顶级会议，每年二月份左右召开，地点一般在北美。</li>\n</ol>\n<p>另外，人工智能的很多子领域也都有非常好的专业学术会议。在计算机视觉领域，有计算机视觉与模式识别大会（IEEE Conference on Computer Vision and Pattern Recognition，CVPR）和国际计算机视觉会议（International Comference on Computer Vision，ICCV）。在自然语言处理领域，有计算语言学年会（Annual Meeting of the Association for Computational Linguistics，ACL）和自然语言处理实证方法大会（Conference on Empirical Methods in Natural Language Processing，EMNLP）等。</p>\n",
            "tags": [
                "机器学习",
                "神经网络与深度学习",
                "系列长篇",
                "机器学习",
                "深度学习",
                "学习笔记",
                "神经网络"
            ]
        },
        {
            "id": "https://gality.cn/os/04-32bit-print/",
            "url": "https://gality.cn/os/04-32bit-print/",
            "title": "04-在保护模式下打印",
            "date_published": "2023-09-21T12:32:21.000Z",
            "content_html": "<div class=\"note info\">\n<p>本章是操作系统从 0 到 1 系列的第五篇文章，暂时喘口气，来讲解下怎么在 32 位模式下向屏幕打印字符串，方便我们打印各种信息，增加成就感。</p>\n</div>\n<div class=\"note warning\">\n<p><em>Concepts you may want to Google beforehand: 32-bit protected mode, VGA, video memory</em></p>\n</div>\n<h1 id=\"背景\"><a class=\"anchor\" href=\"#背景\">#</a> 背景</h1>\n<p>当系统进入到 32 位模式后，我们可以使用 32 位寄存器、更大的内存空间、保护模式、虚拟内存等高级功能，但同样的，我们也失去了通过中断直接调用 BIOS 的能力，所以前几章中使用的 <code>print</code>  函数就无法继续使用了（如果你细心的话，也可以注意到，在上一章末尾的 <code>main</code>  程序中，在进入 32 位模式后，我们就没有打印字符了，只是通过 <code>switch_to_pm</code>  函数后的打印来确定程序是否出错）。</p>\n<p>这一点还是很难受的，所以本章我们就来写一个 32 位模式下的打印函数。</p>\n<h1 id=\"原理\"><a class=\"anchor\" href=\"#原理\">#</a> 原理</h1>\n<p>在 32 位下打印信息需要用到<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLm9zZGV2Lm9yZy9UZXh0X21vZGU=\"> VGA Text Mode</span>，一种极其古老的显示模式，打印的原理简单来说就是用 <code>32KB</code>  的内存来控制一个 <code>25行 * 80列</code> 的字符的屏幕终端，回忆一下第三章中出现的图：</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/h04dzu.png\" alt=\"实模式下的内存布局\" /></p>\n<p>看红框标出来的，答案就是利用 <code>0xB8000 ~ 0xBFFFF</code>  这 <code>32KB</code>  的空间，可以通过访问并修改这一段内存的值来控制屏幕的显示。</p>\n<p>屏幕上有  <code>25 * 80 = 2000</code>  个字符，每个字符由  <code>2 byte</code>  控制，这样一屏幕就占用  <code>4000  bytes</code> ，所以 32 KB 最大容纳大约 8 屏的内容。为了简单起见，只控制第一屏幕的数据，超出部分就不予显示，也不支持上下翻屏等功能。</p>\n<h2 id=\"字符显示\"><a class=\"anchor\" href=\"#字符显示\">#</a> 字符显示</h2>\n<p>一个字符由 <code>2 byte</code>  来控制，高 <code>1 byte</code>  控制字符颜色（前景色 / 背景色 / 闪烁等），低 <code>1 byte</code>  为字符对应的 <code>Ascii</code>  码，更加具体可以参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVkdBX3RleHRfbW9kZQ==\"> Wiki 百科</span>，这里给出其中的一个图。</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/sv2gp5.png\" alt=\"VGA Text Mode Char\" /></p>\n<p>3 个 bit 可以显示 8 种颜色</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">颜色</th>\n<th style=\"text-align:center\">bit 值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">黑</td>\n<td style=\"text-align:center\">0</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">蓝</td>\n<td style=\"text-align:center\">1</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">绿</td>\n<td style=\"text-align:center\">2</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">青</td>\n<td style=\"text-align:center\">3</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">红</td>\n<td style=\"text-align:center\">4</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">粉</td>\n<td style=\"text-align:center\">5</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">粽</td>\n<td style=\"text-align:center\">6</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">白</td>\n<td style=\"text-align:center\">7</td>\n</tr>\n</tbody>\n</table>\n<p>其他控制位是类似的，就不再赘述了。</p>\n<h1 id=\"实现\"><a class=\"anchor\" href=\"#实现\">#</a> 实现</h1>\n<p>由于是直接读写内存，实现的思想其实就是之前的 <code>print</code>  的思想，只不过会更简单一些，我们可以利用 <code>ax</code>  来暂存要打印的字符 (2 bytes)，用 <code>ebx</code>  存储需要打印的字符串地址，用 <code>edx</code>  指向 VGA 的地址。代码非常简单，自己试试实现吧！</p>\n<details class=\"info\"><summary>32bit-print.asm</summary><div>\n<figure class=\"highlight nasm\"><figcaption data-lang=\"NASM\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">[</span>bits <span class=\"token number\">32</span><span class=\"token operator\">]</span> <span class=\"token comment\">; using 32-bit protected mode</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">; this is how constants are defined</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>VIDEO_MEMORY equ <span class=\"token number\">0xb8000</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>WHITE_ON_BLACK equ <span class=\"token number\">0x0f</span> <span class=\"token comment\">; the color byte for each character</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token label function\">print_string_pm:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    pusha</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    mov <span class=\"token register variable\">edx</span>, VIDEO_MEMORY</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token label function\">print_string_pm_loop:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    mov <span class=\"token register variable\">al</span>, <span class=\"token operator\">[</span><span class=\"token register variable\">ebx</span><span class=\"token operator\">]</span> <span class=\"token comment\">; [ebx] is the address of our character</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    mov <span class=\"token register variable\">ah</span>, WHITE_ON_BLACK <span class=\"token comment\">; control char color</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    cmp <span class=\"token register variable\">al</span>, <span class=\"token number\">0</span> <span class=\"token comment\">; check if end of string</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    je print_string_pm_done</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    mov <span class=\"token operator\">[</span><span class=\"token register variable\">edx</span><span class=\"token operator\">]</span>, <span class=\"token register variable\">ax</span> <span class=\"token comment\">; store character + attribute in video memory</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    add <span class=\"token register variable\">ebx</span>, <span class=\"token number\">1</span> <span class=\"token comment\">; next char</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    add <span class=\"token register variable\">edx</span>, <span class=\"token number\">2</span> <span class=\"token comment\">; next video memory position</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    jmp print_string_pm_loop</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token label function\">print_string_pm_done:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    popa</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    ret</pre></td></tr></table></figure></div></details>\n<p>「一定要尝试自己将文字颜色换一换试试哟！」</p>\n<p>然后我们可以对上一章中的 <code>main</code>  代码中加入一下 <code>print_string_pm</code>  函数来试试吧</p>\n<details class=\"info\"><summary>32bit-main.asm</summary><div>\n<figure class=\"highlight nasm\"><figcaption data-lang=\"NASM\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token operator\">[</span>org <span class=\"token number\">0x7c00</span><span class=\"token operator\">]</span> <span class=\"token comment\">; bootloader offset</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    mov <span class=\"token register variable\">bp</span>, <span class=\"token number\">0x9000</span> <span class=\"token comment\">; set the stack</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    mov <span class=\"token register variable\">sp</span>, <span class=\"token register variable\">bp</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    mov <span class=\"token register variable\">bx</span>, MSG_REAL_MODE</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    call print <span class=\"token comment\">; This will be written after the BIOS messages</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    call switch_to_pm</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    mov <span class=\"token register variable\">bx</span>, MSG_ERROR </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    call print </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    jmp <span class=\"token operator\">$</span> <span class=\"token comment\">; this will actually never be executed</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">%</span>include <span class=\"token string\">\"../02-mbr/boot-print.asm\"</span> <span class=\"token comment\">; must be the first included</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token operator\">%</span>include <span class=\"token string\">\"../03-loader/32bit-gdt.asm\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">%</span>include <span class=\"token string\">\"32bit-print.asm\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">%</span>include <span class=\"token string\">\"../03-loader/32bit-switch.asm\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token operator\">[</span>bits <span class=\"token number\">32</span><span class=\"token operator\">]</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token label function\">BEGIN_PM:</span> <span class=\"token comment\">; after the switch we will get here</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    mov <span class=\"token register variable\">ebx</span>, MSG_PROT_MODE</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    call print_string_pm <span class=\"token comment\">; Note that this will be written at the top left corner</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    jmp <span class=\"token operator\">$</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>MSG_REAL_MODE db <span class=\"token string\">\"Started in 16-bit real mode\"</span>, <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>MSG_ERROR db <span class=\"token string\">\"Loaded 32-bit protected mode ERROR\"</span>, <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>MSG_PROT_MODE db <span class=\"token string\">\"Loaded 32-bit protected mode\"</span>, <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">; bootsector</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>times <span class=\"token number\">510</span><span class=\"token operator\">-</span>(<span class=\"token operator\">$</span><span class=\"token operator\">-</span><span class=\"token operator\">$</span><span class=\"token operator\">$</span>) db <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>dw <span class=\"token number\">0xaa55</span></pre></td></tr></table></figure></div></details>\n<p>编译并运行后，我们就可以看到打印出来的文字啦！</p>\n<p><img data-src=\"http://imgcdn.gality.cn/blog/ekfisv.png\" alt=\"VGA Text Mode Print\" /></p>\n<p>「我们之前说过，VGA Text Mode 的内存是对应终端的字符的，由于我们是在 <code>0xb8000</code>  开始处写的，所以打印的字符也会从终端最开始处开始，而且可以明显看出，VGA 下的打印出字体的白色会更凉一点，与 BIOS 的打印不同。」</p>\n<h1 id=\"参考\"><a class=\"anchor\" href=\"#参考\">#</a> 参考</h1>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVkdBX3RleHRfbW9kZQ==\">https://en.wikipedia.org/wiki/VGA_text_mode</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLm9zZGV2Lm9yZy9UZXh0X21vZGU=\">https://wiki.osdev.org/Text_mode</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpLm9zZGV2Lm9yZy9QcmludGluZ19Ub19TY3JlZW4=\">https://wiki.osdev.org/Printing_To_Screen</span></li>\n</ul>\n",
            "tags": [
                "操作系统",
                "从0到1",
                "操作系统",
                "系列长篇",
                "二进制基本功"
            ]
        }
    ]
}